
<!-- saved from url=(0112)file://localhost/Users/briandanielak/Dropbox/dev/GitDataCollection/analysis-tools/SampleVisualizationOutput.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style>
  a {
    font-size: 20pt;
  }

  td {
    vertical-align: top;
  }

  .changed {
    width: 100%;
    color: black;
    background: #00cc00;
  }

  .compileroutput {
    background: #cccccc;
    border: 1px ridge #999999;
    white-space: pre-wrap;
    font-family: monospace;
    display: block;
  }

</style>
</head><body><table><tbody><tr>
<td>
<a name=""></a>
 
<br>
<pre><span class="changed">53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data</span>
<span class="changed">a7114834 R/granovagg.ds.R        2   2) #'</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y</span>
<span class="changed">3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.</span>
<span class="changed">a7114834 R/granovagg.ds.R        6   6) #'</span>
<span class="changed">61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line</span>
<span class="changed">61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)</span>
<span class="changed">61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The</span>
<span class="changed">4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be</span>
<span class="changed">a7114834 R/granovagg.ds.R       23  23) #' accommodated.</span>
<span class="changed">a7114834 R/granovagg.ds.R       24  24) #'</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       32  32) #' analysis.</span>
<span class="changed">a7114834 R/granovagg.ds.R       33  33) #'</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.</span>
<span class="changed">892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is</span>
<span class="changed">d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.</span>
<span class="changed">f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications</span>
<span class="changed">485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not</span>
<span class="changed">485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.</span>
<span class="changed">485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not</span>
<span class="changed">485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.</span>
<span class="changed">a7114834 R/granovagg.ds.R       43  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test.</span>
<span class="changed">3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)</span>
<span class="changed">62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the</span>
<span class="changed">62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic</span>
<span class="changed">a7114834 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.</span>
<span class="changed">a7114834 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.</span>
<span class="changed">3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions</span>
<span class="changed">a7114834 R/granovagg.ds.R       54  54) #' @return Returns a plot object of class \code{ggplot}.</span>
<span class="changed">80f8f002 R/granovagg.ds.R       38  55) #'</span>
<span class="changed">a7114834 R/granovagg.ds.R       56  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr</span>
<span class="changed">80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}</span>
<span class="changed">80f8f002 R/granovagg.ds.R       41  58) #'</span>
<span class="changed">80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr</span>
<span class="changed">a7114834 R/granovagg.ds.R       60  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr</span>
<span class="changed">a7114834 R/granovagg.ds.R       61  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr</span>
<span class="changed">80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}</span>
<span class="changed">80f8f002 R/granovagg.ds.R       46  63) #'</span>
<span class="changed">48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},</span>
<span class="changed">9b70f3c2 R/granovagg.ds.R       65  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}}</span>
<span class="changed">48265964 R/granovagg.ds.R       61  66) #'</span>
<span class="changed">19d1b011 R/granovagg.ds.R       42  67) #' @example demo/granovagg.ds.R</span>
<span class="changed">8ca83f73 R/granovagg.ds.R       47  68) #' @export</span>
<span class="changed">be5c4c16 R/granovagg.ds.R       64  69) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.</span>
<span class="changed">795b19d3 R/granovagg.ds.R       60  70) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.</span>
<span class="changed">795b19d3 R/granovagg.ds.R       61  71) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.</span>
<span class="changed">f855a782 R/granovagg.ds.R       46  72) granovagg.ds &lt;- function(data       = NULL,</span>
<span class="changed">a7114834 R/granovagg.ds.R       74  73)                          revc       = FALSE,</span>
<span class="changed">e55d776c R/granovagg.ds.R       39  74)                          main       = "default_granova_title",</span>
<span class="changed">0afa3a38 R/granovagg.ds.R       40  75)                          xlab       = NULL,</span>
<span class="changed">485d5f02 R/granovagg.ds.R       42  76)                          ylab       = NULL,</span>
<span class="changed">e55d776c R/granovagg.ds.R       40  77)                          conf.level = 0.95,</span>
<span class="changed">3329011e R/granovagg.ds.R       50  78)                          plot.theme = "theme_granova_ds",</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       80  79)                          northeast.padding = 0,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       81  80)                          southwest.padding = 0,</span>
<span class="changed">3329011e R/granovagg.ds.R       51  81)                          ...</span>
<span class="changed">a7114834 R/granovagg.ds.R       83  82)                 )</span>
<span class="changed">be2e6fbd R/granova.ds.bd.R      19  83) </span>
<span class="changed">be2e6fbd R/granova.ds.bd.R      20  84) {</span>
<span class="changed">a7114834 R/granovagg.ds.R       86  85) </span>
<span class="changed">f855a782 R/granovagg.ds.R       58  86)   GetData &lt;- function(data) {</span>
<span class="changed">482de62f R/granovagg.ds.R       80  87)     data &lt;- CheckData(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       81  88)     data &lt;- ReverseXAndY(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       82  89)     data &lt;- EnsureDataHasColumnNames(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       83  90)     data &lt;- EnsureDataIsADataFrame(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       84  91)     return(data)</span>
<span class="changed">f855a782 R/granovagg.ds.R       62  92)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R       94  93) </span>
<span class="changed">f855a782 R/granovagg.ds.R       64  94)   CheckData &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       57  95)     IsDataNull(data)</span>
<span class="changed">544a88ef R/granovagg.ds.R       58  96)     IsDataInTwoColumnFormat(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       90  97)     return(data)</span>
<span class="changed">544a88ef R/granovagg.ds.R       60  98)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      100  99) </span>
<span class="changed">f855a782 R/granovagg.ds.R       70 100)   ReverseXAndY &lt;- function(data) {</span>
<span class="changed">f855a782 R/granovagg.ds.R       71 101)     output &lt;- data</span>
<span class="changed">f855a782 R/granovagg.ds.R       72 102)     if (revc) {</span>
<span class="changed">f855a782 R/granovagg.ds.R       73 103)       output[, 1] &lt;- data[, 2]</span>
<span class="changed">f855a782 R/granovagg.ds.R       74 104)       output[, 2] &lt;- data[, 1]</span>
<span class="changed">f855a782 R/granovagg.ds.R       75 105)       names(output) &lt;- names(data)[2:1]</span>
<span class="changed">f855a782 R/granovagg.ds.R       76 106)     }</span>
<span class="changed">f855a782 R/granovagg.ds.R       77 107)     return(output)</span>
<span class="changed">f855a782 R/granovagg.ds.R       78 108)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      110 109) </span>
<span class="changed">544a88ef R/granovagg.ds.R       62 110)   IsDataNull &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       63 111)     if (is.null(length(data))) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       64 112)       stop("It looks like you didn't pass any data to granovagg.ds")</span>
<span class="changed">544a88ef R/granovagg.ds.R       65 113)     }</span>
<span class="changed">544a88ef R/granovagg.ds.R       66 114)   }</span>
<span class="changed">544a88ef R/granovagg.ds.R       67 115) </span>
<span class="changed">544a88ef R/granovagg.ds.R       68 116)   IsDataInTwoColumnFormat &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       69 117)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."</span>
<span class="changed">544a88ef R/granovagg.ds.R       70 118)     if (is.null(dim(data))) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       71 119)       stop(message)</span>
<span class="changed">544a88ef R/granovagg.ds.R       72 120)     }</span>
<span class="changed">a7114834 R/granovagg.ds.R      122 121) </span>
<span class="changed">544a88ef R/granovagg.ds.R       74 122)     if (dim(data)[2] != 2) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       75 123)       stop(message)</span>
<span class="changed">544a88ef R/granovagg.ds.R       76 124)     }</span>
<span class="changed">544a88ef R/granovagg.ds.R       77 125)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      127 126) </span>
<span class="changed">544a88ef R/granovagg.ds.R       79 127)   EnsureDataIsADataFrame &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       80 128)     output &lt;- data</span>
<span class="changed">544a88ef R/granovagg.ds.R       81 129)     if (!is.data.frame(data)) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       82 130)       output &lt;- as.data.frame(output)</span>
<span class="changed">544a88ef R/granovagg.ds.R       83 131)     }</span>
<span class="changed">544a88ef R/granovagg.ds.R       84 132)     return(output)</span>
<span class="changed">544a88ef R/granovagg.ds.R       85 133)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      135 134) </span>
<span class="changed">482de62f R/granovagg.ds.R      128 135)   EnsureDataHasColumnNames &lt;- function(data) {</span>
<span class="changed">482de62f R/granovagg.ds.R      129 136)     output &lt;- data</span>
<span class="changed">482de62f R/granovagg.ds.R      130 137)     if (is.null(colnames(data))) {</span>
<span class="changed">482de62f R/granovagg.ds.R      131 138)       colnames(data) &lt;- c("x", "y")</span>
<span class="changed">482de62f R/granovagg.ds.R      132 139)     }</span>
<span class="changed">a7114834 R/granovagg.ds.R      141 140) </span>
<span class="changed">482de62f R/granovagg.ds.R      134 141)     return(data)</span>
<span class="changed">482de62f R/granovagg.ds.R      135 142)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      144 143) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R   9 144)   GetXs &lt;- function(data) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  10 145)     return(data[, 1])</span>
<span class="changed">e589a242 R/granova.ds.bd.R      12 146)   }</span>
<span class="changed">a806fcaa R/granova.ds.bd.R      15 147) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  13 148)   GetYs &lt;- function(data) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  14 149)     return(data[, 2])</span>
<span class="changed">e589a242 R/granova.ds.bd.R      16 150)   }</span>
<span class="changed">e589a242 R/granova.ds.bd.R      17 151) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  17 152)   GetEffect &lt;- function(dsp) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  18 153)     return(GetXs(dsp$data) - GetYs(dsp$data))</span>
<span class="changed">863d348b R/granova.ds.ggplot.R  21 154)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      156 155) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  21 156)   GetTtest &lt;- function(data, conf.level) {</span>
<span class="changed">a7114834 R/granovagg.ds.R      158 157)     return(t.test(data[, 1],</span>
<span class="changed">a7114834 R/granovagg.ds.R      159 158)                   data[, 2],</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  24 159)                   paired     = TRUE,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  25 160)                   conf.level = conf.level</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  26 161)                  )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  27 162)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R  30 163)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      165 164) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  30 165)   GetStats &lt;- function(dsp, conf.level) {</span>
<span class="changed">e603b053 R/granova.ds.ggplot.R  31 166)     ttest &lt;- GetTtest(dsp$data, conf.level)</span>
<span class="changed">e6196600 R/granova.ds.ggplot.R  32 167)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),</span>
<span class="changed">e6196600 R/granova.ds.ggplot.R  33 168)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),</span>
<span class="changed">e6196600 R/granova.ds.ggplot.R  34 169)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),</span>
<span class="changed">e6196600 R/granova.ds.ggplot.R  35 170)                       t.statistic            = as.numeric(ttest$statistic[1])</span>
<span class="changed">e6196600 R/granova.ds.ggplot.R  36 171)                      )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  38 172)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R  41 173)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      175 174) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  41 175)   GetGraphicsParams &lt;- function(dsp) {</span>
<span class="changed">e603b053 R/granova.ds.ggplot.R  42 176)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))</span>
<span class="changed">a7114834 R/granovagg.ds.R      178 177)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))</span>
<span class="changed">e603b053 R/granova.ds.ggplot.R  44 178)     .square.data.range     &lt;- max(.extrema) - min(.extrema)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  45 179)     .southwest.padding     &lt;- (65/100) * .square.data.range</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      181 180)     .northeast.padding     &lt;- (15/100) * .square.data.range</span>
<span class="changed">e603b053 R/granova.ds.ggplot.R  47 181)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      183 182)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  49 183)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  50 184)     .center                &lt;- mean(.bounds)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  51 185)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  52 186)     .shadow.offset         &lt;- (1/100)*.square.data.range</span>
<span class="changed">a7114834 R/granovagg.ds.R      188 187) </span>
<span class="changed">a7114834 R/granovagg.ds.R      189 188)     return(list(square.data.range = .square.data.range,</span>
<span class="changed">a7114834 R/granovagg.ds.R      190 189)                 bounds            = .bounds,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  56 190)                 shadow.offset     = .shadow.offset,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  57 191)                 anchor            = .crossbow.anchor,</span>
<span class="changed">8dc6cf2b R/granovagg.ds.R      193 192)                 point.size        = I(2.5),</span>
<span class="changed">a7114834 R/granovagg.ds.R      194 193)                 mean.line.size    = I(1/2)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  60 194)                )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  61 195)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R  64 196)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      198 197) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  64 198)   GetShadows &lt;- function(dsp) {</span>
<span class="changed">a7114834 R/granovagg.ds.R      200 199)     x.shadow &lt;- (dsp$effect / 2) +</span>
<span class="changed">a7114834 R/granovagg.ds.R      201 200)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 +</span>
<span class="changed">48638496 R/granova.ds.ggplot.R  67 201)                 (4 * dsp$params$shadow.offset)</span>
<span class="changed">e603b053 R/granova.ds.ggplot.R  68 202)     y.shadow &lt;- x.shadow - dsp$effect</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  69 203)     return(data.frame(x.shadow, y.shadow))</span>
<span class="changed">863d348b R/granova.ds.ggplot.R  72 204)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R  73 205) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  72 206)   GetCrossbow &lt;- function(dsp) {</span>
<span class="changed">48638496 R/granova.ds.ggplot.R  73 207)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),</span>
<span class="changed">48638496 R/granova.ds.ggplot.R  74 208)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),</span>
<span class="changed">48638496 R/granova.ds.ggplot.R  75 209)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),</span>
<span class="changed">48638496 R/granova.ds.ggplot.R  76 210)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  77 211)                      )</span>
<span class="changed">a7114834 R/granovagg.ds.R      213 212)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R  82 213)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      215 214) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  82 215)   GetCIBand &lt;- function(dsp) {</span>
<span class="changed">0d72518f R/granovagg.ds.R      159 216)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      160 217)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      161 218)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      162 219)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      163 220)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  87 221)                      )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  88 222)           )</span>
<span class="changed">a7114834 R/granovagg.ds.R      224 223) </span>
<span class="changed">863d348b R/granova.ds.ggplot.R  94 224)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      226 225) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R  94 226)   GetTreatmentLine &lt;- function(dsp) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  93 227)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  94 228)                       slope     = 1,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  95 229)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  96 230)                      )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R  97 231)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 103 232)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 104 233) </span>
<span class="changed">754a8540 R/granovagg.ds.R      177 234)   GetCrossElementCoordinates &lt;- function(dsp) {</span>
<span class="changed">754a8540 R/granovagg.ds.R      178 235)     crossbow &lt;- dsp$crossbow</span>
<span class="changed">754a8540 R/granovagg.ds.R      179 236)     ci.band  &lt;- subset(dsp$CIBand, select = -color)</span>
<span class="changed">754a8540 R/granovagg.ds.R      180 237)     output   &lt;- rbind(crossbow, ci.band)</span>
<span class="changed">754a8540 R/granovagg.ds.R      181 238)     return(output)</span>
<span class="changed">754a8540 R/granovagg.ds.R      182 239)   }</span>
<span class="changed">754a8540 R/granovagg.ds.R      183 240) </span>
<span class="changed">73167de2 R/granovagg.ds.R      184 241)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {</span>
<span class="changed">73167de2 R/granovagg.ds.R      185 242)     minimum &lt;- min(dsp$params$bounds,</span>
<span class="changed">73167de2 R/granovagg.ds.R      186 243)                    dsp$cross.elements$x,</span>
<span class="changed">73167de2 R/granovagg.ds.R      187 244)                    dsp$cross.elements$y.end</span>
<span class="changed">73167de2 R/granovagg.ds.R      188 245)                )</span>
<span class="changed">73167de2 R/granovagg.ds.R      189 246)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))</span>
<span class="changed">73167de2 R/granovagg.ds.R      190 247)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      249 248) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 103 249)   GetTrails &lt;- function(dsp) {</span>
<span class="changed">a7114834 R/granovagg.ds.R      251 250)     return(data.frame(x.trail.start = GetXs(dsp$data),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 102 251)                       y.trail.start = GetYs(dsp$data),</span>
<span class="changed">a7114834 R/granovagg.ds.R      253 252)                       x.trail.end   = GetXs(dsp$shadow),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 104 253)                       y.trail.end   = GetYs(dsp$shadow)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 105 254)                      )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 106 255)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 114 256)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      258 257) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 114 258)   GetColors &lt;- function(dsp) {</span>
<span class="changed">e883b72f R/granova.ds.ggplot.R 109 259)     return(list(treatment.line = "#542570",</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 111 260)                 rugplot        = "black",</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 112 261)                 mean.line      = "#542570",</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 113 262)                 CIBand         = "#33A02C",</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 114 263)                 crossbow       = "#377EB8"</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 115 264)                )</span>
<span class="changed">a7114834 R/granovagg.ds.R      266 265)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 125 266)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      268 267) </span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      250 268)   PrintSummary &lt;- function(dsp) {</span>
<span class="changed">1d932c76 R/granovagg.ds.R      251 269)     summary &lt;- GetPrintedSummary(dsp)</span>
<span class="changed">1d932c76 R/granovagg.ds.R      252 270)     summary &lt;- RenamePrintedSummaryRows(summary)</span>
<span class="changed">7315d685 R/granovagg.ds.R      253 271)     summary &lt;- round(summary, digits = 3)</span>
<span class="changed">a7114834 R/granovagg.ds.R      273 272) </span>
<span class="changed">1d932c76 R/granovagg.ds.R      254 273)     print(summary)</span>
<span class="changed">1d932c76 R/granovagg.ds.R      255 274)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      276 275) </span>
<span class="changed">1d932c76 R/granovagg.ds.R      257 276)   GetPrintedSummary &lt;- function(dsp) {</span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      251 277)     n &lt;- dim(dsp$data)[1]</span>
<span class="changed">c6634692 R/granovagg.ds.R      252 278)     mean.1 &lt;- mean(dsp$data[, 1])</span>
<span class="changed">c6634692 R/granovagg.ds.R      253 279)     mean.2 &lt;- mean(dsp$data[, 2])</span>
<span class="changed">d7e58513 R/granovagg.ds.R      254 280)     mean.d &lt;- mean.1 - mean.2</span>
<span class="changed">d7e58513 R/granovagg.ds.R      255 281)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])</span>
<span class="changed">48593231 R/granovagg.ds.R      256 282)     effect.size &lt;- (mean.d / standard.deviation.d)</span>
<span class="changed">eaf5611d R/granovagg.ds.R      257 283)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])</span>
<span class="changed">129861a6 R/granovagg.ds.R      258 284)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))</span>
<span class="changed">b36b6241 R/granovagg.ds.R      259 285)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect</span>
<span class="changed">2595918e R/granovagg.ds.R      260 286)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect</span>
<span class="changed">d543180b R/granovagg.ds.R      261 287)     t.value &lt;- dsp$t.test$statistic</span>
<span class="changed">f4c75a58 R/granovagg.ds.R      262 288)     degrees.of.freedom &lt;- dsp$t.test$parameter</span>
<span class="changed">d63415a6 R/granovagg.ds.R      263 289)     p.value &lt;- dsp$t.test$p.value</span>
<span class="changed">a7114834 R/granovagg.ds.R      291 290) </span>
<span class="changed">a7114834 R/granovagg.ds.R      292 291)     return(matrix(c(n,</span>
<span class="changed">a7114834 R/granovagg.ds.R      293 292)                     mean.1,</span>
<span class="changed">a7114834 R/granovagg.ds.R      294 293)                     mean.2,</span>
<span class="changed">a7114834 R/granovagg.ds.R      295 294)                     mean.d,</span>
<span class="changed">a7114834 R/granovagg.ds.R      296 295)                     standard.deviation.d,</span>
<span class="changed">a7114834 R/granovagg.ds.R      297 296)                     effect.size,</span>
<span class="changed">a7114834 R/granovagg.ds.R      298 297)                     r.xy,</span>
<span class="changed">a7114834 R/granovagg.ds.R      299 298)                     r.x.plus.y.d,</span>
<span class="changed">a7114834 R/granovagg.ds.R      300 299)                     lower.treatment.confidence,</span>
<span class="changed">a7114834 R/granovagg.ds.R      301 300)                     upper.treatment.confidence,</span>
<span class="changed">a7114834 R/granovagg.ds.R      302 301)                     t.value,</span>
<span class="changed">a7114834 R/granovagg.ds.R      303 302)                     degrees.of.freedom,</span>
<span class="changed">1d932c76 R/granovagg.ds.R      284 303)                     p.value</span>
<span class="changed">a7114834 R/granovagg.ds.R      305 304)                   ),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      286 305)                  ncol = 1</span>
<span class="changed">1d932c76 R/granovagg.ds.R      287 306)            )</span>
<span class="changed">1d932c76 R/granovagg.ds.R      288 307)     )</span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      255 308)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      310 309) </span>
<span class="changed">1d932c76 R/granovagg.ds.R      291 310)   RenamePrintedSummaryRows &lt;- function(summary) {</span>
<span class="changed">1d932c76 R/granovagg.ds.R      292 311)     dimnames(summary) &lt;- list(</span>
<span class="changed">a7114834 R/granovagg.ds.R      313 312)                            c("n",</span>
<span class="changed">a7114834 R/granovagg.ds.R      314 313)                              paste(colnames(dsp$data)[1], "mean"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      295 314)                              paste(colnames(dsp$data)[2], "mean"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      296 315)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      297 316)                              paste("SD(D)"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      298 317)                              paste("Effect Size"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      299 318)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      300 319)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),</span>
<span class="changed">bf3b02cb R/granovagg.ds.R      313 320)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),</span>
<span class="changed">bf3b02cb R/granovagg.ds.R      314 321)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      303 322)                              paste("t (D-bar)"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      304 323)                              paste("df.t"),</span>
<span class="changed">85bdd70d R/granovagg.ds.R      317 324)                              paste("p-value (t-statistic)")</span>
<span class="changed">1d932c76 R/granovagg.ds.R      306 325)                            ), "Summary Statistics")</span>
<span class="changed">a7114834 R/granovagg.ds.R      327 326) </span>
<span class="changed">1d932c76 R/granovagg.ds.R      308 327)     return(summary)</span>
<span class="changed">1d932c76 R/granovagg.ds.R      309 328)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      330 329) </span>
<span class="changed">f855a782 R/granovagg.ds.R      229 330)   dsp                &lt;- list(data = GetData(data))</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 120 331)   dsp$effect         &lt;- GetEffect(dsp)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 121 332)   dsp$stats          &lt;- GetStats(dsp, conf.level)</span>
<span class="changed">d543180b R/granovagg.ds.R      283 333)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)</span>
<span class="changed">e5f6a588 R/granova.ds.ggplot.R 122 334)   dsp$params         &lt;- GetGraphicsParams(dsp)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 123 335)   dsp$shadows        &lt;- GetShadows(dsp)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 124 336)   dsp$crossbow       &lt;- GetCrossbow(dsp)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 125 337)   dsp$CIBand         &lt;- GetCIBand(dsp)</span>
<span class="changed">754a8540 R/granovagg.ds.R      210 338)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)</span>
<span class="changed">73167de2 R/granovagg.ds.R      219 339)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)</span>
<span class="changed">e603b053 R/granova.ds.ggplot.R 132 340)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 127 341)   dsp$trails         &lt;- GetTrails(dsp)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 128 342)   dsp$colors         &lt;- GetColors(dsp)</span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      269 343)   PrintSummary(dsp)</span>
<span class="changed">a7114834 R/granovagg.ds.R      345 344) </span>
<span class="changed">a7114834 R/granovagg.ds.R      346 345) </span>
<span class="changed">863d348b R/granova.ds.ggplot.R 139 346) </span>
<span class="changed">863d348b R/granova.ds.ggplot.R 140 347)   # Because of the way ggplot2 creates plot objects, layers can be</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 141 348)   # added to a plot p simply by calling "p &lt;- p + newLayer"</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 142 349) </span>
<span class="changed">a7114834 R/granovagg.ds.R      351 350) </span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 142 351)   InitializeGgplot &lt;- function(dsp) {</span>
<span class="changed">c5a67319 R/granovagg.ds.R      345 352)     return(</span>
<span class="changed">c5a67319 R/granovagg.ds.R      346 353)       ggplot(</span>
<span class="changed">a7114834 R/granovagg.ds.R      355 354)         aes_string(x = dsp$data[1],</span>
<span class="changed">c5a67319 R/granovagg.ds.R      348 355)                    y = dsp$data[2]</span>
<span class="changed">c5a67319 R/granovagg.ds.R      349 356)         ), data = dsp$data</span>
<span class="changed">c5a67319 R/granovagg.ds.R      350 357)       )</span>
<span class="changed">c5a67319 R/granovagg.ds.R      351 358)     )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 152 359)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      361 360) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 152 361)   TreatmentLine &lt;- function(dsp) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 146 362)     return(geom_abline(aes(intercept = intercept,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 147 363)                            slope     = slope,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 148 364)                            color     = color</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 149 365)                           ),</span>
<span class="changed">fb9acd24 R/granova.ds.ggplot.R 149 366)                        alpha    = 0.5,</span>
<span class="changed">fb9acd24 R/granova.ds.ggplot.R 150 367)                        size     = I(1),</span>
<span class="changed">e883b72f R/granova.ds.ggplot.R 151 368)                        linetype = "dashed",</span>
<span class="changed">fb9acd24 R/granova.ds.ggplot.R 152 369)                        data     = dsp$treatment.line</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 153 370)                       )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 154 371)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 166 372)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 167 373) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 166 374)   RawData &lt;- function(dsp) {</span>
<span class="changed">48638496 R/granova.ds.ggplot.R 158 375)     return(geom_point(size = dsp$params$point.size))</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 173 376)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 174 377) </span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 173 378)   IdentityLine &lt;- function() {</span>
<span class="changed">a7114834 R/granovagg.ds.R      380 379)     return(geom_abline(slope     = 1,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 163 380)                        intercept = 0,</span>
<span class="changed">958f0c6c R/granova.ds.ggplot.R 164 381)                        alpha     = 0.75,</span>
<span class="changed">958f0c6c R/granova.ds.ggplot.R 165 382)                        size      = 1</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 165 383)                       )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 166 384)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 183 385)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 184 386) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 183 387)   ScaleX &lt;- function(dsp) {</span>
<span class="changed">48638496 R/granova.ds.ggplot.R 170 388)     return(scale_x_continuous(limits = dsp$params$bounds))</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 187 389)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 188 390) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 187 391)   ScaleY &lt;- function(dsp) {</span>
<span class="changed">48638496 R/granova.ds.ggplot.R 174 392)     return(scale_y_continuous(limits = dsp$params$bounds))</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 191 393)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      395 394) </span>
<span class="changed">0ae8f524 R/granovagg.ds.R      396 395)   PadViewingWindow &lt;- function(params) {</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      397 396)     ne.offset = params$square.data.range * southwest.padding</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      398 397)     sw.offset = params$square.data.range * northeast.padding</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      399 398)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)</span>
<span class="changed">a7114834 R/granovagg.ds.R      400 399) </span>
<span class="changed">0ae8f524 R/granovagg.ds.R      401 400)     return(</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      402 401)       coord_cartesian(xlim = padded.window,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      403 402)                       ylim = padded.window</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      404 403)       )</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      405 404)     )</span>
<span class="changed">a7114834 R/granovagg.ds.R      406 405)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 192 406) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 191 407)   RugPlot &lt;- function(dsp) {</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      409 408)     return(</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      410 409)       geom_rug(</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      411 410)         size  = I(1/2),</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      412 411)         alpha = I(1/3),</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      413 412)         color = dsp$colors$rugplot,</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      414 413)         sides = "tr", # top and right sides</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      415 414)         data  = dsp$data</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      416 415)       )</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      417 416)     )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 202 417)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 203 418) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 202 419)   XMeanLine &lt;- function(dsp) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 187 420)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 188 421)                       color      = dsp$colors$mean.line,</span>
<span class="changed">48638496 R/granova.ds.ggplot.R 189 422)                       size       = dsp$params$mean.line.size,</span>
<span class="changed">97cf9e88 R/granova.ds.ggplot.R 191 423)                       linetype   = "dashed",</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 190 424)                       alpha      = I(1/2)</span>
<span class="changed">a7114834 R/granovagg.ds.R      423 425)                      )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 192 426)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 213 427)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      426 428) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 213 429)   YMeanLine &lt;- function(dsp)  {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 196 430)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 197 431)                       color      = dsp$colors$mean.line,</span>
<span class="changed">48638496 R/granova.ds.ggplot.R 198 432)                       size       = dsp$params$mean.line.size,</span>
<span class="changed">97cf9e88 R/granova.ds.ggplot.R 201 433)                       linetype   = "dashed",</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 199 434)                       alpha      = I(1/2)</span>
<span class="changed">a7114834 R/granovagg.ds.R      433 435)                      )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 201 436)           )</span>
<span class="changed">a7114834 R/granovagg.ds.R      435 437) </span>
<span class="changed">863d348b R/granova.ds.ggplot.R 225 438)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 226 439) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 225 440)   Crossbow &lt;- function(dsp) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 206 441)     return(geom_segment(aes(x    = x,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 207 442)                             y    = y,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 208 443)                             xend = x.end,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 209 444)                             yend = y.end</span>
<span class="changed">a7114834 R/granovagg.ds.R      443 445)                            ),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 211 446)                         size  = I(3/4),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 212 447)                         alpha = I(3/4),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 213 448)                         color = dsp$colors$crossbow,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 214 449)                         data  = dsp$crossbow</span>
<span class="changed">a7114834 R/granovagg.ds.R      448 450)                        )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 216 451)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 242 452)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 243 453) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 242 454)   CIBand &lt;- function(dsp) {</span>
<span class="changed">7f8f9355 R/granovagg.ds.R      309 455)     return(geom_segment(aes(x     = x,</span>
<span class="changed">7f8f9355 R/granovagg.ds.R      310 456)                             y     = y,</span>
<span class="changed">0d72518f R/granovagg.ds.R      303 457)                             xend  = x.end,</span>
<span class="changed">a7114834 R/granovagg.ds.R      456 458)                             yend  = y.end,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 224 459)                             color = color</span>
<span class="changed">a7114834 R/granovagg.ds.R      458 460)                            ),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 226 461)                         size = I(2),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 227 462)                         data = dsp$CIBand</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 228 463)                        )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 229 464)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 258 465)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 259 466) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 258 467)   Shadows &lt;- function(dsp) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 233 468)     return(geom_point(aes(x = x.shadow,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 234 469)                           y = y.shadow</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 235 470)                          ),</span>
<span class="changed">a7114834 R/granovagg.ds.R      469 471)                       data  = dsp$shadow,</span>
<span class="changed">48638496 R/granova.ds.ggplot.R 237 472)                       size  = dsp$params$point.size,</span>
<span class="changed">72c2ef7a R/granova.ds.ggplot.R 241 473)                       shape = 16,</span>
<span class="changed">a7114834 R/granovagg.ds.R      472 474)                       alpha = I(1/2)</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 239 475)                      )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 240 476)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 272 477)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 273 478) </span>
<span class="changed">794c4b70 R/granova.ds.ggplot.R 272 479)   Trails &lt;- function(dsp) {</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 244 480)     return(geom_segment(aes(x    = x.trail.start,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 245 481)                             y    = y.trail.start,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 246 482)                             xend = x.trail.end,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 247 483)                             yend = y.trail.end</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 248 484)                            ),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 249 485)                         data     = dsp$trails,</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 250 486)                         size     = I(1/3),</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 251 487)                         color    = "black",</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 252 488)                         linetype = 1,</span>
<span class="changed">a7114834 R/granovagg.ds.R      487 489)                         alpha    = I(1/10)</span>
<span class="changed">a7114834 R/granovagg.ds.R      488 490)                        )</span>
<span class="changed">a71441d3 R/granova.ds.ggplot.R 255 491)           )</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 290 492)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 291 493) </span>
<span class="changed">ef841aa1 R/granova.ds.ggplot.R 257 494)   ColorScale &lt;- function(dsp) {</span>
<span class="changed">e603b053 R/granova.ds.ggplot.R 291 495)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)</span>
<span class="changed">a7114834 R/granovagg.ds.R      494 496) </span>
<span class="changed">52d9cc47 R/granovagg.ds.R      495 497)     return(scale_color_manual(values = colors, name = ""))</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 296 498)   }</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 297 499) </span>
<span class="changed">0afa3a38 R/granovagg.ds.R      306 500)   XLabel &lt;- function(dsp) {</span>
<span class="changed">5ede31eb R/granovagg.ds.R      316 501)     result &lt;- colnames(dsp$data)[1]</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      308 502)     if(!is.null(xlab)) {</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      309 503)       result &lt;- xlab</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      310 504)     }</span>
<span class="changed">a7114834 R/granovagg.ds.R      503 505) </span>
<span class="changed">0afa3a38 R/granovagg.ds.R      312 506)     return(xlab(result))</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      313 507)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      506 508) </span>
<span class="changed">485d5f02 R/granovagg.ds.R      317 509)   YLabel &lt;- function(dsp) {</span>
<span class="changed">5ede31eb R/granovagg.ds.R      325 510)     result &lt;- colnames(dsp$data)[2]</span>
<span class="changed">485d5f02 R/granovagg.ds.R      319 511)     if(!is.null(ylab)) {</span>
<span class="changed">485d5f02 R/granovagg.ds.R      320 512)       result &lt;- ylab</span>
<span class="changed">485d5f02 R/granovagg.ds.R      321 513)     }</span>
<span class="changed">a7114834 R/granovagg.ds.R      512 514) </span>
<span class="changed">485d5f02 R/granovagg.ds.R      323 515)     return(ylab(result))</span>
<span class="changed">485d5f02 R/granovagg.ds.R      324 516)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      515 517) </span>
<span class="changed">74d74c41 R/granovagg.ds.R      516 518)   Title &lt;- function(main) {</span>
<span class="changed">74d74c41 R/granovagg.ds.R      517 519)     output.title &lt;- "Dependent Sample Assessment Plot"</span>
<span class="changed">74d74c41 R/granovagg.ds.R      518 520)     if (main != "default_granova_title") {</span>
<span class="changed">74d74c41 R/granovagg.ds.R      519 521)       output.title &lt;- main</span>
<span class="changed">a2b6fe7d R/granovagg.ds.R      319 522)     }</span>
<span class="changed">a7114834 R/granovagg.ds.R      520 523) </span>
<span class="changed">74d74c41 R/granovagg.ds.R      522 524)     return(</span>
<span class="changed">74d74c41 R/granovagg.ds.R      523 525)       ggtitle(output.title)</span>
<span class="changed">74d74c41 R/granovagg.ds.R      524 526)     )</span>
<span class="changed">74d74c41 R/granovagg.ds.R      525 527) </span>
<span class="changed">863d348b R/granova.ds.ggplot.R 304 528)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      525 529) </span>
<span class="changed">b5b60529 R/granova.ds.ggplot.R 271 530)   ForceCoordinateAxesToBeEqual &lt;- function() {</span>
<span class="changed">9d259747 R/granovagg.ds.R      527 531)     return(coord_fixed(ratio = 1))</span>
<span class="changed">b5b60529 R/granova.ds.ggplot.R 273 532)   }</span>
<span class="changed">a7114834 R/granovagg.ds.R      529 533) </span>
<span class="changed">a7114834 R/granovagg.ds.R      530 534) </span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 304 535)   p &lt;- InitializeGgplot(dsp)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 305 536)   p &lt;- p + TreatmentLine(dsp)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 306 537)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 307 538)   p &lt;- p + Shadows(dsp)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 308 539)   p &lt;- p + Trails(dsp)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 309 540)   p &lt;- p + RawData(dsp)</span>
<span class="changed">3a2f0d25 R/granova.ds.ggplot.R 278 541)   p &lt;- p + Theme(plot.theme)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 311 542)   p &lt;- p + IdentityLine()</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 312 543)   p &lt;- p + RugPlot(dsp)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 313 544)   p &lt;- p + Crossbow(dsp)</span>
<span class="changed">863d348b R/granova.ds.ggplot.R 316 545)   p &lt;- p + CIBand(dsp)</span>
<span class="changed">ef841aa1 R/granova.ds.ggplot.R 287 546)   p &lt;- p + ColorScale(dsp)</span>
<span class="changed">3eb0e1f7 R/granova.ds.ggplot.R 316 547)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      545 548)   p &lt;- p + PadViewingWindow(dsp$params)</span>
<span class="changed">9d259747 R/granovagg.ds.R      545 549)   p &lt;- p + ForceCoordinateAxesToBeEqual()</span>
<span class="changed">74d74c41 R/granovagg.ds.R      548 550)   p &lt;- p + Title(main)</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      345 551)   p &lt;- p + XLabel(dsp)</span>
<span class="changed">485d5f02 R/granovagg.ds.R      357 552)   p &lt;- p + YLabel(dsp)</span>
<span class="changed">e589a242 R/granova.ds.bd.R     316 553) </span>
<span class="changed">482de62f R/granovagg.ds.R      528 554)   return(p)</span>
<span class="changed">5d58b37c R/granova.ds.bd.R     314 555) </span>
<span class="changed">b3a74c98 R/granova.ds.bd.R     301 556) }</span>
</pre>
<div class="compileroutput">
remove geom_rug_alt<p>Whitespace changes<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="ee1b067"></a>
ee1b067 2011-08-16 18:01:01 -0400
<br>
<pre><span class="changed">ee1b067f R/granovagg.ds.R        1   1) granovagg.ds &lt;- function(data       = NULL, </span>
3693776f R/granova.ds.ggplot.R   2   2)                               main       = "Dependent Sample Assessment Plot",
794c4b70 R/granova.ds.ggplot.R   3   3)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4   4)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5   5)                              ) 
be2e6fbd R/granova.ds.bd.R      19   6) 
be2e6fbd R/granova.ds.bd.R      20   7) {
d6c27487 R/granova.ds.bd.R      12   8)   
794c4b70 R/granova.ds.ggplot.R   9   9)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  10)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  11)   }
a806fcaa R/granova.ds.bd.R      15  12) 
794c4b70 R/granova.ds.ggplot.R  13  13)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  14)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  15)   }
e589a242 R/granova.ds.bd.R      17  16) 
794c4b70 R/granova.ds.ggplot.R  17  17)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  18)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  19)   }
c2605051 R/granova.ds.bd.R     182  20)   
794c4b70 R/granova.ds.ggplot.R  21  21)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  22)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  23)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  24)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  25)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  26)                  )
a71441d3 R/granova.ds.ggplot.R  27  27)           )
863d348b R/granova.ds.ggplot.R  30  28)   }
c2605051 R/granova.ds.bd.R     187  29)   
794c4b70 R/granova.ds.ggplot.R  30  30)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  31)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  32)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  33)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  34)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  35)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  36)                      )
a71441d3 R/granova.ds.ggplot.R  38  37)           )
863d348b R/granova.ds.ggplot.R  41  38)   }
c2605051 R/granova.ds.bd.R     191  39)   
794c4b70 R/granova.ds.ggplot.R  41  40)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  41)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  42)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  43)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  44)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  45)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  46)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  47)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  48)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  49)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  50)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  51)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  52)   
a71441d3 R/granova.ds.ggplot.R  54  53)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  54)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  55)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  56)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  57)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  58)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  59)                )
a71441d3 R/granova.ds.ggplot.R  61  60)           )
863d348b R/granova.ds.ggplot.R  64  61)   }
c2605051 R/granova.ds.bd.R     199  62)   
794c4b70 R/granova.ds.ggplot.R  64  63)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65  64)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66  65)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67  66)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68  67)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69  68)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72  69)   }
863d348b R/granova.ds.ggplot.R  73  70) 
794c4b70 R/granova.ds.ggplot.R  72  71)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73  72)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74  73)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75  74)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76  75)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77  76)                      )
a71441d3 R/granova.ds.ggplot.R  78  77)           )  
863d348b R/granova.ds.ggplot.R  82  78)   }
c2605051 R/granova.ds.bd.R     209  79)   
794c4b70 R/granova.ds.ggplot.R  82  80)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82  81)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83  82)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84  83)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85  84)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86  85)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87  86)                      )
a71441d3 R/granova.ds.ggplot.R  88  87)           )
5f570d2d R/granova.ds.bd.R     190  88)     
863d348b R/granova.ds.ggplot.R  94  89)   }
c2605051 R/granova.ds.bd.R     224  90)   
794c4b70 R/granova.ds.ggplot.R  94  91)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93  92)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94  93)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95  94)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96  95)                      )
a71441d3 R/granova.ds.ggplot.R  97  96)           )
863d348b R/granova.ds.ggplot.R 103  97)   }
863d348b R/granova.ds.ggplot.R 104  98) 
794c4b70 R/granova.ds.ggplot.R 103  99)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 100)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 101)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 102)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 103)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 104)                      )
a71441d3 R/granova.ds.ggplot.R 106 105)           )
863d348b R/granova.ds.ggplot.R 114 106)   }
c2605051 R/granova.ds.bd.R     239 107)   
794c4b70 R/granova.ds.ggplot.R 114 108)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 109)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 110)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 111)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 112)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 113)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 114)                )
a71441d3 R/granova.ds.ggplot.R 116 115)           )         
863d348b R/granova.ds.ggplot.R 125 116)   }
863d348b R/granova.ds.ggplot.R 126 117) 
48638496 R/granova.ds.ggplot.R 119 118)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 119)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 120)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 121)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 122)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 123)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 124)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 125)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 126)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 127)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 128)     
c2605051 R/granova.ds.bd.R     256 129)   
863d348b R/granova.ds.ggplot.R 139 130) 
863d348b R/granova.ds.ggplot.R 140 131)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 132)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 133) 
863d348b R/granova.ds.ggplot.R 143 134)   
3eb0e1f7 R/granova.ds.ggplot.R 142 135)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 136)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 137)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 138)                             ),
a71441d3 R/granova.ds.ggplot.R 140 139)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 140)                  )
863d348b R/granova.ds.ggplot.R 151 141)           )
863d348b R/granova.ds.ggplot.R 152 142)   }
e60e59e1 R/granova.ds.bd.R     241 143)     
794c4b70 R/granova.ds.ggplot.R 152 144)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 145)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 146)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 147)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 148)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 149)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 150)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 151)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 152)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 153)                       )
a71441d3 R/granova.ds.ggplot.R 154 154)           )
863d348b R/granova.ds.ggplot.R 166 155)   }
863d348b R/granova.ds.ggplot.R 167 156) 
794c4b70 R/granova.ds.ggplot.R 166 157)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 158)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 159)   }
863d348b R/granova.ds.ggplot.R 174 160) 
3eb0e1f7 R/granova.ds.ggplot.R 173 161)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 162)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 163)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 164)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 165)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 166)                       )
a71441d3 R/granova.ds.ggplot.R 166 167)           )
863d348b R/granova.ds.ggplot.R 183 168)   }
863d348b R/granova.ds.ggplot.R 184 169) 
794c4b70 R/granova.ds.ggplot.R 183 170)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 171)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 172)   }
863d348b R/granova.ds.ggplot.R 188 173) 
794c4b70 R/granova.ds.ggplot.R 187 174)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 175)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 176)   }
863d348b R/granova.ds.ggplot.R 192 177) 
794c4b70 R/granova.ds.ggplot.R 191 178)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 179)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 180)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 181)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 182)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 183)                    )  
a71441d3 R/granova.ds.ggplot.R 183 184)           )
863d348b R/granova.ds.ggplot.R 202 185)   }
863d348b R/granova.ds.ggplot.R 203 186) 
794c4b70 R/granova.ds.ggplot.R 202 187)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 188)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 189)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 190)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 191)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 192)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 193)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 194)           )
863d348b R/granova.ds.ggplot.R 213 195)   }
c2605051 R/granova.ds.bd.R     271 196)   
794c4b70 R/granova.ds.ggplot.R 213 197)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 198)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 199)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 200)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 201)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 202)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 203)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 204)           )
aaeade58 R/granova.ds.bd.R     274 205)     
863d348b R/granova.ds.ggplot.R 225 206)   }
863d348b R/granova.ds.ggplot.R 226 207) 
794c4b70 R/granova.ds.ggplot.R 225 208)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 209)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 210)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 211)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 212)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 213)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 214)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 215)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 216)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 217)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 218)                        )  
a71441d3 R/granova.ds.ggplot.R 216 219)           )
863d348b R/granova.ds.ggplot.R 242 220)   }
863d348b R/granova.ds.ggplot.R 243 221) 
794c4b70 R/granova.ds.ggplot.R 242 222)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 223)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 224)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 225)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 226)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 227)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 228)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 229)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 230)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 231)                        )
a71441d3 R/granova.ds.ggplot.R 229 232)           )
863d348b R/granova.ds.ggplot.R 258 233)   }
863d348b R/granova.ds.ggplot.R 259 234) 
794c4b70 R/granova.ds.ggplot.R 258 235)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 236)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 237)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 238)                          ),
a71441d3 R/granova.ds.ggplot.R 236 239)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 240)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 241)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 242)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 243)                      )
a71441d3 R/granova.ds.ggplot.R 240 244)           )
863d348b R/granova.ds.ggplot.R 272 245)   }
863d348b R/granova.ds.ggplot.R 273 246) 
794c4b70 R/granova.ds.ggplot.R 272 247)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 248)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 249)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 250)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 251)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 252)                            ),
a71441d3 R/granova.ds.ggplot.R 249 253)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 254)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 255)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 256)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 257)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 258)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 259)           )
863d348b R/granova.ds.ggplot.R 290 260)   }
863d348b R/granova.ds.ggplot.R 291 261) 
ef841aa1 R/granova.ds.ggplot.R 257 262)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 263)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 264)   
a71441d3 R/granova.ds.ggplot.R 261 265)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 266)   }
863d348b R/granova.ds.ggplot.R 297 267) 
794c4b70 R/granova.ds.ggplot.R 296 268)   Title &lt;- function() {
3a2f0d25 R/granova.ds.ggplot.R 264 269)     return(opts(title = main))
863d348b R/granova.ds.ggplot.R 304 270)   }
b5b60529 R/granova.ds.ggplot.R 270 271)   
b5b60529 R/granova.ds.ggplot.R 271 272)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 273)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 274)   }
b5b60529 R/granova.ds.ggplot.R 274 275)   
3b102930 R/granova.ds.ggplot.R 275 276)           
3eb0e1f7 R/granova.ds.ggplot.R 304 277)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 278)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 279)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 280)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 281)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 282)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 283)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 284)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 285)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 286)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 287)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 288)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 289)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 290)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 291)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 292) 
a71441d3 R/granova.ds.ggplot.R 288 293)   return(p)
5d58b37c R/granova.ds.bd.R     314 294) 
b3a74c98 R/granova.ds.bd.R     301 295) }
</pre>
<div class="compileroutput">
Changed references from granova.ds.ggplot to granovagg.1w<p></p><p><br>
</p></div>
</td>
<td>
<a name="743b4d6"></a>
743b4d6 2011-08-17 21:42:01 -0400
<br>
<pre><span class="changed">743b4d68 R/granovagg.ds.R        1   1) #' Graphic Display of Contrast Effect of ANOVA</span>
<span class="changed">743b4d68 R/granovagg.ds.R        2   2) #' </span>
<span class="changed">743b4d68 R/granovagg.ds.R        3   3) #' Provides graphic displays that shows data and effects for a priori contrasts</span>
<span class="changed">743b4d68 R/granovagg.ds.R        4   4) #' in ANOVA contexts; also corresponding numerical results.</span>
<span class="changed">743b4d68 R/granovagg.ds.R        5   5) #' </span>
<span class="changed">743b4d68 R/granovagg.ds.R        6   6) #' Function provides graphic displays of contrast effects for prespecified</span>
<span class="changed">743b4d68 R/granovagg.ds.R        7   7) #' contrasts in ANOVA. Data points are displayed as relevant for each contrast</span>
<span class="changed">743b4d68 R/granovagg.ds.R        8   8) #' based on comparing groups according to the positive and negative contrast</span>
<span class="changed">743b4d68 R/granovagg.ds.R        9   9) #' coefficients for each contrast on the horizontal axis, against response</span>
<span class="changed">743b4d68 R/granovagg.ds.R       10  10) #' values on the vertical axis. Data points corresponding to groups not being</span>
<span class="changed">743b4d68 R/granovagg.ds.R       11  11) #' compared in any contrast (coefficients of zero) are ignored. For each</span>
<span class="changed">743b4d68 R/granovagg.ds.R       12  12) #' contrast (generally as part of a 2 x 2 panel) a line segment is given that</span>
<span class="changed">743b4d68 R/granovagg.ds.R       13  13) #' compares the (weighted) mean of the response variable for the negative</span>
<span class="changed">743b4d68 R/granovagg.ds.R       14  14) #' coefficients versus the positive coefficients. Standardized contrasts are</span>
<span class="changed">743b4d68 R/granovagg.ds.R       15  15) #' used, wherein the sum of (magnitudes) of negative coefficients is unity; and</span>
<span class="changed">743b4d68 R/granovagg.ds.R       16  16) #' the same for positive coefficients. If a line is `notably' different from</span>
<span class="changed">743b4d68 R/granovagg.ds.R       17  17) #' horizontal (i.e. slope of zero), a `notable' effect has been identified;</span>
<span class="changed">743b4d68 R/granovagg.ds.R       18  18) #' however, the question of statistical significance generally depends on a</span>
<span class="changed">743b4d68 R/granovagg.ds.R       19  19) #' sound context-based estimate of standard error for the corresponding effect.</span>
<span class="changed">743b4d68 R/granovagg.ds.R       20  20) #' This means that while summary aov numerical results and test statistics are</span>
<span class="changed">743b4d68 R/granovagg.ds.R       21  21) #' presented (see below), the appropriateness of the default standard error</span>
<span class="changed">743b4d68 R/granovagg.ds.R       22  22) #' generally requires the analyst's judgment. The response values are to be</span>
<span class="changed">743b4d68 R/granovagg.ds.R       23  23) #' input in (a stacked) form, i.e. as a vector, for all cells (cf. arg. ylab).</span>
<span class="changed">743b4d68 R/granovagg.ds.R       24  24) #' The matrix of contrast vectors \code{contrasts} must have G rows (the number</span>
<span class="changed">743b4d68 R/granovagg.ds.R       25  25) #' of groups), and a number of columns equal to the number of prespecified</span>
<span class="changed">743b4d68 R/granovagg.ds.R       26  26) #' contrasts, at most G-1. If the number of columns of \code{contrasts} is G-1,</span>
<span class="changed">743b4d68 R/granovagg.ds.R       27  27) #' then the number per group, or cell size, is taken to be</span>
<span class="changed">743b4d68 R/granovagg.ds.R       28  28) #' \code{length(data)/G}, where \code{G = nrow(contrasts)}.</span>
<span class="changed">743b4d68 R/granovagg.ds.R       29  29) #' </span>
<span class="changed">743b4d68 R/granovagg.ds.R       30  30) #' If the number of columns of \code{contrasts} is less than G-1 then the user</span>
<span class="changed">743b4d68 R/granovagg.ds.R       31  31) #' must stipulate \code{npg}, the number in each group or cell.  The function</span>
<span class="changed">743b4d68 R/granovagg.ds.R       32  32) #' is designed for the case when all cell sizes are the same, and may be most</span>
<span class="changed">743b4d68 R/granovagg.ds.R       33  33) #' helpful when the a priori contrasts are mutually orthogonal (e.g., in power</span>
<span class="changed">743b4d68 R/granovagg.ds.R       34  34) #' of 2 designs, or their fractional counterparts; also when specific row or</span>
<span class="changed">743b4d68 R/granovagg.ds.R       35  35) #' column comparisons, or their interactions (see the example below based on</span>
<span class="changed">743b4d68 R/granovagg.ds.R       36  36) #' rat weight gain data)). It is not essential that contrasts be mutually</span>
<span class="changed">743b4d68 R/granovagg.ds.R       37  37) #' orthogonal; but mutual linear independence is required. (When factor levels</span>
<span class="changed">743b4d68 R/granovagg.ds.R       38  38) #' correspond to some underlying continuum a standard application might use</span>
<span class="changed">743b4d68 R/granovagg.ds.R       39  39) #' \code{con = contr.poly(G)}, for G the number of groups; consider also</span>
<span class="changed">743b4d68 R/granovagg.ds.R       40  40) #' \code{contr.helmert(G)}.)  The final plot in each application shows the data</span>
<span class="changed">743b4d68 R/granovagg.ds.R       41  41) #' for all groups or cells in the design, where groups are simply numbered from</span>
<span class="changed">743b4d68 R/granovagg.ds.R       42  42) #' 1:G, for G the number of groups, on the horizontal axis, versus the response</span>
<span class="changed">743b4d68 R/granovagg.ds.R       43  43) #' values on the vertical axis.</span>
<span class="changed">743b4d68 R/granovagg.ds.R       44  44) #' </span>
<span class="changed">743b4d68 R/granovagg.ds.R       45  45) #' @param data Vector of scores for all equally sized groups, or a data.fame or</span>
<span class="changed">743b4d68 R/granovagg.ds.R       46  46) #'   matrix where each column represents a group.</span>
<span class="changed">743b4d68 R/granovagg.ds.R       47  47) #' @param contrasts Matrix of column contrasts with dimensions (number of</span>
<span class="changed">743b4d68 R/granovagg.ds.R       48  48) #'   groups [G]) x (number of contrasts) [generally (G x G-1)].</span>
<span class="changed">743b4d68 R/granovagg.ds.R       49  49) #' @param ylab Character; y axis lable.</span>
<span class="changed">743b4d68 R/granovagg.ds.R       50  50) #' @param xlab Character vector of length number of contrast columns.  To name</span>
<span class="changed">743b4d68 R/granovagg.ds.R       51  51) #'   the specific contrast being made in all but last panel of graphic.</span>
<span class="changed">743b4d68 R/granovagg.ds.R       52  52) #'   Default = \code{NULL}</span>
<span class="changed">743b4d68 R/granovagg.ds.R       53  53) #' @param jj Numeric; controls \code{\link{jitter}} and confers the possibility</span>
<span class="changed">743b4d68 R/granovagg.ds.R       54  54) #'   of controlling the amount of jitter in the panel plots for the contrasts</span>
<span class="changed">743b4d68 R/granovagg.ds.R       55  55) #'   Default is 1.</span>
<span class="changed">743b4d68 R/granovagg.ds.R       56  56) #' @return Two sets of numerical results are presented: Weighted cell means for</span>
<span class="changed">743b4d68 R/granovagg.ds.R       57  57) #'   positive and negative coefficients for each a priori contrast, and summary</span>
<span class="changed">743b4d68 R/granovagg.ds.R       58  58) #'   results from \code{lm}.  \item{summary.lm}{Summary results for a linear</span>
<span class="changed">743b4d68 R/granovagg.ds.R       59  59) #'   model analysis based on the R function \code{lm} (When effects are simple,</span>
<span class="changed">743b4d68 R/granovagg.ds.R       60  60) #'   as in an equal n's power of 2 design, mean differences will generally</span>
<span class="changed">743b4d68 R/granovagg.ds.R       61  61) #'   correspond to the linear regression coefficients as seen in the \code{lm}</span>
<span class="changed">743b4d68 R/granovagg.ds.R       62  62) #'   summary results.)} \item{means.pos.neg.coeff}{table showing the (weighted)</span>
<span class="changed">743b4d68 R/granovagg.ds.R       63  63) #'   means for positive and negative coefficients for each (row) contrast, and</span>
<span class="changed">743b4d68 R/granovagg.ds.R       64  64) #'   for each row, the difference between these means in the final column}</span>
<span class="changed">743b4d68 R/granovagg.ds.R       65  65) #'   \item{means.pos.neg.coeff}{Table showing the (weighted) means for positive</span>
<span class="changed">743b4d68 R/granovagg.ds.R       66  66) #'   and negative coefficients for each (row) contrast, and for each row, the</span>
<span class="changed">743b4d68 R/granovagg.ds.R       67  67) #'   difference between these means, and the standardized effect size in the</span>
<span class="changed">743b4d68 R/granovagg.ds.R       68  68) #'   final column.} \item{contrasts}{Contrast matrix used.}</span>
<span class="changed">743b4d68 R/granovagg.ds.R       69  69) #'   \item{group.means.sds}{Group means and standard deviations.}</span>
<span class="changed">743b4d68 R/granovagg.ds.R       70  70) #'   \item{data}{Input data in matrix form.}</span>
ee1b067f R/granovagg.ds.R        1  71) granovagg.ds &lt;- function(data       = NULL, 
3693776f R/granova.ds.ggplot.R   2  72)                               main       = "Dependent Sample Assessment Plot",
794c4b70 R/granova.ds.ggplot.R   3  73)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  74)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  75)                              ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
794c4b70 R/granova.ds.ggplot.R   9  79)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  80)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  81)   }
a806fcaa R/granova.ds.bd.R      15  82) 
794c4b70 R/granova.ds.ggplot.R  13  83)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  84)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  85)   }
e589a242 R/granova.ds.bd.R      17  86) 
794c4b70 R/granova.ds.ggplot.R  17  87)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  88)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  89)   }
c2605051 R/granova.ds.bd.R     182  90)   
794c4b70 R/granova.ds.ggplot.R  21  91)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  92)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  93)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  94)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  95)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  96)                  )
a71441d3 R/granova.ds.ggplot.R  27  97)           )
863d348b R/granova.ds.ggplot.R  30  98)   }
c2605051 R/granova.ds.bd.R     187  99)   
794c4b70 R/granova.ds.ggplot.R  30 100)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 101)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 102)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 103)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 104)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 105)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 106)                      )
a71441d3 R/granova.ds.ggplot.R  38 107)           )
863d348b R/granova.ds.ggplot.R  41 108)   }
c2605051 R/granova.ds.bd.R     191 109)   
794c4b70 R/granova.ds.ggplot.R  41 110)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 111)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 112)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 113)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 114)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 115)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 116)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 117)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 118)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 119)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 120)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 121)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 122)   
a71441d3 R/granova.ds.ggplot.R  54 123)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 124)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 125)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 126)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 127)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 128)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 129)                )
a71441d3 R/granova.ds.ggplot.R  61 130)           )
863d348b R/granova.ds.ggplot.R  64 131)   }
c2605051 R/granova.ds.bd.R     199 132)   
794c4b70 R/granova.ds.ggplot.R  64 133)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 134)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 135)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 136)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 137)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 138)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 139)   }
863d348b R/granova.ds.ggplot.R  73 140) 
794c4b70 R/granova.ds.ggplot.R  72 141)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 142)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 143)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 144)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 145)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 146)                      )
a71441d3 R/granova.ds.ggplot.R  78 147)           )  
863d348b R/granova.ds.ggplot.R  82 148)   }
c2605051 R/granova.ds.bd.R     209 149)   
794c4b70 R/granova.ds.ggplot.R  82 150)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 151)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 152)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 153)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 154)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 155)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 156)                      )
a71441d3 R/granova.ds.ggplot.R  88 157)           )
5f570d2d R/granova.ds.bd.R     190 158)     
863d348b R/granova.ds.ggplot.R  94 159)   }
c2605051 R/granova.ds.bd.R     224 160)   
794c4b70 R/granova.ds.ggplot.R  94 161)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 162)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 163)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 164)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 165)                      )
a71441d3 R/granova.ds.ggplot.R  97 166)           )
863d348b R/granova.ds.ggplot.R 103 167)   }
863d348b R/granova.ds.ggplot.R 104 168) 
794c4b70 R/granova.ds.ggplot.R 103 169)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 170)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 171)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 172)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 173)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 174)                      )
a71441d3 R/granova.ds.ggplot.R 106 175)           )
863d348b R/granova.ds.ggplot.R 114 176)   }
c2605051 R/granova.ds.bd.R     239 177)   
794c4b70 R/granova.ds.ggplot.R 114 178)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 179)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 180)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 181)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 182)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 183)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 184)                )
a71441d3 R/granova.ds.ggplot.R 116 185)           )         
863d348b R/granova.ds.ggplot.R 125 186)   }
863d348b R/granova.ds.ggplot.R 126 187) 
48638496 R/granova.ds.ggplot.R 119 188)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 189)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 190)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 191)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 192)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 193)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 194)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 195)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 196)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 197)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 198)     
c2605051 R/granova.ds.bd.R     256 199)   
863d348b R/granova.ds.ggplot.R 139 200) 
863d348b R/granova.ds.ggplot.R 140 201)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 202)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 203) 
863d348b R/granova.ds.ggplot.R 143 204)   
3eb0e1f7 R/granova.ds.ggplot.R 142 205)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 206)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 207)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 208)                             ),
a71441d3 R/granova.ds.ggplot.R 140 209)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 210)                  )
863d348b R/granova.ds.ggplot.R 151 211)           )
863d348b R/granova.ds.ggplot.R 152 212)   }
e60e59e1 R/granova.ds.bd.R     241 213)     
794c4b70 R/granova.ds.ggplot.R 152 214)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 215)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 216)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 217)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 218)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 219)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 220)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 221)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 222)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 223)                       )
a71441d3 R/granova.ds.ggplot.R 154 224)           )
863d348b R/granova.ds.ggplot.R 166 225)   }
863d348b R/granova.ds.ggplot.R 167 226) 
794c4b70 R/granova.ds.ggplot.R 166 227)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 228)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 229)   }
863d348b R/granova.ds.ggplot.R 174 230) 
3eb0e1f7 R/granova.ds.ggplot.R 173 231)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 232)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 233)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 234)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 235)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 236)                       )
a71441d3 R/granova.ds.ggplot.R 166 237)           )
863d348b R/granova.ds.ggplot.R 183 238)   }
863d348b R/granova.ds.ggplot.R 184 239) 
794c4b70 R/granova.ds.ggplot.R 183 240)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 241)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 242)   }
863d348b R/granova.ds.ggplot.R 188 243) 
794c4b70 R/granova.ds.ggplot.R 187 244)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 245)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 246)   }
863d348b R/granova.ds.ggplot.R 192 247) 
794c4b70 R/granova.ds.ggplot.R 191 248)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 249)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 250)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 251)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 252)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 253)                    )  
a71441d3 R/granova.ds.ggplot.R 183 254)           )
863d348b R/granova.ds.ggplot.R 202 255)   }
863d348b R/granova.ds.ggplot.R 203 256) 
794c4b70 R/granova.ds.ggplot.R 202 257)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 258)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 259)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 260)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 261)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 262)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 263)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 264)           )
863d348b R/granova.ds.ggplot.R 213 265)   }
c2605051 R/granova.ds.bd.R     271 266)   
794c4b70 R/granova.ds.ggplot.R 213 267)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 268)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 269)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 270)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 271)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 272)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 273)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 274)           )
aaeade58 R/granova.ds.bd.R     274 275)     
863d348b R/granova.ds.ggplot.R 225 276)   }
863d348b R/granova.ds.ggplot.R 226 277) 
794c4b70 R/granova.ds.ggplot.R 225 278)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 279)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 280)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 281)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 282)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 283)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 284)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 285)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 286)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 287)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 288)                        )  
a71441d3 R/granova.ds.ggplot.R 216 289)           )
863d348b R/granova.ds.ggplot.R 242 290)   }
863d348b R/granova.ds.ggplot.R 243 291) 
794c4b70 R/granova.ds.ggplot.R 242 292)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 293)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 294)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 295)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 296)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 297)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 298)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 299)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 300)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 301)                        )
a71441d3 R/granova.ds.ggplot.R 229 302)           )
863d348b R/granova.ds.ggplot.R 258 303)   }
863d348b R/granova.ds.ggplot.R 259 304) 
794c4b70 R/granova.ds.ggplot.R 258 305)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 306)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 307)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 308)                          ),
a71441d3 R/granova.ds.ggplot.R 236 309)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 310)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 311)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 312)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 313)                      )
a71441d3 R/granova.ds.ggplot.R 240 314)           )
863d348b R/granova.ds.ggplot.R 272 315)   }
863d348b R/granova.ds.ggplot.R 273 316) 
794c4b70 R/granova.ds.ggplot.R 272 317)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 318)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 319)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 320)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 321)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 322)                            ),
a71441d3 R/granova.ds.ggplot.R 249 323)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 324)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 325)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 326)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 327)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 328)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 329)           )
863d348b R/granova.ds.ggplot.R 290 330)   }
863d348b R/granova.ds.ggplot.R 291 331) 
ef841aa1 R/granova.ds.ggplot.R 257 332)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 333)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 334)   
a71441d3 R/granova.ds.ggplot.R 261 335)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 336)   }
863d348b R/granova.ds.ggplot.R 297 337) 
794c4b70 R/granova.ds.ggplot.R 296 338)   Title &lt;- function() {
3a2f0d25 R/granova.ds.ggplot.R 264 339)     return(opts(title = main))
863d348b R/granova.ds.ggplot.R 304 340)   }
b5b60529 R/granova.ds.ggplot.R 270 341)   
b5b60529 R/granova.ds.ggplot.R 271 342)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 343)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 344)   }
b5b60529 R/granova.ds.ggplot.R 274 345)   
3b102930 R/granova.ds.ggplot.R 275 346)           
3eb0e1f7 R/granova.ds.ggplot.R 304 347)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 348)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 349)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 350)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 351)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 352)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 353)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 354)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 355)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 356)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 357)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 358)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 359)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 360)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 361)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 362) 
a71441d3 R/granova.ds.ggplot.R 288 363)   return(p)
5d58b37c R/granova.ds.bd.R     314 364) 
b3a74c98 R/granova.ds.bd.R     301 365) }
</pre>
<div class="compileroutput">
pasted granovagg.ds roxygen documentation (output from running granova through Rd2roxygen)<p></p><p><br>
</p></div>
</td>
<td>
<a name="2b0c8b8"></a>
2b0c8b8 2011-08-17 21:43:41 -0400
<br>
<pre><span class="changed">2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data</span>
743b4d68 R/granovagg.ds.R        2   2) #' 
<span class="changed">2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores. Also prints various</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R        6   6) #' summary statistics including: effect size, means for X and Y, a 95%</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R        7   7) #' confidence interval for the mean difference as well as the t-statistic and</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R        8   8) #' degrees of freedom.</span>
743b4d68 R/granovagg.ds.R        5   9) #' 
<span class="changed">2b0c8b84 R/granovagg.ds.R       10  10) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       11  11) #' (for Y=X) is drawn. Since the better data view often entails having X's &gt;</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       12  12) #' Y's the revc argument facilitates reversal of the X, Y specifications.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       13  13) #' Parallel projections of data points to (a lower-left) line segment show how</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       14  14) #' each point relates to its X-Y = D difference; blue `crosses' are used to</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       15  15) #' display the distribution of difference scores and the mean difference is</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       16  16) #' displayed as a heavy dashed (red) line, parallel to the identity reference</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       17  17) #' line. Means for X and Y are also plotted (as thin dashed vertical and</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       18  18) #' horizontal lines), and rug plots are shown for the distributions of X (at</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       19  19) #' the top of graphic) and Y (on the right side). Several summary statistics</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       20  20) #' are plotted as well, to facilitate both description and inference; see</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       21  21) #' below. The 95% confidence interval for the population mean difference is</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       22  22) #' also shown graphically.  Because all data points are plotted relative to the</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       23  23) #' identity line, and summary results are shown graphically, clusters, data</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       24  24) #' trends, outliers, and possible uses of transformations are readily seen,</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       25  25) #' possibly to be accommodated.</span>
743b4d68 R/granovagg.ds.R       29  26) #' 
<span class="changed">2b0c8b84 R/granovagg.ds.R       27  27) #' @param data is an n X 2 dataframe or matrix. First column defines X</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       28  28) #'   (intially for horzontal axis), the second defines Y.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       29  29) #' @param revc reverses X,Y specifications.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       30  30) #' @param sw extends axes toward lower left, effectively moving data points to</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       31  31) #'   the southwest.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       32  32) #' @param ne extends axes toward upper right, effectively moving data points to</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       33  33) #'   northeast. Making both sw and ne smaller moves points farther apart, while</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       34  34) #'   making both larger moves data points closer together.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       35  35) #' @param ptpch controls the pch of the (X,Y) points and of differences score</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       36  36) #'   points.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       37  37) #' @param ptcex controls the cex of the (X,Y) points and of differences score</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       38  38) #'   points.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       39  39) #' @param labcex controls size of axes labels.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       40  40) #' @param ident logical, default FALSE. Allows user to identify individual</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       41  41) #'   points.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       42  42) #' @param colors vector defining colors of six components of the plot: (X,Y)</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       43  43) #'   points, horizontal and vertical dashed lines representing means of the two</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       44  44) #'   groups, light dashed diagonal lines connecting (X,Y) points and</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       45  45) #'   projections differences dotplot, differences arranged as a dotplot, heavy</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       46  46) #'   dashed diagonal line representing the mean of differences, confidence</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       47  47) #'   interval.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       48  48) #' @param pt.lab optional character vector defining labels for points.  Only</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       49  49) #'   used if ident is TRUE.  If NULL, rownames(data) are used if available; if</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       50  50) #'   not 1:n is used.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       51  51) #' @param xlab optional label (as character) for horizontal axis. If not</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       52  52) #'   defined, axis labels are taken from colnames of data.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       53  53) #' @param ylab optional label (as character) for vertical axis.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       54  54) #' @param main optional main title (as character); if not supplied by user</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       55  55) #'   generic title is provided.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       56  56) #' @param sub optional subtile (as character).</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       57  57) #' @param par.orig returns par to original settings; if multipanel plots it is</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       58  58) #'   advisable to specify FALSE.</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       59  59) #' @return A list is returned with the following components:</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       60  60) #'   \item{mean(X)}{Mean of X values} \item{mean(Y)}{Mean of Y values}</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       61  61) #'   \item{mean(D=X-Y)}{Mean of differences D = X - Y} \item{SD(D)}{Standard</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       62  62) #'   deviation of differences D} \item{ES(D)}{Effect Size for differences D:</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       63  63) #'   mean(D)/SD(D)} \item{r(X,Y)}{Correlation based on X,Y pairs}</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       64  64) #'   \item{r(x+y,D)}{Correlation based on X+Y,D pairs} \item{LL 95%CI}{Lower</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       65  65) #'   bound for 95% confidence interval for population mean(D)} \item{UL</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       66  66) #'   95%CI}{Upper bound for 95% confidence interval for population mean(D)}</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       67  67) #'   \item{t(D-bar)}{t-statistic associated w/ test of hypothesis that</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       68  68) #'   population mean(D) = 0.0} \item{df.t}{Degrees of freedom for the</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       69  69) #'   t-statistic} \item{pval.t}{P-value for two sided t-test of null hypothesis</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       70  70) #'   that population mean(D) does not equal zero.}</span>
<span class="changed">2b0c8b84 R/granovagg.ds.R       71  71) </span>
ee1b067f R/granovagg.ds.R        1  72) granovagg.ds &lt;- function(data       = NULL, 
3693776f R/granova.ds.ggplot.R   2  73)                               main       = "Dependent Sample Assessment Plot",
794c4b70 R/granova.ds.ggplot.R   3  74)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  75)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  76)                              ) 
be2e6fbd R/granova.ds.bd.R      19  77) 
be2e6fbd R/granova.ds.bd.R      20  78) {
d6c27487 R/granova.ds.bd.R      12  79)   
794c4b70 R/granova.ds.ggplot.R   9  80)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  81)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  82)   }
a806fcaa R/granova.ds.bd.R      15  83) 
794c4b70 R/granova.ds.ggplot.R  13  84)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  85)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  86)   }
e589a242 R/granova.ds.bd.R      17  87) 
794c4b70 R/granova.ds.ggplot.R  17  88)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  89)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  90)   }
c2605051 R/granova.ds.bd.R     182  91)   
794c4b70 R/granova.ds.ggplot.R  21  92)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  93)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  94)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  95)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  96)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  97)                  )
a71441d3 R/granova.ds.ggplot.R  27  98)           )
863d348b R/granova.ds.ggplot.R  30  99)   }
c2605051 R/granova.ds.bd.R     187 100)   
794c4b70 R/granova.ds.ggplot.R  30 101)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 102)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 103)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 104)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 105)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 106)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 107)                      )
a71441d3 R/granova.ds.ggplot.R  38 108)           )
863d348b R/granova.ds.ggplot.R  41 109)   }
c2605051 R/granova.ds.bd.R     191 110)   
794c4b70 R/granova.ds.ggplot.R  41 111)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 112)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 113)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 114)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 115)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 116)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 117)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 118)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 119)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 120)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 121)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 122)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 123)   
a71441d3 R/granova.ds.ggplot.R  54 124)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 125)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 126)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 127)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 128)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 129)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 130)                )
a71441d3 R/granova.ds.ggplot.R  61 131)           )
863d348b R/granova.ds.ggplot.R  64 132)   }
c2605051 R/granova.ds.bd.R     199 133)   
794c4b70 R/granova.ds.ggplot.R  64 134)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 135)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 136)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 137)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 138)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 139)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 140)   }
863d348b R/granova.ds.ggplot.R  73 141) 
794c4b70 R/granova.ds.ggplot.R  72 142)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 143)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 144)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 145)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 146)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 147)                      )
a71441d3 R/granova.ds.ggplot.R  78 148)           )  
863d348b R/granova.ds.ggplot.R  82 149)   }
c2605051 R/granova.ds.bd.R     209 150)   
794c4b70 R/granova.ds.ggplot.R  82 151)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 152)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 153)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 154)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 155)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 156)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 157)                      )
a71441d3 R/granova.ds.ggplot.R  88 158)           )
5f570d2d R/granova.ds.bd.R     190 159)     
863d348b R/granova.ds.ggplot.R  94 160)   }
c2605051 R/granova.ds.bd.R     224 161)   
794c4b70 R/granova.ds.ggplot.R  94 162)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 163)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 164)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 165)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 166)                      )
a71441d3 R/granova.ds.ggplot.R  97 167)           )
863d348b R/granova.ds.ggplot.R 103 168)   }
863d348b R/granova.ds.ggplot.R 104 169) 
794c4b70 R/granova.ds.ggplot.R 103 170)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 171)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 172)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 173)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 174)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 175)                      )
a71441d3 R/granova.ds.ggplot.R 106 176)           )
863d348b R/granova.ds.ggplot.R 114 177)   }
c2605051 R/granova.ds.bd.R     239 178)   
794c4b70 R/granova.ds.ggplot.R 114 179)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 180)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 181)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 182)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 183)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 184)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 185)                )
a71441d3 R/granova.ds.ggplot.R 116 186)           )         
863d348b R/granova.ds.ggplot.R 125 187)   }
863d348b R/granova.ds.ggplot.R 126 188) 
48638496 R/granova.ds.ggplot.R 119 189)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 190)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 191)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 192)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 193)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 194)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 195)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 196)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 197)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 198)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 199)     
c2605051 R/granova.ds.bd.R     256 200)   
863d348b R/granova.ds.ggplot.R 139 201) 
863d348b R/granova.ds.ggplot.R 140 202)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 203)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 204) 
863d348b R/granova.ds.ggplot.R 143 205)   
3eb0e1f7 R/granova.ds.ggplot.R 142 206)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 207)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 208)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 209)                             ),
a71441d3 R/granova.ds.ggplot.R 140 210)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 211)                  )
863d348b R/granova.ds.ggplot.R 151 212)           )
863d348b R/granova.ds.ggplot.R 152 213)   }
e60e59e1 R/granova.ds.bd.R     241 214)     
794c4b70 R/granova.ds.ggplot.R 152 215)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 216)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 217)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 218)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 219)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 220)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 221)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 222)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 223)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 224)                       )
a71441d3 R/granova.ds.ggplot.R 154 225)           )
863d348b R/granova.ds.ggplot.R 166 226)   }
863d348b R/granova.ds.ggplot.R 167 227) 
794c4b70 R/granova.ds.ggplot.R 166 228)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 229)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 230)   }
863d348b R/granova.ds.ggplot.R 174 231) 
3eb0e1f7 R/granova.ds.ggplot.R 173 232)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 233)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 234)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 235)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 236)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 237)                       )
a71441d3 R/granova.ds.ggplot.R 166 238)           )
863d348b R/granova.ds.ggplot.R 183 239)   }
863d348b R/granova.ds.ggplot.R 184 240) 
794c4b70 R/granova.ds.ggplot.R 183 241)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 242)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 243)   }
863d348b R/granova.ds.ggplot.R 188 244) 
794c4b70 R/granova.ds.ggplot.R 187 245)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 246)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 247)   }
863d348b R/granova.ds.ggplot.R 192 248) 
794c4b70 R/granova.ds.ggplot.R 191 249)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 250)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 251)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 252)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 253)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 254)                    )  
a71441d3 R/granova.ds.ggplot.R 183 255)           )
863d348b R/granova.ds.ggplot.R 202 256)   }
863d348b R/granova.ds.ggplot.R 203 257) 
794c4b70 R/granova.ds.ggplot.R 202 258)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 259)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 260)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 261)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 262)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 263)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 264)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 265)           )
863d348b R/granova.ds.ggplot.R 213 266)   }
c2605051 R/granova.ds.bd.R     271 267)   
794c4b70 R/granova.ds.ggplot.R 213 268)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 269)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 270)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 271)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 272)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 273)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 274)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 275)           )
aaeade58 R/granova.ds.bd.R     274 276)     
863d348b R/granova.ds.ggplot.R 225 277)   }
863d348b R/granova.ds.ggplot.R 226 278) 
794c4b70 R/granova.ds.ggplot.R 225 279)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 280)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 281)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 282)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 283)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 284)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 285)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 286)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 287)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 288)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 289)                        )  
a71441d3 R/granova.ds.ggplot.R 216 290)           )
863d348b R/granova.ds.ggplot.R 242 291)   }
863d348b R/granova.ds.ggplot.R 243 292) 
794c4b70 R/granova.ds.ggplot.R 242 293)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 294)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 295)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 296)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 297)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 298)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 299)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 300)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 301)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 302)                        )
a71441d3 R/granova.ds.ggplot.R 229 303)           )
863d348b R/granova.ds.ggplot.R 258 304)   }
863d348b R/granova.ds.ggplot.R 259 305) 
794c4b70 R/granova.ds.ggplot.R 258 306)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 307)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 308)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 309)                          ),
a71441d3 R/granova.ds.ggplot.R 236 310)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 311)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 312)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 313)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 314)                      )
a71441d3 R/granova.ds.ggplot.R 240 315)           )
863d348b R/granova.ds.ggplot.R 272 316)   }
863d348b R/granova.ds.ggplot.R 273 317) 
794c4b70 R/granova.ds.ggplot.R 272 318)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 319)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 320)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 321)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 322)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 323)                            ),
a71441d3 R/granova.ds.ggplot.R 249 324)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 325)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 326)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 327)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 328)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 329)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 330)           )
863d348b R/granova.ds.ggplot.R 290 331)   }
863d348b R/granova.ds.ggplot.R 291 332) 
ef841aa1 R/granova.ds.ggplot.R 257 333)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 334)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 335)   
a71441d3 R/granova.ds.ggplot.R 261 336)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 337)   }
863d348b R/granova.ds.ggplot.R 297 338) 
794c4b70 R/granova.ds.ggplot.R 296 339)   Title &lt;- function() {
3a2f0d25 R/granova.ds.ggplot.R 264 340)     return(opts(title = main))
863d348b R/granova.ds.ggplot.R 304 341)   }
b5b60529 R/granova.ds.ggplot.R 270 342)   
b5b60529 R/granova.ds.ggplot.R 271 343)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 344)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 345)   }
b5b60529 R/granova.ds.ggplot.R 274 346)   
3b102930 R/granova.ds.ggplot.R 275 347)           
3eb0e1f7 R/granova.ds.ggplot.R 304 348)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 349)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 350)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 351)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 352)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 353)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 354)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 355)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 356)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 357)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 358)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 359)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 360)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 361)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 362)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 363) 
a71441d3 R/granova.ds.ggplot.R 288 364)   return(p)
5d58b37c R/granova.ds.bd.R     314 365) 
b3a74c98 R/granova.ds.bd.R     301 366) }
</pre>
<div class="compileroutput">
Previous commit had inadvertently pasted documentation for granova.contr. granovagg.ds documentation is now from the original ds function.<p></p><p><br>
</p></div>
</td>
<td>
<a name="56bb21d"></a>
56bb21d 2011-08-17 21:57:46 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
2b0c8b84 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores. Also prints various
<span class="changed">56bb21d6 R/granovagg.ds.R        6   6) #' summary statistics including: effect size, means for X and Y, a 95\%</span>
2b0c8b84 R/granovagg.ds.R        7   7) #' confidence interval for the mean difference as well as the t-statistic and
2b0c8b84 R/granovagg.ds.R        8   8) #' degrees of freedom.
743b4d68 R/granovagg.ds.R        5   9) #' 
2b0c8b84 R/granovagg.ds.R       10  10) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
2b0c8b84 R/granovagg.ds.R       11  11) #' (for Y=X) is drawn. Since the better data view often entails having X's &gt;
2b0c8b84 R/granovagg.ds.R       12  12) #' Y's the revc argument facilitates reversal of the X, Y specifications.
2b0c8b84 R/granovagg.ds.R       13  13) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  14) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  15) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  16) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  17) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  18) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  19) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  20) #' are plotted as well, to facilitate both description and inference; see
<span class="changed">56bb21d6 R/granovagg.ds.R       21  21) #' below. The 95\% confidence interval for the population mean difference is</span>
2b0c8b84 R/granovagg.ds.R       22  22) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  23) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  24) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  25) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  26) #' 
2b0c8b84 R/granovagg.ds.R       27  27) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  28) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  29) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  30) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  31) #' @param ylab optional label (as character) for vertical axis.
2b0c8b84 R/granovagg.ds.R       54  32) #' @param main optional main title (as character); if not supplied by user
2b0c8b84 R/granovagg.ds.R       55  33) #'   generic title is provided.
2b0c8b84 R/granovagg.ds.R       59  34) #' @return A list is returned with the following components:
2b0c8b84 R/granovagg.ds.R       60  35) #'   \item{mean(X)}{Mean of X values} \item{mean(Y)}{Mean of Y values}
2b0c8b84 R/granovagg.ds.R       61  36) #'   \item{mean(D=X-Y)}{Mean of differences D = X - Y} \item{SD(D)}{Standard
2b0c8b84 R/granovagg.ds.R       62  37) #'   deviation of differences D} \item{ES(D)}{Effect Size for differences D:
2b0c8b84 R/granovagg.ds.R       63  38) #'   mean(D)/SD(D)} \item{r(X,Y)}{Correlation based on X,Y pairs}
<span class="changed">56bb21d6 R/granovagg.ds.R       39  39) #'   \item{r(x+y,D)}{Correlation based on X+Y,D pairs} \item{LL 95\%CI}{Lower</span>
<span class="changed">56bb21d6 R/granovagg.ds.R       40  40) #'   bound for 95\% confidence interval for population mean(D)} \item{UL</span>
<span class="changed">56bb21d6 R/granovagg.ds.R       41  41) #'   95\%CI}{Upper bound for 95\% confidence interval for population mean(D)}</span>
2b0c8b84 R/granovagg.ds.R       67  42) #'   \item{t(D-bar)}{t-statistic associated w/ test of hypothesis that
2b0c8b84 R/granovagg.ds.R       68  43) #'   population mean(D) = 0.0} \item{df.t}{Degrees of freedom for the
2b0c8b84 R/granovagg.ds.R       69  44) #'   t-statistic} \item{pval.t}{P-value for two sided t-test of null hypothesis
2b0c8b84 R/granovagg.ds.R       70  45) #'   that population mean(D) does not equal zero.}
<span class="changed">56bb21d6 R/granovagg.ds.R       46  46) #' @examples NULL</span>
2b0c8b84 R/granovagg.ds.R       71  47) 
ee1b067f R/granovagg.ds.R        1  48) granovagg.ds &lt;- function(data       = NULL, 
3693776f R/granova.ds.ggplot.R   2  49)                               main       = "Dependent Sample Assessment Plot",
794c4b70 R/granova.ds.ggplot.R   3  50)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  51)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  52)                              ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
794c4b70 R/granova.ds.ggplot.R   9  56)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  57)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  58)   }
a806fcaa R/granova.ds.bd.R      15  59) 
794c4b70 R/granova.ds.ggplot.R  13  60)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  61)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  62)   }
e589a242 R/granova.ds.bd.R      17  63) 
794c4b70 R/granova.ds.ggplot.R  17  64)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  65)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  66)   }
c2605051 R/granova.ds.bd.R     182  67)   
794c4b70 R/granova.ds.ggplot.R  21  68)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  69)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  70)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  71)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  72)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  73)                  )
a71441d3 R/granova.ds.ggplot.R  27  74)           )
863d348b R/granova.ds.ggplot.R  30  75)   }
c2605051 R/granova.ds.bd.R     187  76)   
794c4b70 R/granova.ds.ggplot.R  30  77)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  78)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  79)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  80)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  81)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  82)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  83)                      )
a71441d3 R/granova.ds.ggplot.R  38  84)           )
863d348b R/granova.ds.ggplot.R  41  85)   }
c2605051 R/granova.ds.bd.R     191  86)   
794c4b70 R/granova.ds.ggplot.R  41  87)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  88)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  89)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  90)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  91)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  92)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  93)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  94)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  95)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  96)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  97)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  98)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  99)   
a71441d3 R/granova.ds.ggplot.R  54 100)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 101)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 102)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 103)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 104)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 105)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 106)                )
a71441d3 R/granova.ds.ggplot.R  61 107)           )
863d348b R/granova.ds.ggplot.R  64 108)   }
c2605051 R/granova.ds.bd.R     199 109)   
794c4b70 R/granova.ds.ggplot.R  64 110)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 111)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 112)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 113)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 114)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 115)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 116)   }
863d348b R/granova.ds.ggplot.R  73 117) 
794c4b70 R/granova.ds.ggplot.R  72 118)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 119)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 120)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 121)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 122)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 123)                      )
a71441d3 R/granova.ds.ggplot.R  78 124)           )  
863d348b R/granova.ds.ggplot.R  82 125)   }
c2605051 R/granova.ds.bd.R     209 126)   
794c4b70 R/granova.ds.ggplot.R  82 127)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 128)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 129)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 130)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 131)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 132)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 133)                      )
a71441d3 R/granova.ds.ggplot.R  88 134)           )
5f570d2d R/granova.ds.bd.R     190 135)     
863d348b R/granova.ds.ggplot.R  94 136)   }
c2605051 R/granova.ds.bd.R     224 137)   
794c4b70 R/granova.ds.ggplot.R  94 138)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 139)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 140)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 141)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 142)                      )
a71441d3 R/granova.ds.ggplot.R  97 143)           )
863d348b R/granova.ds.ggplot.R 103 144)   }
863d348b R/granova.ds.ggplot.R 104 145) 
794c4b70 R/granova.ds.ggplot.R 103 146)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 147)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 148)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 149)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 150)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 151)                      )
a71441d3 R/granova.ds.ggplot.R 106 152)           )
863d348b R/granova.ds.ggplot.R 114 153)   }
c2605051 R/granova.ds.bd.R     239 154)   
794c4b70 R/granova.ds.ggplot.R 114 155)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 156)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 157)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 158)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 159)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 160)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 161)                )
a71441d3 R/granova.ds.ggplot.R 116 162)           )         
863d348b R/granova.ds.ggplot.R 125 163)   }
863d348b R/granova.ds.ggplot.R 126 164) 
48638496 R/granova.ds.ggplot.R 119 165)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 166)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 167)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 168)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 169)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 170)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 171)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 172)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 173)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 174)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 175)     
c2605051 R/granova.ds.bd.R     256 176)   
863d348b R/granova.ds.ggplot.R 139 177) 
863d348b R/granova.ds.ggplot.R 140 178)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 179)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 180) 
863d348b R/granova.ds.ggplot.R 143 181)   
3eb0e1f7 R/granova.ds.ggplot.R 142 182)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 183)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 184)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 185)                             ),
a71441d3 R/granova.ds.ggplot.R 140 186)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 187)                  )
863d348b R/granova.ds.ggplot.R 151 188)           )
863d348b R/granova.ds.ggplot.R 152 189)   }
e60e59e1 R/granova.ds.bd.R     241 190)     
794c4b70 R/granova.ds.ggplot.R 152 191)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 192)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 193)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 194)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 195)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 196)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 197)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 198)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 199)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 200)                       )
a71441d3 R/granova.ds.ggplot.R 154 201)           )
863d348b R/granova.ds.ggplot.R 166 202)   }
863d348b R/granova.ds.ggplot.R 167 203) 
794c4b70 R/granova.ds.ggplot.R 166 204)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 205)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 206)   }
863d348b R/granova.ds.ggplot.R 174 207) 
3eb0e1f7 R/granova.ds.ggplot.R 173 208)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 209)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 210)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 211)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 212)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 213)                       )
a71441d3 R/granova.ds.ggplot.R 166 214)           )
863d348b R/granova.ds.ggplot.R 183 215)   }
863d348b R/granova.ds.ggplot.R 184 216) 
794c4b70 R/granova.ds.ggplot.R 183 217)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 218)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 219)   }
863d348b R/granova.ds.ggplot.R 188 220) 
794c4b70 R/granova.ds.ggplot.R 187 221)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 222)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 223)   }
863d348b R/granova.ds.ggplot.R 192 224) 
794c4b70 R/granova.ds.ggplot.R 191 225)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 226)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 227)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 228)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 229)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 230)                    )  
a71441d3 R/granova.ds.ggplot.R 183 231)           )
863d348b R/granova.ds.ggplot.R 202 232)   }
863d348b R/granova.ds.ggplot.R 203 233) 
794c4b70 R/granova.ds.ggplot.R 202 234)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 235)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 236)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 237)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 238)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 239)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 240)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 241)           )
863d348b R/granova.ds.ggplot.R 213 242)   }
c2605051 R/granova.ds.bd.R     271 243)   
794c4b70 R/granova.ds.ggplot.R 213 244)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 245)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 246)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 247)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 248)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 249)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 250)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 251)           )
aaeade58 R/granova.ds.bd.R     274 252)     
863d348b R/granova.ds.ggplot.R 225 253)   }
863d348b R/granova.ds.ggplot.R 226 254) 
794c4b70 R/granova.ds.ggplot.R 225 255)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 256)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 257)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 258)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 259)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 260)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 261)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 262)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 263)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 264)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 265)                        )  
a71441d3 R/granova.ds.ggplot.R 216 266)           )
863d348b R/granova.ds.ggplot.R 242 267)   }
863d348b R/granova.ds.ggplot.R 243 268) 
794c4b70 R/granova.ds.ggplot.R 242 269)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 270)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 271)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 272)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 273)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 274)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 275)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 276)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 277)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 278)                        )
a71441d3 R/granova.ds.ggplot.R 229 279)           )
863d348b R/granova.ds.ggplot.R 258 280)   }
863d348b R/granova.ds.ggplot.R 259 281) 
794c4b70 R/granova.ds.ggplot.R 258 282)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 283)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 284)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 285)                          ),
a71441d3 R/granova.ds.ggplot.R 236 286)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 287)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 288)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 289)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 290)                      )
a71441d3 R/granova.ds.ggplot.R 240 291)           )
863d348b R/granova.ds.ggplot.R 272 292)   }
863d348b R/granova.ds.ggplot.R 273 293) 
794c4b70 R/granova.ds.ggplot.R 272 294)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 295)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 296)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 297)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 298)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 299)                            ),
a71441d3 R/granova.ds.ggplot.R 249 300)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 301)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 302)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 303)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 304)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 305)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 306)           )
863d348b R/granova.ds.ggplot.R 290 307)   }
863d348b R/granova.ds.ggplot.R 291 308) 
ef841aa1 R/granova.ds.ggplot.R 257 309)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 310)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 311)   
a71441d3 R/granova.ds.ggplot.R 261 312)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 313)   }
863d348b R/granova.ds.ggplot.R 297 314) 
794c4b70 R/granova.ds.ggplot.R 296 315)   Title &lt;- function() {
3a2f0d25 R/granova.ds.ggplot.R 264 316)     return(opts(title = main))
863d348b R/granova.ds.ggplot.R 304 317)   }
b5b60529 R/granova.ds.ggplot.R 270 318)   
b5b60529 R/granova.ds.ggplot.R 271 319)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 320)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 321)   }
b5b60529 R/granova.ds.ggplot.R 274 322)   
3b102930 R/granova.ds.ggplot.R 275 323)           
3eb0e1f7 R/granova.ds.ggplot.R 304 324)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 325)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 326)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 327)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 328)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 329)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 330)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 331)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 332)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 333)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 334)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 335)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 336)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 337)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 338)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 339) 
a71441d3 R/granova.ds.ggplot.R 288 340)   return(p)
5d58b37c R/granova.ds.bd.R     314 341) 
b3a74c98 R/granova.ds.bd.R     301 342) }
</pre>
<div class="compileroutput">
Removed legacy parameters from granovagg.ds documentation. Escaped percentage signs using "\%"<p>Added a NULL examples section<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="8ca83f7"></a>
8ca83f7 2011-08-17 22:30:42 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
2b0c8b84 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores. Also prints various
56bb21d6 R/granovagg.ds.R        6   6) #' summary statistics including: effect size, means for X and Y, a 95\%
2b0c8b84 R/granovagg.ds.R        7   7) #' confidence interval for the mean difference as well as the t-statistic and
2b0c8b84 R/granovagg.ds.R        8   8) #' degrees of freedom.
743b4d68 R/granovagg.ds.R        5   9) #' 
2b0c8b84 R/granovagg.ds.R       10  10) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
2b0c8b84 R/granovagg.ds.R       11  11) #' (for Y=X) is drawn. Since the better data view often entails having X's &gt;
2b0c8b84 R/granovagg.ds.R       12  12) #' Y's the revc argument facilitates reversal of the X, Y specifications.
2b0c8b84 R/granovagg.ds.R       13  13) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  14) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  15) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  16) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  17) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  18) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  19) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  20) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  21) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  22) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  23) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  24) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  25) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  26) #' 
2b0c8b84 R/granovagg.ds.R       27  27) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  28) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  29) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  30) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  31) #' @param ylab optional label (as character) for vertical axis.
2b0c8b84 R/granovagg.ds.R       54  32) #' @param main optional main title (as character); if not supplied by user
2b0c8b84 R/granovagg.ds.R       55  33) #'   generic title is provided.
2b0c8b84 R/granovagg.ds.R       59  34) #' @return A list is returned with the following components:
2b0c8b84 R/granovagg.ds.R       60  35) #'   \item{mean(X)}{Mean of X values} \item{mean(Y)}{Mean of Y values}
2b0c8b84 R/granovagg.ds.R       61  36) #'   \item{mean(D=X-Y)}{Mean of differences D = X - Y} \item{SD(D)}{Standard
2b0c8b84 R/granovagg.ds.R       62  37) #'   deviation of differences D} \item{ES(D)}{Effect Size for differences D:
2b0c8b84 R/granovagg.ds.R       63  38) #'   mean(D)/SD(D)} \item{r(X,Y)}{Correlation based on X,Y pairs}
56bb21d6 R/granovagg.ds.R       39  39) #'   \item{r(x+y,D)}{Correlation based on X+Y,D pairs} \item{LL 95\%CI}{Lower
56bb21d6 R/granovagg.ds.R       40  40) #'   bound for 95\% confidence interval for population mean(D)} \item{UL
56bb21d6 R/granovagg.ds.R       41  41) #'   95\%CI}{Upper bound for 95\% confidence interval for population mean(D)}
2b0c8b84 R/granovagg.ds.R       67  42) #'   \item{t(D-bar)}{t-statistic associated w/ test of hypothesis that
2b0c8b84 R/granovagg.ds.R       68  43) #'   population mean(D) = 0.0} \item{df.t}{Degrees of freedom for the
2b0c8b84 R/granovagg.ds.R       69  44) #'   t-statistic} \item{pval.t}{P-value for two sided t-test of null hypothesis
2b0c8b84 R/granovagg.ds.R       70  45) #'   that population mean(D) does not equal zero.}
56bb21d6 R/granovagg.ds.R       46  46) #' @examples NULL
<span class="changed">8ca83f73 R/granovagg.ds.R       47  47) #' @export</span>
2b0c8b84 R/granovagg.ds.R       71  48) 
ee1b067f R/granovagg.ds.R        1  49) granovagg.ds &lt;- function(data       = NULL, 
3693776f R/granova.ds.ggplot.R   2  50)                               main       = "Dependent Sample Assessment Plot",
794c4b70 R/granova.ds.ggplot.R   3  51)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  52)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  53)                              ) 
be2e6fbd R/granova.ds.bd.R      19  54) 
be2e6fbd R/granova.ds.bd.R      20  55) {
d6c27487 R/granova.ds.bd.R      12  56)   
794c4b70 R/granova.ds.ggplot.R   9  57)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  58)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  59)   }
a806fcaa R/granova.ds.bd.R      15  60) 
794c4b70 R/granova.ds.ggplot.R  13  61)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  62)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  63)   }
e589a242 R/granova.ds.bd.R      17  64) 
794c4b70 R/granova.ds.ggplot.R  17  65)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  66)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  67)   }
c2605051 R/granova.ds.bd.R     182  68)   
794c4b70 R/granova.ds.ggplot.R  21  69)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  70)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  71)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  72)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  73)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  74)                  )
a71441d3 R/granova.ds.ggplot.R  27  75)           )
863d348b R/granova.ds.ggplot.R  30  76)   }
c2605051 R/granova.ds.bd.R     187  77)   
794c4b70 R/granova.ds.ggplot.R  30  78)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  79)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  80)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  81)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  82)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  83)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  84)                      )
a71441d3 R/granova.ds.ggplot.R  38  85)           )
863d348b R/granova.ds.ggplot.R  41  86)   }
c2605051 R/granova.ds.bd.R     191  87)   
794c4b70 R/granova.ds.ggplot.R  41  88)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  89)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  90)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  91)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  92)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  93)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  94)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  95)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  96)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  97)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  98)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  99)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 100)   
a71441d3 R/granova.ds.ggplot.R  54 101)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 102)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 103)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 104)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 105)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 106)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 107)                )
a71441d3 R/granova.ds.ggplot.R  61 108)           )
863d348b R/granova.ds.ggplot.R  64 109)   }
c2605051 R/granova.ds.bd.R     199 110)   
794c4b70 R/granova.ds.ggplot.R  64 111)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 112)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 113)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 114)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 115)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 116)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 117)   }
863d348b R/granova.ds.ggplot.R  73 118) 
794c4b70 R/granova.ds.ggplot.R  72 119)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 120)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 121)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 122)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 123)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 124)                      )
a71441d3 R/granova.ds.ggplot.R  78 125)           )  
863d348b R/granova.ds.ggplot.R  82 126)   }
c2605051 R/granova.ds.bd.R     209 127)   
794c4b70 R/granova.ds.ggplot.R  82 128)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 129)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 130)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 131)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 132)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 133)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 134)                      )
a71441d3 R/granova.ds.ggplot.R  88 135)           )
5f570d2d R/granova.ds.bd.R     190 136)     
863d348b R/granova.ds.ggplot.R  94 137)   }
c2605051 R/granova.ds.bd.R     224 138)   
794c4b70 R/granova.ds.ggplot.R  94 139)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 140)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 141)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 142)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 143)                      )
a71441d3 R/granova.ds.ggplot.R  97 144)           )
863d348b R/granova.ds.ggplot.R 103 145)   }
863d348b R/granova.ds.ggplot.R 104 146) 
794c4b70 R/granova.ds.ggplot.R 103 147)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 148)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 149)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 150)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 151)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 152)                      )
a71441d3 R/granova.ds.ggplot.R 106 153)           )
863d348b R/granova.ds.ggplot.R 114 154)   }
c2605051 R/granova.ds.bd.R     239 155)   
794c4b70 R/granova.ds.ggplot.R 114 156)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 157)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 158)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 159)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 160)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 161)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 162)                )
a71441d3 R/granova.ds.ggplot.R 116 163)           )         
863d348b R/granova.ds.ggplot.R 125 164)   }
863d348b R/granova.ds.ggplot.R 126 165) 
48638496 R/granova.ds.ggplot.R 119 166)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 167)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 168)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 169)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 170)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 171)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 172)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 173)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 174)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 175)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 176)     
c2605051 R/granova.ds.bd.R     256 177)   
863d348b R/granova.ds.ggplot.R 139 178) 
863d348b R/granova.ds.ggplot.R 140 179)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 180)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 181) 
863d348b R/granova.ds.ggplot.R 143 182)   
3eb0e1f7 R/granova.ds.ggplot.R 142 183)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 184)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 185)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 186)                             ),
a71441d3 R/granova.ds.ggplot.R 140 187)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 188)                  )
863d348b R/granova.ds.ggplot.R 151 189)           )
863d348b R/granova.ds.ggplot.R 152 190)   }
e60e59e1 R/granova.ds.bd.R     241 191)     
794c4b70 R/granova.ds.ggplot.R 152 192)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 193)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 194)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 195)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 196)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 197)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 198)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 199)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 200)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 201)                       )
a71441d3 R/granova.ds.ggplot.R 154 202)           )
863d348b R/granova.ds.ggplot.R 166 203)   }
863d348b R/granova.ds.ggplot.R 167 204) 
794c4b70 R/granova.ds.ggplot.R 166 205)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 206)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 207)   }
863d348b R/granova.ds.ggplot.R 174 208) 
3eb0e1f7 R/granova.ds.ggplot.R 173 209)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 210)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 211)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 212)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 213)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 214)                       )
a71441d3 R/granova.ds.ggplot.R 166 215)           )
863d348b R/granova.ds.ggplot.R 183 216)   }
863d348b R/granova.ds.ggplot.R 184 217) 
794c4b70 R/granova.ds.ggplot.R 183 218)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 219)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 220)   }
863d348b R/granova.ds.ggplot.R 188 221) 
794c4b70 R/granova.ds.ggplot.R 187 222)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 223)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 224)   }
863d348b R/granova.ds.ggplot.R 192 225) 
794c4b70 R/granova.ds.ggplot.R 191 226)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 227)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 228)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 229)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 230)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 231)                    )  
a71441d3 R/granova.ds.ggplot.R 183 232)           )
863d348b R/granova.ds.ggplot.R 202 233)   }
863d348b R/granova.ds.ggplot.R 203 234) 
794c4b70 R/granova.ds.ggplot.R 202 235)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 236)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 237)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 238)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 239)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 240)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 241)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 242)           )
863d348b R/granova.ds.ggplot.R 213 243)   }
c2605051 R/granova.ds.bd.R     271 244)   
794c4b70 R/granova.ds.ggplot.R 213 245)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 246)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 247)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 248)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 249)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 250)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 251)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 252)           )
aaeade58 R/granova.ds.bd.R     274 253)     
863d348b R/granova.ds.ggplot.R 225 254)   }
863d348b R/granova.ds.ggplot.R 226 255) 
794c4b70 R/granova.ds.ggplot.R 225 256)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 257)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 258)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 259)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 260)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 261)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 262)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 263)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 264)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 265)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 266)                        )  
a71441d3 R/granova.ds.ggplot.R 216 267)           )
863d348b R/granova.ds.ggplot.R 242 268)   }
863d348b R/granova.ds.ggplot.R 243 269) 
794c4b70 R/granova.ds.ggplot.R 242 270)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 271)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 272)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 273)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 274)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 275)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 276)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 277)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 278)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 279)                        )
a71441d3 R/granova.ds.ggplot.R 229 280)           )
863d348b R/granova.ds.ggplot.R 258 281)   }
863d348b R/granova.ds.ggplot.R 259 282) 
794c4b70 R/granova.ds.ggplot.R 258 283)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 284)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 285)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 286)                          ),
a71441d3 R/granova.ds.ggplot.R 236 287)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 288)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 289)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 290)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 291)                      )
a71441d3 R/granova.ds.ggplot.R 240 292)           )
863d348b R/granova.ds.ggplot.R 272 293)   }
863d348b R/granova.ds.ggplot.R 273 294) 
794c4b70 R/granova.ds.ggplot.R 272 295)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 296)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 297)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 298)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 299)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 300)                            ),
a71441d3 R/granova.ds.ggplot.R 249 301)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 302)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 303)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 304)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 305)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 306)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 307)           )
863d348b R/granova.ds.ggplot.R 290 308)   }
863d348b R/granova.ds.ggplot.R 291 309) 
ef841aa1 R/granova.ds.ggplot.R 257 310)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 311)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 312)   
a71441d3 R/granova.ds.ggplot.R 261 313)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 314)   }
863d348b R/granova.ds.ggplot.R 297 315) 
794c4b70 R/granova.ds.ggplot.R 296 316)   Title &lt;- function() {
3a2f0d25 R/granova.ds.ggplot.R 264 317)     return(opts(title = main))
863d348b R/granova.ds.ggplot.R 304 318)   }
b5b60529 R/granova.ds.ggplot.R 270 319)   
b5b60529 R/granova.ds.ggplot.R 271 320)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 321)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 322)   }
b5b60529 R/granova.ds.ggplot.R 274 323)   
3b102930 R/granova.ds.ggplot.R 275 324)           
3eb0e1f7 R/granova.ds.ggplot.R 304 325)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 326)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 327)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 328)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 329)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 330)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 331)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 332)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 333)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 334)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 335)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 336)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 337)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 338)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 339)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 340) 
a71441d3 R/granova.ds.ggplot.R 288 341)   return(p)
5d58b37c R/granova.ds.bd.R     314 342) 
b3a74c98 R/granova.ds.bd.R     301 343) }
</pre>
<div class="compileroutput">
Forced package to export granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="a2b6fe7"></a>
a2b6fe7 2011-08-17 22:41:43 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
2b0c8b84 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores. Also prints various
56bb21d6 R/granovagg.ds.R        6   6) #' summary statistics including: effect size, means for X and Y, a 95\%
2b0c8b84 R/granovagg.ds.R        7   7) #' confidence interval for the mean difference as well as the t-statistic and
2b0c8b84 R/granovagg.ds.R        8   8) #' degrees of freedom.
743b4d68 R/granovagg.ds.R        5   9) #' 
2b0c8b84 R/granovagg.ds.R       10  10) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
2b0c8b84 R/granovagg.ds.R       11  11) #' (for Y=X) is drawn. Since the better data view often entails having X's &gt;
2b0c8b84 R/granovagg.ds.R       12  12) #' Y's the revc argument facilitates reversal of the X, Y specifications.
2b0c8b84 R/granovagg.ds.R       13  13) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  14) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  15) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  16) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  17) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  18) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  19) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  20) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  21) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  22) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  23) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  24) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  25) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  26) #' 
2b0c8b84 R/granovagg.ds.R       27  27) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  28) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  29) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  30) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  31) #' @param ylab optional label (as character) for vertical axis.
2b0c8b84 R/granovagg.ds.R       54  32) #' @param main optional main title (as character); if not supplied by user
2b0c8b84 R/granovagg.ds.R       55  33) #'   generic title is provided.
2b0c8b84 R/granovagg.ds.R       59  34) #' @return A list is returned with the following components:
2b0c8b84 R/granovagg.ds.R       60  35) #'   \item{mean(X)}{Mean of X values} \item{mean(Y)}{Mean of Y values}
2b0c8b84 R/granovagg.ds.R       61  36) #'   \item{mean(D=X-Y)}{Mean of differences D = X - Y} \item{SD(D)}{Standard
2b0c8b84 R/granovagg.ds.R       62  37) #'   deviation of differences D} \item{ES(D)}{Effect Size for differences D:
2b0c8b84 R/granovagg.ds.R       63  38) #'   mean(D)/SD(D)} \item{r(X,Y)}{Correlation based on X,Y pairs}
56bb21d6 R/granovagg.ds.R       39  39) #'   \item{r(x+y,D)}{Correlation based on X+Y,D pairs} \item{LL 95\%CI}{Lower
56bb21d6 R/granovagg.ds.R       40  40) #'   bound for 95\% confidence interval for population mean(D)} \item{UL
56bb21d6 R/granovagg.ds.R       41  41) #'   95\%CI}{Upper bound for 95\% confidence interval for population mean(D)}
2b0c8b84 R/granovagg.ds.R       67  42) #'   \item{t(D-bar)}{t-statistic associated w/ test of hypothesis that
2b0c8b84 R/granovagg.ds.R       68  43) #'   population mean(D) = 0.0} \item{df.t}{Degrees of freedom for the
2b0c8b84 R/granovagg.ds.R       69  44) #'   t-statistic} \item{pval.t}{P-value for two sided t-test of null hypothesis
2b0c8b84 R/granovagg.ds.R       70  45) #'   that population mean(D) does not equal zero.}
56bb21d6 R/granovagg.ds.R       46  46) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  47) #' @export
2b0c8b84 R/granovagg.ds.R       71  48) 
ee1b067f R/granovagg.ds.R        1  49) granovagg.ds &lt;- function(data       = NULL, 
3693776f R/granova.ds.ggplot.R   2  50)                               main       = "Dependent Sample Assessment Plot",
794c4b70 R/granova.ds.ggplot.R   3  51)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  52)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  53)                              ) 
be2e6fbd R/granova.ds.bd.R      19  54) 
be2e6fbd R/granova.ds.bd.R      20  55) {
d6c27487 R/granova.ds.bd.R      12  56)   
794c4b70 R/granova.ds.ggplot.R   9  57)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  58)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  59)   }
a806fcaa R/granova.ds.bd.R      15  60) 
794c4b70 R/granova.ds.ggplot.R  13  61)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  62)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  63)   }
e589a242 R/granova.ds.bd.R      17  64) 
794c4b70 R/granova.ds.ggplot.R  17  65)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  66)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  67)   }
c2605051 R/granova.ds.bd.R     182  68)   
794c4b70 R/granova.ds.ggplot.R  21  69)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  70)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  71)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  72)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  73)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  74)                  )
a71441d3 R/granova.ds.ggplot.R  27  75)           )
863d348b R/granova.ds.ggplot.R  30  76)   }
c2605051 R/granova.ds.bd.R     187  77)   
794c4b70 R/granova.ds.ggplot.R  30  78)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  79)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  80)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  81)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  82)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  83)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  84)                      )
a71441d3 R/granova.ds.ggplot.R  38  85)           )
863d348b R/granova.ds.ggplot.R  41  86)   }
c2605051 R/granova.ds.bd.R     191  87)   
794c4b70 R/granova.ds.ggplot.R  41  88)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  89)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  90)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  91)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  92)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  93)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  94)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  95)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  96)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  97)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  98)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  99)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 100)   
a71441d3 R/granova.ds.ggplot.R  54 101)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 102)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 103)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 104)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 105)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 106)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 107)                )
a71441d3 R/granova.ds.ggplot.R  61 108)           )
863d348b R/granova.ds.ggplot.R  64 109)   }
c2605051 R/granova.ds.bd.R     199 110)   
794c4b70 R/granova.ds.ggplot.R  64 111)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 112)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 113)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 114)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 115)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 116)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 117)   }
863d348b R/granova.ds.ggplot.R  73 118) 
794c4b70 R/granova.ds.ggplot.R  72 119)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 120)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 121)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 122)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 123)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 124)                      )
a71441d3 R/granova.ds.ggplot.R  78 125)           )  
863d348b R/granova.ds.ggplot.R  82 126)   }
c2605051 R/granova.ds.bd.R     209 127)   
794c4b70 R/granova.ds.ggplot.R  82 128)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 129)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 130)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 131)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 132)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 133)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 134)                      )
a71441d3 R/granova.ds.ggplot.R  88 135)           )
5f570d2d R/granova.ds.bd.R     190 136)     
863d348b R/granova.ds.ggplot.R  94 137)   }
c2605051 R/granova.ds.bd.R     224 138)   
794c4b70 R/granova.ds.ggplot.R  94 139)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 140)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 141)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 142)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 143)                      )
a71441d3 R/granova.ds.ggplot.R  97 144)           )
863d348b R/granova.ds.ggplot.R 103 145)   }
863d348b R/granova.ds.ggplot.R 104 146) 
794c4b70 R/granova.ds.ggplot.R 103 147)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 148)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 149)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 150)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 151)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 152)                      )
a71441d3 R/granova.ds.ggplot.R 106 153)           )
863d348b R/granova.ds.ggplot.R 114 154)   }
c2605051 R/granova.ds.bd.R     239 155)   
794c4b70 R/granova.ds.ggplot.R 114 156)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 157)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 158)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 159)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 160)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 161)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 162)                )
a71441d3 R/granova.ds.ggplot.R 116 163)           )         
863d348b R/granova.ds.ggplot.R 125 164)   }
863d348b R/granova.ds.ggplot.R 126 165) 
48638496 R/granova.ds.ggplot.R 119 166)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 167)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 168)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 169)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 170)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 171)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 172)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 173)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 174)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 175)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 176)     
c2605051 R/granova.ds.bd.R     256 177)   
863d348b R/granova.ds.ggplot.R 139 178) 
863d348b R/granova.ds.ggplot.R 140 179)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 180)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 181) 
863d348b R/granova.ds.ggplot.R 143 182)   
3eb0e1f7 R/granova.ds.ggplot.R 142 183)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 184)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 185)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 186)                             ),
a71441d3 R/granova.ds.ggplot.R 140 187)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 188)                  )
863d348b R/granova.ds.ggplot.R 151 189)           )
863d348b R/granova.ds.ggplot.R 152 190)   }
e60e59e1 R/granova.ds.bd.R     241 191)     
794c4b70 R/granova.ds.ggplot.R 152 192)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 193)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 194)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 195)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 196)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 197)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 198)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 199)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 200)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 201)                       )
a71441d3 R/granova.ds.ggplot.R 154 202)           )
863d348b R/granova.ds.ggplot.R 166 203)   }
863d348b R/granova.ds.ggplot.R 167 204) 
794c4b70 R/granova.ds.ggplot.R 166 205)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 206)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 207)   }
863d348b R/granova.ds.ggplot.R 174 208) 
3eb0e1f7 R/granova.ds.ggplot.R 173 209)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 210)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 211)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 212)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 213)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 214)                       )
a71441d3 R/granova.ds.ggplot.R 166 215)           )
863d348b R/granova.ds.ggplot.R 183 216)   }
863d348b R/granova.ds.ggplot.R 184 217) 
794c4b70 R/granova.ds.ggplot.R 183 218)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 219)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 220)   }
863d348b R/granova.ds.ggplot.R 188 221) 
794c4b70 R/granova.ds.ggplot.R 187 222)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 223)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 224)   }
863d348b R/granova.ds.ggplot.R 192 225) 
794c4b70 R/granova.ds.ggplot.R 191 226)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 227)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 228)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 229)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 230)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 231)                    )  
a71441d3 R/granova.ds.ggplot.R 183 232)           )
863d348b R/granova.ds.ggplot.R 202 233)   }
863d348b R/granova.ds.ggplot.R 203 234) 
794c4b70 R/granova.ds.ggplot.R 202 235)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 236)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 237)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 238)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 239)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 240)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 241)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 242)           )
863d348b R/granova.ds.ggplot.R 213 243)   }
c2605051 R/granova.ds.bd.R     271 244)   
794c4b70 R/granova.ds.ggplot.R 213 245)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 246)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 247)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 248)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 249)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 250)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 251)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 252)           )
aaeade58 R/granova.ds.bd.R     274 253)     
863d348b R/granova.ds.ggplot.R 225 254)   }
863d348b R/granova.ds.ggplot.R 226 255) 
794c4b70 R/granova.ds.ggplot.R 225 256)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 257)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 258)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 259)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 260)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 261)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 262)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 263)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 264)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 265)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 266)                        )  
a71441d3 R/granova.ds.ggplot.R 216 267)           )
863d348b R/granova.ds.ggplot.R 242 268)   }
863d348b R/granova.ds.ggplot.R 243 269) 
794c4b70 R/granova.ds.ggplot.R 242 270)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 271)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 272)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 273)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 274)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 275)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 276)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 277)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 278)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 279)                        )
a71441d3 R/granova.ds.ggplot.R 229 280)           )
863d348b R/granova.ds.ggplot.R 258 281)   }
863d348b R/granova.ds.ggplot.R 259 282) 
794c4b70 R/granova.ds.ggplot.R 258 283)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 284)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 285)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 286)                          ),
a71441d3 R/granova.ds.ggplot.R 236 287)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 288)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 289)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 290)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 291)                      )
a71441d3 R/granova.ds.ggplot.R 240 292)           )
863d348b R/granova.ds.ggplot.R 272 293)   }
863d348b R/granova.ds.ggplot.R 273 294) 
794c4b70 R/granova.ds.ggplot.R 272 295)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 296)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 297)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 298)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 299)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 300)                            ),
a71441d3 R/granova.ds.ggplot.R 249 301)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 302)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 303)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 304)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 305)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 306)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 307)           )
863d348b R/granova.ds.ggplot.R 290 308)   }
863d348b R/granova.ds.ggplot.R 291 309) 
ef841aa1 R/granova.ds.ggplot.R 257 310)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 311)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 312)   
a71441d3 R/granova.ds.ggplot.R 261 313)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 314)   }
863d348b R/granova.ds.ggplot.R 297 315) 
794c4b70 R/granova.ds.ggplot.R 296 316)   Title &lt;- function() {
<span class="changed">a2b6fe7d R/granovagg.ds.R      317 317)     if (main == "default_granova_title") {</span>
<span class="changed">a2b6fe7d R/granovagg.ds.R      318 318)       return(opts(title = "Dependent Sample Assessment Plot"))</span>
<span class="changed">a2b6fe7d R/granovagg.ds.R      319 319)     }</span>
<span class="changed">a2b6fe7d R/granovagg.ds.R      320 320)     </span>
<span class="changed">a2b6fe7d R/granovagg.ds.R      321 321)     else {</span>
<span class="changed">a2b6fe7d R/granovagg.ds.R      322 322)       return(opts(title = main))</span>
<span class="changed">a2b6fe7d R/granovagg.ds.R      323 323)     }</span>
863d348b R/granova.ds.ggplot.R 304 324)   }
b5b60529 R/granova.ds.ggplot.R 270 325)   
b5b60529 R/granova.ds.ggplot.R 271 326)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 327)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 328)   }
b5b60529 R/granova.ds.ggplot.R 274 329)   
3b102930 R/granova.ds.ggplot.R 275 330)           
3eb0e1f7 R/granova.ds.ggplot.R 304 331)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 332)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 333)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 334)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 335)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 336)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 337)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 338)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 339)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 340)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 341)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 342)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 343)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 344)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 345)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 346) 
a71441d3 R/granova.ds.ggplot.R 288 347)   return(p)
5d58b37c R/granova.ds.bd.R     314 348) 
b3a74c98 R/granova.ds.bd.R     301 349) }
</pre>
<div class="compileroutput">
granovagg.ds now can now accept a user-supplied title, a NULL title, or print the default title<p></p><p><br>
</p></div>
</td>
<td>
<a name="892e6c4"></a>
892e6c4 2011-08-17 22:43:26 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
2b0c8b84 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores. Also prints various
56bb21d6 R/granovagg.ds.R        6   6) #' summary statistics including: effect size, means for X and Y, a 95\%
2b0c8b84 R/granovagg.ds.R        7   7) #' confidence interval for the mean difference as well as the t-statistic and
2b0c8b84 R/granovagg.ds.R        8   8) #' degrees of freedom.
743b4d68 R/granovagg.ds.R        5   9) #' 
2b0c8b84 R/granovagg.ds.R       10  10) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
<span class="changed">892e6c44 R/granovagg.ds.R       11  11) #' (for Y=X) is drawn. </span>
2b0c8b84 R/granovagg.ds.R       13  12) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  13) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  14) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  15) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  16) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  17) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  18) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  19) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  20) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  21) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  22) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  23) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  24) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  25) #' 
2b0c8b84 R/granovagg.ds.R       27  26) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  27) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  28) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  29) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  30) #' @param ylab optional label (as character) for vertical axis.
<span class="changed">892e6c44 R/granovagg.ds.R       31  31) #' @param main optional main title (as character); can be supplied by user. The default value is</span>
<span class="changed">892e6c44 R/granovagg.ds.R       32  32) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.</span>
<span class="changed">892e6c44 R/granovagg.ds.R       33  33) #' @return Returns a plot object of class \code{ggplot}. </span>
56bb21d6 R/granovagg.ds.R       46  34) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  35) #' @export
2b0c8b84 R/granovagg.ds.R       71  36) 
ee1b067f R/granovagg.ds.R        1  37) granovagg.ds &lt;- function(data       = NULL, 
<span class="changed">892e6c44 R/granovagg.ds.R       38  38)                               main       = "default_granova_title",</span>
794c4b70 R/granova.ds.ggplot.R   3  39)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  40)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  41)                              ) 
be2e6fbd R/granova.ds.bd.R      19  42) 
be2e6fbd R/granova.ds.bd.R      20  43) {
d6c27487 R/granova.ds.bd.R      12  44)   
794c4b70 R/granova.ds.ggplot.R   9  45)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  46)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  47)   }
a806fcaa R/granova.ds.bd.R      15  48) 
794c4b70 R/granova.ds.ggplot.R  13  49)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  50)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  51)   }
e589a242 R/granova.ds.bd.R      17  52) 
794c4b70 R/granova.ds.ggplot.R  17  53)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  54)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  55)   }
c2605051 R/granova.ds.bd.R     182  56)   
794c4b70 R/granova.ds.ggplot.R  21  57)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  58)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  59)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  60)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  61)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  62)                  )
a71441d3 R/granova.ds.ggplot.R  27  63)           )
863d348b R/granova.ds.ggplot.R  30  64)   }
c2605051 R/granova.ds.bd.R     187  65)   
794c4b70 R/granova.ds.ggplot.R  30  66)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  67)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  68)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  69)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  70)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  71)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  72)                      )
a71441d3 R/granova.ds.ggplot.R  38  73)           )
863d348b R/granova.ds.ggplot.R  41  74)   }
c2605051 R/granova.ds.bd.R     191  75)   
794c4b70 R/granova.ds.ggplot.R  41  76)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  77)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  78)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  79)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  80)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  81)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  82)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  83)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  84)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  85)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  86)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  87)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  88)   
a71441d3 R/granova.ds.ggplot.R  54  89)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  90)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  91)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  92)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  93)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  94)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  95)                )
a71441d3 R/granova.ds.ggplot.R  61  96)           )
863d348b R/granova.ds.ggplot.R  64  97)   }
c2605051 R/granova.ds.bd.R     199  98)   
794c4b70 R/granova.ds.ggplot.R  64  99)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 100)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 101)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 102)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 103)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 104)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 105)   }
863d348b R/granova.ds.ggplot.R  73 106) 
794c4b70 R/granova.ds.ggplot.R  72 107)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 108)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 109)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 110)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 111)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 112)                      )
a71441d3 R/granova.ds.ggplot.R  78 113)           )  
863d348b R/granova.ds.ggplot.R  82 114)   }
c2605051 R/granova.ds.bd.R     209 115)   
794c4b70 R/granova.ds.ggplot.R  82 116)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 117)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 118)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 119)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 120)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 121)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 122)                      )
a71441d3 R/granova.ds.ggplot.R  88 123)           )
5f570d2d R/granova.ds.bd.R     190 124)     
863d348b R/granova.ds.ggplot.R  94 125)   }
c2605051 R/granova.ds.bd.R     224 126)   
794c4b70 R/granova.ds.ggplot.R  94 127)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 128)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 129)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 130)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 131)                      )
a71441d3 R/granova.ds.ggplot.R  97 132)           )
863d348b R/granova.ds.ggplot.R 103 133)   }
863d348b R/granova.ds.ggplot.R 104 134) 
794c4b70 R/granova.ds.ggplot.R 103 135)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 136)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 137)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 138)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 139)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 140)                      )
a71441d3 R/granova.ds.ggplot.R 106 141)           )
863d348b R/granova.ds.ggplot.R 114 142)   }
c2605051 R/granova.ds.bd.R     239 143)   
794c4b70 R/granova.ds.ggplot.R 114 144)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 145)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 146)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 147)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 148)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 149)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 150)                )
a71441d3 R/granova.ds.ggplot.R 116 151)           )         
863d348b R/granova.ds.ggplot.R 125 152)   }
863d348b R/granova.ds.ggplot.R 126 153) 
48638496 R/granova.ds.ggplot.R 119 154)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 155)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 156)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 157)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 158)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 159)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 160)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 161)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 162)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 163)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 164)     
c2605051 R/granova.ds.bd.R     256 165)   
863d348b R/granova.ds.ggplot.R 139 166) 
863d348b R/granova.ds.ggplot.R 140 167)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 168)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 169) 
863d348b R/granova.ds.ggplot.R 143 170)   
3eb0e1f7 R/granova.ds.ggplot.R 142 171)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 172)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 173)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 174)                             ),
a71441d3 R/granova.ds.ggplot.R 140 175)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 176)                  )
863d348b R/granova.ds.ggplot.R 151 177)           )
863d348b R/granova.ds.ggplot.R 152 178)   }
e60e59e1 R/granova.ds.bd.R     241 179)     
794c4b70 R/granova.ds.ggplot.R 152 180)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 181)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 182)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 183)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 184)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 185)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 186)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 187)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 188)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 189)                       )
a71441d3 R/granova.ds.ggplot.R 154 190)           )
863d348b R/granova.ds.ggplot.R 166 191)   }
863d348b R/granova.ds.ggplot.R 167 192) 
794c4b70 R/granova.ds.ggplot.R 166 193)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 194)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 195)   }
863d348b R/granova.ds.ggplot.R 174 196) 
3eb0e1f7 R/granova.ds.ggplot.R 173 197)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 198)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 199)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 200)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 201)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 202)                       )
a71441d3 R/granova.ds.ggplot.R 166 203)           )
863d348b R/granova.ds.ggplot.R 183 204)   }
863d348b R/granova.ds.ggplot.R 184 205) 
794c4b70 R/granova.ds.ggplot.R 183 206)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 207)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 208)   }
863d348b R/granova.ds.ggplot.R 188 209) 
794c4b70 R/granova.ds.ggplot.R 187 210)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 211)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 212)   }
863d348b R/granova.ds.ggplot.R 192 213) 
794c4b70 R/granova.ds.ggplot.R 191 214)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 215)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 216)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 217)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 218)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 219)                    )  
a71441d3 R/granova.ds.ggplot.R 183 220)           )
863d348b R/granova.ds.ggplot.R 202 221)   }
863d348b R/granova.ds.ggplot.R 203 222) 
794c4b70 R/granova.ds.ggplot.R 202 223)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 224)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 225)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 226)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 227)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 228)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 229)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 230)           )
863d348b R/granova.ds.ggplot.R 213 231)   }
c2605051 R/granova.ds.bd.R     271 232)   
794c4b70 R/granova.ds.ggplot.R 213 233)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 234)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 235)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 236)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 237)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 238)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 239)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 240)           )
aaeade58 R/granova.ds.bd.R     274 241)     
863d348b R/granova.ds.ggplot.R 225 242)   }
863d348b R/granova.ds.ggplot.R 226 243) 
794c4b70 R/granova.ds.ggplot.R 225 244)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 245)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 246)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 247)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 248)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 249)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 250)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 251)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 252)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 253)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 254)                        )  
a71441d3 R/granova.ds.ggplot.R 216 255)           )
863d348b R/granova.ds.ggplot.R 242 256)   }
863d348b R/granova.ds.ggplot.R 243 257) 
794c4b70 R/granova.ds.ggplot.R 242 258)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 259)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 260)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 261)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 262)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 263)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 264)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 265)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 266)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 267)                        )
a71441d3 R/granova.ds.ggplot.R 229 268)           )
863d348b R/granova.ds.ggplot.R 258 269)   }
863d348b R/granova.ds.ggplot.R 259 270) 
794c4b70 R/granova.ds.ggplot.R 258 271)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 272)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 273)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 274)                          ),
a71441d3 R/granova.ds.ggplot.R 236 275)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 276)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 277)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 278)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 279)                      )
a71441d3 R/granova.ds.ggplot.R 240 280)           )
863d348b R/granova.ds.ggplot.R 272 281)   }
863d348b R/granova.ds.ggplot.R 273 282) 
794c4b70 R/granova.ds.ggplot.R 272 283)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 284)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 285)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 286)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 287)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 288)                            ),
a71441d3 R/granova.ds.ggplot.R 249 289)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 290)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 291)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 292)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 293)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 294)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 295)           )
863d348b R/granova.ds.ggplot.R 290 296)   }
863d348b R/granova.ds.ggplot.R 291 297) 
ef841aa1 R/granova.ds.ggplot.R 257 298)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 299)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 300)   
a71441d3 R/granova.ds.ggplot.R 261 301)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 302)   }
863d348b R/granova.ds.ggplot.R 297 303) 
794c4b70 R/granova.ds.ggplot.R 296 304)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 305)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 306)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 307)     }
a2b6fe7d R/granovagg.ds.R      320 308)     
a2b6fe7d R/granovagg.ds.R      321 309)     else {
a2b6fe7d R/granovagg.ds.R      322 310)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 311)     }
863d348b R/granova.ds.ggplot.R 304 312)   }
b5b60529 R/granova.ds.ggplot.R 270 313)   
b5b60529 R/granova.ds.ggplot.R 271 314)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 315)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 316)   }
b5b60529 R/granova.ds.ggplot.R 274 317)   
3b102930 R/granova.ds.ggplot.R 275 318)           
3eb0e1f7 R/granova.ds.ggplot.R 304 319)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 320)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 321)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 322)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 323)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 324)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 325)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 326)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 327)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 328)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 329)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 330)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 331)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 332)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 333)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 334) 
a71441d3 R/granova.ds.ggplot.R 288 335)   return(p)
5d58b37c R/granova.ds.bd.R     314 336) 
b3a74c98 R/granova.ds.bd.R     301 337) }
</pre>
<div class="compileroutput">
granovads.gg documentation no longer reflects reversing X and y through revc.<p></p><p><br>
</p></div>
</td>
<td>
<a name="62c4a36"></a>
62c4a36 2011-08-17 22:45:29 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
2b0c8b84 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores. Also prints various
56bb21d6 R/granovagg.ds.R        6   6) #' summary statistics including: effect size, means for X and Y, a 95\%
2b0c8b84 R/granovagg.ds.R        7   7) #' confidence interval for the mean difference as well as the t-statistic and
2b0c8b84 R/granovagg.ds.R        8   8) #' degrees of freedom.
743b4d68 R/granovagg.ds.R        5   9) #' 
2b0c8b84 R/granovagg.ds.R       10  10) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11  11) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13  12) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  13) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  14) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  15) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  16) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  17) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  18) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  19) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  20) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  21) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  22) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  23) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  24) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  25) #' 
2b0c8b84 R/granovagg.ds.R       27  26) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  27) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  28) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  29) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  30) #' @param ylab optional label (as character) for vertical axis.
892e6c44 R/granovagg.ds.R       31  31) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  32) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
892e6c44 R/granovagg.ds.R       33  33) #' @return Returns a plot object of class \code{ggplot}. 
<span class="changed">62c4a36e R/granovagg.ds.R       34  34) #' @param plot.theme argument indicating a ggplot2 theme to apply to the</span>
<span class="changed">62c4a36e R/granovagg.ds.R       35  35) #'   graphic; defaults to a customized theme created for the dependent sample graphic</span>
56bb21d6 R/granovagg.ds.R       46  36) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  37) #' @export
2b0c8b84 R/granovagg.ds.R       71  38) 
ee1b067f R/granovagg.ds.R        1  39) granovagg.ds &lt;- function(data       = NULL, 
892e6c44 R/granovagg.ds.R       38  40)                               main       = "default_granova_title",
794c4b70 R/granova.ds.ggplot.R   3  41)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  42)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  43)                              ) 
be2e6fbd R/granova.ds.bd.R      19  44) 
be2e6fbd R/granova.ds.bd.R      20  45) {
d6c27487 R/granova.ds.bd.R      12  46)   
794c4b70 R/granova.ds.ggplot.R   9  47)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  48)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  49)   }
a806fcaa R/granova.ds.bd.R      15  50) 
794c4b70 R/granova.ds.ggplot.R  13  51)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  52)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  53)   }
e589a242 R/granova.ds.bd.R      17  54) 
794c4b70 R/granova.ds.ggplot.R  17  55)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  56)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  57)   }
c2605051 R/granova.ds.bd.R     182  58)   
794c4b70 R/granova.ds.ggplot.R  21  59)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  60)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  61)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  62)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  63)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  64)                  )
a71441d3 R/granova.ds.ggplot.R  27  65)           )
863d348b R/granova.ds.ggplot.R  30  66)   }
c2605051 R/granova.ds.bd.R     187  67)   
794c4b70 R/granova.ds.ggplot.R  30  68)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  69)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  70)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  71)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  72)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  73)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  74)                      )
a71441d3 R/granova.ds.ggplot.R  38  75)           )
863d348b R/granova.ds.ggplot.R  41  76)   }
c2605051 R/granova.ds.bd.R     191  77)   
794c4b70 R/granova.ds.ggplot.R  41  78)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  79)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  80)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  81)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  82)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  83)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  84)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  85)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  86)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  87)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  88)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  89)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  90)   
a71441d3 R/granova.ds.ggplot.R  54  91)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  92)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  93)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  94)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  95)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  96)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  97)                )
a71441d3 R/granova.ds.ggplot.R  61  98)           )
863d348b R/granova.ds.ggplot.R  64  99)   }
c2605051 R/granova.ds.bd.R     199 100)   
794c4b70 R/granova.ds.ggplot.R  64 101)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 102)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 103)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 104)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 105)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 106)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 107)   }
863d348b R/granova.ds.ggplot.R  73 108) 
794c4b70 R/granova.ds.ggplot.R  72 109)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 110)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 111)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 112)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 113)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 114)                      )
a71441d3 R/granova.ds.ggplot.R  78 115)           )  
863d348b R/granova.ds.ggplot.R  82 116)   }
c2605051 R/granova.ds.bd.R     209 117)   
794c4b70 R/granova.ds.ggplot.R  82 118)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 119)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 120)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 121)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 122)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 123)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 124)                      )
a71441d3 R/granova.ds.ggplot.R  88 125)           )
5f570d2d R/granova.ds.bd.R     190 126)     
863d348b R/granova.ds.ggplot.R  94 127)   }
c2605051 R/granova.ds.bd.R     224 128)   
794c4b70 R/granova.ds.ggplot.R  94 129)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 130)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 131)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 132)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 133)                      )
a71441d3 R/granova.ds.ggplot.R  97 134)           )
863d348b R/granova.ds.ggplot.R 103 135)   }
863d348b R/granova.ds.ggplot.R 104 136) 
794c4b70 R/granova.ds.ggplot.R 103 137)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 138)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 139)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 140)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 141)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 142)                      )
a71441d3 R/granova.ds.ggplot.R 106 143)           )
863d348b R/granova.ds.ggplot.R 114 144)   }
c2605051 R/granova.ds.bd.R     239 145)   
794c4b70 R/granova.ds.ggplot.R 114 146)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 147)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 148)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 149)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 150)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 151)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 152)                )
a71441d3 R/granova.ds.ggplot.R 116 153)           )         
863d348b R/granova.ds.ggplot.R 125 154)   }
863d348b R/granova.ds.ggplot.R 126 155) 
48638496 R/granova.ds.ggplot.R 119 156)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 157)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 158)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 159)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 160)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 161)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 162)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 163)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 164)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 165)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 166)     
c2605051 R/granova.ds.bd.R     256 167)   
863d348b R/granova.ds.ggplot.R 139 168) 
863d348b R/granova.ds.ggplot.R 140 169)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 170)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 171) 
863d348b R/granova.ds.ggplot.R 143 172)   
3eb0e1f7 R/granova.ds.ggplot.R 142 173)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 174)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 175)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 176)                             ),
a71441d3 R/granova.ds.ggplot.R 140 177)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 178)                  )
863d348b R/granova.ds.ggplot.R 151 179)           )
863d348b R/granova.ds.ggplot.R 152 180)   }
e60e59e1 R/granova.ds.bd.R     241 181)     
794c4b70 R/granova.ds.ggplot.R 152 182)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 183)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 184)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 185)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 186)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 187)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 188)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 189)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 190)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 191)                       )
a71441d3 R/granova.ds.ggplot.R 154 192)           )
863d348b R/granova.ds.ggplot.R 166 193)   }
863d348b R/granova.ds.ggplot.R 167 194) 
794c4b70 R/granova.ds.ggplot.R 166 195)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 196)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 197)   }
863d348b R/granova.ds.ggplot.R 174 198) 
3eb0e1f7 R/granova.ds.ggplot.R 173 199)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 200)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 201)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 202)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 203)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 204)                       )
a71441d3 R/granova.ds.ggplot.R 166 205)           )
863d348b R/granova.ds.ggplot.R 183 206)   }
863d348b R/granova.ds.ggplot.R 184 207) 
794c4b70 R/granova.ds.ggplot.R 183 208)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 209)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 210)   }
863d348b R/granova.ds.ggplot.R 188 211) 
794c4b70 R/granova.ds.ggplot.R 187 212)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 213)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 214)   }
863d348b R/granova.ds.ggplot.R 192 215) 
794c4b70 R/granova.ds.ggplot.R 191 216)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 217)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 218)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 219)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 220)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 221)                    )  
a71441d3 R/granova.ds.ggplot.R 183 222)           )
863d348b R/granova.ds.ggplot.R 202 223)   }
863d348b R/granova.ds.ggplot.R 203 224) 
794c4b70 R/granova.ds.ggplot.R 202 225)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 226)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 227)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 228)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 229)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 230)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 231)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 232)           )
863d348b R/granova.ds.ggplot.R 213 233)   }
c2605051 R/granova.ds.bd.R     271 234)   
794c4b70 R/granova.ds.ggplot.R 213 235)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 236)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 237)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 238)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 239)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 240)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 241)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 242)           )
aaeade58 R/granova.ds.bd.R     274 243)     
863d348b R/granova.ds.ggplot.R 225 244)   }
863d348b R/granova.ds.ggplot.R 226 245) 
794c4b70 R/granova.ds.ggplot.R 225 246)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 247)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 248)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 249)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 250)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 251)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 252)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 253)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 254)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 255)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 256)                        )  
a71441d3 R/granova.ds.ggplot.R 216 257)           )
863d348b R/granova.ds.ggplot.R 242 258)   }
863d348b R/granova.ds.ggplot.R 243 259) 
794c4b70 R/granova.ds.ggplot.R 242 260)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 261)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 262)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 263)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 264)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 265)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 266)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 267)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 268)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 269)                        )
a71441d3 R/granova.ds.ggplot.R 229 270)           )
863d348b R/granova.ds.ggplot.R 258 271)   }
863d348b R/granova.ds.ggplot.R 259 272) 
794c4b70 R/granova.ds.ggplot.R 258 273)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 274)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 275)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 276)                          ),
a71441d3 R/granova.ds.ggplot.R 236 277)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 278)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 279)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 280)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 281)                      )
a71441d3 R/granova.ds.ggplot.R 240 282)           )
863d348b R/granova.ds.ggplot.R 272 283)   }
863d348b R/granova.ds.ggplot.R 273 284) 
794c4b70 R/granova.ds.ggplot.R 272 285)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 286)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 287)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 288)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 289)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 290)                            ),
a71441d3 R/granova.ds.ggplot.R 249 291)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 292)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 293)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 294)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 295)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 296)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 297)           )
863d348b R/granova.ds.ggplot.R 290 298)   }
863d348b R/granova.ds.ggplot.R 291 299) 
ef841aa1 R/granova.ds.ggplot.R 257 300)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 301)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 302)   
a71441d3 R/granova.ds.ggplot.R 261 303)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 304)   }
863d348b R/granova.ds.ggplot.R 297 305) 
794c4b70 R/granova.ds.ggplot.R 296 306)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 307)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 308)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 309)     }
a2b6fe7d R/granovagg.ds.R      320 310)     
a2b6fe7d R/granovagg.ds.R      321 311)     else {
a2b6fe7d R/granovagg.ds.R      322 312)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 313)     }
863d348b R/granova.ds.ggplot.R 304 314)   }
b5b60529 R/granova.ds.ggplot.R 270 315)   
b5b60529 R/granova.ds.ggplot.R 271 316)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 317)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 318)   }
b5b60529 R/granova.ds.ggplot.R 274 319)   
3b102930 R/granova.ds.ggplot.R 275 320)           
3eb0e1f7 R/granova.ds.ggplot.R 304 321)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 322)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 323)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 324)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 325)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 326)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 327)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 328)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 329)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 330)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 331)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 332)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 333)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 334)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 335)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 336) 
a71441d3 R/granova.ds.ggplot.R 288 337)   return(p)
5d58b37c R/granova.ds.bd.R     314 338) 
b3a74c98 R/granova.ds.bd.R     301 339) }
</pre>
<div class="compileroutput">
documented plot.theme parameter for granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="d6884e4"></a>
d6884e4 2011-08-17 22:49:10 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
2b0c8b84 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores. Also prints various
56bb21d6 R/granovagg.ds.R        6   6) #' summary statistics including: effect size, means for X and Y, a 95\%
2b0c8b84 R/granovagg.ds.R        7   7) #' confidence interval for the mean difference as well as the t-statistic and
2b0c8b84 R/granovagg.ds.R        8   8) #' degrees of freedom.
743b4d68 R/granovagg.ds.R        5   9) #' 
2b0c8b84 R/granovagg.ds.R       10  10) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11  11) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13  12) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  13) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  14) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  15) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  16) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  17) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  18) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  19) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  20) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  21) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  22) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  23) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  24) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  25) #' 
2b0c8b84 R/granovagg.ds.R       27  26) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  27) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  28) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  29) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  30) #' @param ylab optional label (as character) for vertical axis.
892e6c44 R/granovagg.ds.R       31  31) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  32) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
892e6c44 R/granovagg.ds.R       33  33) #' @return Returns a plot object of class \code{ggplot}. 
<span class="changed">d6884e47 R/granovagg.ds.R       34  34) #' @param conf.level The confidence level at which to perform a dependent sample t-test. </span>
<span class="changed">d6884e47 R/granovagg.ds.R       35  35) #' Defaults to \code{0.95} (95\% Confidence)</span>
62c4a36e R/granovagg.ds.R       34  36) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  37) #'   graphic; defaults to a customized theme created for the dependent sample graphic
56bb21d6 R/granovagg.ds.R       46  38) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  39) #' @export
2b0c8b84 R/granovagg.ds.R       71  40) 
ee1b067f R/granovagg.ds.R        1  41) granovagg.ds &lt;- function(data       = NULL, 
892e6c44 R/granovagg.ds.R       38  42)                               main       = "default_granova_title",
794c4b70 R/granova.ds.ggplot.R   3  43)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  44)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  45)                              ) 
be2e6fbd R/granova.ds.bd.R      19  46) 
be2e6fbd R/granova.ds.bd.R      20  47) {
d6c27487 R/granova.ds.bd.R      12  48)   
794c4b70 R/granova.ds.ggplot.R   9  49)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  50)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  51)   }
a806fcaa R/granova.ds.bd.R      15  52) 
794c4b70 R/granova.ds.ggplot.R  13  53)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  54)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  55)   }
e589a242 R/granova.ds.bd.R      17  56) 
794c4b70 R/granova.ds.ggplot.R  17  57)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  58)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  59)   }
c2605051 R/granova.ds.bd.R     182  60)   
794c4b70 R/granova.ds.ggplot.R  21  61)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  62)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  63)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  64)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  65)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  66)                  )
a71441d3 R/granova.ds.ggplot.R  27  67)           )
863d348b R/granova.ds.ggplot.R  30  68)   }
c2605051 R/granova.ds.bd.R     187  69)   
794c4b70 R/granova.ds.ggplot.R  30  70)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  71)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  72)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  73)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  74)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  75)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  76)                      )
a71441d3 R/granova.ds.ggplot.R  38  77)           )
863d348b R/granova.ds.ggplot.R  41  78)   }
c2605051 R/granova.ds.bd.R     191  79)   
794c4b70 R/granova.ds.ggplot.R  41  80)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  81)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  82)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  83)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  84)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  85)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  86)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  87)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  88)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  89)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  90)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  91)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  92)   
a71441d3 R/granova.ds.ggplot.R  54  93)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  94)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  95)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  96)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  97)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  98)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  99)                )
a71441d3 R/granova.ds.ggplot.R  61 100)           )
863d348b R/granova.ds.ggplot.R  64 101)   }
c2605051 R/granova.ds.bd.R     199 102)   
794c4b70 R/granova.ds.ggplot.R  64 103)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 104)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 105)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 106)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 107)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 108)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 109)   }
863d348b R/granova.ds.ggplot.R  73 110) 
794c4b70 R/granova.ds.ggplot.R  72 111)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 112)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 113)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 114)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 115)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 116)                      )
a71441d3 R/granova.ds.ggplot.R  78 117)           )  
863d348b R/granova.ds.ggplot.R  82 118)   }
c2605051 R/granova.ds.bd.R     209 119)   
794c4b70 R/granova.ds.ggplot.R  82 120)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 121)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 122)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 123)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 124)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 125)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 126)                      )
a71441d3 R/granova.ds.ggplot.R  88 127)           )
5f570d2d R/granova.ds.bd.R     190 128)     
863d348b R/granova.ds.ggplot.R  94 129)   }
c2605051 R/granova.ds.bd.R     224 130)   
794c4b70 R/granova.ds.ggplot.R  94 131)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 132)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 133)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 134)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 135)                      )
a71441d3 R/granova.ds.ggplot.R  97 136)           )
863d348b R/granova.ds.ggplot.R 103 137)   }
863d348b R/granova.ds.ggplot.R 104 138) 
794c4b70 R/granova.ds.ggplot.R 103 139)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 140)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 141)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 142)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 143)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 144)                      )
a71441d3 R/granova.ds.ggplot.R 106 145)           )
863d348b R/granova.ds.ggplot.R 114 146)   }
c2605051 R/granova.ds.bd.R     239 147)   
794c4b70 R/granova.ds.ggplot.R 114 148)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 149)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 150)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 151)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 152)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 153)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 154)                )
a71441d3 R/granova.ds.ggplot.R 116 155)           )         
863d348b R/granova.ds.ggplot.R 125 156)   }
863d348b R/granova.ds.ggplot.R 126 157) 
48638496 R/granova.ds.ggplot.R 119 158)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 159)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 160)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 161)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 162)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 163)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 164)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 165)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 166)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 167)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 168)     
c2605051 R/granova.ds.bd.R     256 169)   
863d348b R/granova.ds.ggplot.R 139 170) 
863d348b R/granova.ds.ggplot.R 140 171)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 172)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 173) 
863d348b R/granova.ds.ggplot.R 143 174)   
3eb0e1f7 R/granova.ds.ggplot.R 142 175)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 176)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 177)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 178)                             ),
a71441d3 R/granova.ds.ggplot.R 140 179)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 180)                  )
863d348b R/granova.ds.ggplot.R 151 181)           )
863d348b R/granova.ds.ggplot.R 152 182)   }
e60e59e1 R/granova.ds.bd.R     241 183)     
794c4b70 R/granova.ds.ggplot.R 152 184)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 185)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 186)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 187)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 188)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 189)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 190)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 191)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 192)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 193)                       )
a71441d3 R/granova.ds.ggplot.R 154 194)           )
863d348b R/granova.ds.ggplot.R 166 195)   }
863d348b R/granova.ds.ggplot.R 167 196) 
794c4b70 R/granova.ds.ggplot.R 166 197)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 198)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 199)   }
863d348b R/granova.ds.ggplot.R 174 200) 
3eb0e1f7 R/granova.ds.ggplot.R 173 201)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 202)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 203)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 204)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 205)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 206)                       )
a71441d3 R/granova.ds.ggplot.R 166 207)           )
863d348b R/granova.ds.ggplot.R 183 208)   }
863d348b R/granova.ds.ggplot.R 184 209) 
794c4b70 R/granova.ds.ggplot.R 183 210)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 211)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 212)   }
863d348b R/granova.ds.ggplot.R 188 213) 
794c4b70 R/granova.ds.ggplot.R 187 214)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 215)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 216)   }
863d348b R/granova.ds.ggplot.R 192 217) 
794c4b70 R/granova.ds.ggplot.R 191 218)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 219)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 220)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 221)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 222)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 223)                    )  
a71441d3 R/granova.ds.ggplot.R 183 224)           )
863d348b R/granova.ds.ggplot.R 202 225)   }
863d348b R/granova.ds.ggplot.R 203 226) 
794c4b70 R/granova.ds.ggplot.R 202 227)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 228)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 229)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 230)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 231)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 232)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 233)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 234)           )
863d348b R/granova.ds.ggplot.R 213 235)   }
c2605051 R/granova.ds.bd.R     271 236)   
794c4b70 R/granova.ds.ggplot.R 213 237)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 238)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 239)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 240)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 241)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 242)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 243)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 244)           )
aaeade58 R/granova.ds.bd.R     274 245)     
863d348b R/granova.ds.ggplot.R 225 246)   }
863d348b R/granova.ds.ggplot.R 226 247) 
794c4b70 R/granova.ds.ggplot.R 225 248)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 249)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 250)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 251)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 252)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 253)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 254)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 255)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 256)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 257)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 258)                        )  
a71441d3 R/granova.ds.ggplot.R 216 259)           )
863d348b R/granova.ds.ggplot.R 242 260)   }
863d348b R/granova.ds.ggplot.R 243 261) 
794c4b70 R/granova.ds.ggplot.R 242 262)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 263)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 264)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 265)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 266)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 267)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 268)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 269)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 270)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 271)                        )
a71441d3 R/granova.ds.ggplot.R 229 272)           )
863d348b R/granova.ds.ggplot.R 258 273)   }
863d348b R/granova.ds.ggplot.R 259 274) 
794c4b70 R/granova.ds.ggplot.R 258 275)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 276)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 277)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 278)                          ),
a71441d3 R/granova.ds.ggplot.R 236 279)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 280)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 281)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 282)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 283)                      )
a71441d3 R/granova.ds.ggplot.R 240 284)           )
863d348b R/granova.ds.ggplot.R 272 285)   }
863d348b R/granova.ds.ggplot.R 273 286) 
794c4b70 R/granova.ds.ggplot.R 272 287)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 288)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 289)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 290)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 291)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 292)                            ),
a71441d3 R/granova.ds.ggplot.R 249 293)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 294)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 295)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 296)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 297)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 298)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 299)           )
863d348b R/granova.ds.ggplot.R 290 300)   }
863d348b R/granova.ds.ggplot.R 291 301) 
ef841aa1 R/granova.ds.ggplot.R 257 302)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 303)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 304)   
a71441d3 R/granova.ds.ggplot.R 261 305)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 306)   }
863d348b R/granova.ds.ggplot.R 297 307) 
794c4b70 R/granova.ds.ggplot.R 296 308)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 309)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 310)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 311)     }
a2b6fe7d R/granovagg.ds.R      320 312)     
a2b6fe7d R/granovagg.ds.R      321 313)     else {
a2b6fe7d R/granovagg.ds.R      322 314)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 315)     }
863d348b R/granova.ds.ggplot.R 304 316)   }
b5b60529 R/granova.ds.ggplot.R 270 317)   
b5b60529 R/granova.ds.ggplot.R 271 318)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 319)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 320)   }
b5b60529 R/granova.ds.ggplot.R 274 321)   
3b102930 R/granova.ds.ggplot.R 275 322)           
3eb0e1f7 R/granova.ds.ggplot.R 304 323)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 324)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 325)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 326)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 327)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 328)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 329)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 330)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 331)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 332)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 333)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 334)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 335)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 336)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 337)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 338) 
a71441d3 R/granova.ds.ggplot.R 288 339)   return(p)
5d58b37c R/granova.ds.bd.R     314 340) 
b3a74c98 R/granova.ds.bd.R     301 341) }
</pre>
<div class="compileroutput">
Documented the conf.level parameter in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="3ad69d8"></a>
3ad69d8 2011-08-17 22:50:02 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
<span class="changed">3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.</span>
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  25) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  26) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  27) #' @param ylab optional label (as character) for vertical axis.
892e6c44 R/granovagg.ds.R       31  28) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  29) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
892e6c44 R/granovagg.ds.R       33  30) #' @return Returns a plot object of class \code{ggplot}. 
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
<span class="changed">3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)</span>
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
56bb21d6 R/granovagg.ds.R       46  35) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  36) #' @export
2b0c8b84 R/granovagg.ds.R       71  37) 
ee1b067f R/granovagg.ds.R        1  38) granovagg.ds &lt;- function(data       = NULL, 
892e6c44 R/granovagg.ds.R       38  39)                               main       = "default_granova_title",
794c4b70 R/granova.ds.ggplot.R   3  40)                               conf.level = 0.95,
c2efc919 R/granova.ds.ggplot.R   4  41)                               plot.theme = "theme_granova_ds"
794c4b70 R/granova.ds.ggplot.R   5  42)                              ) 
be2e6fbd R/granova.ds.bd.R      19  43) 
be2e6fbd R/granova.ds.bd.R      20  44) {
d6c27487 R/granova.ds.bd.R      12  45)   
794c4b70 R/granova.ds.ggplot.R   9  46)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  47)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  48)   }
a806fcaa R/granova.ds.bd.R      15  49) 
794c4b70 R/granova.ds.ggplot.R  13  50)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  51)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  52)   }
e589a242 R/granova.ds.bd.R      17  53) 
794c4b70 R/granova.ds.ggplot.R  17  54)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  55)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  56)   }
c2605051 R/granova.ds.bd.R     182  57)   
794c4b70 R/granova.ds.ggplot.R  21  58)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  59)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  60)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  61)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  62)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  63)                  )
a71441d3 R/granova.ds.ggplot.R  27  64)           )
863d348b R/granova.ds.ggplot.R  30  65)   }
c2605051 R/granova.ds.bd.R     187  66)   
794c4b70 R/granova.ds.ggplot.R  30  67)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  68)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  69)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  70)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  71)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  72)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  73)                      )
a71441d3 R/granova.ds.ggplot.R  38  74)           )
863d348b R/granova.ds.ggplot.R  41  75)   }
c2605051 R/granova.ds.bd.R     191  76)   
794c4b70 R/granova.ds.ggplot.R  41  77)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  78)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  79)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  80)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  81)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  82)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  83)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  84)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  85)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  86)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  87)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  88)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  89)   
a71441d3 R/granova.ds.ggplot.R  54  90)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  91)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  92)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  93)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  94)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  95)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  96)                )
a71441d3 R/granova.ds.ggplot.R  61  97)           )
863d348b R/granova.ds.ggplot.R  64  98)   }
c2605051 R/granova.ds.bd.R     199  99)   
794c4b70 R/granova.ds.ggplot.R  64 100)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 101)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 102)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 103)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 104)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 105)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 106)   }
863d348b R/granova.ds.ggplot.R  73 107) 
794c4b70 R/granova.ds.ggplot.R  72 108)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 109)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 110)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 111)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 112)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 113)                      )
a71441d3 R/granova.ds.ggplot.R  78 114)           )  
863d348b R/granova.ds.ggplot.R  82 115)   }
c2605051 R/granova.ds.bd.R     209 116)   
794c4b70 R/granova.ds.ggplot.R  82 117)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 118)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 119)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 120)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 121)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 122)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 123)                      )
a71441d3 R/granova.ds.ggplot.R  88 124)           )
5f570d2d R/granova.ds.bd.R     190 125)     
863d348b R/granova.ds.ggplot.R  94 126)   }
c2605051 R/granova.ds.bd.R     224 127)   
794c4b70 R/granova.ds.ggplot.R  94 128)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 129)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 130)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 131)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 132)                      )
a71441d3 R/granova.ds.ggplot.R  97 133)           )
863d348b R/granova.ds.ggplot.R 103 134)   }
863d348b R/granova.ds.ggplot.R 104 135) 
794c4b70 R/granova.ds.ggplot.R 103 136)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 137)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 138)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 139)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 140)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 141)                      )
a71441d3 R/granova.ds.ggplot.R 106 142)           )
863d348b R/granova.ds.ggplot.R 114 143)   }
c2605051 R/granova.ds.bd.R     239 144)   
794c4b70 R/granova.ds.ggplot.R 114 145)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 146)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 147)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 148)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 149)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 150)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 151)                )
a71441d3 R/granova.ds.ggplot.R 116 152)           )         
863d348b R/granova.ds.ggplot.R 125 153)   }
863d348b R/granova.ds.ggplot.R 126 154) 
48638496 R/granova.ds.ggplot.R 119 155)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 156)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 157)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 158)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 159)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 160)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 161)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 162)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 163)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 164)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 165)     
c2605051 R/granova.ds.bd.R     256 166)   
863d348b R/granova.ds.ggplot.R 139 167) 
863d348b R/granova.ds.ggplot.R 140 168)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 169)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 170) 
863d348b R/granova.ds.ggplot.R 143 171)   
3eb0e1f7 R/granova.ds.ggplot.R 142 172)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 173)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 174)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 175)                             ),
a71441d3 R/granova.ds.ggplot.R 140 176)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 177)                  )
863d348b R/granova.ds.ggplot.R 151 178)           )
863d348b R/granova.ds.ggplot.R 152 179)   }
e60e59e1 R/granova.ds.bd.R     241 180)     
794c4b70 R/granova.ds.ggplot.R 152 181)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 182)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 183)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 184)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 185)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 186)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 187)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 188)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 189)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 190)                       )
a71441d3 R/granova.ds.ggplot.R 154 191)           )
863d348b R/granova.ds.ggplot.R 166 192)   }
863d348b R/granova.ds.ggplot.R 167 193) 
794c4b70 R/granova.ds.ggplot.R 166 194)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 195)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 196)   }
863d348b R/granova.ds.ggplot.R 174 197) 
3eb0e1f7 R/granova.ds.ggplot.R 173 198)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 199)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 200)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 201)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 202)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 203)                       )
a71441d3 R/granova.ds.ggplot.R 166 204)           )
863d348b R/granova.ds.ggplot.R 183 205)   }
863d348b R/granova.ds.ggplot.R 184 206) 
794c4b70 R/granova.ds.ggplot.R 183 207)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 208)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 209)   }
863d348b R/granova.ds.ggplot.R 188 210) 
794c4b70 R/granova.ds.ggplot.R 187 211)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 212)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 213)   }
863d348b R/granova.ds.ggplot.R 192 214) 
794c4b70 R/granova.ds.ggplot.R 191 215)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 216)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 217)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 218)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 219)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 220)                    )  
a71441d3 R/granova.ds.ggplot.R 183 221)           )
863d348b R/granova.ds.ggplot.R 202 222)   }
863d348b R/granova.ds.ggplot.R 203 223) 
794c4b70 R/granova.ds.ggplot.R 202 224)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 225)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 226)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 227)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 228)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 229)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 230)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 231)           )
863d348b R/granova.ds.ggplot.R 213 232)   }
c2605051 R/granova.ds.bd.R     271 233)   
794c4b70 R/granova.ds.ggplot.R 213 234)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 235)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 236)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 237)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 238)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 239)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 240)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 241)           )
aaeade58 R/granova.ds.bd.R     274 242)     
863d348b R/granova.ds.ggplot.R 225 243)   }
863d348b R/granova.ds.ggplot.R 226 244) 
794c4b70 R/granova.ds.ggplot.R 225 245)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 246)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 247)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 248)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 249)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 250)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 251)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 252)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 253)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 254)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 255)                        )  
a71441d3 R/granova.ds.ggplot.R 216 256)           )
863d348b R/granova.ds.ggplot.R 242 257)   }
863d348b R/granova.ds.ggplot.R 243 258) 
794c4b70 R/granova.ds.ggplot.R 242 259)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 260)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 261)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 262)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 263)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 264)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 265)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 266)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 267)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 268)                        )
a71441d3 R/granova.ds.ggplot.R 229 269)           )
863d348b R/granova.ds.ggplot.R 258 270)   }
863d348b R/granova.ds.ggplot.R 259 271) 
794c4b70 R/granova.ds.ggplot.R 258 272)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 273)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 274)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 275)                          ),
a71441d3 R/granova.ds.ggplot.R 236 276)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 277)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 278)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 279)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 280)                      )
a71441d3 R/granova.ds.ggplot.R 240 281)           )
863d348b R/granova.ds.ggplot.R 272 282)   }
863d348b R/granova.ds.ggplot.R 273 283) 
794c4b70 R/granova.ds.ggplot.R 272 284)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 285)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 286)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 287)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 288)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 289)                            ),
a71441d3 R/granova.ds.ggplot.R 249 290)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 291)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 292)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 293)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 294)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 295)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 296)           )
863d348b R/granova.ds.ggplot.R 290 297)   }
863d348b R/granova.ds.ggplot.R 291 298) 
ef841aa1 R/granova.ds.ggplot.R 257 299)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 300)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 301)   
a71441d3 R/granova.ds.ggplot.R 261 302)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 303)   }
863d348b R/granova.ds.ggplot.R 297 304) 
794c4b70 R/granova.ds.ggplot.R 296 305)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 306)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 307)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 308)     }
a2b6fe7d R/granovagg.ds.R      320 309)     
a2b6fe7d R/granovagg.ds.R      321 310)     else {
a2b6fe7d R/granovagg.ds.R      322 311)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 312)     }
863d348b R/granova.ds.ggplot.R 304 313)   }
b5b60529 R/granova.ds.ggplot.R 270 314)   
b5b60529 R/granova.ds.ggplot.R 271 315)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 316)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 317)   }
b5b60529 R/granova.ds.ggplot.R 274 318)   
3b102930 R/granova.ds.ggplot.R 275 319)           
3eb0e1f7 R/granova.ds.ggplot.R 304 320)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 321)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 322)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 323)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 324)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 325)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 326)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 327)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 328)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 329)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 330)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 331)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 332)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 333)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 334)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 335) 
a71441d3 R/granova.ds.ggplot.R 288 336)   return(p)
5d58b37c R/granova.ds.bd.R     314 337) 
b3a74c98 R/granova.ds.bd.R     301 338) }
</pre>
<div class="compileroutput">
Removed legacy documentation about printed output from granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="e55d776"></a>
e55d776 2011-08-17 22:51:20 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  25) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  26) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  27) #' @param ylab optional label (as character) for vertical axis.
892e6c44 R/granovagg.ds.R       31  28) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  29) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
892e6c44 R/granovagg.ds.R       33  30) #' @return Returns a plot object of class \code{ggplot}. 
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
56bb21d6 R/granovagg.ds.R       46  35) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  36) #' @export
2b0c8b84 R/granovagg.ds.R       71  37) 
ee1b067f R/granovagg.ds.R        1  38) granovagg.ds &lt;- function(data       = NULL, 
<span class="changed">e55d776c R/granovagg.ds.R       39  39)                          main       = "default_granova_title",</span>
<span class="changed">e55d776c R/granovagg.ds.R       40  40)                          conf.level = 0.95,</span>
<span class="changed">e55d776c R/granovagg.ds.R       41  41)                          plot.theme = "theme_granova_ds"</span>
<span class="changed">e55d776c R/granovagg.ds.R       42  42)                 ) </span>
be2e6fbd R/granova.ds.bd.R      19  43) 
be2e6fbd R/granova.ds.bd.R      20  44) {
d6c27487 R/granova.ds.bd.R      12  45)   
794c4b70 R/granova.ds.ggplot.R   9  46)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  47)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  48)   }
a806fcaa R/granova.ds.bd.R      15  49) 
794c4b70 R/granova.ds.ggplot.R  13  50)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  51)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  52)   }
e589a242 R/granova.ds.bd.R      17  53) 
794c4b70 R/granova.ds.ggplot.R  17  54)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  55)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  56)   }
c2605051 R/granova.ds.bd.R     182  57)   
794c4b70 R/granova.ds.ggplot.R  21  58)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  59)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  60)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  61)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  62)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  63)                  )
a71441d3 R/granova.ds.ggplot.R  27  64)           )
863d348b R/granova.ds.ggplot.R  30  65)   }
c2605051 R/granova.ds.bd.R     187  66)   
794c4b70 R/granova.ds.ggplot.R  30  67)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  68)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  69)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  70)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  71)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  72)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  73)                      )
a71441d3 R/granova.ds.ggplot.R  38  74)           )
863d348b R/granova.ds.ggplot.R  41  75)   }
c2605051 R/granova.ds.bd.R     191  76)   
794c4b70 R/granova.ds.ggplot.R  41  77)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  78)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  79)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  80)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  81)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  82)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  83)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  84)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  85)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  86)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  87)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  88)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  89)   
a71441d3 R/granova.ds.ggplot.R  54  90)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  91)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  92)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  93)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  94)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  95)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  96)                )
a71441d3 R/granova.ds.ggplot.R  61  97)           )
863d348b R/granova.ds.ggplot.R  64  98)   }
c2605051 R/granova.ds.bd.R     199  99)   
794c4b70 R/granova.ds.ggplot.R  64 100)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 101)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 102)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 103)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 104)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 105)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 106)   }
863d348b R/granova.ds.ggplot.R  73 107) 
794c4b70 R/granova.ds.ggplot.R  72 108)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 109)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 110)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 111)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 112)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 113)                      )
a71441d3 R/granova.ds.ggplot.R  78 114)           )  
863d348b R/granova.ds.ggplot.R  82 115)   }
c2605051 R/granova.ds.bd.R     209 116)   
794c4b70 R/granova.ds.ggplot.R  82 117)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 118)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 119)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 120)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 121)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 122)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 123)                      )
a71441d3 R/granova.ds.ggplot.R  88 124)           )
5f570d2d R/granova.ds.bd.R     190 125)     
863d348b R/granova.ds.ggplot.R  94 126)   }
c2605051 R/granova.ds.bd.R     224 127)   
794c4b70 R/granova.ds.ggplot.R  94 128)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 129)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 130)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 131)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 132)                      )
a71441d3 R/granova.ds.ggplot.R  97 133)           )
863d348b R/granova.ds.ggplot.R 103 134)   }
863d348b R/granova.ds.ggplot.R 104 135) 
794c4b70 R/granova.ds.ggplot.R 103 136)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 137)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 138)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 139)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 140)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 141)                      )
a71441d3 R/granova.ds.ggplot.R 106 142)           )
863d348b R/granova.ds.ggplot.R 114 143)   }
c2605051 R/granova.ds.bd.R     239 144)   
794c4b70 R/granova.ds.ggplot.R 114 145)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 146)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 147)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 148)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 149)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 150)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 151)                )
a71441d3 R/granova.ds.ggplot.R 116 152)           )         
863d348b R/granova.ds.ggplot.R 125 153)   }
863d348b R/granova.ds.ggplot.R 126 154) 
48638496 R/granova.ds.ggplot.R 119 155)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 156)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 157)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 158)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 159)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 160)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 161)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 162)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 163)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 164)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 165)     
c2605051 R/granova.ds.bd.R     256 166)   
863d348b R/granova.ds.ggplot.R 139 167) 
863d348b R/granova.ds.ggplot.R 140 168)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 169)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 170) 
863d348b R/granova.ds.ggplot.R 143 171)   
3eb0e1f7 R/granova.ds.ggplot.R 142 172)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 173)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 174)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 175)                             ),
a71441d3 R/granova.ds.ggplot.R 140 176)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 177)                  )
863d348b R/granova.ds.ggplot.R 151 178)           )
863d348b R/granova.ds.ggplot.R 152 179)   }
e60e59e1 R/granova.ds.bd.R     241 180)     
794c4b70 R/granova.ds.ggplot.R 152 181)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 182)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 183)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 184)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 185)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 186)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 187)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 188)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 189)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 190)                       )
a71441d3 R/granova.ds.ggplot.R 154 191)           )
863d348b R/granova.ds.ggplot.R 166 192)   }
863d348b R/granova.ds.ggplot.R 167 193) 
794c4b70 R/granova.ds.ggplot.R 166 194)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 195)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 196)   }
863d348b R/granova.ds.ggplot.R 174 197) 
3eb0e1f7 R/granova.ds.ggplot.R 173 198)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 199)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 200)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 201)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 202)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 203)                       )
a71441d3 R/granova.ds.ggplot.R 166 204)           )
863d348b R/granova.ds.ggplot.R 183 205)   }
863d348b R/granova.ds.ggplot.R 184 206) 
794c4b70 R/granova.ds.ggplot.R 183 207)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 208)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 209)   }
863d348b R/granova.ds.ggplot.R 188 210) 
794c4b70 R/granova.ds.ggplot.R 187 211)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 212)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 213)   }
863d348b R/granova.ds.ggplot.R 192 214) 
794c4b70 R/granova.ds.ggplot.R 191 215)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 216)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 217)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 218)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 219)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 220)                    )  
a71441d3 R/granova.ds.ggplot.R 183 221)           )
863d348b R/granova.ds.ggplot.R 202 222)   }
863d348b R/granova.ds.ggplot.R 203 223) 
794c4b70 R/granova.ds.ggplot.R 202 224)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 225)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 226)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 227)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 228)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 229)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 230)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 231)           )
863d348b R/granova.ds.ggplot.R 213 232)   }
c2605051 R/granova.ds.bd.R     271 233)   
794c4b70 R/granova.ds.ggplot.R 213 234)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 235)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 236)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 237)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 238)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 239)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 240)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 241)           )
aaeade58 R/granova.ds.bd.R     274 242)     
863d348b R/granova.ds.ggplot.R 225 243)   }
863d348b R/granova.ds.ggplot.R 226 244) 
794c4b70 R/granova.ds.ggplot.R 225 245)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 246)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 247)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 248)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 249)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 250)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 251)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 252)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 253)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 254)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 255)                        )  
a71441d3 R/granova.ds.ggplot.R 216 256)           )
863d348b R/granova.ds.ggplot.R 242 257)   }
863d348b R/granova.ds.ggplot.R 243 258) 
794c4b70 R/granova.ds.ggplot.R 242 259)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 260)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 261)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 262)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 263)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 264)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 265)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 266)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 267)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 268)                        )
a71441d3 R/granova.ds.ggplot.R 229 269)           )
863d348b R/granova.ds.ggplot.R 258 270)   }
863d348b R/granova.ds.ggplot.R 259 271) 
794c4b70 R/granova.ds.ggplot.R 258 272)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 273)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 274)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 275)                          ),
a71441d3 R/granova.ds.ggplot.R 236 276)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 277)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 278)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 279)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 280)                      )
a71441d3 R/granova.ds.ggplot.R 240 281)           )
863d348b R/granova.ds.ggplot.R 272 282)   }
863d348b R/granova.ds.ggplot.R 273 283) 
794c4b70 R/granova.ds.ggplot.R 272 284)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 285)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 286)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 287)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 288)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 289)                            ),
a71441d3 R/granova.ds.ggplot.R 249 290)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 291)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 292)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 293)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 294)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 295)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 296)           )
863d348b R/granova.ds.ggplot.R 290 297)   }
863d348b R/granova.ds.ggplot.R 291 298) 
ef841aa1 R/granova.ds.ggplot.R 257 299)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 300)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 301)   
a71441d3 R/granova.ds.ggplot.R 261 302)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 303)   }
863d348b R/granova.ds.ggplot.R 297 304) 
794c4b70 R/granova.ds.ggplot.R 296 305)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 306)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 307)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 308)     }
a2b6fe7d R/granovagg.ds.R      320 309)     
a2b6fe7d R/granovagg.ds.R      321 310)     else {
a2b6fe7d R/granovagg.ds.R      322 311)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 312)     }
863d348b R/granova.ds.ggplot.R 304 313)   }
b5b60529 R/granova.ds.ggplot.R 270 314)   
b5b60529 R/granova.ds.ggplot.R 271 315)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 316)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 317)   }
b5b60529 R/granova.ds.ggplot.R 274 318)   
3b102930 R/granova.ds.ggplot.R 275 319)           
3eb0e1f7 R/granova.ds.ggplot.R 304 320)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 321)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 322)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 323)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 324)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 325)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 326)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 327)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 328)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 329)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 330)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 331)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 332)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 333)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 334)   p &lt;- p + Title()
e589a242 R/granova.ds.bd.R     316 335) 
a71441d3 R/granova.ds.ggplot.R 288 336)   return(p)
5d58b37c R/granova.ds.bd.R     314 337) 
b3a74c98 R/granova.ds.bd.R     301 338) }
</pre>
<div class="compileroutput">
formatting and whitespace changes in granovagg.ds signature<p></p><p><br>
</p></div>
</td>
<td>
<a name="0afa3a3"></a>
0afa3a3 2011-08-17 23:01:20 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
2b0c8b84 R/granovagg.ds.R       51  25) #' @param xlab optional label (as character) for horizontal axis. If not
2b0c8b84 R/granovagg.ds.R       52  26) #'   defined, axis labels are taken from colnames of data.
2b0c8b84 R/granovagg.ds.R       53  27) #' @param ylab optional label (as character) for vertical axis.
892e6c44 R/granovagg.ds.R       31  28) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  29) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
892e6c44 R/granovagg.ds.R       33  30) #' @return Returns a plot object of class \code{ggplot}. 
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
56bb21d6 R/granovagg.ds.R       46  35) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  36) #' @export
2b0c8b84 R/granovagg.ds.R       71  37) 
ee1b067f R/granovagg.ds.R        1  38) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  39)                          main       = "default_granova_title",
<span class="changed">0afa3a38 R/granovagg.ds.R       40  40)                          xlab       = NULL,</span>
e55d776c R/granovagg.ds.R       40  41)                          conf.level = 0.95,
e55d776c R/granovagg.ds.R       41  42)                          plot.theme = "theme_granova_ds"
e55d776c R/granovagg.ds.R       42  43)                 ) 
be2e6fbd R/granova.ds.bd.R      19  44) 
be2e6fbd R/granova.ds.bd.R      20  45) {
d6c27487 R/granova.ds.bd.R      12  46)   
794c4b70 R/granova.ds.ggplot.R   9  47)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  48)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  49)   }
a806fcaa R/granova.ds.bd.R      15  50) 
794c4b70 R/granova.ds.ggplot.R  13  51)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  52)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  53)   }
e589a242 R/granova.ds.bd.R      17  54) 
794c4b70 R/granova.ds.ggplot.R  17  55)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  56)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  57)   }
c2605051 R/granova.ds.bd.R     182  58)   
794c4b70 R/granova.ds.ggplot.R  21  59)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  60)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  61)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  62)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  63)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  64)                  )
a71441d3 R/granova.ds.ggplot.R  27  65)           )
863d348b R/granova.ds.ggplot.R  30  66)   }
c2605051 R/granova.ds.bd.R     187  67)   
794c4b70 R/granova.ds.ggplot.R  30  68)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  69)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  70)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  71)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  72)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  73)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  74)                      )
a71441d3 R/granova.ds.ggplot.R  38  75)           )
863d348b R/granova.ds.ggplot.R  41  76)   }
c2605051 R/granova.ds.bd.R     191  77)   
794c4b70 R/granova.ds.ggplot.R  41  78)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  79)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  80)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  81)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  82)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  83)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  84)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  85)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  86)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  87)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  88)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  89)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  90)   
a71441d3 R/granova.ds.ggplot.R  54  91)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  92)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  93)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  94)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  95)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  96)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  97)                )
a71441d3 R/granova.ds.ggplot.R  61  98)           )
863d348b R/granova.ds.ggplot.R  64  99)   }
c2605051 R/granova.ds.bd.R     199 100)   
794c4b70 R/granova.ds.ggplot.R  64 101)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 102)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 103)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 104)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 105)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 106)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 107)   }
863d348b R/granova.ds.ggplot.R  73 108) 
794c4b70 R/granova.ds.ggplot.R  72 109)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 110)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 111)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 112)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 113)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 114)                      )
a71441d3 R/granova.ds.ggplot.R  78 115)           )  
863d348b R/granova.ds.ggplot.R  82 116)   }
c2605051 R/granova.ds.bd.R     209 117)   
794c4b70 R/granova.ds.ggplot.R  82 118)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 119)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 120)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 121)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 122)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 123)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 124)                      )
a71441d3 R/granova.ds.ggplot.R  88 125)           )
5f570d2d R/granova.ds.bd.R     190 126)     
863d348b R/granova.ds.ggplot.R  94 127)   }
c2605051 R/granova.ds.bd.R     224 128)   
794c4b70 R/granova.ds.ggplot.R  94 129)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 130)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 131)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 132)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 133)                      )
a71441d3 R/granova.ds.ggplot.R  97 134)           )
863d348b R/granova.ds.ggplot.R 103 135)   }
863d348b R/granova.ds.ggplot.R 104 136) 
794c4b70 R/granova.ds.ggplot.R 103 137)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 138)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 139)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 140)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 141)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 142)                      )
a71441d3 R/granova.ds.ggplot.R 106 143)           )
863d348b R/granova.ds.ggplot.R 114 144)   }
c2605051 R/granova.ds.bd.R     239 145)   
794c4b70 R/granova.ds.ggplot.R 114 146)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 147)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 148)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 149)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 150)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 151)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 152)                )
a71441d3 R/granova.ds.ggplot.R 116 153)           )         
863d348b R/granova.ds.ggplot.R 125 154)   }
863d348b R/granova.ds.ggplot.R 126 155) 
48638496 R/granova.ds.ggplot.R 119 156)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 157)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 158)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 159)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 160)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 161)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 162)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 163)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 164)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 165)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 166)     
c2605051 R/granova.ds.bd.R     256 167)   
863d348b R/granova.ds.ggplot.R 139 168) 
863d348b R/granova.ds.ggplot.R 140 169)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 170)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 171) 
863d348b R/granova.ds.ggplot.R 143 172)   
3eb0e1f7 R/granova.ds.ggplot.R 142 173)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 174)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 175)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 176)                             ),
a71441d3 R/granova.ds.ggplot.R 140 177)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 178)                  )
863d348b R/granova.ds.ggplot.R 151 179)           )
863d348b R/granova.ds.ggplot.R 152 180)   }
e60e59e1 R/granova.ds.bd.R     241 181)     
794c4b70 R/granova.ds.ggplot.R 152 182)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 183)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 184)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 185)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 186)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 187)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 188)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 189)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 190)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 191)                       )
a71441d3 R/granova.ds.ggplot.R 154 192)           )
863d348b R/granova.ds.ggplot.R 166 193)   }
863d348b R/granova.ds.ggplot.R 167 194) 
794c4b70 R/granova.ds.ggplot.R 166 195)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 196)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 197)   }
863d348b R/granova.ds.ggplot.R 174 198) 
3eb0e1f7 R/granova.ds.ggplot.R 173 199)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 200)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 201)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 202)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 203)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 204)                       )
a71441d3 R/granova.ds.ggplot.R 166 205)           )
863d348b R/granova.ds.ggplot.R 183 206)   }
863d348b R/granova.ds.ggplot.R 184 207) 
794c4b70 R/granova.ds.ggplot.R 183 208)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 209)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 210)   }
863d348b R/granova.ds.ggplot.R 188 211) 
794c4b70 R/granova.ds.ggplot.R 187 212)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 213)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 214)   }
863d348b R/granova.ds.ggplot.R 192 215) 
794c4b70 R/granova.ds.ggplot.R 191 216)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 217)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 218)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 219)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 220)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 221)                    )  
a71441d3 R/granova.ds.ggplot.R 183 222)           )
863d348b R/granova.ds.ggplot.R 202 223)   }
863d348b R/granova.ds.ggplot.R 203 224) 
794c4b70 R/granova.ds.ggplot.R 202 225)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 226)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 227)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 228)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 229)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 230)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 231)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 232)           )
863d348b R/granova.ds.ggplot.R 213 233)   }
c2605051 R/granova.ds.bd.R     271 234)   
794c4b70 R/granova.ds.ggplot.R 213 235)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 236)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 237)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 238)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 239)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 240)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 241)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 242)           )
aaeade58 R/granova.ds.bd.R     274 243)     
863d348b R/granova.ds.ggplot.R 225 244)   }
863d348b R/granova.ds.ggplot.R 226 245) 
794c4b70 R/granova.ds.ggplot.R 225 246)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 247)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 248)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 249)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 250)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 251)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 252)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 253)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 254)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 255)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 256)                        )  
a71441d3 R/granova.ds.ggplot.R 216 257)           )
863d348b R/granova.ds.ggplot.R 242 258)   }
863d348b R/granova.ds.ggplot.R 243 259) 
794c4b70 R/granova.ds.ggplot.R 242 260)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 261)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 262)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 263)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 264)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 265)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 266)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 267)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 268)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 269)                        )
a71441d3 R/granova.ds.ggplot.R 229 270)           )
863d348b R/granova.ds.ggplot.R 258 271)   }
863d348b R/granova.ds.ggplot.R 259 272) 
794c4b70 R/granova.ds.ggplot.R 258 273)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 274)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 275)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 276)                          ),
a71441d3 R/granova.ds.ggplot.R 236 277)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 278)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 279)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 280)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 281)                      )
a71441d3 R/granova.ds.ggplot.R 240 282)           )
863d348b R/granova.ds.ggplot.R 272 283)   }
863d348b R/granova.ds.ggplot.R 273 284) 
794c4b70 R/granova.ds.ggplot.R 272 285)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 286)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 287)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 288)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 289)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 290)                            ),
a71441d3 R/granova.ds.ggplot.R 249 291)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 292)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 293)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 294)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 295)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 296)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 297)           )
863d348b R/granova.ds.ggplot.R 290 298)   }
863d348b R/granova.ds.ggplot.R 291 299) 
ef841aa1 R/granova.ds.ggplot.R 257 300)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 301)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 302)   
a71441d3 R/granova.ds.ggplot.R 261 303)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 304)   }
863d348b R/granova.ds.ggplot.R 297 305) 
<span class="changed">0afa3a38 R/granovagg.ds.R      306 306)   XLabel &lt;- function(dsp) {</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      307 307)     result &lt;- colnames(dsp$data)</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      308 308)     if(!is.null(xlab)) {</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      309 309)       result &lt;- xlab</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      310 310)     }</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      311 311)     </span>
<span class="changed">0afa3a38 R/granovagg.ds.R      312 312)     return(xlab(result))</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      313 313)   }</span>
<span class="changed">0afa3a38 R/granovagg.ds.R      314 314)   </span>
794c4b70 R/granova.ds.ggplot.R 296 315)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 316)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 317)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 318)     }
a2b6fe7d R/granovagg.ds.R      320 319)     
a2b6fe7d R/granovagg.ds.R      321 320)     else {
a2b6fe7d R/granovagg.ds.R      322 321)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 322)     }
863d348b R/granova.ds.ggplot.R 304 323)   }
b5b60529 R/granova.ds.ggplot.R 270 324)   
b5b60529 R/granova.ds.ggplot.R 271 325)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 326)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 327)   }
b5b60529 R/granova.ds.ggplot.R 274 328)   
3b102930 R/granova.ds.ggplot.R 275 329)           
3eb0e1f7 R/granova.ds.ggplot.R 304 330)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 331)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 332)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 333)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 334)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 335)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 336)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 337)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 338)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 339)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 340)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 341)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 342)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 343)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 344)   p &lt;- p + Title()
<span class="changed">0afa3a38 R/granovagg.ds.R      345 345)   p &lt;- p + XLabel(dsp)</span>
e589a242 R/granova.ds.bd.R     316 346) 
a71441d3 R/granova.ds.ggplot.R 288 347)   return(p)
5d58b37c R/granova.ds.bd.R     314 348) 
b3a74c98 R/granova.ds.bd.R     301 349) }
</pre>
<div class="compileroutput">
granovagg.ds now accepts an xlab argument.<p></p><p><br>
</p></div>
</td>
<td>
<a name="485d5f0"></a>
485d5f0 2011-08-17 23:09:04 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
<span class="changed">485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not</span>
<span class="changed">485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.</span>
<span class="changed">485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not</span>
<span class="changed">485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.</span>
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
<span class="changed">485d5f02 R/granovagg.ds.R       35  35) #' @return Returns a plot object of class \code{ggplot}. </span>
56bb21d6 R/granovagg.ds.R       46  36) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  37) #' @export
2b0c8b84 R/granovagg.ds.R       71  38) 
ee1b067f R/granovagg.ds.R        1  39) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  40)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  41)                          xlab       = NULL,
<span class="changed">485d5f02 R/granovagg.ds.R       42  42)                          ylab       = NULL,</span>
e55d776c R/granovagg.ds.R       40  43)                          conf.level = 0.95,
e55d776c R/granovagg.ds.R       41  44)                          plot.theme = "theme_granova_ds"
e55d776c R/granovagg.ds.R       42  45)                 ) 
be2e6fbd R/granova.ds.bd.R      19  46) 
be2e6fbd R/granova.ds.bd.R      20  47) {
d6c27487 R/granova.ds.bd.R      12  48)   
794c4b70 R/granova.ds.ggplot.R   9  49)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  50)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  51)   }
a806fcaa R/granova.ds.bd.R      15  52) 
794c4b70 R/granova.ds.ggplot.R  13  53)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  54)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  55)   }
e589a242 R/granova.ds.bd.R      17  56) 
794c4b70 R/granova.ds.ggplot.R  17  57)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  58)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  59)   }
c2605051 R/granova.ds.bd.R     182  60)   
794c4b70 R/granova.ds.ggplot.R  21  61)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  62)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  63)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  64)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  65)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  66)                  )
a71441d3 R/granova.ds.ggplot.R  27  67)           )
863d348b R/granova.ds.ggplot.R  30  68)   }
c2605051 R/granova.ds.bd.R     187  69)   
794c4b70 R/granova.ds.ggplot.R  30  70)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  71)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  72)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  73)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  74)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  75)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  76)                      )
a71441d3 R/granova.ds.ggplot.R  38  77)           )
863d348b R/granova.ds.ggplot.R  41  78)   }
c2605051 R/granova.ds.bd.R     191  79)   
794c4b70 R/granova.ds.ggplot.R  41  80)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  81)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  82)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  83)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  84)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  85)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  86)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  87)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  88)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  89)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  90)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  91)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  92)   
a71441d3 R/granova.ds.ggplot.R  54  93)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  94)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56  95)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57  96)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57  97)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59  98)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60  99)                )
a71441d3 R/granova.ds.ggplot.R  61 100)           )
863d348b R/granova.ds.ggplot.R  64 101)   }
c2605051 R/granova.ds.bd.R     199 102)   
794c4b70 R/granova.ds.ggplot.R  64 103)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 104)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 105)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 106)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 107)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 108)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 109)   }
863d348b R/granova.ds.ggplot.R  73 110) 
794c4b70 R/granova.ds.ggplot.R  72 111)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 112)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 113)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 114)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 115)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 116)                      )
a71441d3 R/granova.ds.ggplot.R  78 117)           )  
863d348b R/granova.ds.ggplot.R  82 118)   }
c2605051 R/granova.ds.bd.R     209 119)   
794c4b70 R/granova.ds.ggplot.R  82 120)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 121)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 122)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 123)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 124)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 125)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 126)                      )
a71441d3 R/granova.ds.ggplot.R  88 127)           )
5f570d2d R/granova.ds.bd.R     190 128)     
863d348b R/granova.ds.ggplot.R  94 129)   }
c2605051 R/granova.ds.bd.R     224 130)   
794c4b70 R/granova.ds.ggplot.R  94 131)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 132)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 133)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 134)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 135)                      )
a71441d3 R/granova.ds.ggplot.R  97 136)           )
863d348b R/granova.ds.ggplot.R 103 137)   }
863d348b R/granova.ds.ggplot.R 104 138) 
794c4b70 R/granova.ds.ggplot.R 103 139)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 140)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 141)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 142)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 143)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 144)                      )
a71441d3 R/granova.ds.ggplot.R 106 145)           )
863d348b R/granova.ds.ggplot.R 114 146)   }
c2605051 R/granova.ds.bd.R     239 147)   
794c4b70 R/granova.ds.ggplot.R 114 148)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 149)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 150)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 151)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 152)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 153)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 154)                )
a71441d3 R/granova.ds.ggplot.R 116 155)           )         
863d348b R/granova.ds.ggplot.R 125 156)   }
863d348b R/granova.ds.ggplot.R 126 157) 
48638496 R/granova.ds.ggplot.R 119 158)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 159)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 160)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 161)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 162)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 163)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 164)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 165)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 166)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 167)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 168)     
c2605051 R/granova.ds.bd.R     256 169)   
863d348b R/granova.ds.ggplot.R 139 170) 
863d348b R/granova.ds.ggplot.R 140 171)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 172)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 173) 
863d348b R/granova.ds.ggplot.R 143 174)   
3eb0e1f7 R/granova.ds.ggplot.R 142 175)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 176)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 177)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 178)                             ),
a71441d3 R/granova.ds.ggplot.R 140 179)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 180)                  )
863d348b R/granova.ds.ggplot.R 151 181)           )
863d348b R/granova.ds.ggplot.R 152 182)   }
e60e59e1 R/granova.ds.bd.R     241 183)     
794c4b70 R/granova.ds.ggplot.R 152 184)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 185)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 186)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 187)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 188)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 189)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 190)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 191)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 192)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 193)                       )
a71441d3 R/granova.ds.ggplot.R 154 194)           )
863d348b R/granova.ds.ggplot.R 166 195)   }
863d348b R/granova.ds.ggplot.R 167 196) 
794c4b70 R/granova.ds.ggplot.R 166 197)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 198)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 199)   }
863d348b R/granova.ds.ggplot.R 174 200) 
3eb0e1f7 R/granova.ds.ggplot.R 173 201)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 202)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 203)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 204)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 205)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 206)                       )
a71441d3 R/granova.ds.ggplot.R 166 207)           )
863d348b R/granova.ds.ggplot.R 183 208)   }
863d348b R/granova.ds.ggplot.R 184 209) 
794c4b70 R/granova.ds.ggplot.R 183 210)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 211)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 212)   }
863d348b R/granova.ds.ggplot.R 188 213) 
794c4b70 R/granova.ds.ggplot.R 187 214)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 215)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 216)   }
863d348b R/granova.ds.ggplot.R 192 217) 
794c4b70 R/granova.ds.ggplot.R 191 218)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 219)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 220)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 221)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 222)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 223)                    )  
a71441d3 R/granova.ds.ggplot.R 183 224)           )
863d348b R/granova.ds.ggplot.R 202 225)   }
863d348b R/granova.ds.ggplot.R 203 226) 
794c4b70 R/granova.ds.ggplot.R 202 227)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 228)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 229)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 230)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 231)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 232)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 233)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 234)           )
863d348b R/granova.ds.ggplot.R 213 235)   }
c2605051 R/granova.ds.bd.R     271 236)   
794c4b70 R/granova.ds.ggplot.R 213 237)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 238)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 239)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 240)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 241)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 242)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 243)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 244)           )
aaeade58 R/granova.ds.bd.R     274 245)     
863d348b R/granova.ds.ggplot.R 225 246)   }
863d348b R/granova.ds.ggplot.R 226 247) 
794c4b70 R/granova.ds.ggplot.R 225 248)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 249)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 250)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 251)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 252)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 253)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 254)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 255)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 256)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 257)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 258)                        )  
a71441d3 R/granova.ds.ggplot.R 216 259)           )
863d348b R/granova.ds.ggplot.R 242 260)   }
863d348b R/granova.ds.ggplot.R 243 261) 
794c4b70 R/granova.ds.ggplot.R 242 262)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 263)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 264)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 265)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 266)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 267)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 268)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 269)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 270)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 271)                        )
a71441d3 R/granova.ds.ggplot.R 229 272)           )
863d348b R/granova.ds.ggplot.R 258 273)   }
863d348b R/granova.ds.ggplot.R 259 274) 
794c4b70 R/granova.ds.ggplot.R 258 275)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 276)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 277)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 278)                          ),
a71441d3 R/granova.ds.ggplot.R 236 279)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 280)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 281)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 282)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 283)                      )
a71441d3 R/granova.ds.ggplot.R 240 284)           )
863d348b R/granova.ds.ggplot.R 272 285)   }
863d348b R/granova.ds.ggplot.R 273 286) 
794c4b70 R/granova.ds.ggplot.R 272 287)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 288)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 289)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 290)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 291)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 292)                            ),
a71441d3 R/granova.ds.ggplot.R 249 293)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 294)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 295)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 296)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 297)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 298)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 299)           )
863d348b R/granova.ds.ggplot.R 290 300)   }
863d348b R/granova.ds.ggplot.R 291 301) 
ef841aa1 R/granova.ds.ggplot.R 257 302)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 303)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 304)   
a71441d3 R/granova.ds.ggplot.R 261 305)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 306)   }
863d348b R/granova.ds.ggplot.R 297 307) 
0afa3a38 R/granovagg.ds.R      306 308)   XLabel &lt;- function(dsp) {
0afa3a38 R/granovagg.ds.R      307 309)     result &lt;- colnames(dsp$data)
0afa3a38 R/granovagg.ds.R      308 310)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 311)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 312)     }
0afa3a38 R/granovagg.ds.R      311 313)     
0afa3a38 R/granovagg.ds.R      312 314)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 315)   }
0afa3a38 R/granovagg.ds.R      314 316)   
<span class="changed">485d5f02 R/granovagg.ds.R      317 317)   YLabel &lt;- function(dsp) {</span>
<span class="changed">485d5f02 R/granovagg.ds.R      318 318)     result &lt;- colnames(dsp$data)</span>
<span class="changed">485d5f02 R/granovagg.ds.R      319 319)     if(!is.null(ylab)) {</span>
<span class="changed">485d5f02 R/granovagg.ds.R      320 320)       result &lt;- ylab</span>
<span class="changed">485d5f02 R/granovagg.ds.R      321 321)     }</span>
<span class="changed">485d5f02 R/granovagg.ds.R      322 322)     </span>
<span class="changed">485d5f02 R/granovagg.ds.R      323 323)     return(ylab(result))</span>
<span class="changed">485d5f02 R/granovagg.ds.R      324 324)   }</span>
<span class="changed">485d5f02 R/granovagg.ds.R      325 325)   </span>
794c4b70 R/granova.ds.ggplot.R 296 326)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 327)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 328)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 329)     }
a2b6fe7d R/granovagg.ds.R      320 330)     
a2b6fe7d R/granovagg.ds.R      321 331)     else {
a2b6fe7d R/granovagg.ds.R      322 332)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 333)     }
863d348b R/granova.ds.ggplot.R 304 334)   }
b5b60529 R/granova.ds.ggplot.R 270 335)   
b5b60529 R/granova.ds.ggplot.R 271 336)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 337)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 338)   }
b5b60529 R/granova.ds.ggplot.R 274 339)   
3b102930 R/granova.ds.ggplot.R 275 340)           
3eb0e1f7 R/granova.ds.ggplot.R 304 341)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 342)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 343)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 344)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 345)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 346)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 347)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 348)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 349)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 350)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 351)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 352)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 353)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 354)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 355)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 356)   p &lt;- p + XLabel(dsp)
<span class="changed">485d5f02 R/granovagg.ds.R      357 357)   p &lt;- p + YLabel(dsp)</span>
e589a242 R/granova.ds.bd.R     316 358) 
a71441d3 R/granova.ds.ggplot.R 288 359)   return(p)
5d58b37c R/granova.ds.bd.R     314 360) 
b3a74c98 R/granova.ds.bd.R     301 361) }
</pre>
<div class="compileroutput">
granovagg.ds now takes ylab as an argument.<p></p><p><br>
</p></div>
</td>
<td>
<a name="2e407b6"></a>
2e407b6 2011-08-17 23:16:44 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
485d5f02 R/granovagg.ds.R       35  35) #' @return Returns a plot object of class \code{ggplot}. 
<span class="changed">2e407b6e R/granovagg.ds.R       36  36) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}</span>
<span class="changed">2e407b6e R/granovagg.ds.R       37  37) #' @author Brian A. Danielak \email{brian@@briandk.com}</span>
<span class="changed">2e407b6e R/granovagg.ds.R       38  38) #' @author William E. J. Doane \email{wil@@drdoane.com}</span>
<span class="changed">2e407b6e R/granovagg.ds.R       39  39) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}</span>
<span class="changed">2e407b6e R/granovagg.ds.R       40  40) #' @author Jason Bryer \email{jason@@bryer.org}</span>
56bb21d6 R/granovagg.ds.R       46  41) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  42) #' @export
2b0c8b84 R/granovagg.ds.R       71  43) 
ee1b067f R/granovagg.ds.R        1  44) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  45)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  46)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  47)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  48)                          conf.level = 0.95,
e55d776c R/granovagg.ds.R       41  49)                          plot.theme = "theme_granova_ds"
e55d776c R/granovagg.ds.R       42  50)                 ) 
be2e6fbd R/granova.ds.bd.R      19  51) 
be2e6fbd R/granova.ds.bd.R      20  52) {
d6c27487 R/granova.ds.bd.R      12  53)   
794c4b70 R/granova.ds.ggplot.R   9  54)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  55)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  56)   }
a806fcaa R/granova.ds.bd.R      15  57) 
794c4b70 R/granova.ds.ggplot.R  13  58)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  59)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  60)   }
e589a242 R/granova.ds.bd.R      17  61) 
794c4b70 R/granova.ds.ggplot.R  17  62)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  63)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  64)   }
c2605051 R/granova.ds.bd.R     182  65)   
794c4b70 R/granova.ds.ggplot.R  21  66)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  67)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  68)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  69)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  70)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  71)                  )
a71441d3 R/granova.ds.ggplot.R  27  72)           )
863d348b R/granova.ds.ggplot.R  30  73)   }
c2605051 R/granova.ds.bd.R     187  74)   
794c4b70 R/granova.ds.ggplot.R  30  75)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  76)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  77)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  78)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  79)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  80)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  81)                      )
a71441d3 R/granova.ds.ggplot.R  38  82)           )
863d348b R/granova.ds.ggplot.R  41  83)   }
c2605051 R/granova.ds.bd.R     191  84)   
794c4b70 R/granova.ds.ggplot.R  41  85)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  86)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  87)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  88)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  89)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  90)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  91)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  92)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  93)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  94)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  95)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  96)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  97)   
a71441d3 R/granova.ds.ggplot.R  54  98)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55  99)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 100)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 101)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 102)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 103)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 104)                )
a71441d3 R/granova.ds.ggplot.R  61 105)           )
863d348b R/granova.ds.ggplot.R  64 106)   }
c2605051 R/granova.ds.bd.R     199 107)   
794c4b70 R/granova.ds.ggplot.R  64 108)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 109)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 110)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 111)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 112)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 113)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 114)   }
863d348b R/granova.ds.ggplot.R  73 115) 
794c4b70 R/granova.ds.ggplot.R  72 116)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 117)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 118)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 119)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 120)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 121)                      )
a71441d3 R/granova.ds.ggplot.R  78 122)           )  
863d348b R/granova.ds.ggplot.R  82 123)   }
c2605051 R/granova.ds.bd.R     209 124)   
794c4b70 R/granova.ds.ggplot.R  82 125)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 126)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 127)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 128)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 129)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 130)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 131)                      )
a71441d3 R/granova.ds.ggplot.R  88 132)           )
5f570d2d R/granova.ds.bd.R     190 133)     
863d348b R/granova.ds.ggplot.R  94 134)   }
c2605051 R/granova.ds.bd.R     224 135)   
794c4b70 R/granova.ds.ggplot.R  94 136)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 137)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 138)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 139)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 140)                      )
a71441d3 R/granova.ds.ggplot.R  97 141)           )
863d348b R/granova.ds.ggplot.R 103 142)   }
863d348b R/granova.ds.ggplot.R 104 143) 
794c4b70 R/granova.ds.ggplot.R 103 144)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 145)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 146)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 147)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 148)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 149)                      )
a71441d3 R/granova.ds.ggplot.R 106 150)           )
863d348b R/granova.ds.ggplot.R 114 151)   }
c2605051 R/granova.ds.bd.R     239 152)   
794c4b70 R/granova.ds.ggplot.R 114 153)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 154)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 155)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 156)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 157)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 158)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 159)                )
a71441d3 R/granova.ds.ggplot.R 116 160)           )         
863d348b R/granova.ds.ggplot.R 125 161)   }
863d348b R/granova.ds.ggplot.R 126 162) 
48638496 R/granova.ds.ggplot.R 119 163)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 164)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 165)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 166)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 167)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 168)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 169)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 170)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 171)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 172)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 173)     
c2605051 R/granova.ds.bd.R     256 174)   
863d348b R/granova.ds.ggplot.R 139 175) 
863d348b R/granova.ds.ggplot.R 140 176)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 177)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 178) 
863d348b R/granova.ds.ggplot.R 143 179)   
3eb0e1f7 R/granova.ds.ggplot.R 142 180)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 181)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 182)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 183)                             ),
a71441d3 R/granova.ds.ggplot.R 140 184)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 185)                  )
863d348b R/granova.ds.ggplot.R 151 186)           )
863d348b R/granova.ds.ggplot.R 152 187)   }
e60e59e1 R/granova.ds.bd.R     241 188)     
794c4b70 R/granova.ds.ggplot.R 152 189)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 190)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 191)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 192)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 193)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 194)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 195)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 196)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 197)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 198)                       )
a71441d3 R/granova.ds.ggplot.R 154 199)           )
863d348b R/granova.ds.ggplot.R 166 200)   }
863d348b R/granova.ds.ggplot.R 167 201) 
794c4b70 R/granova.ds.ggplot.R 166 202)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 203)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 204)   }
863d348b R/granova.ds.ggplot.R 174 205) 
3eb0e1f7 R/granova.ds.ggplot.R 173 206)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 207)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 208)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 209)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 210)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 211)                       )
a71441d3 R/granova.ds.ggplot.R 166 212)           )
863d348b R/granova.ds.ggplot.R 183 213)   }
863d348b R/granova.ds.ggplot.R 184 214) 
794c4b70 R/granova.ds.ggplot.R 183 215)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 216)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 217)   }
863d348b R/granova.ds.ggplot.R 188 218) 
794c4b70 R/granova.ds.ggplot.R 187 219)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 220)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 221)   }
863d348b R/granova.ds.ggplot.R 192 222) 
794c4b70 R/granova.ds.ggplot.R 191 223)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 224)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 225)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 226)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 227)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 228)                    )  
a71441d3 R/granova.ds.ggplot.R 183 229)           )
863d348b R/granova.ds.ggplot.R 202 230)   }
863d348b R/granova.ds.ggplot.R 203 231) 
794c4b70 R/granova.ds.ggplot.R 202 232)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 233)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 234)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 235)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 236)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 237)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 238)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 239)           )
863d348b R/granova.ds.ggplot.R 213 240)   }
c2605051 R/granova.ds.bd.R     271 241)   
794c4b70 R/granova.ds.ggplot.R 213 242)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 243)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 244)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 245)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 246)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 247)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 248)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 249)           )
aaeade58 R/granova.ds.bd.R     274 250)     
863d348b R/granova.ds.ggplot.R 225 251)   }
863d348b R/granova.ds.ggplot.R 226 252) 
794c4b70 R/granova.ds.ggplot.R 225 253)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 254)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 255)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 256)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 257)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 258)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 259)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 260)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 261)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 262)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 263)                        )  
a71441d3 R/granova.ds.ggplot.R 216 264)           )
863d348b R/granova.ds.ggplot.R 242 265)   }
863d348b R/granova.ds.ggplot.R 243 266) 
794c4b70 R/granova.ds.ggplot.R 242 267)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 268)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 269)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 270)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 271)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 272)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 273)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 274)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 275)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 276)                        )
a71441d3 R/granova.ds.ggplot.R 229 277)           )
863d348b R/granova.ds.ggplot.R 258 278)   }
863d348b R/granova.ds.ggplot.R 259 279) 
794c4b70 R/granova.ds.ggplot.R 258 280)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 281)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 282)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 283)                          ),
a71441d3 R/granova.ds.ggplot.R 236 284)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 285)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 286)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 287)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 288)                      )
a71441d3 R/granova.ds.ggplot.R 240 289)           )
863d348b R/granova.ds.ggplot.R 272 290)   }
863d348b R/granova.ds.ggplot.R 273 291) 
794c4b70 R/granova.ds.ggplot.R 272 292)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 293)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 294)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 295)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 296)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 297)                            ),
a71441d3 R/granova.ds.ggplot.R 249 298)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 299)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 300)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 301)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 302)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 303)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 304)           )
863d348b R/granova.ds.ggplot.R 290 305)   }
863d348b R/granova.ds.ggplot.R 291 306) 
ef841aa1 R/granova.ds.ggplot.R 257 307)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 308)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 309)   
a71441d3 R/granova.ds.ggplot.R 261 310)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 311)   }
863d348b R/granova.ds.ggplot.R 297 312) 
0afa3a38 R/granovagg.ds.R      306 313)   XLabel &lt;- function(dsp) {
0afa3a38 R/granovagg.ds.R      307 314)     result &lt;- colnames(dsp$data)
0afa3a38 R/granovagg.ds.R      308 315)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 316)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 317)     }
0afa3a38 R/granovagg.ds.R      311 318)     
0afa3a38 R/granovagg.ds.R      312 319)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 320)   }
0afa3a38 R/granovagg.ds.R      314 321)   
485d5f02 R/granovagg.ds.R      317 322)   YLabel &lt;- function(dsp) {
485d5f02 R/granovagg.ds.R      318 323)     result &lt;- colnames(dsp$data)
485d5f02 R/granovagg.ds.R      319 324)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 325)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 326)     }
485d5f02 R/granovagg.ds.R      322 327)     
485d5f02 R/granovagg.ds.R      323 328)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 329)   }
485d5f02 R/granovagg.ds.R      325 330)   
794c4b70 R/granova.ds.ggplot.R 296 331)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 332)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 333)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 334)     }
a2b6fe7d R/granovagg.ds.R      320 335)     
a2b6fe7d R/granovagg.ds.R      321 336)     else {
a2b6fe7d R/granovagg.ds.R      322 337)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 338)     }
863d348b R/granova.ds.ggplot.R 304 339)   }
b5b60529 R/granova.ds.ggplot.R 270 340)   
b5b60529 R/granova.ds.ggplot.R 271 341)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 342)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 343)   }
b5b60529 R/granova.ds.ggplot.R 274 344)   
3b102930 R/granova.ds.ggplot.R 275 345)           
3eb0e1f7 R/granova.ds.ggplot.R 304 346)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 347)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 348)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 349)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 350)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 351)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 352)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 353)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 354)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 355)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 356)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 357)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 358)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 359)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 360)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 361)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 362)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 363) 
a71441d3 R/granova.ds.ggplot.R 288 364)   return(p)
5d58b37c R/granova.ds.bd.R     314 365) 
b3a74c98 R/granova.ds.bd.R     301 366) }
</pre>
<div class="compileroutput">
Added author information to granovagg.ds<p>Whitespace changes in author information in granovagg.1w roxygen blocks<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="3329011"></a>
3329011 2011-08-18 00:35:28 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
<span class="changed">3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions</span>
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
56bb21d6 R/granovagg.ds.R       46  42) #' @examples NULL
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
<span class="changed">3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",</span>
<span class="changed">3329011e R/granovagg.ds.R       51  51)                          ...</span>
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
794c4b70 R/granova.ds.ggplot.R   9  56)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  57)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  58)   }
a806fcaa R/granova.ds.bd.R      15  59) 
794c4b70 R/granova.ds.ggplot.R  13  60)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  61)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  62)   }
e589a242 R/granova.ds.bd.R      17  63) 
794c4b70 R/granova.ds.ggplot.R  17  64)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  65)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  66)   }
c2605051 R/granova.ds.bd.R     182  67)   
794c4b70 R/granova.ds.ggplot.R  21  68)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  69)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  70)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  71)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  72)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  73)                  )
a71441d3 R/granova.ds.ggplot.R  27  74)           )
863d348b R/granova.ds.ggplot.R  30  75)   }
c2605051 R/granova.ds.bd.R     187  76)   
794c4b70 R/granova.ds.ggplot.R  30  77)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  78)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  79)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  80)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  81)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  82)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  83)                      )
a71441d3 R/granova.ds.ggplot.R  38  84)           )
863d348b R/granova.ds.ggplot.R  41  85)   }
c2605051 R/granova.ds.bd.R     191  86)   
794c4b70 R/granova.ds.ggplot.R  41  87)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  88)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  89)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  90)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  91)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  92)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  93)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  94)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  95)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  96)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  97)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  98)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  99)   
a71441d3 R/granova.ds.ggplot.R  54 100)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 101)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 102)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 103)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 104)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 105)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 106)                )
a71441d3 R/granova.ds.ggplot.R  61 107)           )
863d348b R/granova.ds.ggplot.R  64 108)   }
c2605051 R/granova.ds.bd.R     199 109)   
794c4b70 R/granova.ds.ggplot.R  64 110)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 111)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 112)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 113)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 114)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 115)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 116)   }
863d348b R/granova.ds.ggplot.R  73 117) 
794c4b70 R/granova.ds.ggplot.R  72 118)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 119)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 120)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 121)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 122)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 123)                      )
a71441d3 R/granova.ds.ggplot.R  78 124)           )  
863d348b R/granova.ds.ggplot.R  82 125)   }
c2605051 R/granova.ds.bd.R     209 126)   
794c4b70 R/granova.ds.ggplot.R  82 127)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 128)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 129)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 130)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 131)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 132)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 133)                      )
a71441d3 R/granova.ds.ggplot.R  88 134)           )
5f570d2d R/granova.ds.bd.R     190 135)     
863d348b R/granova.ds.ggplot.R  94 136)   }
c2605051 R/granova.ds.bd.R     224 137)   
794c4b70 R/granova.ds.ggplot.R  94 138)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 139)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 140)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 141)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 142)                      )
a71441d3 R/granova.ds.ggplot.R  97 143)           )
863d348b R/granova.ds.ggplot.R 103 144)   }
863d348b R/granova.ds.ggplot.R 104 145) 
794c4b70 R/granova.ds.ggplot.R 103 146)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 147)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 148)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 149)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 150)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 151)                      )
a71441d3 R/granova.ds.ggplot.R 106 152)           )
863d348b R/granova.ds.ggplot.R 114 153)   }
c2605051 R/granova.ds.bd.R     239 154)   
794c4b70 R/granova.ds.ggplot.R 114 155)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 156)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 157)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 158)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 159)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 160)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 161)                )
a71441d3 R/granova.ds.ggplot.R 116 162)           )         
863d348b R/granova.ds.ggplot.R 125 163)   }
863d348b R/granova.ds.ggplot.R 126 164) 
48638496 R/granova.ds.ggplot.R 119 165)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 166)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 167)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 168)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 169)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 170)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 171)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 172)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 173)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 174)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 175)     
c2605051 R/granova.ds.bd.R     256 176)   
863d348b R/granova.ds.ggplot.R 139 177) 
863d348b R/granova.ds.ggplot.R 140 178)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 179)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 180) 
863d348b R/granova.ds.ggplot.R 143 181)   
3eb0e1f7 R/granova.ds.ggplot.R 142 182)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 183)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 184)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 185)                             ),
a71441d3 R/granova.ds.ggplot.R 140 186)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 187)                  )
863d348b R/granova.ds.ggplot.R 151 188)           )
863d348b R/granova.ds.ggplot.R 152 189)   }
e60e59e1 R/granova.ds.bd.R     241 190)     
794c4b70 R/granova.ds.ggplot.R 152 191)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 192)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 193)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 194)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 195)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 196)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 197)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 198)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 199)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 200)                       )
a71441d3 R/granova.ds.ggplot.R 154 201)           )
863d348b R/granova.ds.ggplot.R 166 202)   }
863d348b R/granova.ds.ggplot.R 167 203) 
794c4b70 R/granova.ds.ggplot.R 166 204)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 205)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 206)   }
863d348b R/granova.ds.ggplot.R 174 207) 
3eb0e1f7 R/granova.ds.ggplot.R 173 208)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 209)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 210)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 211)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 212)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 213)                       )
a71441d3 R/granova.ds.ggplot.R 166 214)           )
863d348b R/granova.ds.ggplot.R 183 215)   }
863d348b R/granova.ds.ggplot.R 184 216) 
794c4b70 R/granova.ds.ggplot.R 183 217)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 218)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 219)   }
863d348b R/granova.ds.ggplot.R 188 220) 
794c4b70 R/granova.ds.ggplot.R 187 221)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 222)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 223)   }
863d348b R/granova.ds.ggplot.R 192 224) 
794c4b70 R/granova.ds.ggplot.R 191 225)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 226)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 227)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 228)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 229)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 230)                    )  
a71441d3 R/granova.ds.ggplot.R 183 231)           )
863d348b R/granova.ds.ggplot.R 202 232)   }
863d348b R/granova.ds.ggplot.R 203 233) 
794c4b70 R/granova.ds.ggplot.R 202 234)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 235)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 236)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 237)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 238)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 239)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 240)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 241)           )
863d348b R/granova.ds.ggplot.R 213 242)   }
c2605051 R/granova.ds.bd.R     271 243)   
794c4b70 R/granova.ds.ggplot.R 213 244)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 245)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 246)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 247)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 248)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 249)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 250)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 251)           )
aaeade58 R/granova.ds.bd.R     274 252)     
863d348b R/granova.ds.ggplot.R 225 253)   }
863d348b R/granova.ds.ggplot.R 226 254) 
794c4b70 R/granova.ds.ggplot.R 225 255)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 256)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 257)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 258)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 259)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 260)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 261)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 262)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 263)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 264)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 265)                        )  
a71441d3 R/granova.ds.ggplot.R 216 266)           )
863d348b R/granova.ds.ggplot.R 242 267)   }
863d348b R/granova.ds.ggplot.R 243 268) 
794c4b70 R/granova.ds.ggplot.R 242 269)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 270)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 271)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 272)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 273)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 274)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 275)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 276)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 277)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 278)                        )
a71441d3 R/granova.ds.ggplot.R 229 279)           )
863d348b R/granova.ds.ggplot.R 258 280)   }
863d348b R/granova.ds.ggplot.R 259 281) 
794c4b70 R/granova.ds.ggplot.R 258 282)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 283)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 284)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 285)                          ),
a71441d3 R/granova.ds.ggplot.R 236 286)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 287)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 288)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 289)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 290)                      )
a71441d3 R/granova.ds.ggplot.R 240 291)           )
863d348b R/granova.ds.ggplot.R 272 292)   }
863d348b R/granova.ds.ggplot.R 273 293) 
794c4b70 R/granova.ds.ggplot.R 272 294)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 295)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 296)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 297)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 298)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 299)                            ),
a71441d3 R/granova.ds.ggplot.R 249 300)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 301)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 302)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 303)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 304)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 305)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 306)           )
863d348b R/granova.ds.ggplot.R 290 307)   }
863d348b R/granova.ds.ggplot.R 291 308) 
ef841aa1 R/granova.ds.ggplot.R 257 309)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 310)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 311)   
a71441d3 R/granova.ds.ggplot.R 261 312)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 313)   }
863d348b R/granova.ds.ggplot.R 297 314) 
0afa3a38 R/granovagg.ds.R      306 315)   XLabel &lt;- function(dsp) {
0afa3a38 R/granovagg.ds.R      307 316)     result &lt;- colnames(dsp$data)
0afa3a38 R/granovagg.ds.R      308 317)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 318)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 319)     }
0afa3a38 R/granovagg.ds.R      311 320)     
0afa3a38 R/granovagg.ds.R      312 321)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 322)   }
0afa3a38 R/granovagg.ds.R      314 323)   
485d5f02 R/granovagg.ds.R      317 324)   YLabel &lt;- function(dsp) {
485d5f02 R/granovagg.ds.R      318 325)     result &lt;- colnames(dsp$data)
485d5f02 R/granovagg.ds.R      319 326)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 327)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 328)     }
485d5f02 R/granovagg.ds.R      322 329)     
485d5f02 R/granovagg.ds.R      323 330)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 331)   }
485d5f02 R/granovagg.ds.R      325 332)   
794c4b70 R/granova.ds.ggplot.R 296 333)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 334)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 335)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 336)     }
a2b6fe7d R/granovagg.ds.R      320 337)     
a2b6fe7d R/granovagg.ds.R      321 338)     else {
a2b6fe7d R/granovagg.ds.R      322 339)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 340)     }
863d348b R/granova.ds.ggplot.R 304 341)   }
b5b60529 R/granova.ds.ggplot.R 270 342)   
b5b60529 R/granova.ds.ggplot.R 271 343)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 344)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 345)   }
b5b60529 R/granova.ds.ggplot.R 274 346)   
3b102930 R/granova.ds.ggplot.R 275 347)           
3eb0e1f7 R/granova.ds.ggplot.R 304 348)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 349)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 350)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 351)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 352)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 353)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 354)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 355)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 356)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 357)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 358)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 359)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 360)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 361)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 362)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 363)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 364)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 365) 
a71441d3 R/granova.ds.ggplot.R 288 366)   return(p)
5d58b37c R/granova.ds.bd.R     314 367) 
b3a74c98 R/granova.ds.bd.R     301 368) }
</pre>
<div class="compileroutput">
Added documentation for … parameter in all functions<p></p><p><br>
</p></div>
</td>
<td>
<a name="19d1b01"></a>
19d1b01 2011-08-19 19:26:46 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
<span class="changed">19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R</span>
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
794c4b70 R/granova.ds.ggplot.R   9  56)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  57)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  58)   }
a806fcaa R/granova.ds.bd.R      15  59) 
794c4b70 R/granova.ds.ggplot.R  13  60)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  61)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  62)   }
e589a242 R/granova.ds.bd.R      17  63) 
794c4b70 R/granova.ds.ggplot.R  17  64)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  65)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  66)   }
c2605051 R/granova.ds.bd.R     182  67)   
794c4b70 R/granova.ds.ggplot.R  21  68)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  69)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  70)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  71)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  72)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  73)                  )
a71441d3 R/granova.ds.ggplot.R  27  74)           )
863d348b R/granova.ds.ggplot.R  30  75)   }
c2605051 R/granova.ds.bd.R     187  76)   
794c4b70 R/granova.ds.ggplot.R  30  77)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  78)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  79)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  80)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  81)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  82)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  83)                      )
a71441d3 R/granova.ds.ggplot.R  38  84)           )
863d348b R/granova.ds.ggplot.R  41  85)   }
c2605051 R/granova.ds.bd.R     191  86)   
794c4b70 R/granova.ds.ggplot.R  41  87)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  88)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  89)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  90)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  91)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  92)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  93)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  94)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  95)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  96)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  97)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  98)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  99)   
a71441d3 R/granova.ds.ggplot.R  54 100)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 101)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 102)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 103)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 104)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 105)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 106)                )
a71441d3 R/granova.ds.ggplot.R  61 107)           )
863d348b R/granova.ds.ggplot.R  64 108)   }
c2605051 R/granova.ds.bd.R     199 109)   
794c4b70 R/granova.ds.ggplot.R  64 110)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 111)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 112)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 113)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 114)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 115)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 116)   }
863d348b R/granova.ds.ggplot.R  73 117) 
794c4b70 R/granova.ds.ggplot.R  72 118)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 119)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 120)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 121)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 122)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 123)                      )
a71441d3 R/granova.ds.ggplot.R  78 124)           )  
863d348b R/granova.ds.ggplot.R  82 125)   }
c2605051 R/granova.ds.bd.R     209 126)   
794c4b70 R/granova.ds.ggplot.R  82 127)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 128)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 129)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 130)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 131)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 132)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 133)                      )
a71441d3 R/granova.ds.ggplot.R  88 134)           )
5f570d2d R/granova.ds.bd.R     190 135)     
863d348b R/granova.ds.ggplot.R  94 136)   }
c2605051 R/granova.ds.bd.R     224 137)   
794c4b70 R/granova.ds.ggplot.R  94 138)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 139)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 140)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 141)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 142)                      )
a71441d3 R/granova.ds.ggplot.R  97 143)           )
863d348b R/granova.ds.ggplot.R 103 144)   }
863d348b R/granova.ds.ggplot.R 104 145) 
794c4b70 R/granova.ds.ggplot.R 103 146)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 147)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 148)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 149)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 150)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 151)                      )
a71441d3 R/granova.ds.ggplot.R 106 152)           )
863d348b R/granova.ds.ggplot.R 114 153)   }
c2605051 R/granova.ds.bd.R     239 154)   
794c4b70 R/granova.ds.ggplot.R 114 155)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 156)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 157)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 158)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 159)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 160)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 161)                )
a71441d3 R/granova.ds.ggplot.R 116 162)           )         
863d348b R/granova.ds.ggplot.R 125 163)   }
863d348b R/granova.ds.ggplot.R 126 164) 
48638496 R/granova.ds.ggplot.R 119 165)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 166)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 167)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 168)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 169)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 170)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 171)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 172)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 173)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 174)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 175)     
c2605051 R/granova.ds.bd.R     256 176)   
863d348b R/granova.ds.ggplot.R 139 177) 
863d348b R/granova.ds.ggplot.R 140 178)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 179)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 180) 
863d348b R/granova.ds.ggplot.R 143 181)   
3eb0e1f7 R/granova.ds.ggplot.R 142 182)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 183)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 184)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 185)                             ),
a71441d3 R/granova.ds.ggplot.R 140 186)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 187)                  )
863d348b R/granova.ds.ggplot.R 151 188)           )
863d348b R/granova.ds.ggplot.R 152 189)   }
e60e59e1 R/granova.ds.bd.R     241 190)     
794c4b70 R/granova.ds.ggplot.R 152 191)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 192)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 193)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 194)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 195)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 196)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 197)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 198)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 199)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 200)                       )
a71441d3 R/granova.ds.ggplot.R 154 201)           )
863d348b R/granova.ds.ggplot.R 166 202)   }
863d348b R/granova.ds.ggplot.R 167 203) 
794c4b70 R/granova.ds.ggplot.R 166 204)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 205)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 206)   }
863d348b R/granova.ds.ggplot.R 174 207) 
3eb0e1f7 R/granova.ds.ggplot.R 173 208)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 209)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 210)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 211)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 212)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 213)                       )
a71441d3 R/granova.ds.ggplot.R 166 214)           )
863d348b R/granova.ds.ggplot.R 183 215)   }
863d348b R/granova.ds.ggplot.R 184 216) 
794c4b70 R/granova.ds.ggplot.R 183 217)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 218)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 219)   }
863d348b R/granova.ds.ggplot.R 188 220) 
794c4b70 R/granova.ds.ggplot.R 187 221)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 222)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 223)   }
863d348b R/granova.ds.ggplot.R 192 224) 
794c4b70 R/granova.ds.ggplot.R 191 225)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 226)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 227)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 228)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 229)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 230)                    )  
a71441d3 R/granova.ds.ggplot.R 183 231)           )
863d348b R/granova.ds.ggplot.R 202 232)   }
863d348b R/granova.ds.ggplot.R 203 233) 
794c4b70 R/granova.ds.ggplot.R 202 234)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 235)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 236)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 237)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 238)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 239)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 240)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 241)           )
863d348b R/granova.ds.ggplot.R 213 242)   }
c2605051 R/granova.ds.bd.R     271 243)   
794c4b70 R/granova.ds.ggplot.R 213 244)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 245)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 246)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 247)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 248)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 249)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 250)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 251)           )
aaeade58 R/granova.ds.bd.R     274 252)     
863d348b R/granova.ds.ggplot.R 225 253)   }
863d348b R/granova.ds.ggplot.R 226 254) 
794c4b70 R/granova.ds.ggplot.R 225 255)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 256)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 257)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 258)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 259)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 260)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 261)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 262)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 263)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 264)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 265)                        )  
a71441d3 R/granova.ds.ggplot.R 216 266)           )
863d348b R/granova.ds.ggplot.R 242 267)   }
863d348b R/granova.ds.ggplot.R 243 268) 
794c4b70 R/granova.ds.ggplot.R 242 269)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 270)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 271)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 272)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 273)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 274)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 275)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 276)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 277)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 278)                        )
a71441d3 R/granova.ds.ggplot.R 229 279)           )
863d348b R/granova.ds.ggplot.R 258 280)   }
863d348b R/granova.ds.ggplot.R 259 281) 
794c4b70 R/granova.ds.ggplot.R 258 282)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 283)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 284)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 285)                          ),
a71441d3 R/granova.ds.ggplot.R 236 286)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 287)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 288)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 289)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 290)                      )
a71441d3 R/granova.ds.ggplot.R 240 291)           )
863d348b R/granova.ds.ggplot.R 272 292)   }
863d348b R/granova.ds.ggplot.R 273 293) 
794c4b70 R/granova.ds.ggplot.R 272 294)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 295)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 296)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 297)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 298)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 299)                            ),
a71441d3 R/granova.ds.ggplot.R 249 300)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 301)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 302)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 303)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 304)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 305)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 306)           )
863d348b R/granova.ds.ggplot.R 290 307)   }
863d348b R/granova.ds.ggplot.R 291 308) 
ef841aa1 R/granova.ds.ggplot.R 257 309)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 310)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 311)   
a71441d3 R/granova.ds.ggplot.R 261 312)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 313)   }
863d348b R/granova.ds.ggplot.R 297 314) 
0afa3a38 R/granovagg.ds.R      306 315)   XLabel &lt;- function(dsp) {
0afa3a38 R/granovagg.ds.R      307 316)     result &lt;- colnames(dsp$data)
0afa3a38 R/granovagg.ds.R      308 317)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 318)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 319)     }
0afa3a38 R/granovagg.ds.R      311 320)     
0afa3a38 R/granovagg.ds.R      312 321)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 322)   }
0afa3a38 R/granovagg.ds.R      314 323)   
485d5f02 R/granovagg.ds.R      317 324)   YLabel &lt;- function(dsp) {
485d5f02 R/granovagg.ds.R      318 325)     result &lt;- colnames(dsp$data)
485d5f02 R/granovagg.ds.R      319 326)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 327)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 328)     }
485d5f02 R/granovagg.ds.R      322 329)     
485d5f02 R/granovagg.ds.R      323 330)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 331)   }
485d5f02 R/granovagg.ds.R      325 332)   
794c4b70 R/granova.ds.ggplot.R 296 333)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 334)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 335)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 336)     }
a2b6fe7d R/granovagg.ds.R      320 337)     
a2b6fe7d R/granovagg.ds.R      321 338)     else {
a2b6fe7d R/granovagg.ds.R      322 339)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 340)     }
863d348b R/granova.ds.ggplot.R 304 341)   }
b5b60529 R/granova.ds.ggplot.R 270 342)   
b5b60529 R/granova.ds.ggplot.R 271 343)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 344)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 345)   }
b5b60529 R/granova.ds.ggplot.R 274 346)   
3b102930 R/granova.ds.ggplot.R 275 347)           
3eb0e1f7 R/granova.ds.ggplot.R 304 348)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 349)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 350)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 351)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 352)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 353)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 354)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 355)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 356)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 357)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 358)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 359)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 360)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 361)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 362)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 363)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 364)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 365) 
a71441d3 R/granova.ds.ggplot.R 288 366)   return(p)
5d58b37c R/granova.ds.bd.R     314 367) 
b3a74c98 R/granova.ds.bd.R     301 368) }
</pre>
<div class="compileroutput">
Added example code to granovagg.ds documentation<p></p><p><br>
</p></div>
</td>
<td>
<a name="5ede31e"></a>
5ede31e 2011-08-21 16:10:46 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
794c4b70 R/granova.ds.ggplot.R   9  56)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  57)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  58)   }
a806fcaa R/granova.ds.bd.R      15  59) 
794c4b70 R/granova.ds.ggplot.R  13  60)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  61)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  62)   }
e589a242 R/granova.ds.bd.R      17  63) 
794c4b70 R/granova.ds.ggplot.R  17  64)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  65)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  66)   }
c2605051 R/granova.ds.bd.R     182  67)   
794c4b70 R/granova.ds.ggplot.R  21  68)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22  69)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23  70)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24  71)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25  72)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26  73)                  )
a71441d3 R/granova.ds.ggplot.R  27  74)           )
863d348b R/granova.ds.ggplot.R  30  75)   }
c2605051 R/granova.ds.bd.R     187  76)   
794c4b70 R/granova.ds.ggplot.R  30  77)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31  78)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32  79)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33  80)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34  81)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35  82)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36  83)                      )
a71441d3 R/granova.ds.ggplot.R  38  84)           )
863d348b R/granova.ds.ggplot.R  41  85)   }
c2605051 R/granova.ds.bd.R     191  86)   
794c4b70 R/granova.ds.ggplot.R  41  87)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42  88)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43  89)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44  90)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45  91)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45  92)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47  93)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48  94)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49  95)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50  96)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51  97)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52  98)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195  99)   
a71441d3 R/granova.ds.ggplot.R  54 100)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 101)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 102)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 103)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 104)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 105)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 106)                )
a71441d3 R/granova.ds.ggplot.R  61 107)           )
863d348b R/granova.ds.ggplot.R  64 108)   }
c2605051 R/granova.ds.bd.R     199 109)   
794c4b70 R/granova.ds.ggplot.R  64 110)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 111)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 112)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 113)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 114)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 115)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 116)   }
863d348b R/granova.ds.ggplot.R  73 117) 
794c4b70 R/granova.ds.ggplot.R  72 118)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 119)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 120)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 121)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 122)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 123)                      )
a71441d3 R/granova.ds.ggplot.R  78 124)           )  
863d348b R/granova.ds.ggplot.R  82 125)   }
c2605051 R/granova.ds.bd.R     209 126)   
794c4b70 R/granova.ds.ggplot.R  82 127)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 128)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 129)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 130)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 131)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 132)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 133)                      )
a71441d3 R/granova.ds.ggplot.R  88 134)           )
5f570d2d R/granova.ds.bd.R     190 135)     
863d348b R/granova.ds.ggplot.R  94 136)   }
c2605051 R/granova.ds.bd.R     224 137)   
794c4b70 R/granova.ds.ggplot.R  94 138)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 139)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 140)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 141)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 142)                      )
a71441d3 R/granova.ds.ggplot.R  97 143)           )
863d348b R/granova.ds.ggplot.R 103 144)   }
863d348b R/granova.ds.ggplot.R 104 145) 
794c4b70 R/granova.ds.ggplot.R 103 146)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 147)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 148)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 149)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 150)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 151)                      )
a71441d3 R/granova.ds.ggplot.R 106 152)           )
863d348b R/granova.ds.ggplot.R 114 153)   }
c2605051 R/granova.ds.bd.R     239 154)   
794c4b70 R/granova.ds.ggplot.R 114 155)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 156)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 157)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 158)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 159)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 160)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 161)                )
a71441d3 R/granova.ds.ggplot.R 116 162)           )         
863d348b R/granova.ds.ggplot.R 125 163)   }
863d348b R/granova.ds.ggplot.R 126 164) 
48638496 R/granova.ds.ggplot.R 119 165)   dsp                &lt;- list(data = data)
a71441d3 R/granova.ds.ggplot.R 120 166)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 167)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 168)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 169)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 170)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 171)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 172)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 173)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 174)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 175)     
c2605051 R/granova.ds.bd.R     256 176)   
863d348b R/granova.ds.ggplot.R 139 177) 
863d348b R/granova.ds.ggplot.R 140 178)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 179)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 180) 
863d348b R/granova.ds.ggplot.R 143 181)   
3eb0e1f7 R/granova.ds.ggplot.R 142 182)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 183)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 184)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 185)                             ),
a71441d3 R/granova.ds.ggplot.R 140 186)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 187)                  )
863d348b R/granova.ds.ggplot.R 151 188)           )
863d348b R/granova.ds.ggplot.R 152 189)   }
e60e59e1 R/granova.ds.bd.R     241 190)     
794c4b70 R/granova.ds.ggplot.R 152 191)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 192)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 193)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 194)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 195)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 196)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 197)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 198)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 199)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 200)                       )
a71441d3 R/granova.ds.ggplot.R 154 201)           )
863d348b R/granova.ds.ggplot.R 166 202)   }
863d348b R/granova.ds.ggplot.R 167 203) 
794c4b70 R/granova.ds.ggplot.R 166 204)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 205)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 206)   }
863d348b R/granova.ds.ggplot.R 174 207) 
3eb0e1f7 R/granova.ds.ggplot.R 173 208)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 209)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 210)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 211)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 212)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 213)                       )
a71441d3 R/granova.ds.ggplot.R 166 214)           )
863d348b R/granova.ds.ggplot.R 183 215)   }
863d348b R/granova.ds.ggplot.R 184 216) 
794c4b70 R/granova.ds.ggplot.R 183 217)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 218)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 219)   }
863d348b R/granova.ds.ggplot.R 188 220) 
794c4b70 R/granova.ds.ggplot.R 187 221)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 222)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 223)   }
863d348b R/granova.ds.ggplot.R 192 224) 
794c4b70 R/granova.ds.ggplot.R 191 225)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 226)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 227)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 228)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 229)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 230)                    )  
a71441d3 R/granova.ds.ggplot.R 183 231)           )
863d348b R/granova.ds.ggplot.R 202 232)   }
863d348b R/granova.ds.ggplot.R 203 233) 
794c4b70 R/granova.ds.ggplot.R 202 234)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 235)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 236)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 237)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 238)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 239)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 240)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 241)           )
863d348b R/granova.ds.ggplot.R 213 242)   }
c2605051 R/granova.ds.bd.R     271 243)   
794c4b70 R/granova.ds.ggplot.R 213 244)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 245)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 246)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 247)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 248)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 249)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 250)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 251)           )
aaeade58 R/granova.ds.bd.R     274 252)     
863d348b R/granova.ds.ggplot.R 225 253)   }
863d348b R/granova.ds.ggplot.R 226 254) 
794c4b70 R/granova.ds.ggplot.R 225 255)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 256)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 257)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 258)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 259)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 260)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 261)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 262)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 263)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 264)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 265)                        )  
a71441d3 R/granova.ds.ggplot.R 216 266)           )
863d348b R/granova.ds.ggplot.R 242 267)   }
863d348b R/granova.ds.ggplot.R 243 268) 
794c4b70 R/granova.ds.ggplot.R 242 269)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 270)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 271)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 272)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 273)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 274)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 275)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 276)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 277)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 278)                        )
a71441d3 R/granova.ds.ggplot.R 229 279)           )
863d348b R/granova.ds.ggplot.R 258 280)   }
863d348b R/granova.ds.ggplot.R 259 281) 
794c4b70 R/granova.ds.ggplot.R 258 282)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 283)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 284)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 285)                          ),
a71441d3 R/granova.ds.ggplot.R 236 286)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 287)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 288)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 289)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 290)                      )
a71441d3 R/granova.ds.ggplot.R 240 291)           )
863d348b R/granova.ds.ggplot.R 272 292)   }
863d348b R/granova.ds.ggplot.R 273 293) 
794c4b70 R/granova.ds.ggplot.R 272 294)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 295)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 296)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 297)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 298)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 299)                            ),
a71441d3 R/granova.ds.ggplot.R 249 300)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 301)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 302)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 303)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 304)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 305)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 306)           )
863d348b R/granova.ds.ggplot.R 290 307)   }
863d348b R/granova.ds.ggplot.R 291 308) 
ef841aa1 R/granova.ds.ggplot.R 257 309)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 310)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 311)   
a71441d3 R/granova.ds.ggplot.R 261 312)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 313)   }
863d348b R/granova.ds.ggplot.R 297 314) 
0afa3a38 R/granovagg.ds.R      306 315)   XLabel &lt;- function(dsp) {
<span class="changed">5ede31eb R/granovagg.ds.R      316 316)     result &lt;- colnames(dsp$data)[1]</span>
0afa3a38 R/granovagg.ds.R      308 317)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 318)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 319)     }
0afa3a38 R/granovagg.ds.R      311 320)     
0afa3a38 R/granovagg.ds.R      312 321)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 322)   }
0afa3a38 R/granovagg.ds.R      314 323)   
485d5f02 R/granovagg.ds.R      317 324)   YLabel &lt;- function(dsp) {
<span class="changed">5ede31eb R/granovagg.ds.R      325 325)     result &lt;- colnames(dsp$data)[2]</span>
485d5f02 R/granovagg.ds.R      319 326)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 327)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 328)     }
485d5f02 R/granovagg.ds.R      322 329)     
485d5f02 R/granovagg.ds.R      323 330)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 331)   }
485d5f02 R/granovagg.ds.R      325 332)   
794c4b70 R/granova.ds.ggplot.R 296 333)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 334)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 335)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 336)     }
a2b6fe7d R/granovagg.ds.R      320 337)     
a2b6fe7d R/granovagg.ds.R      321 338)     else {
a2b6fe7d R/granovagg.ds.R      322 339)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 340)     }
863d348b R/granova.ds.ggplot.R 304 341)   }
b5b60529 R/granova.ds.ggplot.R 270 342)   
b5b60529 R/granova.ds.ggplot.R 271 343)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 344)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 345)   }
b5b60529 R/granova.ds.ggplot.R 274 346)   
3b102930 R/granova.ds.ggplot.R 275 347)           
3eb0e1f7 R/granova.ds.ggplot.R 304 348)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 349)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 350)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 351)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 352)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 353)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 354)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 355)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 356)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 357)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 358)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 359)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 360)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 361)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 362)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 363)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 364)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 365) 
a71441d3 R/granova.ds.ggplot.R 288 366)   return(p)
5d58b37c R/granova.ds.bd.R     314 367) 
b3a74c98 R/granova.ds.bd.R     301 368) }
</pre>
<div class="compileroutput">
corrected x and y labels in ds graphic<p></p><p><br>
</p></div>
</td>
<td>
<a name="544a88e"></a>
544a88e 2011-08-22 16:52:32 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
<span class="changed">544a88ef R/granovagg.ds.R       56  56)   GetAndCheckData &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       57  57)     IsDataNull(data)</span>
<span class="changed">544a88ef R/granovagg.ds.R       58  58)     IsDataInTwoColumnFormat(data)</span>
<span class="changed">544a88ef R/granovagg.ds.R       59  59)     return(EnsureDataIsADataFrame(data))</span>
<span class="changed">544a88ef R/granovagg.ds.R       60  60)   }</span>
<span class="changed">544a88ef R/granovagg.ds.R       61  61)   </span>
<span class="changed">544a88ef R/granovagg.ds.R       62  62)   IsDataNull &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       63  63)     if (is.null(length(data))) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       64  64)       stop("It looks like you didn't pass any data to granovagg.ds")</span>
<span class="changed">544a88ef R/granovagg.ds.R       65  65)     }</span>
<span class="changed">544a88ef R/granovagg.ds.R       66  66)   }</span>
<span class="changed">544a88ef R/granovagg.ds.R       67  67) </span>
<span class="changed">544a88ef R/granovagg.ds.R       68  68)   IsDataInTwoColumnFormat &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       69  69)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."</span>
<span class="changed">544a88ef R/granovagg.ds.R       70  70)     if (is.null(dim(data))) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       71  71)       stop(message)</span>
<span class="changed">544a88ef R/granovagg.ds.R       72  72)     }</span>
<span class="changed">544a88ef R/granovagg.ds.R       73  73)     </span>
<span class="changed">544a88ef R/granovagg.ds.R       74  74)     if (dim(data)[2] != 2) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       75  75)       stop(message)</span>
<span class="changed">544a88ef R/granovagg.ds.R       76  76)     }</span>
<span class="changed">544a88ef R/granovagg.ds.R       77  77)   }</span>
<span class="changed">544a88ef R/granovagg.ds.R       78  78)   </span>
<span class="changed">544a88ef R/granovagg.ds.R       79  79)   EnsureDataIsADataFrame &lt;- function(data) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       80  80)     output &lt;- data</span>
<span class="changed">544a88ef R/granovagg.ds.R       81  81)     if (!is.data.frame(data)) {</span>
<span class="changed">544a88ef R/granovagg.ds.R       82  82)       output &lt;- as.data.frame(output)</span>
<span class="changed">544a88ef R/granovagg.ds.R       83  83)     }</span>
<span class="changed">544a88ef R/granovagg.ds.R       84  84)     return(output)</span>
<span class="changed">544a88ef R/granovagg.ds.R       85  85)   }</span>
<span class="changed">544a88ef R/granovagg.ds.R       86  86)   </span>
794c4b70 R/granova.ds.ggplot.R   9  87)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  88)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  89)   }
a806fcaa R/granova.ds.bd.R      15  90) 
794c4b70 R/granova.ds.ggplot.R  13  91)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  92)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  93)   }
e589a242 R/granova.ds.bd.R      17  94) 
794c4b70 R/granova.ds.ggplot.R  17  95)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  96)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  97)   }
c2605051 R/granova.ds.bd.R     182  98)   
794c4b70 R/granova.ds.ggplot.R  21  99)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 100)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 101)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 102)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 103)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 104)                  )
a71441d3 R/granova.ds.ggplot.R  27 105)           )
863d348b R/granova.ds.ggplot.R  30 106)   }
c2605051 R/granova.ds.bd.R     187 107)   
794c4b70 R/granova.ds.ggplot.R  30 108)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 109)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 110)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 111)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 112)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 113)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 114)                      )
a71441d3 R/granova.ds.ggplot.R  38 115)           )
863d348b R/granova.ds.ggplot.R  41 116)   }
c2605051 R/granova.ds.bd.R     191 117)   
794c4b70 R/granova.ds.ggplot.R  41 118)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 119)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 120)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 121)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 122)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 123)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 124)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 125)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 126)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 127)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 128)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 129)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 130)   
a71441d3 R/granova.ds.ggplot.R  54 131)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 132)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 133)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 134)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 135)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 136)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 137)                )
a71441d3 R/granova.ds.ggplot.R  61 138)           )
863d348b R/granova.ds.ggplot.R  64 139)   }
c2605051 R/granova.ds.bd.R     199 140)   
794c4b70 R/granova.ds.ggplot.R  64 141)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 142)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 143)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 144)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 145)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 146)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 147)   }
863d348b R/granova.ds.ggplot.R  73 148) 
794c4b70 R/granova.ds.ggplot.R  72 149)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 150)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 151)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 152)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 153)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 154)                      )
a71441d3 R/granova.ds.ggplot.R  78 155)           )  
863d348b R/granova.ds.ggplot.R  82 156)   }
c2605051 R/granova.ds.bd.R     209 157)   
794c4b70 R/granova.ds.ggplot.R  82 158)   GetCIBand &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  82 159)     return(data.frame(cx     = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  83 160)                       cy     = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  84 161)                       cx.end = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  85 162)                       cy.end = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
a71441d3 R/granova.ds.ggplot.R  86 163)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 164)                      )
a71441d3 R/granova.ds.ggplot.R  88 165)           )
5f570d2d R/granova.ds.bd.R     190 166)     
863d348b R/granova.ds.ggplot.R  94 167)   }
c2605051 R/granova.ds.bd.R     224 168)   
794c4b70 R/granova.ds.ggplot.R  94 169)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 170)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 171)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 172)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 173)                      )
a71441d3 R/granova.ds.ggplot.R  97 174)           )
863d348b R/granova.ds.ggplot.R 103 175)   }
863d348b R/granova.ds.ggplot.R 104 176) 
794c4b70 R/granova.ds.ggplot.R 103 177)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 178)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 179)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 180)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 181)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 182)                      )
a71441d3 R/granova.ds.ggplot.R 106 183)           )
863d348b R/granova.ds.ggplot.R 114 184)   }
c2605051 R/granova.ds.bd.R     239 185)   
794c4b70 R/granova.ds.ggplot.R 114 186)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 187)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 188)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 189)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 190)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 191)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 192)                )
a71441d3 R/granova.ds.ggplot.R 116 193)           )         
863d348b R/granova.ds.ggplot.R 125 194)   }
863d348b R/granova.ds.ggplot.R 126 195) 
<span class="changed">544a88ef R/granovagg.ds.R      196 196)   dsp                &lt;- list(data = GetAndCheckData(data))</span>
a71441d3 R/granova.ds.ggplot.R 120 197)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 198)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 199)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 200)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 201)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 202)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 203)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 204)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 205)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 206)     
c2605051 R/granova.ds.bd.R     256 207)   
863d348b R/granova.ds.ggplot.R 139 208) 
863d348b R/granova.ds.ggplot.R 140 209)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 210)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 211) 
863d348b R/granova.ds.ggplot.R 143 212)   
3eb0e1f7 R/granova.ds.ggplot.R 142 213)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 214)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 215)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 216)                             ),
a71441d3 R/granova.ds.ggplot.R 140 217)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 218)                  )
863d348b R/granova.ds.ggplot.R 151 219)           )
863d348b R/granova.ds.ggplot.R 152 220)   }
e60e59e1 R/granova.ds.bd.R     241 221)     
794c4b70 R/granova.ds.ggplot.R 152 222)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 223)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 224)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 225)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 226)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 227)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 228)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 229)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 230)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 231)                       )
a71441d3 R/granova.ds.ggplot.R 154 232)           )
863d348b R/granova.ds.ggplot.R 166 233)   }
863d348b R/granova.ds.ggplot.R 167 234) 
794c4b70 R/granova.ds.ggplot.R 166 235)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 236)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 237)   }
863d348b R/granova.ds.ggplot.R 174 238) 
3eb0e1f7 R/granova.ds.ggplot.R 173 239)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 240)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 241)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 242)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 243)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 244)                       )
a71441d3 R/granova.ds.ggplot.R 166 245)           )
863d348b R/granova.ds.ggplot.R 183 246)   }
863d348b R/granova.ds.ggplot.R 184 247) 
794c4b70 R/granova.ds.ggplot.R 183 248)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 249)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 250)   }
863d348b R/granova.ds.ggplot.R 188 251) 
794c4b70 R/granova.ds.ggplot.R 187 252)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 253)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 254)   }
863d348b R/granova.ds.ggplot.R 192 255) 
794c4b70 R/granova.ds.ggplot.R 191 256)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 257)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 258)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 259)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 260)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 261)                    )  
a71441d3 R/granova.ds.ggplot.R 183 262)           )
863d348b R/granova.ds.ggplot.R 202 263)   }
863d348b R/granova.ds.ggplot.R 203 264) 
794c4b70 R/granova.ds.ggplot.R 202 265)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 266)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 267)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 268)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 269)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 270)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 271)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 272)           )
863d348b R/granova.ds.ggplot.R 213 273)   }
c2605051 R/granova.ds.bd.R     271 274)   
794c4b70 R/granova.ds.ggplot.R 213 275)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 276)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 277)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 278)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 279)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 280)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 281)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 282)           )
aaeade58 R/granova.ds.bd.R     274 283)     
863d348b R/granova.ds.ggplot.R 225 284)   }
863d348b R/granova.ds.ggplot.R 226 285) 
794c4b70 R/granova.ds.ggplot.R 225 286)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 287)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 288)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 289)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 290)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 291)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 292)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 293)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 294)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 295)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 296)                        )  
a71441d3 R/granova.ds.ggplot.R 216 297)           )
863d348b R/granova.ds.ggplot.R 242 298)   }
863d348b R/granova.ds.ggplot.R 243 299) 
794c4b70 R/granova.ds.ggplot.R 242 300)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 301)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 302)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 303)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 304)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 305)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 306)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 307)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 308)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 309)                        )
a71441d3 R/granova.ds.ggplot.R 229 310)           )
863d348b R/granova.ds.ggplot.R 258 311)   }
863d348b R/granova.ds.ggplot.R 259 312) 
794c4b70 R/granova.ds.ggplot.R 258 313)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 314)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 315)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 316)                          ),
a71441d3 R/granova.ds.ggplot.R 236 317)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 318)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 319)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 320)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 321)                      )
a71441d3 R/granova.ds.ggplot.R 240 322)           )
863d348b R/granova.ds.ggplot.R 272 323)   }
863d348b R/granova.ds.ggplot.R 273 324) 
794c4b70 R/granova.ds.ggplot.R 272 325)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 326)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 327)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 328)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 329)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 330)                            ),
a71441d3 R/granova.ds.ggplot.R 249 331)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 332)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 333)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 334)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 335)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 336)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 337)           )
863d348b R/granova.ds.ggplot.R 290 338)   }
863d348b R/granova.ds.ggplot.R 291 339) 
ef841aa1 R/granova.ds.ggplot.R 257 340)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 341)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 342)   
a71441d3 R/granova.ds.ggplot.R 261 343)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 344)   }
863d348b R/granova.ds.ggplot.R 297 345) 
0afa3a38 R/granovagg.ds.R      306 346)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 347)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 348)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 349)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 350)     }
0afa3a38 R/granovagg.ds.R      311 351)     
0afa3a38 R/granovagg.ds.R      312 352)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 353)   }
0afa3a38 R/granovagg.ds.R      314 354)   
485d5f02 R/granovagg.ds.R      317 355)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 356)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 357)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 358)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 359)     }
485d5f02 R/granovagg.ds.R      322 360)     
485d5f02 R/granovagg.ds.R      323 361)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 362)   }
485d5f02 R/granovagg.ds.R      325 363)   
794c4b70 R/granova.ds.ggplot.R 296 364)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 365)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 366)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 367)     }
a2b6fe7d R/granovagg.ds.R      320 368)     
a2b6fe7d R/granovagg.ds.R      321 369)     else {
a2b6fe7d R/granovagg.ds.R      322 370)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 371)     }
863d348b R/granova.ds.ggplot.R 304 372)   }
b5b60529 R/granova.ds.ggplot.R 270 373)   
b5b60529 R/granova.ds.ggplot.R 271 374)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 375)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 376)   }
b5b60529 R/granova.ds.ggplot.R 274 377)   
3b102930 R/granova.ds.ggplot.R 275 378)           
3eb0e1f7 R/granova.ds.ggplot.R 304 379)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 380)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 381)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 382)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 383)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 384)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 385)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 386)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 387)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 388)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 389)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 390)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 391)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 392)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 393)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 394)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 395)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 396) 
a71441d3 R/granova.ds.ggplot.R 288 397)   return(p)
5d58b37c R/granova.ds.bd.R     314 398) 
b3a74c98 R/granova.ds.bd.R     301 399) }
</pre>
<div class="compileroutput">
granovagg.ds checks to make sure input data is n x 2, coerces data to dataframe if it's not already a dataframe.<p>Closes #73<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="ee6ec76"></a>
ee6ec76 2011-08-22 18:44:49 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
544a88ef R/granovagg.ds.R       56  56)   GetAndCheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  57)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  58)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  59)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  60)   }
544a88ef R/granovagg.ds.R       61  61)   
544a88ef R/granovagg.ds.R       62  62)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  63)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  64)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  65)     }
544a88ef R/granovagg.ds.R       66  66)   }
544a88ef R/granovagg.ds.R       67  67) 
544a88ef R/granovagg.ds.R       68  68)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  69)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  70)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  71)       stop(message)
544a88ef R/granovagg.ds.R       72  72)     }
544a88ef R/granovagg.ds.R       73  73)     
544a88ef R/granovagg.ds.R       74  74)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  75)       stop(message)
544a88ef R/granovagg.ds.R       76  76)     }
544a88ef R/granovagg.ds.R       77  77)   }
544a88ef R/granovagg.ds.R       78  78)   
544a88ef R/granovagg.ds.R       79  79)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  80)     output &lt;- data
544a88ef R/granovagg.ds.R       81  81)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82  82)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83  83)     }
544a88ef R/granovagg.ds.R       84  84)     return(output)
544a88ef R/granovagg.ds.R       85  85)   }
544a88ef R/granovagg.ds.R       86  86)   
794c4b70 R/granova.ds.ggplot.R   9  87)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  88)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  89)   }
a806fcaa R/granova.ds.bd.R      15  90) 
794c4b70 R/granova.ds.ggplot.R  13  91)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  92)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  93)   }
e589a242 R/granova.ds.bd.R      17  94) 
794c4b70 R/granova.ds.ggplot.R  17  95)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  96)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  97)   }
c2605051 R/granova.ds.bd.R     182  98)   
794c4b70 R/granova.ds.ggplot.R  21  99)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 100)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 101)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 102)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 103)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 104)                  )
a71441d3 R/granova.ds.ggplot.R  27 105)           )
863d348b R/granova.ds.ggplot.R  30 106)   }
c2605051 R/granova.ds.bd.R     187 107)   
794c4b70 R/granova.ds.ggplot.R  30 108)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 109)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 110)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 111)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 112)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 113)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 114)                      )
a71441d3 R/granova.ds.ggplot.R  38 115)           )
863d348b R/granova.ds.ggplot.R  41 116)   }
c2605051 R/granova.ds.bd.R     191 117)   
794c4b70 R/granova.ds.ggplot.R  41 118)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 119)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 120)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 121)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 122)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 123)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 124)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 125)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 126)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 127)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 128)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 129)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 130)   
a71441d3 R/granova.ds.ggplot.R  54 131)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 132)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 133)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 134)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 135)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 136)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 137)                )
a71441d3 R/granova.ds.ggplot.R  61 138)           )
863d348b R/granova.ds.ggplot.R  64 139)   }
c2605051 R/granova.ds.bd.R     199 140)   
794c4b70 R/granova.ds.ggplot.R  64 141)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 142)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 143)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 144)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 145)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 146)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 147)   }
863d348b R/granova.ds.ggplot.R  73 148) 
794c4b70 R/granova.ds.ggplot.R  72 149)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 150)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 151)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 152)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 153)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 154)                      )
a71441d3 R/granova.ds.ggplot.R  78 155)           )  
863d348b R/granova.ds.ggplot.R  82 156)   }
c2605051 R/granova.ds.bd.R     209 157)   
794c4b70 R/granova.ds.ggplot.R  82 158)   GetCIBand &lt;- function(dsp) {
<span class="changed">ee6ec76f R/granovagg.ds.R      159 159)     return(data.frame(cx.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">ee6ec76f R/granovagg.ds.R      160 160)                       cy.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">ee6ec76f R/granovagg.ds.R      161 161)                       cx     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">ee6ec76f R/granovagg.ds.R      162 162)                       cy     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
a71441d3 R/granova.ds.ggplot.R  86 163)                       color  = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 164)                      )
a71441d3 R/granova.ds.ggplot.R  88 165)           )
5f570d2d R/granova.ds.bd.R     190 166)     
863d348b R/granova.ds.ggplot.R  94 167)   }
c2605051 R/granova.ds.bd.R     224 168)   
794c4b70 R/granova.ds.ggplot.R  94 169)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 170)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 171)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 172)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 173)                      )
a71441d3 R/granova.ds.ggplot.R  97 174)           )
863d348b R/granova.ds.ggplot.R 103 175)   }
863d348b R/granova.ds.ggplot.R 104 176) 
794c4b70 R/granova.ds.ggplot.R 103 177)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 178)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 179)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 180)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 181)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 182)                      )
a71441d3 R/granova.ds.ggplot.R 106 183)           )
863d348b R/granova.ds.ggplot.R 114 184)   }
c2605051 R/granova.ds.bd.R     239 185)   
794c4b70 R/granova.ds.ggplot.R 114 186)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 187)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 188)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 189)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 190)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 191)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 192)                )
a71441d3 R/granova.ds.ggplot.R 116 193)           )         
863d348b R/granova.ds.ggplot.R 125 194)   }
863d348b R/granova.ds.ggplot.R 126 195) 
544a88ef R/granovagg.ds.R      196 196)   dsp                &lt;- list(data = GetAndCheckData(data))
a71441d3 R/granova.ds.ggplot.R 120 197)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 198)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 199)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 200)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 201)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 202)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 203)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 204)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 205)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 206)     
c2605051 R/granova.ds.bd.R     256 207)   
863d348b R/granova.ds.ggplot.R 139 208) 
863d348b R/granova.ds.ggplot.R 140 209)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 210)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 211) 
863d348b R/granova.ds.ggplot.R 143 212)   
3eb0e1f7 R/granova.ds.ggplot.R 142 213)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 214)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 215)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 216)                             ),
a71441d3 R/granova.ds.ggplot.R 140 217)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 218)                  )
863d348b R/granova.ds.ggplot.R 151 219)           )
863d348b R/granova.ds.ggplot.R 152 220)   }
e60e59e1 R/granova.ds.bd.R     241 221)     
794c4b70 R/granova.ds.ggplot.R 152 222)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 223)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 224)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 225)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 226)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 227)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 228)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 229)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 230)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 231)                       )
a71441d3 R/granova.ds.ggplot.R 154 232)           )
863d348b R/granova.ds.ggplot.R 166 233)   }
863d348b R/granova.ds.ggplot.R 167 234) 
794c4b70 R/granova.ds.ggplot.R 166 235)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 236)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 237)   }
863d348b R/granova.ds.ggplot.R 174 238) 
3eb0e1f7 R/granova.ds.ggplot.R 173 239)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 240)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 241)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 242)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 243)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 244)                       )
a71441d3 R/granova.ds.ggplot.R 166 245)           )
863d348b R/granova.ds.ggplot.R 183 246)   }
863d348b R/granova.ds.ggplot.R 184 247) 
794c4b70 R/granova.ds.ggplot.R 183 248)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 249)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 250)   }
863d348b R/granova.ds.ggplot.R 188 251) 
794c4b70 R/granova.ds.ggplot.R 187 252)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 253)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 254)   }
863d348b R/granova.ds.ggplot.R 192 255) 
794c4b70 R/granova.ds.ggplot.R 191 256)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 257)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 258)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 259)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 260)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 261)                    )  
a71441d3 R/granova.ds.ggplot.R 183 262)           )
863d348b R/granova.ds.ggplot.R 202 263)   }
863d348b R/granova.ds.ggplot.R 203 264) 
794c4b70 R/granova.ds.ggplot.R 202 265)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 266)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 267)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 268)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 269)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 270)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 271)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 272)           )
863d348b R/granova.ds.ggplot.R 213 273)   }
c2605051 R/granova.ds.bd.R     271 274)   
794c4b70 R/granova.ds.ggplot.R 213 275)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 276)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 277)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 278)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 279)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 280)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 281)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 282)           )
aaeade58 R/granova.ds.bd.R     274 283)     
863d348b R/granova.ds.ggplot.R 225 284)   }
863d348b R/granova.ds.ggplot.R 226 285) 
794c4b70 R/granova.ds.ggplot.R 225 286)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 287)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 288)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 289)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 290)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 291)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 292)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 293)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 294)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 295)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 296)                        )  
a71441d3 R/granova.ds.ggplot.R 216 297)           )
863d348b R/granova.ds.ggplot.R 242 298)   }
863d348b R/granova.ds.ggplot.R 243 299) 
794c4b70 R/granova.ds.ggplot.R 242 300)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 301)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 302)                             y     = cy,
a71441d3 R/granova.ds.ggplot.R 222 303)                             xend  = cx.end,
a71441d3 R/granova.ds.ggplot.R 223 304)                             yend  = cy.end,                        
a71441d3 R/granova.ds.ggplot.R 224 305)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 306)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 307)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 308)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 309)                        )
a71441d3 R/granova.ds.ggplot.R 229 310)           )
863d348b R/granova.ds.ggplot.R 258 311)   }
863d348b R/granova.ds.ggplot.R 259 312) 
794c4b70 R/granova.ds.ggplot.R 258 313)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 314)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 315)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 316)                          ),
a71441d3 R/granova.ds.ggplot.R 236 317)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 318)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 319)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 320)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 321)                      )
a71441d3 R/granova.ds.ggplot.R 240 322)           )
863d348b R/granova.ds.ggplot.R 272 323)   }
863d348b R/granova.ds.ggplot.R 273 324) 
794c4b70 R/granova.ds.ggplot.R 272 325)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 326)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 327)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 328)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 329)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 330)                            ),
a71441d3 R/granova.ds.ggplot.R 249 331)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 332)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 333)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 334)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 335)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 336)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 337)           )
863d348b R/granova.ds.ggplot.R 290 338)   }
863d348b R/granova.ds.ggplot.R 291 339) 
ef841aa1 R/granova.ds.ggplot.R 257 340)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 341)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 342)   
a71441d3 R/granova.ds.ggplot.R 261 343)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 344)   }
863d348b R/granova.ds.ggplot.R 297 345) 
0afa3a38 R/granovagg.ds.R      306 346)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 347)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 348)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 349)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 350)     }
0afa3a38 R/granovagg.ds.R      311 351)     
0afa3a38 R/granovagg.ds.R      312 352)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 353)   }
0afa3a38 R/granovagg.ds.R      314 354)   
485d5f02 R/granovagg.ds.R      317 355)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 356)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 357)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 358)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 359)     }
485d5f02 R/granovagg.ds.R      322 360)     
485d5f02 R/granovagg.ds.R      323 361)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 362)   }
485d5f02 R/granovagg.ds.R      325 363)   
794c4b70 R/granova.ds.ggplot.R 296 364)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 365)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 366)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 367)     }
a2b6fe7d R/granovagg.ds.R      320 368)     
a2b6fe7d R/granovagg.ds.R      321 369)     else {
a2b6fe7d R/granovagg.ds.R      322 370)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 371)     }
863d348b R/granova.ds.ggplot.R 304 372)   }
b5b60529 R/granova.ds.ggplot.R 270 373)   
b5b60529 R/granova.ds.ggplot.R 271 374)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 375)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 376)   }
b5b60529 R/granova.ds.ggplot.R 274 377)   
3b102930 R/granova.ds.ggplot.R 275 378)           
3eb0e1f7 R/granova.ds.ggplot.R 304 379)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 380)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 381)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 382)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 383)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 384)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 385)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 386)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 387)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 388)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 389)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 390)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 391)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 392)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 393)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 394)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 395)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 396) 
a71441d3 R/granova.ds.ggplot.R 288 397)   return(p)
5d58b37c R/granova.ds.bd.R     314 398) 
b3a74c98 R/granova.ds.bd.R     301 399) }
</pre>
<div class="compileroutput">
Both the Crossbow and the CI Band now plot top-left to bottom-right.<p>That is, the starting x,y coordinate pairs for each are the minimal x and maximal y, respectively, and the ending coordinates are the maximal x and minimal y, respectively. <br>
</p><p><br>
</p></div>
</td>
<td>
<a name="0d72518"></a>
0d72518 2011-08-22 19:35:08 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
544a88ef R/granovagg.ds.R       56  56)   GetAndCheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  57)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  58)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  59)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  60)   }
544a88ef R/granovagg.ds.R       61  61)   
544a88ef R/granovagg.ds.R       62  62)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  63)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  64)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  65)     }
544a88ef R/granovagg.ds.R       66  66)   }
544a88ef R/granovagg.ds.R       67  67) 
544a88ef R/granovagg.ds.R       68  68)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  69)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  70)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  71)       stop(message)
544a88ef R/granovagg.ds.R       72  72)     }
544a88ef R/granovagg.ds.R       73  73)     
544a88ef R/granovagg.ds.R       74  74)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  75)       stop(message)
544a88ef R/granovagg.ds.R       76  76)     }
544a88ef R/granovagg.ds.R       77  77)   }
544a88ef R/granovagg.ds.R       78  78)   
544a88ef R/granovagg.ds.R       79  79)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  80)     output &lt;- data
544a88ef R/granovagg.ds.R       81  81)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82  82)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83  83)     }
544a88ef R/granovagg.ds.R       84  84)     return(output)
544a88ef R/granovagg.ds.R       85  85)   }
544a88ef R/granovagg.ds.R       86  86)   
794c4b70 R/granova.ds.ggplot.R   9  87)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  88)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  89)   }
a806fcaa R/granova.ds.bd.R      15  90) 
794c4b70 R/granova.ds.ggplot.R  13  91)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  92)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  93)   }
e589a242 R/granova.ds.bd.R      17  94) 
794c4b70 R/granova.ds.ggplot.R  17  95)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  96)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  97)   }
c2605051 R/granova.ds.bd.R     182  98)   
794c4b70 R/granova.ds.ggplot.R  21  99)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 100)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 101)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 102)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 103)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 104)                  )
a71441d3 R/granova.ds.ggplot.R  27 105)           )
863d348b R/granova.ds.ggplot.R  30 106)   }
c2605051 R/granova.ds.bd.R     187 107)   
794c4b70 R/granova.ds.ggplot.R  30 108)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 109)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 110)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 111)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 112)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 113)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 114)                      )
a71441d3 R/granova.ds.ggplot.R  38 115)           )
863d348b R/granova.ds.ggplot.R  41 116)   }
c2605051 R/granova.ds.bd.R     191 117)   
794c4b70 R/granova.ds.ggplot.R  41 118)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 119)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 120)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 121)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 122)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 123)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 124)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 125)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 126)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 127)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 128)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 129)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 130)   
a71441d3 R/granova.ds.ggplot.R  54 131)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 132)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 133)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 134)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 135)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 136)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 137)                )
a71441d3 R/granova.ds.ggplot.R  61 138)           )
863d348b R/granova.ds.ggplot.R  64 139)   }
c2605051 R/granova.ds.bd.R     199 140)   
794c4b70 R/granova.ds.ggplot.R  64 141)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 142)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 143)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 144)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 145)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 146)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 147)   }
863d348b R/granova.ds.ggplot.R  73 148) 
794c4b70 R/granova.ds.ggplot.R  72 149)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 150)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 151)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 152)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 153)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 154)                      )
a71441d3 R/granova.ds.ggplot.R  78 155)           )  
863d348b R/granova.ds.ggplot.R  82 156)   }
c2605051 R/granova.ds.bd.R     209 157)   
794c4b70 R/granova.ds.ggplot.R  82 158)   GetCIBand &lt;- function(dsp) {
<span class="changed">0d72518f R/granovagg.ds.R      159 159)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      160 160)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      161 161)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      162 162)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),</span>
<span class="changed">0d72518f R/granovagg.ds.R      163 163)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))</span>
a71441d3 R/granova.ds.ggplot.R  87 164)                      )
a71441d3 R/granova.ds.ggplot.R  88 165)           )
5f570d2d R/granova.ds.bd.R     190 166)     
863d348b R/granova.ds.ggplot.R  94 167)   }
c2605051 R/granova.ds.bd.R     224 168)   
794c4b70 R/granova.ds.ggplot.R  94 169)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 170)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 171)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 172)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 173)                      )
a71441d3 R/granova.ds.ggplot.R  97 174)           )
863d348b R/granova.ds.ggplot.R 103 175)   }
863d348b R/granova.ds.ggplot.R 104 176) 
794c4b70 R/granova.ds.ggplot.R 103 177)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 178)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 179)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 180)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 181)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 182)                      )
a71441d3 R/granova.ds.ggplot.R 106 183)           )
863d348b R/granova.ds.ggplot.R 114 184)   }
c2605051 R/granova.ds.bd.R     239 185)   
794c4b70 R/granova.ds.ggplot.R 114 186)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 187)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 188)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 189)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 190)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 191)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 192)                )
a71441d3 R/granova.ds.ggplot.R 116 193)           )         
863d348b R/granova.ds.ggplot.R 125 194)   }
863d348b R/granova.ds.ggplot.R 126 195) 
544a88ef R/granovagg.ds.R      196 196)   dsp                &lt;- list(data = GetAndCheckData(data))
a71441d3 R/granova.ds.ggplot.R 120 197)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 198)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 199)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 200)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 201)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 202)   dsp$CIBand         &lt;- GetCIBand(dsp)
e603b053 R/granova.ds.ggplot.R 132 203)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 204)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 205)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 206)     
c2605051 R/granova.ds.bd.R     256 207)   
863d348b R/granova.ds.ggplot.R 139 208) 
863d348b R/granova.ds.ggplot.R 140 209)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 210)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 211) 
863d348b R/granova.ds.ggplot.R 143 212)   
3eb0e1f7 R/granova.ds.ggplot.R 142 213)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 214)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 215)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 216)                             ),
a71441d3 R/granova.ds.ggplot.R 140 217)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 218)                  )
863d348b R/granova.ds.ggplot.R 151 219)           )
863d348b R/granova.ds.ggplot.R 152 220)   }
e60e59e1 R/granova.ds.bd.R     241 221)     
794c4b70 R/granova.ds.ggplot.R 152 222)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 223)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 224)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 225)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 226)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 227)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 228)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 229)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 230)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 231)                       )
a71441d3 R/granova.ds.ggplot.R 154 232)           )
863d348b R/granova.ds.ggplot.R 166 233)   }
863d348b R/granova.ds.ggplot.R 167 234) 
794c4b70 R/granova.ds.ggplot.R 166 235)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 236)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 237)   }
863d348b R/granova.ds.ggplot.R 174 238) 
3eb0e1f7 R/granova.ds.ggplot.R 173 239)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 240)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 241)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 242)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 243)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 244)                       )
a71441d3 R/granova.ds.ggplot.R 166 245)           )
863d348b R/granova.ds.ggplot.R 183 246)   }
863d348b R/granova.ds.ggplot.R 184 247) 
794c4b70 R/granova.ds.ggplot.R 183 248)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 249)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 250)   }
863d348b R/granova.ds.ggplot.R 188 251) 
794c4b70 R/granova.ds.ggplot.R 187 252)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 253)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 254)   }
863d348b R/granova.ds.ggplot.R 192 255) 
794c4b70 R/granova.ds.ggplot.R 191 256)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 257)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 258)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 259)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 260)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 261)                    )  
a71441d3 R/granova.ds.ggplot.R 183 262)           )
863d348b R/granova.ds.ggplot.R 202 263)   }
863d348b R/granova.ds.ggplot.R 203 264) 
794c4b70 R/granova.ds.ggplot.R 202 265)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 266)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 267)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 268)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 269)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 270)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 271)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 272)           )
863d348b R/granova.ds.ggplot.R 213 273)   }
c2605051 R/granova.ds.bd.R     271 274)   
794c4b70 R/granova.ds.ggplot.R 213 275)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 276)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 277)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 278)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 279)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 280)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 281)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 282)           )
aaeade58 R/granova.ds.bd.R     274 283)     
863d348b R/granova.ds.ggplot.R 225 284)   }
863d348b R/granova.ds.ggplot.R 226 285) 
794c4b70 R/granova.ds.ggplot.R 225 286)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 287)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 288)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 289)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 290)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 291)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 292)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 293)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 294)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 295)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 296)                        )  
a71441d3 R/granova.ds.ggplot.R 216 297)           )
863d348b R/granova.ds.ggplot.R 242 298)   }
863d348b R/granova.ds.ggplot.R 243 299) 
794c4b70 R/granova.ds.ggplot.R 242 300)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 301)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 302)                             y     = cy,
<span class="changed">0d72518f R/granovagg.ds.R      303 303)                             xend  = x.end,</span>
<span class="changed">0d72518f R/granovagg.ds.R      304 304)                             yend  = y.end,                        </span>
a71441d3 R/granova.ds.ggplot.R 224 305)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 306)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 307)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 308)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 309)                        )
a71441d3 R/granova.ds.ggplot.R 229 310)           )
863d348b R/granova.ds.ggplot.R 258 311)   }
863d348b R/granova.ds.ggplot.R 259 312) 
794c4b70 R/granova.ds.ggplot.R 258 313)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 314)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 315)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 316)                          ),
a71441d3 R/granova.ds.ggplot.R 236 317)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 318)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 319)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 320)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 321)                      )
a71441d3 R/granova.ds.ggplot.R 240 322)           )
863d348b R/granova.ds.ggplot.R 272 323)   }
863d348b R/granova.ds.ggplot.R 273 324) 
794c4b70 R/granova.ds.ggplot.R 272 325)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 326)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 327)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 328)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 329)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 330)                            ),
a71441d3 R/granova.ds.ggplot.R 249 331)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 332)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 333)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 334)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 335)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 336)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 337)           )
863d348b R/granova.ds.ggplot.R 290 338)   }
863d348b R/granova.ds.ggplot.R 291 339) 
ef841aa1 R/granova.ds.ggplot.R 257 340)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 341)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 342)   
a71441d3 R/granova.ds.ggplot.R 261 343)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 344)   }
863d348b R/granova.ds.ggplot.R 297 345) 
0afa3a38 R/granovagg.ds.R      306 346)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 347)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 348)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 349)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 350)     }
0afa3a38 R/granovagg.ds.R      311 351)     
0afa3a38 R/granovagg.ds.R      312 352)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 353)   }
0afa3a38 R/granovagg.ds.R      314 354)   
485d5f02 R/granovagg.ds.R      317 355)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 356)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 357)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 358)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 359)     }
485d5f02 R/granovagg.ds.R      322 360)     
485d5f02 R/granovagg.ds.R      323 361)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 362)   }
485d5f02 R/granovagg.ds.R      325 363)   
794c4b70 R/granova.ds.ggplot.R 296 364)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 365)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 366)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 367)     }
a2b6fe7d R/granovagg.ds.R      320 368)     
a2b6fe7d R/granovagg.ds.R      321 369)     else {
a2b6fe7d R/granovagg.ds.R      322 370)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 371)     }
863d348b R/granova.ds.ggplot.R 304 372)   }
b5b60529 R/granova.ds.ggplot.R 270 373)   
b5b60529 R/granova.ds.ggplot.R 271 374)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 375)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 376)   }
b5b60529 R/granova.ds.ggplot.R 274 377)   
3b102930 R/granova.ds.ggplot.R 275 378)           
3eb0e1f7 R/granova.ds.ggplot.R 304 379)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 380)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 381)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 382)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 383)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 384)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 385)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 386)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 387)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 388)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 389)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 390)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 391)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 392)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 393)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 394)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 395)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 396) 
a71441d3 R/granova.ds.ggplot.R 288 397)   return(p)
5d58b37c R/granova.ds.bd.R     314 398) 
b3a74c98 R/granova.ds.bd.R     301 399) }
</pre>
<div class="compileroutput">
Standardize names for GetCIBand output columns to match output column names from GetCrossbow.<p></p><p><br>
</p></div>
</td>
<td>
<a name="754a854"></a>
754a854 2011-08-22 21:04:15 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
544a88ef R/granovagg.ds.R       56  56)   GetAndCheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  57)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  58)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  59)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  60)   }
544a88ef R/granovagg.ds.R       61  61)   
544a88ef R/granovagg.ds.R       62  62)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  63)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  64)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  65)     }
544a88ef R/granovagg.ds.R       66  66)   }
544a88ef R/granovagg.ds.R       67  67) 
544a88ef R/granovagg.ds.R       68  68)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  69)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  70)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  71)       stop(message)
544a88ef R/granovagg.ds.R       72  72)     }
544a88ef R/granovagg.ds.R       73  73)     
544a88ef R/granovagg.ds.R       74  74)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  75)       stop(message)
544a88ef R/granovagg.ds.R       76  76)     }
544a88ef R/granovagg.ds.R       77  77)   }
544a88ef R/granovagg.ds.R       78  78)   
544a88ef R/granovagg.ds.R       79  79)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  80)     output &lt;- data
544a88ef R/granovagg.ds.R       81  81)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82  82)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83  83)     }
544a88ef R/granovagg.ds.R       84  84)     return(output)
544a88ef R/granovagg.ds.R       85  85)   }
544a88ef R/granovagg.ds.R       86  86)   
794c4b70 R/granova.ds.ggplot.R   9  87)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  88)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  89)   }
a806fcaa R/granova.ds.bd.R      15  90) 
794c4b70 R/granova.ds.ggplot.R  13  91)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  92)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  93)   }
e589a242 R/granova.ds.bd.R      17  94) 
794c4b70 R/granova.ds.ggplot.R  17  95)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  96)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  97)   }
c2605051 R/granova.ds.bd.R     182  98)   
794c4b70 R/granova.ds.ggplot.R  21  99)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 100)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 101)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 102)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 103)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 104)                  )
a71441d3 R/granova.ds.ggplot.R  27 105)           )
863d348b R/granova.ds.ggplot.R  30 106)   }
c2605051 R/granova.ds.bd.R     187 107)   
794c4b70 R/granova.ds.ggplot.R  30 108)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 109)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 110)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 111)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 112)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 113)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 114)                      )
a71441d3 R/granova.ds.ggplot.R  38 115)           )
863d348b R/granova.ds.ggplot.R  41 116)   }
c2605051 R/granova.ds.bd.R     191 117)   
794c4b70 R/granova.ds.ggplot.R  41 118)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 119)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 120)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 121)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 122)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 123)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 124)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 125)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 126)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 127)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 128)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 129)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 130)   
a71441d3 R/granova.ds.ggplot.R  54 131)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 132)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 133)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 134)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 135)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 136)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 137)                )
a71441d3 R/granova.ds.ggplot.R  61 138)           )
863d348b R/granova.ds.ggplot.R  64 139)   }
c2605051 R/granova.ds.bd.R     199 140)   
794c4b70 R/granova.ds.ggplot.R  64 141)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 142)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 143)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 144)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 145)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 146)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 147)   }
863d348b R/granova.ds.ggplot.R  73 148) 
794c4b70 R/granova.ds.ggplot.R  72 149)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 150)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 151)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 152)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 153)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 154)                      )
a71441d3 R/granova.ds.ggplot.R  78 155)           )  
863d348b R/granova.ds.ggplot.R  82 156)   }
c2605051 R/granova.ds.bd.R     209 157)   
794c4b70 R/granova.ds.ggplot.R  82 158)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 159)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 160)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 161)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 162)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 163)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 164)                      )
a71441d3 R/granova.ds.ggplot.R  88 165)           )
5f570d2d R/granova.ds.bd.R     190 166)     
863d348b R/granova.ds.ggplot.R  94 167)   }
c2605051 R/granova.ds.bd.R     224 168)   
794c4b70 R/granova.ds.ggplot.R  94 169)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 170)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 171)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 172)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 173)                      )
a71441d3 R/granova.ds.ggplot.R  97 174)           )
863d348b R/granova.ds.ggplot.R 103 175)   }
863d348b R/granova.ds.ggplot.R 104 176) 
<span class="changed">754a8540 R/granovagg.ds.R      177 177)   GetCrossElementCoordinates &lt;- function(dsp) {</span>
<span class="changed">754a8540 R/granovagg.ds.R      178 178)     crossbow &lt;- dsp$crossbow</span>
<span class="changed">754a8540 R/granovagg.ds.R      179 179)     ci.band  &lt;- subset(dsp$CIBand, select = -color)</span>
<span class="changed">754a8540 R/granovagg.ds.R      180 180)     output   &lt;- rbind(crossbow, ci.band)</span>
<span class="changed">754a8540 R/granovagg.ds.R      181 181)     return(output)</span>
<span class="changed">754a8540 R/granovagg.ds.R      182 182)   }</span>
<span class="changed">754a8540 R/granovagg.ds.R      183 183) </span>
794c4b70 R/granova.ds.ggplot.R 103 184)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 185)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 186)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 187)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 188)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 189)                      )
a71441d3 R/granova.ds.ggplot.R 106 190)           )
863d348b R/granova.ds.ggplot.R 114 191)   }
c2605051 R/granova.ds.bd.R     239 192)   
794c4b70 R/granova.ds.ggplot.R 114 193)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 194)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 195)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 196)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 197)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 198)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 199)                )
a71441d3 R/granova.ds.ggplot.R 116 200)           )         
863d348b R/granova.ds.ggplot.R 125 201)   }
863d348b R/granova.ds.ggplot.R 126 202) 
544a88ef R/granovagg.ds.R      196 203)   dsp                &lt;- list(data = GetAndCheckData(data))
a71441d3 R/granova.ds.ggplot.R 120 204)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 205)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 206)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 207)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 208)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 209)   dsp$CIBand         &lt;- GetCIBand(dsp)
<span class="changed">754a8540 R/granovagg.ds.R      210 210)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)</span>
e603b053 R/granova.ds.ggplot.R 132 211)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 212)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 213)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 214)     
c2605051 R/granova.ds.bd.R     256 215)   
863d348b R/granova.ds.ggplot.R 139 216) 
863d348b R/granova.ds.ggplot.R 140 217)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 218)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 219) 
863d348b R/granova.ds.ggplot.R 143 220)   
3eb0e1f7 R/granova.ds.ggplot.R 142 221)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 222)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 223)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 224)                             ),
a71441d3 R/granova.ds.ggplot.R 140 225)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 226)                  )
863d348b R/granova.ds.ggplot.R 151 227)           )
863d348b R/granova.ds.ggplot.R 152 228)   }
e60e59e1 R/granova.ds.bd.R     241 229)     
794c4b70 R/granova.ds.ggplot.R 152 230)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 231)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 232)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 233)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 234)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 235)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 236)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 237)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 238)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 239)                       )
a71441d3 R/granova.ds.ggplot.R 154 240)           )
863d348b R/granova.ds.ggplot.R 166 241)   }
863d348b R/granova.ds.ggplot.R 167 242) 
794c4b70 R/granova.ds.ggplot.R 166 243)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 244)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 245)   }
863d348b R/granova.ds.ggplot.R 174 246) 
3eb0e1f7 R/granova.ds.ggplot.R 173 247)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 248)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 249)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 250)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 251)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 252)                       )
a71441d3 R/granova.ds.ggplot.R 166 253)           )
863d348b R/granova.ds.ggplot.R 183 254)   }
863d348b R/granova.ds.ggplot.R 184 255) 
794c4b70 R/granova.ds.ggplot.R 183 256)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 257)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 258)   }
863d348b R/granova.ds.ggplot.R 188 259) 
794c4b70 R/granova.ds.ggplot.R 187 260)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 261)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 262)   }
863d348b R/granova.ds.ggplot.R 192 263) 
794c4b70 R/granova.ds.ggplot.R 191 264)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 265)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 266)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 267)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 268)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 269)                    )  
a71441d3 R/granova.ds.ggplot.R 183 270)           )
863d348b R/granova.ds.ggplot.R 202 271)   }
863d348b R/granova.ds.ggplot.R 203 272) 
794c4b70 R/granova.ds.ggplot.R 202 273)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 274)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 275)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 276)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 277)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 278)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 279)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 280)           )
863d348b R/granova.ds.ggplot.R 213 281)   }
c2605051 R/granova.ds.bd.R     271 282)   
794c4b70 R/granova.ds.ggplot.R 213 283)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 284)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 285)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 286)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 287)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 288)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 289)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 290)           )
aaeade58 R/granova.ds.bd.R     274 291)     
863d348b R/granova.ds.ggplot.R 225 292)   }
863d348b R/granova.ds.ggplot.R 226 293) 
794c4b70 R/granova.ds.ggplot.R 225 294)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 295)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 296)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 297)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 298)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 299)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 300)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 301)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 302)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 303)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 304)                        )  
a71441d3 R/granova.ds.ggplot.R 216 305)           )
863d348b R/granova.ds.ggplot.R 242 306)   }
863d348b R/granova.ds.ggplot.R 243 307) 
794c4b70 R/granova.ds.ggplot.R 242 308)   CIBand &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 220 309)     return(geom_segment(aes(x     = cx,
a71441d3 R/granova.ds.ggplot.R 221 310)                             y     = cy,
0d72518f R/granovagg.ds.R      303 311)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 312)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 313)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 314)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 315)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 316)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 317)                        )
a71441d3 R/granova.ds.ggplot.R 229 318)           )
863d348b R/granova.ds.ggplot.R 258 319)   }
863d348b R/granova.ds.ggplot.R 259 320) 
794c4b70 R/granova.ds.ggplot.R 258 321)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 322)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 323)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 324)                          ),
a71441d3 R/granova.ds.ggplot.R 236 325)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 326)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 327)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 328)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 329)                      )
a71441d3 R/granova.ds.ggplot.R 240 330)           )
863d348b R/granova.ds.ggplot.R 272 331)   }
863d348b R/granova.ds.ggplot.R 273 332) 
794c4b70 R/granova.ds.ggplot.R 272 333)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 334)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 335)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 336)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 337)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 338)                            ),
a71441d3 R/granova.ds.ggplot.R 249 339)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 340)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 341)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 342)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 343)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 344)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 345)           )
863d348b R/granova.ds.ggplot.R 290 346)   }
863d348b R/granova.ds.ggplot.R 291 347) 
ef841aa1 R/granova.ds.ggplot.R 257 348)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 349)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 350)   
a71441d3 R/granova.ds.ggplot.R 261 351)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 352)   }
863d348b R/granova.ds.ggplot.R 297 353) 
0afa3a38 R/granovagg.ds.R      306 354)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 355)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 356)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 357)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 358)     }
0afa3a38 R/granovagg.ds.R      311 359)     
0afa3a38 R/granovagg.ds.R      312 360)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 361)   }
0afa3a38 R/granovagg.ds.R      314 362)   
485d5f02 R/granovagg.ds.R      317 363)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 364)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 365)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 366)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 367)     }
485d5f02 R/granovagg.ds.R      322 368)     
485d5f02 R/granovagg.ds.R      323 369)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 370)   }
485d5f02 R/granovagg.ds.R      325 371)   
794c4b70 R/granova.ds.ggplot.R 296 372)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 373)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 374)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 375)     }
a2b6fe7d R/granovagg.ds.R      320 376)     
a2b6fe7d R/granovagg.ds.R      321 377)     else {
a2b6fe7d R/granovagg.ds.R      322 378)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 379)     }
863d348b R/granova.ds.ggplot.R 304 380)   }
b5b60529 R/granova.ds.ggplot.R 270 381)   
b5b60529 R/granova.ds.ggplot.R 271 382)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 383)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 384)   }
b5b60529 R/granova.ds.ggplot.R 274 385)   
3b102930 R/granova.ds.ggplot.R 275 386)           
3eb0e1f7 R/granova.ds.ggplot.R 304 387)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 388)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 389)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 390)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 391)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 392)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 393)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 394)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 395)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 396)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 397)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 398)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 399)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 400)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 401)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 402)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 403)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 404) 
a71441d3 R/granova.ds.ggplot.R 288 405)   return(p)
5d58b37c R/granova.ds.bd.R     314 406) 
b3a74c98 R/granova.ds.bd.R     301 407) }
</pre>
<div class="compileroutput">
Create GetCrossElementCoordinates in granovagg.ds.<p>This function combines all of the coordinate information for "cross elements" of the plot (viz., the Crossbow and Confidence Interval Band) so we can make sure those won't be out of the visual bounds of the plot.<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="7f8f935"></a>
7f8f935 2011-08-22 21:20:00 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
544a88ef R/granovagg.ds.R       56  56)   GetAndCheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  57)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  58)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  59)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  60)   }
544a88ef R/granovagg.ds.R       61  61)   
544a88ef R/granovagg.ds.R       62  62)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  63)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  64)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  65)     }
544a88ef R/granovagg.ds.R       66  66)   }
544a88ef R/granovagg.ds.R       67  67) 
544a88ef R/granovagg.ds.R       68  68)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  69)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  70)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  71)       stop(message)
544a88ef R/granovagg.ds.R       72  72)     }
544a88ef R/granovagg.ds.R       73  73)     
544a88ef R/granovagg.ds.R       74  74)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  75)       stop(message)
544a88ef R/granovagg.ds.R       76  76)     }
544a88ef R/granovagg.ds.R       77  77)   }
544a88ef R/granovagg.ds.R       78  78)   
544a88ef R/granovagg.ds.R       79  79)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  80)     output &lt;- data
544a88ef R/granovagg.ds.R       81  81)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82  82)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83  83)     }
544a88ef R/granovagg.ds.R       84  84)     return(output)
544a88ef R/granovagg.ds.R       85  85)   }
544a88ef R/granovagg.ds.R       86  86)   
794c4b70 R/granova.ds.ggplot.R   9  87)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  88)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  89)   }
a806fcaa R/granova.ds.bd.R      15  90) 
794c4b70 R/granova.ds.ggplot.R  13  91)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  92)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  93)   }
e589a242 R/granova.ds.bd.R      17  94) 
794c4b70 R/granova.ds.ggplot.R  17  95)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  96)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  97)   }
c2605051 R/granova.ds.bd.R     182  98)   
794c4b70 R/granova.ds.ggplot.R  21  99)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 100)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 101)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 102)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 103)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 104)                  )
a71441d3 R/granova.ds.ggplot.R  27 105)           )
863d348b R/granova.ds.ggplot.R  30 106)   }
c2605051 R/granova.ds.bd.R     187 107)   
794c4b70 R/granova.ds.ggplot.R  30 108)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 109)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 110)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 111)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 112)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 113)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 114)                      )
a71441d3 R/granova.ds.ggplot.R  38 115)           )
863d348b R/granova.ds.ggplot.R  41 116)   }
c2605051 R/granova.ds.bd.R     191 117)   
794c4b70 R/granova.ds.ggplot.R  41 118)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 119)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 120)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 121)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 122)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 123)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 124)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 125)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 126)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 127)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 128)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 129)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 130)   
a71441d3 R/granova.ds.ggplot.R  54 131)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 132)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 133)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 134)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 135)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 136)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 137)                )
a71441d3 R/granova.ds.ggplot.R  61 138)           )
863d348b R/granova.ds.ggplot.R  64 139)   }
c2605051 R/granova.ds.bd.R     199 140)   
794c4b70 R/granova.ds.ggplot.R  64 141)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 142)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 143)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 144)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 145)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 146)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 147)   }
863d348b R/granova.ds.ggplot.R  73 148) 
794c4b70 R/granova.ds.ggplot.R  72 149)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 150)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 151)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 152)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 153)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 154)                      )
a71441d3 R/granova.ds.ggplot.R  78 155)           )  
863d348b R/granova.ds.ggplot.R  82 156)   }
c2605051 R/granova.ds.bd.R     209 157)   
794c4b70 R/granova.ds.ggplot.R  82 158)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 159)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 160)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 161)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 162)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 163)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 164)                      )
a71441d3 R/granova.ds.ggplot.R  88 165)           )
5f570d2d R/granova.ds.bd.R     190 166)     
863d348b R/granova.ds.ggplot.R  94 167)   }
c2605051 R/granova.ds.bd.R     224 168)   
794c4b70 R/granova.ds.ggplot.R  94 169)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 170)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 171)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 172)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 173)                      )
a71441d3 R/granova.ds.ggplot.R  97 174)           )
863d348b R/granova.ds.ggplot.R 103 175)   }
863d348b R/granova.ds.ggplot.R 104 176) 
754a8540 R/granovagg.ds.R      177 177)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 178)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 179)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 180)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 181)     return(output)
754a8540 R/granovagg.ds.R      182 182)   }
754a8540 R/granovagg.ds.R      183 183) 
794c4b70 R/granova.ds.ggplot.R 103 184)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 185)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 186)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 187)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 188)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 189)                      )
a71441d3 R/granova.ds.ggplot.R 106 190)           )
863d348b R/granova.ds.ggplot.R 114 191)   }
c2605051 R/granova.ds.bd.R     239 192)   
794c4b70 R/granova.ds.ggplot.R 114 193)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 194)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 195)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 196)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 197)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 198)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 199)                )
a71441d3 R/granova.ds.ggplot.R 116 200)           )         
863d348b R/granova.ds.ggplot.R 125 201)   }
863d348b R/granova.ds.ggplot.R 126 202) 
544a88ef R/granovagg.ds.R      196 203)   dsp                &lt;- list(data = GetAndCheckData(data))
a71441d3 R/granova.ds.ggplot.R 120 204)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 205)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 206)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 207)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 208)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 209)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 210)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
e603b053 R/granova.ds.ggplot.R 132 211)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 212)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 213)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 214)     
c2605051 R/granova.ds.bd.R     256 215)   
863d348b R/granova.ds.ggplot.R 139 216) 
863d348b R/granova.ds.ggplot.R 140 217)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 218)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 219) 
863d348b R/granova.ds.ggplot.R 143 220)   
3eb0e1f7 R/granova.ds.ggplot.R 142 221)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 222)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 223)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 224)                             ),
a71441d3 R/granova.ds.ggplot.R 140 225)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 226)                  )
863d348b R/granova.ds.ggplot.R 151 227)           )
863d348b R/granova.ds.ggplot.R 152 228)   }
e60e59e1 R/granova.ds.bd.R     241 229)     
794c4b70 R/granova.ds.ggplot.R 152 230)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 231)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 232)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 233)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 234)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 235)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 236)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 237)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 238)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 239)                       )
a71441d3 R/granova.ds.ggplot.R 154 240)           )
863d348b R/granova.ds.ggplot.R 166 241)   }
863d348b R/granova.ds.ggplot.R 167 242) 
794c4b70 R/granova.ds.ggplot.R 166 243)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 244)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 245)   }
863d348b R/granova.ds.ggplot.R 174 246) 
3eb0e1f7 R/granova.ds.ggplot.R 173 247)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 248)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 249)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 250)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 251)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 252)                       )
a71441d3 R/granova.ds.ggplot.R 166 253)           )
863d348b R/granova.ds.ggplot.R 183 254)   }
863d348b R/granova.ds.ggplot.R 184 255) 
794c4b70 R/granova.ds.ggplot.R 183 256)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 257)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 258)   }
863d348b R/granova.ds.ggplot.R 188 259) 
794c4b70 R/granova.ds.ggplot.R 187 260)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 261)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 262)   }
863d348b R/granova.ds.ggplot.R 192 263) 
794c4b70 R/granova.ds.ggplot.R 191 264)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 265)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 266)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 267)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 268)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 269)                    )  
a71441d3 R/granova.ds.ggplot.R 183 270)           )
863d348b R/granova.ds.ggplot.R 202 271)   }
863d348b R/granova.ds.ggplot.R 203 272) 
794c4b70 R/granova.ds.ggplot.R 202 273)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 274)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 275)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 276)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 277)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 278)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 279)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 280)           )
863d348b R/granova.ds.ggplot.R 213 281)   }
c2605051 R/granova.ds.bd.R     271 282)   
794c4b70 R/granova.ds.ggplot.R 213 283)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 284)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 285)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 286)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 287)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 288)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 289)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 290)           )
aaeade58 R/granova.ds.bd.R     274 291)     
863d348b R/granova.ds.ggplot.R 225 292)   }
863d348b R/granova.ds.ggplot.R 226 293) 
794c4b70 R/granova.ds.ggplot.R 225 294)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 295)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 296)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 297)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 298)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 299)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 300)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 301)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 302)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 303)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 304)                        )  
a71441d3 R/granova.ds.ggplot.R 216 305)           )
863d348b R/granova.ds.ggplot.R 242 306)   }
863d348b R/granova.ds.ggplot.R 243 307) 
794c4b70 R/granova.ds.ggplot.R 242 308)   CIBand &lt;- function(dsp) {
<span class="changed">7f8f9355 R/granovagg.ds.R      309 309)     return(geom_segment(aes(x     = x,</span>
<span class="changed">7f8f9355 R/granovagg.ds.R      310 310)                             y     = y,</span>
0d72518f R/granovagg.ds.R      303 311)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 312)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 313)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 314)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 315)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 316)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 317)                        )
a71441d3 R/granova.ds.ggplot.R 229 318)           )
863d348b R/granova.ds.ggplot.R 258 319)   }
863d348b R/granova.ds.ggplot.R 259 320) 
794c4b70 R/granova.ds.ggplot.R 258 321)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 322)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 323)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 324)                          ),
a71441d3 R/granova.ds.ggplot.R 236 325)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 326)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 327)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 328)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 329)                      )
a71441d3 R/granova.ds.ggplot.R 240 330)           )
863d348b R/granova.ds.ggplot.R 272 331)   }
863d348b R/granova.ds.ggplot.R 273 332) 
794c4b70 R/granova.ds.ggplot.R 272 333)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 334)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 335)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 336)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 337)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 338)                            ),
a71441d3 R/granova.ds.ggplot.R 249 339)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 340)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 341)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 342)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 343)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 344)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 345)           )
863d348b R/granova.ds.ggplot.R 290 346)   }
863d348b R/granova.ds.ggplot.R 291 347) 
ef841aa1 R/granova.ds.ggplot.R 257 348)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 349)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 350)   
a71441d3 R/granova.ds.ggplot.R 261 351)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 352)   }
863d348b R/granova.ds.ggplot.R 297 353) 
0afa3a38 R/granovagg.ds.R      306 354)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 355)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 356)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 357)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 358)     }
0afa3a38 R/granovagg.ds.R      311 359)     
0afa3a38 R/granovagg.ds.R      312 360)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 361)   }
0afa3a38 R/granovagg.ds.R      314 362)   
485d5f02 R/granovagg.ds.R      317 363)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 364)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 365)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 366)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 367)     }
485d5f02 R/granovagg.ds.R      322 368)     
485d5f02 R/granovagg.ds.R      323 369)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 370)   }
485d5f02 R/granovagg.ds.R      325 371)   
794c4b70 R/granova.ds.ggplot.R 296 372)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 373)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 374)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 375)     }
a2b6fe7d R/granovagg.ds.R      320 376)     
a2b6fe7d R/granovagg.ds.R      321 377)     else {
a2b6fe7d R/granovagg.ds.R      322 378)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 379)     }
863d348b R/granova.ds.ggplot.R 304 380)   }
b5b60529 R/granova.ds.ggplot.R 270 381)   
b5b60529 R/granova.ds.ggplot.R 271 382)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 383)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 384)   }
b5b60529 R/granova.ds.ggplot.R 274 385)   
3b102930 R/granova.ds.ggplot.R 275 386)           
3eb0e1f7 R/granova.ds.ggplot.R 304 387)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 388)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 389)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 390)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 391)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 392)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 393)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 394)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 395)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 396)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 397)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 398)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 399)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 400)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 401)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 402)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 403)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 404) 
a71441d3 R/granova.ds.ggplot.R 288 405)   return(p)
5d58b37c R/granova.ds.bd.R     314 406) 
b3a74c98 R/granova.ds.bd.R     301 407) }
</pre>
<div class="compileroutput">
Fix inconsistency in the column name output for CIBand() in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="73167de"></a>
73167de 2011-08-22 21:22:35 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
485d5f02 R/granovagg.ds.R       27  27) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  28) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  29) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  30) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  31) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  32) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  33) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  34) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  35) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  36) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  37) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  38) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  39) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  40) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  41) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  42) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  43) #' @export
2b0c8b84 R/granovagg.ds.R       71  44) 
ee1b067f R/granovagg.ds.R        1  45) granovagg.ds &lt;- function(data       = NULL, 
e55d776c R/granovagg.ds.R       39  46)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  47)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  48)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  49)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  50)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  51)                          ...
e55d776c R/granovagg.ds.R       42  52)                 ) 
be2e6fbd R/granova.ds.bd.R      19  53) 
be2e6fbd R/granova.ds.bd.R      20  54) {
d6c27487 R/granova.ds.bd.R      12  55)   
544a88ef R/granovagg.ds.R       56  56)   GetAndCheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  57)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  58)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  59)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  60)   }
544a88ef R/granovagg.ds.R       61  61)   
544a88ef R/granovagg.ds.R       62  62)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  63)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  64)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  65)     }
544a88ef R/granovagg.ds.R       66  66)   }
544a88ef R/granovagg.ds.R       67  67) 
544a88ef R/granovagg.ds.R       68  68)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  69)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  70)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  71)       stop(message)
544a88ef R/granovagg.ds.R       72  72)     }
544a88ef R/granovagg.ds.R       73  73)     
544a88ef R/granovagg.ds.R       74  74)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  75)       stop(message)
544a88ef R/granovagg.ds.R       76  76)     }
544a88ef R/granovagg.ds.R       77  77)   }
544a88ef R/granovagg.ds.R       78  78)   
544a88ef R/granovagg.ds.R       79  79)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  80)     output &lt;- data
544a88ef R/granovagg.ds.R       81  81)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82  82)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83  83)     }
544a88ef R/granovagg.ds.R       84  84)     return(output)
544a88ef R/granovagg.ds.R       85  85)   }
544a88ef R/granovagg.ds.R       86  86)   
794c4b70 R/granova.ds.ggplot.R   9  87)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10  88)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12  89)   }
a806fcaa R/granova.ds.bd.R      15  90) 
794c4b70 R/granova.ds.ggplot.R  13  91)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14  92)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16  93)   }
e589a242 R/granova.ds.bd.R      17  94) 
794c4b70 R/granova.ds.ggplot.R  17  95)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18  96)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21  97)   }
c2605051 R/granova.ds.bd.R     182  98)   
794c4b70 R/granova.ds.ggplot.R  21  99)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 100)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 101)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 102)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 103)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 104)                  )
a71441d3 R/granova.ds.ggplot.R  27 105)           )
863d348b R/granova.ds.ggplot.R  30 106)   }
c2605051 R/granova.ds.bd.R     187 107)   
794c4b70 R/granova.ds.ggplot.R  30 108)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 109)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 110)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 111)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 112)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 113)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 114)                      )
a71441d3 R/granova.ds.ggplot.R  38 115)           )
863d348b R/granova.ds.ggplot.R  41 116)   }
c2605051 R/granova.ds.bd.R     191 117)   
794c4b70 R/granova.ds.ggplot.R  41 118)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 119)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 120)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 121)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 122)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 123)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 124)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 125)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 126)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 127)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 128)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 129)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 130)   
a71441d3 R/granova.ds.ggplot.R  54 131)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 132)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 133)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 134)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 135)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 136)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 137)                )
a71441d3 R/granova.ds.ggplot.R  61 138)           )
863d348b R/granova.ds.ggplot.R  64 139)   }
c2605051 R/granova.ds.bd.R     199 140)   
794c4b70 R/granova.ds.ggplot.R  64 141)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 142)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 143)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 144)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 145)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 146)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 147)   }
863d348b R/granova.ds.ggplot.R  73 148) 
794c4b70 R/granova.ds.ggplot.R  72 149)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 150)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 151)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 152)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 153)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 154)                      )
a71441d3 R/granova.ds.ggplot.R  78 155)           )  
863d348b R/granova.ds.ggplot.R  82 156)   }
c2605051 R/granova.ds.bd.R     209 157)   
794c4b70 R/granova.ds.ggplot.R  82 158)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 159)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 160)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 161)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 162)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 163)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 164)                      )
a71441d3 R/granova.ds.ggplot.R  88 165)           )
5f570d2d R/granova.ds.bd.R     190 166)     
863d348b R/granova.ds.ggplot.R  94 167)   }
c2605051 R/granova.ds.bd.R     224 168)   
794c4b70 R/granova.ds.ggplot.R  94 169)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 170)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 171)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 172)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 173)                      )
a71441d3 R/granova.ds.ggplot.R  97 174)           )
863d348b R/granova.ds.ggplot.R 103 175)   }
863d348b R/granova.ds.ggplot.R 104 176) 
754a8540 R/granovagg.ds.R      177 177)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 178)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 179)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 180)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 181)     return(output)
754a8540 R/granovagg.ds.R      182 182)   }
754a8540 R/granovagg.ds.R      183 183) 
<span class="changed">73167de2 R/granovagg.ds.R      184 184)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {</span>
<span class="changed">73167de2 R/granovagg.ds.R      185 185)     minimum &lt;- min(dsp$params$bounds,</span>
<span class="changed">73167de2 R/granovagg.ds.R      186 186)                    dsp$cross.elements$x,</span>
<span class="changed">73167de2 R/granovagg.ds.R      187 187)                    dsp$cross.elements$y.end</span>
<span class="changed">73167de2 R/granovagg.ds.R      188 188)                )</span>
<span class="changed">73167de2 R/granovagg.ds.R      189 189)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))</span>
<span class="changed">73167de2 R/granovagg.ds.R      190 190)   }</span>
<span class="changed">73167de2 R/granovagg.ds.R      191 191)   </span>
794c4b70 R/granova.ds.ggplot.R 103 192)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 193)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 194)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 195)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 196)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 197)                      )
a71441d3 R/granova.ds.ggplot.R 106 198)           )
863d348b R/granova.ds.ggplot.R 114 199)   }
c2605051 R/granova.ds.bd.R     239 200)   
794c4b70 R/granova.ds.ggplot.R 114 201)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 202)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 203)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 204)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 205)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 206)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 207)                )
a71441d3 R/granova.ds.ggplot.R 116 208)           )         
863d348b R/granova.ds.ggplot.R 125 209)   }
863d348b R/granova.ds.ggplot.R 126 210) 
544a88ef R/granovagg.ds.R      196 211)   dsp                &lt;- list(data = GetAndCheckData(data))
a71441d3 R/granova.ds.ggplot.R 120 212)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 213)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 214)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 215)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 216)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 217)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 218)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
<span class="changed">73167de2 R/granovagg.ds.R      219 219)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)</span>
e603b053 R/granova.ds.ggplot.R 132 220)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 221)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 222)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 223)     
c2605051 R/granova.ds.bd.R     256 224)   
863d348b R/granova.ds.ggplot.R 139 225) 
863d348b R/granova.ds.ggplot.R 140 226)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 227)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 228) 
863d348b R/granova.ds.ggplot.R 143 229)   
3eb0e1f7 R/granova.ds.ggplot.R 142 230)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 231)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 232)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 233)                             ),
a71441d3 R/granova.ds.ggplot.R 140 234)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 235)                  )
863d348b R/granova.ds.ggplot.R 151 236)           )
863d348b R/granova.ds.ggplot.R 152 237)   }
e60e59e1 R/granova.ds.bd.R     241 238)     
794c4b70 R/granova.ds.ggplot.R 152 239)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 240)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 241)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 242)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 243)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 244)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 245)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 246)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 247)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 248)                       )
a71441d3 R/granova.ds.ggplot.R 154 249)           )
863d348b R/granova.ds.ggplot.R 166 250)   }
863d348b R/granova.ds.ggplot.R 167 251) 
794c4b70 R/granova.ds.ggplot.R 166 252)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 253)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 254)   }
863d348b R/granova.ds.ggplot.R 174 255) 
3eb0e1f7 R/granova.ds.ggplot.R 173 256)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 257)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 258)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 259)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 260)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 261)                       )
a71441d3 R/granova.ds.ggplot.R 166 262)           )
863d348b R/granova.ds.ggplot.R 183 263)   }
863d348b R/granova.ds.ggplot.R 184 264) 
794c4b70 R/granova.ds.ggplot.R 183 265)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 266)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 267)   }
863d348b R/granova.ds.ggplot.R 188 268) 
794c4b70 R/granova.ds.ggplot.R 187 269)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 270)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 271)   }
863d348b R/granova.ds.ggplot.R 192 272) 
794c4b70 R/granova.ds.ggplot.R 191 273)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 274)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 275)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 276)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 277)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 278)                    )  
a71441d3 R/granova.ds.ggplot.R 183 279)           )
863d348b R/granova.ds.ggplot.R 202 280)   }
863d348b R/granova.ds.ggplot.R 203 281) 
794c4b70 R/granova.ds.ggplot.R 202 282)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 283)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 284)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 285)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 286)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 287)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 288)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 289)           )
863d348b R/granova.ds.ggplot.R 213 290)   }
c2605051 R/granova.ds.bd.R     271 291)   
794c4b70 R/granova.ds.ggplot.R 213 292)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 293)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 294)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 295)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 296)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 297)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 298)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 299)           )
aaeade58 R/granova.ds.bd.R     274 300)     
863d348b R/granova.ds.ggplot.R 225 301)   }
863d348b R/granova.ds.ggplot.R 226 302) 
794c4b70 R/granova.ds.ggplot.R 225 303)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 304)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 305)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 306)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 307)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 308)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 309)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 310)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 311)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 312)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 313)                        )  
a71441d3 R/granova.ds.ggplot.R 216 314)           )
863d348b R/granova.ds.ggplot.R 242 315)   }
863d348b R/granova.ds.ggplot.R 243 316) 
794c4b70 R/granova.ds.ggplot.R 242 317)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 318)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 319)                             y     = y,
0d72518f R/granovagg.ds.R      303 320)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 321)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 322)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 323)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 324)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 325)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 326)                        )
a71441d3 R/granova.ds.ggplot.R 229 327)           )
863d348b R/granova.ds.ggplot.R 258 328)   }
863d348b R/granova.ds.ggplot.R 259 329) 
794c4b70 R/granova.ds.ggplot.R 258 330)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 331)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 332)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 333)                          ),
a71441d3 R/granova.ds.ggplot.R 236 334)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 335)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 336)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 337)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 338)                      )
a71441d3 R/granova.ds.ggplot.R 240 339)           )
863d348b R/granova.ds.ggplot.R 272 340)   }
863d348b R/granova.ds.ggplot.R 273 341) 
794c4b70 R/granova.ds.ggplot.R 272 342)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 343)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 344)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 345)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 346)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 347)                            ),
a71441d3 R/granova.ds.ggplot.R 249 348)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 349)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 350)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 351)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 352)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 353)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 354)           )
863d348b R/granova.ds.ggplot.R 290 355)   }
863d348b R/granova.ds.ggplot.R 291 356) 
ef841aa1 R/granova.ds.ggplot.R 257 357)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 358)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 359)   
a71441d3 R/granova.ds.ggplot.R 261 360)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 361)   }
863d348b R/granova.ds.ggplot.R 297 362) 
0afa3a38 R/granovagg.ds.R      306 363)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 364)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 365)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 366)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 367)     }
0afa3a38 R/granovagg.ds.R      311 368)     
0afa3a38 R/granovagg.ds.R      312 369)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 370)   }
0afa3a38 R/granovagg.ds.R      314 371)   
485d5f02 R/granovagg.ds.R      317 372)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 373)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 374)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 375)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 376)     }
485d5f02 R/granovagg.ds.R      322 377)     
485d5f02 R/granovagg.ds.R      323 378)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 379)   }
485d5f02 R/granovagg.ds.R      325 380)   
794c4b70 R/granova.ds.ggplot.R 296 381)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 382)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 383)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 384)     }
a2b6fe7d R/granovagg.ds.R      320 385)     
a2b6fe7d R/granovagg.ds.R      321 386)     else {
a2b6fe7d R/granovagg.ds.R      322 387)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 388)     }
863d348b R/granova.ds.ggplot.R 304 389)   }
b5b60529 R/granova.ds.ggplot.R 270 390)   
b5b60529 R/granova.ds.ggplot.R 271 391)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 392)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 393)   }
b5b60529 R/granova.ds.ggplot.R 274 394)   
3b102930 R/granova.ds.ggplot.R 275 395)           
3eb0e1f7 R/granova.ds.ggplot.R 304 396)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 397)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 398)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 399)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 400)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 401)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 402)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 403)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 404)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 405)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 406)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 407)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 408)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 409)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 410)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 411)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 412)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 413) 
a71441d3 R/granova.ds.ggplot.R 288 414)   return(p)
5d58b37c R/granova.ds.bd.R     314 415) 
b3a74c98 R/granova.ds.bd.R     301 416) }
</pre>
<div class="compileroutput">
Created EnsureCrossElementsAppearInVisualBounds to make sure both the CI Band and Crossbow appear in the final granovagg.ds plot.<p>Refs:<br>
ee6ec76fa230a951f301371141bc3428429607b2<br>
0d72518ffa40f5154168b9aa1b6cb60bf5cdc3c4<br>
0d72518ffa40f5154168b9aa1b6cb60bf5cdc3c4<br>
754a85400747591b9b7657a147f3358e11481c16<br>
7f8f93558d16068c515c8acf81651dc5ae912ef6<br>
<br>
Closes #74<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="f855a78"></a>
f855a78 2011-08-22 21:49:14 -0400
<br>
<pre>2b0c8b84 R/granovagg.ds.R        1   1) #' Granova for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
<span class="changed">f855a782 R/granovagg.ds.R       27  27) #' @param revc reverses X,Y specifications</span>
485d5f02 R/granovagg.ds.R       27  28) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  29) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  30) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  31) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  32) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  33) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  34) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  35) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  36) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  37) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  38) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  39) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  40) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  41) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  42) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  43) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  44) #' @export
2b0c8b84 R/granovagg.ds.R       71  45) 
<span class="changed">f855a782 R/granovagg.ds.R       46  46) granovagg.ds &lt;- function(data       = NULL,</span>
<span class="changed">f855a782 R/granovagg.ds.R       47  47)                          revc       = FALSE, </span>
e55d776c R/granovagg.ds.R       39  48)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  49)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  50)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  51)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  52)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  53)                          ...
e55d776c R/granovagg.ds.R       42  54)                 ) 
be2e6fbd R/granova.ds.bd.R      19  55) 
be2e6fbd R/granova.ds.bd.R      20  56) {
d6c27487 R/granova.ds.bd.R      12  57)   
<span class="changed">f855a782 R/granovagg.ds.R       58  58)   GetData &lt;- function(data) {</span>
<span class="changed">f855a782 R/granovagg.ds.R       59  59)     output &lt;- CheckData(data)</span>
<span class="changed">f855a782 R/granovagg.ds.R       60  60)     output &lt;- ReverseXAndY(data)</span>
<span class="changed">f855a782 R/granovagg.ds.R       61  61)     return(output)</span>
<span class="changed">f855a782 R/granovagg.ds.R       62  62)   }</span>
<span class="changed">f855a782 R/granovagg.ds.R       63  63)   </span>
<span class="changed">f855a782 R/granovagg.ds.R       64  64)   CheckData &lt;- function(data) {</span>
544a88ef R/granovagg.ds.R       57  65)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  66)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  67)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  68)   }
544a88ef R/granovagg.ds.R       61  69)   
<span class="changed">f855a782 R/granovagg.ds.R       70  70)   ReverseXAndY &lt;- function(data) {</span>
<span class="changed">f855a782 R/granovagg.ds.R       71  71)     output &lt;- data</span>
<span class="changed">f855a782 R/granovagg.ds.R       72  72)     if (revc) {</span>
<span class="changed">f855a782 R/granovagg.ds.R       73  73)       output[, 1] &lt;- data[, 2]</span>
<span class="changed">f855a782 R/granovagg.ds.R       74  74)       output[, 2] &lt;- data[, 1]</span>
<span class="changed">f855a782 R/granovagg.ds.R       75  75)       names(output) &lt;- names(data)[2:1]</span>
<span class="changed">f855a782 R/granovagg.ds.R       76  76)     }</span>
<span class="changed">f855a782 R/granovagg.ds.R       77  77)     return(output)</span>
<span class="changed">f855a782 R/granovagg.ds.R       78  78)   }</span>
<span class="changed">f855a782 R/granovagg.ds.R       79  79)   </span>
544a88ef R/granovagg.ds.R       62  80)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  81)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  82)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  83)     }
544a88ef R/granovagg.ds.R       66  84)   }
544a88ef R/granovagg.ds.R       67  85) 
544a88ef R/granovagg.ds.R       68  86)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  87)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  88)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  89)       stop(message)
544a88ef R/granovagg.ds.R       72  90)     }
544a88ef R/granovagg.ds.R       73  91)     
544a88ef R/granovagg.ds.R       74  92)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  93)       stop(message)
544a88ef R/granovagg.ds.R       76  94)     }
544a88ef R/granovagg.ds.R       77  95)   }
544a88ef R/granovagg.ds.R       78  96)   
544a88ef R/granovagg.ds.R       79  97)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  98)     output &lt;- data
544a88ef R/granovagg.ds.R       81  99)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 100)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 101)     }
544a88ef R/granovagg.ds.R       84 102)     return(output)
544a88ef R/granovagg.ds.R       85 103)   }
544a88ef R/granovagg.ds.R       86 104)   
794c4b70 R/granova.ds.ggplot.R   9 105)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 106)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 107)   }
a806fcaa R/granova.ds.bd.R      15 108) 
794c4b70 R/granova.ds.ggplot.R  13 109)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 110)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 111)   }
e589a242 R/granova.ds.bd.R      17 112) 
794c4b70 R/granova.ds.ggplot.R  17 113)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 114)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 115)   }
c2605051 R/granova.ds.bd.R     182 116)   
794c4b70 R/granova.ds.ggplot.R  21 117)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 118)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 119)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 120)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 121)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 122)                  )
a71441d3 R/granova.ds.ggplot.R  27 123)           )
863d348b R/granova.ds.ggplot.R  30 124)   }
c2605051 R/granova.ds.bd.R     187 125)   
794c4b70 R/granova.ds.ggplot.R  30 126)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 127)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 128)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 129)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 130)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 131)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 132)                      )
a71441d3 R/granova.ds.ggplot.R  38 133)           )
863d348b R/granova.ds.ggplot.R  41 134)   }
c2605051 R/granova.ds.bd.R     191 135)   
794c4b70 R/granova.ds.ggplot.R  41 136)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 137)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 138)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 139)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 140)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 141)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 142)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 143)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 144)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 145)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 146)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 147)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 148)   
a71441d3 R/granova.ds.ggplot.R  54 149)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 150)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 151)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 152)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 153)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 154)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 155)                )
a71441d3 R/granova.ds.ggplot.R  61 156)           )
863d348b R/granova.ds.ggplot.R  64 157)   }
c2605051 R/granova.ds.bd.R     199 158)   
794c4b70 R/granova.ds.ggplot.R  64 159)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 160)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 161)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 162)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 163)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 164)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 165)   }
863d348b R/granova.ds.ggplot.R  73 166) 
794c4b70 R/granova.ds.ggplot.R  72 167)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 168)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 169)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 170)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 171)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 172)                      )
a71441d3 R/granova.ds.ggplot.R  78 173)           )  
863d348b R/granova.ds.ggplot.R  82 174)   }
c2605051 R/granova.ds.bd.R     209 175)   
794c4b70 R/granova.ds.ggplot.R  82 176)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 177)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 178)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 179)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 180)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 181)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 182)                      )
a71441d3 R/granova.ds.ggplot.R  88 183)           )
5f570d2d R/granova.ds.bd.R     190 184)     
863d348b R/granova.ds.ggplot.R  94 185)   }
c2605051 R/granova.ds.bd.R     224 186)   
794c4b70 R/granova.ds.ggplot.R  94 187)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 188)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 189)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 190)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 191)                      )
a71441d3 R/granova.ds.ggplot.R  97 192)           )
863d348b R/granova.ds.ggplot.R 103 193)   }
863d348b R/granova.ds.ggplot.R 104 194) 
754a8540 R/granovagg.ds.R      177 195)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 196)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 197)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 198)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 199)     return(output)
754a8540 R/granovagg.ds.R      182 200)   }
754a8540 R/granovagg.ds.R      183 201) 
73167de2 R/granovagg.ds.R      184 202)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 203)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 204)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 205)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 206)                )
73167de2 R/granovagg.ds.R      189 207)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 208)   }
73167de2 R/granovagg.ds.R      191 209)   
794c4b70 R/granova.ds.ggplot.R 103 210)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 211)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 212)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 213)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 214)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 215)                      )
a71441d3 R/granova.ds.ggplot.R 106 216)           )
863d348b R/granova.ds.ggplot.R 114 217)   }
c2605051 R/granova.ds.bd.R     239 218)   
794c4b70 R/granova.ds.ggplot.R 114 219)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 220)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 221)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 222)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 223)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 224)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 225)                )
a71441d3 R/granova.ds.ggplot.R 116 226)           )         
863d348b R/granova.ds.ggplot.R 125 227)   }
863d348b R/granova.ds.ggplot.R 126 228) 
<span class="changed">f855a782 R/granovagg.ds.R      229 229)   dsp                &lt;- list(data = GetData(data))</span>
a71441d3 R/granova.ds.ggplot.R 120 230)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 231)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 232)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 233)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 234)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 235)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 236)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 237)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 238)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 239)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 240)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 241)     
c2605051 R/granova.ds.bd.R     256 242)   
863d348b R/granova.ds.ggplot.R 139 243) 
863d348b R/granova.ds.ggplot.R 140 244)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 245)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 246) 
863d348b R/granova.ds.ggplot.R 143 247)   
3eb0e1f7 R/granova.ds.ggplot.R 142 248)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 249)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 250)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 251)                             ),
a71441d3 R/granova.ds.ggplot.R 140 252)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 253)                  )
863d348b R/granova.ds.ggplot.R 151 254)           )
863d348b R/granova.ds.ggplot.R 152 255)   }
e60e59e1 R/granova.ds.bd.R     241 256)     
794c4b70 R/granova.ds.ggplot.R 152 257)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 258)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 259)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 260)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 261)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 262)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 263)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 264)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 265)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 266)                       )
a71441d3 R/granova.ds.ggplot.R 154 267)           )
863d348b R/granova.ds.ggplot.R 166 268)   }
863d348b R/granova.ds.ggplot.R 167 269) 
794c4b70 R/granova.ds.ggplot.R 166 270)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 271)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 272)   }
863d348b R/granova.ds.ggplot.R 174 273) 
3eb0e1f7 R/granova.ds.ggplot.R 173 274)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 275)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 276)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 277)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 278)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 279)                       )
a71441d3 R/granova.ds.ggplot.R 166 280)           )
863d348b R/granova.ds.ggplot.R 183 281)   }
863d348b R/granova.ds.ggplot.R 184 282) 
794c4b70 R/granova.ds.ggplot.R 183 283)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 284)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 285)   }
863d348b R/granova.ds.ggplot.R 188 286) 
794c4b70 R/granova.ds.ggplot.R 187 287)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 288)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 289)   }
863d348b R/granova.ds.ggplot.R 192 290) 
794c4b70 R/granova.ds.ggplot.R 191 291)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 292)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 293)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 294)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 295)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 296)                    )  
a71441d3 R/granova.ds.ggplot.R 183 297)           )
863d348b R/granova.ds.ggplot.R 202 298)   }
863d348b R/granova.ds.ggplot.R 203 299) 
794c4b70 R/granova.ds.ggplot.R 202 300)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 301)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 302)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 303)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 304)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 305)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 306)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 307)           )
863d348b R/granova.ds.ggplot.R 213 308)   }
c2605051 R/granova.ds.bd.R     271 309)   
794c4b70 R/granova.ds.ggplot.R 213 310)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 311)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 312)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 313)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 314)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 315)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 316)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 317)           )
aaeade58 R/granova.ds.bd.R     274 318)     
863d348b R/granova.ds.ggplot.R 225 319)   }
863d348b R/granova.ds.ggplot.R 226 320) 
794c4b70 R/granova.ds.ggplot.R 225 321)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 322)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 323)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 324)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 325)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 326)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 327)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 328)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 329)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 330)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 331)                        )  
a71441d3 R/granova.ds.ggplot.R 216 332)           )
863d348b R/granova.ds.ggplot.R 242 333)   }
863d348b R/granova.ds.ggplot.R 243 334) 
794c4b70 R/granova.ds.ggplot.R 242 335)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 336)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 337)                             y     = y,
0d72518f R/granovagg.ds.R      303 338)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 339)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 340)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 341)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 342)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 343)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 344)                        )
a71441d3 R/granova.ds.ggplot.R 229 345)           )
863d348b R/granova.ds.ggplot.R 258 346)   }
863d348b R/granova.ds.ggplot.R 259 347) 
794c4b70 R/granova.ds.ggplot.R 258 348)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 349)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 350)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 351)                          ),
a71441d3 R/granova.ds.ggplot.R 236 352)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 353)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 354)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 355)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 356)                      )
a71441d3 R/granova.ds.ggplot.R 240 357)           )
863d348b R/granova.ds.ggplot.R 272 358)   }
863d348b R/granova.ds.ggplot.R 273 359) 
794c4b70 R/granova.ds.ggplot.R 272 360)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 361)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 362)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 363)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 364)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 365)                            ),
a71441d3 R/granova.ds.ggplot.R 249 366)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 367)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 368)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 369)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 370)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 371)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 372)           )
863d348b R/granova.ds.ggplot.R 290 373)   }
863d348b R/granova.ds.ggplot.R 291 374) 
ef841aa1 R/granova.ds.ggplot.R 257 375)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 376)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 377)   
a71441d3 R/granova.ds.ggplot.R 261 378)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 379)   }
863d348b R/granova.ds.ggplot.R 297 380) 
0afa3a38 R/granovagg.ds.R      306 381)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 382)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 383)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 384)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 385)     }
0afa3a38 R/granovagg.ds.R      311 386)     
0afa3a38 R/granovagg.ds.R      312 387)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 388)   }
0afa3a38 R/granovagg.ds.R      314 389)   
485d5f02 R/granovagg.ds.R      317 390)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 391)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 392)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 393)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 394)     }
485d5f02 R/granovagg.ds.R      322 395)     
485d5f02 R/granovagg.ds.R      323 396)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 397)   }
485d5f02 R/granovagg.ds.R      325 398)   
794c4b70 R/granova.ds.ggplot.R 296 399)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 400)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 401)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 402)     }
a2b6fe7d R/granovagg.ds.R      320 403)     
a2b6fe7d R/granovagg.ds.R      321 404)     else {
a2b6fe7d R/granovagg.ds.R      322 405)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 406)     }
863d348b R/granova.ds.ggplot.R 304 407)   }
b5b60529 R/granova.ds.ggplot.R 270 408)   
b5b60529 R/granova.ds.ggplot.R 271 409)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 410)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 411)   }
b5b60529 R/granova.ds.ggplot.R 274 412)   
3b102930 R/granova.ds.ggplot.R 275 413)           
3eb0e1f7 R/granova.ds.ggplot.R 304 414)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 415)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 416)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 417)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 418)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 419)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 420)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 421)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 422)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 423)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 424)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 425)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 426)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 427)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 428)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 429)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 430)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 431) 
a71441d3 R/granova.ds.ggplot.R 288 432)   return(p)
5d58b37c R/granova.ds.bd.R     314 433) 
b3a74c98 R/granova.ds.bd.R     301 434) }
</pre>
<div class="compileroutput">
granovagg.ds now accepts a revc argument, which reverses the X and Y specifications.<p>Closes #76<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="53df74c"></a>
53df74c 2011-08-24 01:04:04 -0400
<br>
<pre><span class="changed">53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data</span>
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  27) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  28) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  29) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  30) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  31) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  32) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  33) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  34) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  35) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  36) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  37) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  38) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  39) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  40) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  41) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  42) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  43) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  44) #' @export
2b0c8b84 R/granovagg.ds.R       71  45) 
f855a782 R/granovagg.ds.R       46  46) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  47)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  48)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  49)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  50)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  51)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  52)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  53)                          ...
e55d776c R/granovagg.ds.R       42  54)                 ) 
be2e6fbd R/granova.ds.bd.R      19  55) 
be2e6fbd R/granova.ds.bd.R      20  56) {
d6c27487 R/granova.ds.bd.R      12  57)   
f855a782 R/granovagg.ds.R       58  58)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  59)     output &lt;- CheckData(data)
f855a782 R/granovagg.ds.R       60  60)     output &lt;- ReverseXAndY(data)
f855a782 R/granovagg.ds.R       61  61)     return(output)
f855a782 R/granovagg.ds.R       62  62)   }
f855a782 R/granovagg.ds.R       63  63)   
f855a782 R/granovagg.ds.R       64  64)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  65)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  66)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  67)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  68)   }
544a88ef R/granovagg.ds.R       61  69)   
f855a782 R/granovagg.ds.R       70  70)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  71)     output &lt;- data
f855a782 R/granovagg.ds.R       72  72)     if (revc) {
f855a782 R/granovagg.ds.R       73  73)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  74)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  75)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  76)     }
f855a782 R/granovagg.ds.R       77  77)     return(output)
f855a782 R/granovagg.ds.R       78  78)   }
f855a782 R/granovagg.ds.R       79  79)   
544a88ef R/granovagg.ds.R       62  80)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  81)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  82)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  83)     }
544a88ef R/granovagg.ds.R       66  84)   }
544a88ef R/granovagg.ds.R       67  85) 
544a88ef R/granovagg.ds.R       68  86)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  87)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  88)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  89)       stop(message)
544a88ef R/granovagg.ds.R       72  90)     }
544a88ef R/granovagg.ds.R       73  91)     
544a88ef R/granovagg.ds.R       74  92)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  93)       stop(message)
544a88ef R/granovagg.ds.R       76  94)     }
544a88ef R/granovagg.ds.R       77  95)   }
544a88ef R/granovagg.ds.R       78  96)   
544a88ef R/granovagg.ds.R       79  97)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  98)     output &lt;- data
544a88ef R/granovagg.ds.R       81  99)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 100)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 101)     }
544a88ef R/granovagg.ds.R       84 102)     return(output)
544a88ef R/granovagg.ds.R       85 103)   }
544a88ef R/granovagg.ds.R       86 104)   
794c4b70 R/granova.ds.ggplot.R   9 105)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 106)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 107)   }
a806fcaa R/granova.ds.bd.R      15 108) 
794c4b70 R/granova.ds.ggplot.R  13 109)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 110)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 111)   }
e589a242 R/granova.ds.bd.R      17 112) 
794c4b70 R/granova.ds.ggplot.R  17 113)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 114)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 115)   }
c2605051 R/granova.ds.bd.R     182 116)   
794c4b70 R/granova.ds.ggplot.R  21 117)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 118)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 119)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 120)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 121)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 122)                  )
a71441d3 R/granova.ds.ggplot.R  27 123)           )
863d348b R/granova.ds.ggplot.R  30 124)   }
c2605051 R/granova.ds.bd.R     187 125)   
794c4b70 R/granova.ds.ggplot.R  30 126)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 127)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 128)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 129)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 130)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 131)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 132)                      )
a71441d3 R/granova.ds.ggplot.R  38 133)           )
863d348b R/granova.ds.ggplot.R  41 134)   }
c2605051 R/granova.ds.bd.R     191 135)   
794c4b70 R/granova.ds.ggplot.R  41 136)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 137)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 138)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 139)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 140)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 141)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 142)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 143)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 144)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 145)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 146)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 147)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 148)   
a71441d3 R/granova.ds.ggplot.R  54 149)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 150)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 151)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 152)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 153)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 154)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 155)                )
a71441d3 R/granova.ds.ggplot.R  61 156)           )
863d348b R/granova.ds.ggplot.R  64 157)   }
c2605051 R/granova.ds.bd.R     199 158)   
794c4b70 R/granova.ds.ggplot.R  64 159)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 160)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 161)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 162)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 163)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 164)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 165)   }
863d348b R/granova.ds.ggplot.R  73 166) 
794c4b70 R/granova.ds.ggplot.R  72 167)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 168)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 169)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 170)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 171)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 172)                      )
a71441d3 R/granova.ds.ggplot.R  78 173)           )  
863d348b R/granova.ds.ggplot.R  82 174)   }
c2605051 R/granova.ds.bd.R     209 175)   
794c4b70 R/granova.ds.ggplot.R  82 176)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 177)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 178)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 179)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 180)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 181)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 182)                      )
a71441d3 R/granova.ds.ggplot.R  88 183)           )
5f570d2d R/granova.ds.bd.R     190 184)     
863d348b R/granova.ds.ggplot.R  94 185)   }
c2605051 R/granova.ds.bd.R     224 186)   
794c4b70 R/granova.ds.ggplot.R  94 187)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 188)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 189)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 190)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 191)                      )
a71441d3 R/granova.ds.ggplot.R  97 192)           )
863d348b R/granova.ds.ggplot.R 103 193)   }
863d348b R/granova.ds.ggplot.R 104 194) 
754a8540 R/granovagg.ds.R      177 195)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 196)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 197)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 198)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 199)     return(output)
754a8540 R/granovagg.ds.R      182 200)   }
754a8540 R/granovagg.ds.R      183 201) 
73167de2 R/granovagg.ds.R      184 202)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 203)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 204)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 205)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 206)                )
73167de2 R/granovagg.ds.R      189 207)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 208)   }
73167de2 R/granovagg.ds.R      191 209)   
794c4b70 R/granova.ds.ggplot.R 103 210)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 211)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 212)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 213)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 214)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 215)                      )
a71441d3 R/granova.ds.ggplot.R 106 216)           )
863d348b R/granova.ds.ggplot.R 114 217)   }
c2605051 R/granova.ds.bd.R     239 218)   
794c4b70 R/granova.ds.ggplot.R 114 219)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 220)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 221)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 222)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 223)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 224)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 225)                )
a71441d3 R/granova.ds.ggplot.R 116 226)           )         
863d348b R/granova.ds.ggplot.R 125 227)   }
863d348b R/granova.ds.ggplot.R 126 228) 
f855a782 R/granovagg.ds.R      229 229)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 230)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 231)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 232)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 233)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 234)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 235)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 236)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 237)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 238)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 239)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 240)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 241)     
c2605051 R/granova.ds.bd.R     256 242)   
863d348b R/granova.ds.ggplot.R 139 243) 
863d348b R/granova.ds.ggplot.R 140 244)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 245)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 246) 
863d348b R/granova.ds.ggplot.R 143 247)   
3eb0e1f7 R/granova.ds.ggplot.R 142 248)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 249)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 250)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 251)                             ),
a71441d3 R/granova.ds.ggplot.R 140 252)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 253)                  )
863d348b R/granova.ds.ggplot.R 151 254)           )
863d348b R/granova.ds.ggplot.R 152 255)   }
e60e59e1 R/granova.ds.bd.R     241 256)     
794c4b70 R/granova.ds.ggplot.R 152 257)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 258)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 259)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 260)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 261)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 262)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 263)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 264)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 265)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 266)                       )
a71441d3 R/granova.ds.ggplot.R 154 267)           )
863d348b R/granova.ds.ggplot.R 166 268)   }
863d348b R/granova.ds.ggplot.R 167 269) 
794c4b70 R/granova.ds.ggplot.R 166 270)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 271)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 272)   }
863d348b R/granova.ds.ggplot.R 174 273) 
3eb0e1f7 R/granova.ds.ggplot.R 173 274)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 275)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 276)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 277)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 278)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 279)                       )
a71441d3 R/granova.ds.ggplot.R 166 280)           )
863d348b R/granova.ds.ggplot.R 183 281)   }
863d348b R/granova.ds.ggplot.R 184 282) 
794c4b70 R/granova.ds.ggplot.R 183 283)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 284)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 285)   }
863d348b R/granova.ds.ggplot.R 188 286) 
794c4b70 R/granova.ds.ggplot.R 187 287)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 288)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 289)   }
863d348b R/granova.ds.ggplot.R 192 290) 
794c4b70 R/granova.ds.ggplot.R 191 291)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 292)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 293)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 294)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 295)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 296)                    )  
a71441d3 R/granova.ds.ggplot.R 183 297)           )
863d348b R/granova.ds.ggplot.R 202 298)   }
863d348b R/granova.ds.ggplot.R 203 299) 
794c4b70 R/granova.ds.ggplot.R 202 300)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 301)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 302)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 303)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 304)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 305)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 306)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 307)           )
863d348b R/granova.ds.ggplot.R 213 308)   }
c2605051 R/granova.ds.bd.R     271 309)   
794c4b70 R/granova.ds.ggplot.R 213 310)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 311)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 312)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 313)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 314)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 315)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 316)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 317)           )
aaeade58 R/granova.ds.bd.R     274 318)     
863d348b R/granova.ds.ggplot.R 225 319)   }
863d348b R/granova.ds.ggplot.R 226 320) 
794c4b70 R/granova.ds.ggplot.R 225 321)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 322)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 323)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 324)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 325)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 326)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 327)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 328)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 329)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 330)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 331)                        )  
a71441d3 R/granova.ds.ggplot.R 216 332)           )
863d348b R/granova.ds.ggplot.R 242 333)   }
863d348b R/granova.ds.ggplot.R 243 334) 
794c4b70 R/granova.ds.ggplot.R 242 335)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 336)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 337)                             y     = y,
0d72518f R/granovagg.ds.R      303 338)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 339)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 340)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 341)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 342)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 343)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 344)                        )
a71441d3 R/granova.ds.ggplot.R 229 345)           )
863d348b R/granova.ds.ggplot.R 258 346)   }
863d348b R/granova.ds.ggplot.R 259 347) 
794c4b70 R/granova.ds.ggplot.R 258 348)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 349)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 350)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 351)                          ),
a71441d3 R/granova.ds.ggplot.R 236 352)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 353)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 354)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 355)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 356)                      )
a71441d3 R/granova.ds.ggplot.R 240 357)           )
863d348b R/granova.ds.ggplot.R 272 358)   }
863d348b R/granova.ds.ggplot.R 273 359) 
794c4b70 R/granova.ds.ggplot.R 272 360)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 361)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 362)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 363)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 364)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 365)                            ),
a71441d3 R/granova.ds.ggplot.R 249 366)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 367)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 368)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 369)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 370)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 371)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 372)           )
863d348b R/granova.ds.ggplot.R 290 373)   }
863d348b R/granova.ds.ggplot.R 291 374) 
ef841aa1 R/granova.ds.ggplot.R 257 375)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 376)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 377)   
a71441d3 R/granova.ds.ggplot.R 261 378)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 379)   }
863d348b R/granova.ds.ggplot.R 297 380) 
0afa3a38 R/granovagg.ds.R      306 381)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 382)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 383)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 384)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 385)     }
0afa3a38 R/granovagg.ds.R      311 386)     
0afa3a38 R/granovagg.ds.R      312 387)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 388)   }
0afa3a38 R/granovagg.ds.R      314 389)   
485d5f02 R/granovagg.ds.R      317 390)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 391)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 392)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 393)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 394)     }
485d5f02 R/granovagg.ds.R      322 395)     
485d5f02 R/granovagg.ds.R      323 396)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 397)   }
485d5f02 R/granovagg.ds.R      325 398)   
794c4b70 R/granova.ds.ggplot.R 296 399)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 400)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 401)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 402)     }
a2b6fe7d R/granovagg.ds.R      320 403)     
a2b6fe7d R/granovagg.ds.R      321 404)     else {
a2b6fe7d R/granovagg.ds.R      322 405)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 406)     }
863d348b R/granova.ds.ggplot.R 304 407)   }
b5b60529 R/granova.ds.ggplot.R 270 408)   
b5b60529 R/granova.ds.ggplot.R 271 409)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 410)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 411)   }
b5b60529 R/granova.ds.ggplot.R 274 412)   
3b102930 R/granova.ds.ggplot.R 275 413)           
3eb0e1f7 R/granova.ds.ggplot.R 304 414)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 415)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 416)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 417)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 418)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 419)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 420)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 421)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 422)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 423)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 424)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 425)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 426)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 427)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 428)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 429)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 430)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 431) 
a71441d3 R/granova.ds.ggplot.R 288 432)   return(p)
5d58b37c R/granova.ds.bd.R     314 433) 
b3a74c98 R/granova.ds.bd.R     301 434) }
</pre>
<div class="compileroutput">
Standardize titles for documentation pages by using "Elemental Graphic" display syntax<p></p><p><br>
</p></div>
</td>
<td>
<a name="3146f39"></a>
3146f39 2011-08-24 17:36:08 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  27) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  28) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  29) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  30) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  31) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  32) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  33) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  34) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  35) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  36) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  37) #' @return Returns a plot object of class \code{ggplot}. 
2e407b6e R/granovagg.ds.R       36  38) #' @author Robert M. Pruzek \email{RMPruzek@@yahoo.com}
2e407b6e R/granovagg.ds.R       37  39) #' @author Brian A. Danielak \email{brian@@briandk.com}
2e407b6e R/granovagg.ds.R       38  40) #' @author William E. J. Doane \email{wil@@drdoane.com}
2e407b6e R/granovagg.ds.R       39  41) #' @author James E. Helmreich \email{James.Helmreich@@Marist.edu}
2e407b6e R/granovagg.ds.R       40  42) #' @author Jason Bryer \email{jason@@bryer.org}
19d1b011 R/granovagg.ds.R       42  43) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  44) #' @export
2b0c8b84 R/granovagg.ds.R       71  45) 
f855a782 R/granovagg.ds.R       46  46) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  47)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  48)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  49)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  50)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  51)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  52)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  53)                          ...
e55d776c R/granovagg.ds.R       42  54)                 ) 
be2e6fbd R/granova.ds.bd.R      19  55) 
be2e6fbd R/granova.ds.bd.R      20  56) {
d6c27487 R/granova.ds.bd.R      12  57)   
f855a782 R/granovagg.ds.R       58  58)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  59)     output &lt;- CheckData(data)
<span class="changed">3146f39f R/granovagg.ds.R       60  60)     output &lt;- ReverseXAndY(output)</span>
f855a782 R/granovagg.ds.R       61  61)     return(output)
f855a782 R/granovagg.ds.R       62  62)   }
f855a782 R/granovagg.ds.R       63  63)   
f855a782 R/granovagg.ds.R       64  64)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  65)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  66)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  67)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  68)   }
544a88ef R/granovagg.ds.R       61  69)   
f855a782 R/granovagg.ds.R       70  70)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  71)     output &lt;- data
f855a782 R/granovagg.ds.R       72  72)     if (revc) {
f855a782 R/granovagg.ds.R       73  73)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  74)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  75)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  76)     }
f855a782 R/granovagg.ds.R       77  77)     return(output)
f855a782 R/granovagg.ds.R       78  78)   }
f855a782 R/granovagg.ds.R       79  79)   
544a88ef R/granovagg.ds.R       62  80)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  81)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  82)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  83)     }
544a88ef R/granovagg.ds.R       66  84)   }
544a88ef R/granovagg.ds.R       67  85) 
544a88ef R/granovagg.ds.R       68  86)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  87)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  88)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  89)       stop(message)
544a88ef R/granovagg.ds.R       72  90)     }
544a88ef R/granovagg.ds.R       73  91)     
544a88ef R/granovagg.ds.R       74  92)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  93)       stop(message)
544a88ef R/granovagg.ds.R       76  94)     }
544a88ef R/granovagg.ds.R       77  95)   }
544a88ef R/granovagg.ds.R       78  96)   
544a88ef R/granovagg.ds.R       79  97)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80  98)     output &lt;- data
544a88ef R/granovagg.ds.R       81  99)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 100)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 101)     }
544a88ef R/granovagg.ds.R       84 102)     return(output)
544a88ef R/granovagg.ds.R       85 103)   }
544a88ef R/granovagg.ds.R       86 104)   
794c4b70 R/granova.ds.ggplot.R   9 105)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 106)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 107)   }
a806fcaa R/granova.ds.bd.R      15 108) 
794c4b70 R/granova.ds.ggplot.R  13 109)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 110)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 111)   }
e589a242 R/granova.ds.bd.R      17 112) 
794c4b70 R/granova.ds.ggplot.R  17 113)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 114)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 115)   }
c2605051 R/granova.ds.bd.R     182 116)   
794c4b70 R/granova.ds.ggplot.R  21 117)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 118)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 119)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 120)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 121)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 122)                  )
a71441d3 R/granova.ds.ggplot.R  27 123)           )
863d348b R/granova.ds.ggplot.R  30 124)   }
c2605051 R/granova.ds.bd.R     187 125)   
794c4b70 R/granova.ds.ggplot.R  30 126)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 127)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 128)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 129)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 130)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 131)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 132)                      )
a71441d3 R/granova.ds.ggplot.R  38 133)           )
863d348b R/granova.ds.ggplot.R  41 134)   }
c2605051 R/granova.ds.bd.R     191 135)   
794c4b70 R/granova.ds.ggplot.R  41 136)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 137)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 138)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 139)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 140)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 141)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 142)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 143)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 144)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 145)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 146)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 147)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 148)   
a71441d3 R/granova.ds.ggplot.R  54 149)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 150)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 151)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 152)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 153)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 154)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 155)                )
a71441d3 R/granova.ds.ggplot.R  61 156)           )
863d348b R/granova.ds.ggplot.R  64 157)   }
c2605051 R/granova.ds.bd.R     199 158)   
794c4b70 R/granova.ds.ggplot.R  64 159)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 160)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 161)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 162)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 163)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 164)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 165)   }
863d348b R/granova.ds.ggplot.R  73 166) 
794c4b70 R/granova.ds.ggplot.R  72 167)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 168)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 169)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 170)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 171)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 172)                      )
a71441d3 R/granova.ds.ggplot.R  78 173)           )  
863d348b R/granova.ds.ggplot.R  82 174)   }
c2605051 R/granova.ds.bd.R     209 175)   
794c4b70 R/granova.ds.ggplot.R  82 176)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 177)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 178)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 179)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 180)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 181)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 182)                      )
a71441d3 R/granova.ds.ggplot.R  88 183)           )
5f570d2d R/granova.ds.bd.R     190 184)     
863d348b R/granova.ds.ggplot.R  94 185)   }
c2605051 R/granova.ds.bd.R     224 186)   
794c4b70 R/granova.ds.ggplot.R  94 187)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 188)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 189)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 190)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 191)                      )
a71441d3 R/granova.ds.ggplot.R  97 192)           )
863d348b R/granova.ds.ggplot.R 103 193)   }
863d348b R/granova.ds.ggplot.R 104 194) 
754a8540 R/granovagg.ds.R      177 195)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 196)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 197)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 198)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 199)     return(output)
754a8540 R/granovagg.ds.R      182 200)   }
754a8540 R/granovagg.ds.R      183 201) 
73167de2 R/granovagg.ds.R      184 202)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 203)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 204)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 205)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 206)                )
73167de2 R/granovagg.ds.R      189 207)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 208)   }
73167de2 R/granovagg.ds.R      191 209)   
794c4b70 R/granova.ds.ggplot.R 103 210)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 211)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 212)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 213)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 214)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 215)                      )
a71441d3 R/granova.ds.ggplot.R 106 216)           )
863d348b R/granova.ds.ggplot.R 114 217)   }
c2605051 R/granova.ds.bd.R     239 218)   
794c4b70 R/granova.ds.ggplot.R 114 219)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 220)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 221)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 222)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 223)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 224)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 225)                )
a71441d3 R/granova.ds.ggplot.R 116 226)           )         
863d348b R/granova.ds.ggplot.R 125 227)   }
863d348b R/granova.ds.ggplot.R 126 228) 
f855a782 R/granovagg.ds.R      229 229)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 230)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 231)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 232)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 233)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 234)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 235)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 236)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 237)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 238)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 239)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 240)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 241)     
c2605051 R/granova.ds.bd.R     256 242)   
863d348b R/granova.ds.ggplot.R 139 243) 
863d348b R/granova.ds.ggplot.R 140 244)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 245)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 246) 
863d348b R/granova.ds.ggplot.R 143 247)   
3eb0e1f7 R/granova.ds.ggplot.R 142 248)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 249)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 250)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 251)                             ),
a71441d3 R/granova.ds.ggplot.R 140 252)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 253)                  )
863d348b R/granova.ds.ggplot.R 151 254)           )
863d348b R/granova.ds.ggplot.R 152 255)   }
e60e59e1 R/granova.ds.bd.R     241 256)     
794c4b70 R/granova.ds.ggplot.R 152 257)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 258)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 259)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 260)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 261)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 262)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 263)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 264)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 265)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 266)                       )
a71441d3 R/granova.ds.ggplot.R 154 267)           )
863d348b R/granova.ds.ggplot.R 166 268)   }
863d348b R/granova.ds.ggplot.R 167 269) 
794c4b70 R/granova.ds.ggplot.R 166 270)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 271)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 272)   }
863d348b R/granova.ds.ggplot.R 174 273) 
3eb0e1f7 R/granova.ds.ggplot.R 173 274)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 275)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 276)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 277)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 278)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 279)                       )
a71441d3 R/granova.ds.ggplot.R 166 280)           )
863d348b R/granova.ds.ggplot.R 183 281)   }
863d348b R/granova.ds.ggplot.R 184 282) 
794c4b70 R/granova.ds.ggplot.R 183 283)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 284)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 285)   }
863d348b R/granova.ds.ggplot.R 188 286) 
794c4b70 R/granova.ds.ggplot.R 187 287)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 288)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 289)   }
863d348b R/granova.ds.ggplot.R 192 290) 
794c4b70 R/granova.ds.ggplot.R 191 291)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 292)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 293)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 294)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 295)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 296)                    )  
a71441d3 R/granova.ds.ggplot.R 183 297)           )
863d348b R/granova.ds.ggplot.R 202 298)   }
863d348b R/granova.ds.ggplot.R 203 299) 
794c4b70 R/granova.ds.ggplot.R 202 300)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 301)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 302)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 303)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 304)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 305)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 306)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 307)           )
863d348b R/granova.ds.ggplot.R 213 308)   }
c2605051 R/granova.ds.bd.R     271 309)   
794c4b70 R/granova.ds.ggplot.R 213 310)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 311)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 312)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 313)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 314)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 315)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 316)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 317)           )
aaeade58 R/granova.ds.bd.R     274 318)     
863d348b R/granova.ds.ggplot.R 225 319)   }
863d348b R/granova.ds.ggplot.R 226 320) 
794c4b70 R/granova.ds.ggplot.R 225 321)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 322)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 323)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 324)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 325)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 326)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 327)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 328)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 329)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 330)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 331)                        )  
a71441d3 R/granova.ds.ggplot.R 216 332)           )
863d348b R/granova.ds.ggplot.R 242 333)   }
863d348b R/granova.ds.ggplot.R 243 334) 
794c4b70 R/granova.ds.ggplot.R 242 335)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 336)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 337)                             y     = y,
0d72518f R/granovagg.ds.R      303 338)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 339)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 340)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 341)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 342)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 343)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 344)                        )
a71441d3 R/granova.ds.ggplot.R 229 345)           )
863d348b R/granova.ds.ggplot.R 258 346)   }
863d348b R/granova.ds.ggplot.R 259 347) 
794c4b70 R/granova.ds.ggplot.R 258 348)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 349)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 350)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 351)                          ),
a71441d3 R/granova.ds.ggplot.R 236 352)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 353)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 354)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 355)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 356)                      )
a71441d3 R/granova.ds.ggplot.R 240 357)           )
863d348b R/granova.ds.ggplot.R 272 358)   }
863d348b R/granova.ds.ggplot.R 273 359) 
794c4b70 R/granova.ds.ggplot.R 272 360)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 361)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 362)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 363)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 364)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 365)                            ),
a71441d3 R/granova.ds.ggplot.R 249 366)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 367)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 368)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 369)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 370)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 371)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 372)           )
863d348b R/granova.ds.ggplot.R 290 373)   }
863d348b R/granova.ds.ggplot.R 291 374) 
ef841aa1 R/granova.ds.ggplot.R 257 375)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 376)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 377)   
a71441d3 R/granova.ds.ggplot.R 261 378)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 379)   }
863d348b R/granova.ds.ggplot.R 297 380) 
0afa3a38 R/granovagg.ds.R      306 381)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 382)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 383)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 384)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 385)     }
0afa3a38 R/granovagg.ds.R      311 386)     
0afa3a38 R/granovagg.ds.R      312 387)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 388)   }
0afa3a38 R/granovagg.ds.R      314 389)   
485d5f02 R/granovagg.ds.R      317 390)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 391)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 392)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 393)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 394)     }
485d5f02 R/granovagg.ds.R      322 395)     
485d5f02 R/granovagg.ds.R      323 396)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 397)   }
485d5f02 R/granovagg.ds.R      325 398)   
794c4b70 R/granova.ds.ggplot.R 296 399)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 400)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 401)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 402)     }
a2b6fe7d R/granovagg.ds.R      320 403)     
a2b6fe7d R/granovagg.ds.R      321 404)     else {
a2b6fe7d R/granovagg.ds.R      322 405)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 406)     }
863d348b R/granova.ds.ggplot.R 304 407)   }
b5b60529 R/granova.ds.ggplot.R 270 408)   
b5b60529 R/granova.ds.ggplot.R 271 409)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 410)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 411)   }
b5b60529 R/granova.ds.ggplot.R 274 412)   
3b102930 R/granova.ds.ggplot.R 275 413)           
3eb0e1f7 R/granova.ds.ggplot.R 304 414)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 415)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 416)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 417)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 418)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 419)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 420)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 421)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 422)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 423)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 424)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 425)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 426)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 427)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 428)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 429)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 430)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 431) 
a71441d3 R/granova.ds.ggplot.R 288 432)   return(p)
5d58b37c R/granova.ds.bd.R     314 433) 
b3a74c98 R/granova.ds.bd.R     301 434) }
</pre>
<div class="compileroutput">
Fix a bug so granovagg.ds will now properly accept matrix data.<p>Closes #73<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="80f8f00"></a>
80f8f00 2011-08-30 09:46:09 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
2b0c8b84 R/granovagg.ds.R       10   7) #' Paired X &amp; Y values are plotted as scatterplot. The identity reference line
892e6c44 R/granovagg.ds.R       11   8) #' (for Y=X) is drawn. 
2b0c8b84 R/granovagg.ds.R       13   9) #' Parallel projections of data points to (a lower-left) line segment show how
2b0c8b84 R/granovagg.ds.R       14  10) #' each point relates to its X-Y = D difference; blue `crosses' are used to
2b0c8b84 R/granovagg.ds.R       15  11) #' display the distribution of difference scores and the mean difference is
2b0c8b84 R/granovagg.ds.R       16  12) #' displayed as a heavy dashed (red) line, parallel to the identity reference
2b0c8b84 R/granovagg.ds.R       17  13) #' line. Means for X and Y are also plotted (as thin dashed vertical and
2b0c8b84 R/granovagg.ds.R       18  14) #' horizontal lines), and rug plots are shown for the distributions of X (at
2b0c8b84 R/granovagg.ds.R       19  15) #' the top of graphic) and Y (on the right side). Several summary statistics
2b0c8b84 R/granovagg.ds.R       20  16) #' are plotted as well, to facilitate both description and inference; see
56bb21d6 R/granovagg.ds.R       21  17) #' below. The 95\% confidence interval for the population mean difference is
2b0c8b84 R/granovagg.ds.R       22  18) #' also shown graphically.  Because all data points are plotted relative to the
2b0c8b84 R/granovagg.ds.R       23  19) #' identity line, and summary results are shown graphically, clusters, data
2b0c8b84 R/granovagg.ds.R       24  20) #' trends, outliers, and possible uses of transformations are readily seen,
2b0c8b84 R/granovagg.ds.R       25  21) #' possibly to be accommodated.
743b4d68 R/granovagg.ds.R       29  22) #' 
2b0c8b84 R/granovagg.ds.R       27  23) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  24) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  25) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  26) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  27) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  28) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  29) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  30) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  31) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  32) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  33) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  34) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  35) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  36) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  37) #' @return Returns a plot object of class \code{ggplot}. 
<span class="changed">80f8f002 R/granovagg.ds.R       38  38) #'</span>
<span class="changed">80f8f002 R/granovagg.ds.R       39  39) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr </span>
<span class="changed">80f8f002 R/granovagg.ds.R       40  40) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}</span>
<span class="changed">80f8f002 R/granovagg.ds.R       41  41) #'</span>
<span class="changed">80f8f002 R/granovagg.ds.R       42  42) #' with contributions by:\cr</span>
<span class="changed">80f8f002 R/granovagg.ds.R       43  43) #'   William E. J. Doane \email{wil@@drdoane.com}\cr </span>
<span class="changed">80f8f002 R/granovagg.ds.R       44  44) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr </span>
<span class="changed">80f8f002 R/granovagg.ds.R       45  45) #'   Jason Bryer \email{jason@@bryer.org}</span>
<span class="changed">80f8f002 R/granovagg.ds.R       46  46) #'</span>
19d1b011 R/granovagg.ds.R       42  47) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  48) #' @export
2b0c8b84 R/granovagg.ds.R       71  49) 
f855a782 R/granovagg.ds.R       46  50) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  51)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  52)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  53)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  54)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  55)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  56)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  57)                          ...
e55d776c R/granovagg.ds.R       42  58)                 ) 
be2e6fbd R/granova.ds.bd.R      19  59) 
be2e6fbd R/granova.ds.bd.R      20  60) {
d6c27487 R/granova.ds.bd.R      12  61)   
f855a782 R/granovagg.ds.R       58  62)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  63)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  64)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  65)     return(output)
f855a782 R/granovagg.ds.R       62  66)   }
f855a782 R/granovagg.ds.R       63  67)   
f855a782 R/granovagg.ds.R       64  68)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  69)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  70)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  71)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  72)   }
544a88ef R/granovagg.ds.R       61  73)   
f855a782 R/granovagg.ds.R       70  74)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  75)     output &lt;- data
f855a782 R/granovagg.ds.R       72  76)     if (revc) {
f855a782 R/granovagg.ds.R       73  77)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  78)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  79)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  80)     }
f855a782 R/granovagg.ds.R       77  81)     return(output)
f855a782 R/granovagg.ds.R       78  82)   }
f855a782 R/granovagg.ds.R       79  83)   
544a88ef R/granovagg.ds.R       62  84)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  85)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  86)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  87)     }
544a88ef R/granovagg.ds.R       66  88)   }
544a88ef R/granovagg.ds.R       67  89) 
544a88ef R/granovagg.ds.R       68  90)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69  91)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70  92)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71  93)       stop(message)
544a88ef R/granovagg.ds.R       72  94)     }
544a88ef R/granovagg.ds.R       73  95)     
544a88ef R/granovagg.ds.R       74  96)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75  97)       stop(message)
544a88ef R/granovagg.ds.R       76  98)     }
544a88ef R/granovagg.ds.R       77  99)   }
544a88ef R/granovagg.ds.R       78 100)   
544a88ef R/granovagg.ds.R       79 101)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 102)     output &lt;- data
544a88ef R/granovagg.ds.R       81 103)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 104)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 105)     }
544a88ef R/granovagg.ds.R       84 106)     return(output)
544a88ef R/granovagg.ds.R       85 107)   }
544a88ef R/granovagg.ds.R       86 108)   
794c4b70 R/granova.ds.ggplot.R   9 109)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 110)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 111)   }
a806fcaa R/granova.ds.bd.R      15 112) 
794c4b70 R/granova.ds.ggplot.R  13 113)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 114)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 115)   }
e589a242 R/granova.ds.bd.R      17 116) 
794c4b70 R/granova.ds.ggplot.R  17 117)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 118)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 119)   }
c2605051 R/granova.ds.bd.R     182 120)   
794c4b70 R/granova.ds.ggplot.R  21 121)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 122)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 123)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 124)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 125)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 126)                  )
a71441d3 R/granova.ds.ggplot.R  27 127)           )
863d348b R/granova.ds.ggplot.R  30 128)   }
c2605051 R/granova.ds.bd.R     187 129)   
794c4b70 R/granova.ds.ggplot.R  30 130)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 131)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 132)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 133)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 134)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 135)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 136)                      )
a71441d3 R/granova.ds.ggplot.R  38 137)           )
863d348b R/granova.ds.ggplot.R  41 138)   }
c2605051 R/granova.ds.bd.R     191 139)   
794c4b70 R/granova.ds.ggplot.R  41 140)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 141)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 142)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 143)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 144)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 145)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 146)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 147)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 148)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 149)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 150)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 151)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 152)   
a71441d3 R/granova.ds.ggplot.R  54 153)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 154)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 155)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 156)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 157)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 158)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 159)                )
a71441d3 R/granova.ds.ggplot.R  61 160)           )
863d348b R/granova.ds.ggplot.R  64 161)   }
c2605051 R/granova.ds.bd.R     199 162)   
794c4b70 R/granova.ds.ggplot.R  64 163)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 164)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 165)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 166)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 167)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 168)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 169)   }
863d348b R/granova.ds.ggplot.R  73 170) 
794c4b70 R/granova.ds.ggplot.R  72 171)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 172)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 173)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 174)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 175)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 176)                      )
a71441d3 R/granova.ds.ggplot.R  78 177)           )  
863d348b R/granova.ds.ggplot.R  82 178)   }
c2605051 R/granova.ds.bd.R     209 179)   
794c4b70 R/granova.ds.ggplot.R  82 180)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 181)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 182)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 183)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 184)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 185)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 186)                      )
a71441d3 R/granova.ds.ggplot.R  88 187)           )
5f570d2d R/granova.ds.bd.R     190 188)     
863d348b R/granova.ds.ggplot.R  94 189)   }
c2605051 R/granova.ds.bd.R     224 190)   
794c4b70 R/granova.ds.ggplot.R  94 191)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 192)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 193)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 194)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 195)                      )
a71441d3 R/granova.ds.ggplot.R  97 196)           )
863d348b R/granova.ds.ggplot.R 103 197)   }
863d348b R/granova.ds.ggplot.R 104 198) 
754a8540 R/granovagg.ds.R      177 199)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 200)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 201)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 202)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 203)     return(output)
754a8540 R/granovagg.ds.R      182 204)   }
754a8540 R/granovagg.ds.R      183 205) 
73167de2 R/granovagg.ds.R      184 206)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 207)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 208)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 209)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 210)                )
73167de2 R/granovagg.ds.R      189 211)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 212)   }
73167de2 R/granovagg.ds.R      191 213)   
794c4b70 R/granova.ds.ggplot.R 103 214)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 215)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 216)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 217)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 218)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 219)                      )
a71441d3 R/granova.ds.ggplot.R 106 220)           )
863d348b R/granova.ds.ggplot.R 114 221)   }
c2605051 R/granova.ds.bd.R     239 222)   
794c4b70 R/granova.ds.ggplot.R 114 223)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 224)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 225)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 226)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 227)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 228)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 229)                )
a71441d3 R/granova.ds.ggplot.R 116 230)           )         
863d348b R/granova.ds.ggplot.R 125 231)   }
863d348b R/granova.ds.ggplot.R 126 232) 
f855a782 R/granovagg.ds.R      229 233)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 234)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 235)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 236)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 237)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 238)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 239)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 240)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 241)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 242)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 243)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 244)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 245)     
c2605051 R/granova.ds.bd.R     256 246)   
863d348b R/granova.ds.ggplot.R 139 247) 
863d348b R/granova.ds.ggplot.R 140 248)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 249)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 250) 
863d348b R/granova.ds.ggplot.R 143 251)   
3eb0e1f7 R/granova.ds.ggplot.R 142 252)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 253)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 254)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 255)                             ),
a71441d3 R/granova.ds.ggplot.R 140 256)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 257)                  )
863d348b R/granova.ds.ggplot.R 151 258)           )
863d348b R/granova.ds.ggplot.R 152 259)   }
e60e59e1 R/granova.ds.bd.R     241 260)     
794c4b70 R/granova.ds.ggplot.R 152 261)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 262)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 263)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 264)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 265)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 266)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 267)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 268)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 269)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 270)                       )
a71441d3 R/granova.ds.ggplot.R 154 271)           )
863d348b R/granova.ds.ggplot.R 166 272)   }
863d348b R/granova.ds.ggplot.R 167 273) 
794c4b70 R/granova.ds.ggplot.R 166 274)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 275)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 276)   }
863d348b R/granova.ds.ggplot.R 174 277) 
3eb0e1f7 R/granova.ds.ggplot.R 173 278)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 279)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 280)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 281)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 282)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 283)                       )
a71441d3 R/granova.ds.ggplot.R 166 284)           )
863d348b R/granova.ds.ggplot.R 183 285)   }
863d348b R/granova.ds.ggplot.R 184 286) 
794c4b70 R/granova.ds.ggplot.R 183 287)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 288)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 289)   }
863d348b R/granova.ds.ggplot.R 188 290) 
794c4b70 R/granova.ds.ggplot.R 187 291)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 292)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 293)   }
863d348b R/granova.ds.ggplot.R 192 294) 
794c4b70 R/granova.ds.ggplot.R 191 295)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 296)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 297)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 298)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 299)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 300)                    )  
a71441d3 R/granova.ds.ggplot.R 183 301)           )
863d348b R/granova.ds.ggplot.R 202 302)   }
863d348b R/granova.ds.ggplot.R 203 303) 
794c4b70 R/granova.ds.ggplot.R 202 304)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 305)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 306)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 307)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 308)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 309)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 310)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 311)           )
863d348b R/granova.ds.ggplot.R 213 312)   }
c2605051 R/granova.ds.bd.R     271 313)   
794c4b70 R/granova.ds.ggplot.R 213 314)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 315)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 316)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 317)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 318)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 319)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 320)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 321)           )
aaeade58 R/granova.ds.bd.R     274 322)     
863d348b R/granova.ds.ggplot.R 225 323)   }
863d348b R/granova.ds.ggplot.R 226 324) 
794c4b70 R/granova.ds.ggplot.R 225 325)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 326)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 327)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 328)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 329)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 330)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 331)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 332)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 333)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 334)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 335)                        )  
a71441d3 R/granova.ds.ggplot.R 216 336)           )
863d348b R/granova.ds.ggplot.R 242 337)   }
863d348b R/granova.ds.ggplot.R 243 338) 
794c4b70 R/granova.ds.ggplot.R 242 339)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 340)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 341)                             y     = y,
0d72518f R/granovagg.ds.R      303 342)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 343)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 344)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 345)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 346)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 347)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 348)                        )
a71441d3 R/granova.ds.ggplot.R 229 349)           )
863d348b R/granova.ds.ggplot.R 258 350)   }
863d348b R/granova.ds.ggplot.R 259 351) 
794c4b70 R/granova.ds.ggplot.R 258 352)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 353)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 354)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 355)                          ),
a71441d3 R/granova.ds.ggplot.R 236 356)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 357)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 358)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 359)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 360)                      )
a71441d3 R/granova.ds.ggplot.R 240 361)           )
863d348b R/granova.ds.ggplot.R 272 362)   }
863d348b R/granova.ds.ggplot.R 273 363) 
794c4b70 R/granova.ds.ggplot.R 272 364)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 365)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 366)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 367)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 368)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 369)                            ),
a71441d3 R/granova.ds.ggplot.R 249 370)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 371)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 372)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 373)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 374)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 375)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 376)           )
863d348b R/granova.ds.ggplot.R 290 377)   }
863d348b R/granova.ds.ggplot.R 291 378) 
ef841aa1 R/granova.ds.ggplot.R 257 379)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 380)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 381)   
a71441d3 R/granova.ds.ggplot.R 261 382)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 383)   }
863d348b R/granova.ds.ggplot.R 297 384) 
0afa3a38 R/granovagg.ds.R      306 385)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 386)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 387)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 388)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 389)     }
0afa3a38 R/granovagg.ds.R      311 390)     
0afa3a38 R/granovagg.ds.R      312 391)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 392)   }
0afa3a38 R/granovagg.ds.R      314 393)   
485d5f02 R/granovagg.ds.R      317 394)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 395)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 396)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 397)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 398)     }
485d5f02 R/granovagg.ds.R      322 399)     
485d5f02 R/granovagg.ds.R      323 400)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 401)   }
485d5f02 R/granovagg.ds.R      325 402)   
794c4b70 R/granova.ds.ggplot.R 296 403)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 404)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 405)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 406)     }
a2b6fe7d R/granovagg.ds.R      320 407)     
a2b6fe7d R/granovagg.ds.R      321 408)     else {
a2b6fe7d R/granovagg.ds.R      322 409)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 410)     }
863d348b R/granova.ds.ggplot.R 304 411)   }
b5b60529 R/granova.ds.ggplot.R 270 412)   
b5b60529 R/granova.ds.ggplot.R 271 413)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 414)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 415)   }
b5b60529 R/granova.ds.ggplot.R 274 416)   
3b102930 R/granova.ds.ggplot.R 275 417)           
3eb0e1f7 R/granova.ds.ggplot.R 304 418)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 419)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 420)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 421)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 422)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 423)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 424)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 425)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 426)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 427)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 428)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 429)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 430)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 431)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 432)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 433)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 434)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 435) 
a71441d3 R/granova.ds.ggplot.R 288 436)   return(p)
5d58b37c R/granova.ds.bd.R     314 437) 
b3a74c98 R/granova.ds.bd.R     301 438) }
</pre>
<div class="compileroutput">
Change authorship to reflect latest authorship discussions.<p>Closes #89<br>
Closes #90<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="61fb56e"></a>
61fb56e 2011-08-30 18:07:17 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
<span class="changed">61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line</span>
<span class="changed">61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)</span>
<span class="changed">61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       18  18) #' 95% confidence interval for the population mean difference is also shown</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. </span>
<span class="changed">61fb56e0 R/granovagg.ds.R       24  24) #' </span>
<span class="changed">61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample</span>
<span class="changed">61fb56e0 R/granovagg.ds.R       32  32) #' analysis.</span>
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
19d1b011 R/granovagg.ds.R       42  58) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  59) #' @export
2b0c8b84 R/granovagg.ds.R       71  60) 
f855a782 R/granovagg.ds.R       46  61) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  62)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  63)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  64)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  65)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  66)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  67)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  68)                          ...
e55d776c R/granovagg.ds.R       42  69)                 ) 
be2e6fbd R/granova.ds.bd.R      19  70) 
be2e6fbd R/granova.ds.bd.R      20  71) {
d6c27487 R/granova.ds.bd.R      12  72)   
f855a782 R/granovagg.ds.R       58  73)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  74)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  75)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  76)     return(output)
f855a782 R/granovagg.ds.R       62  77)   }
f855a782 R/granovagg.ds.R       63  78)   
f855a782 R/granovagg.ds.R       64  79)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  80)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  81)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  82)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  83)   }
544a88ef R/granovagg.ds.R       61  84)   
f855a782 R/granovagg.ds.R       70  85)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  86)     output &lt;- data
f855a782 R/granovagg.ds.R       72  87)     if (revc) {
f855a782 R/granovagg.ds.R       73  88)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  89)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  90)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  91)     }
f855a782 R/granovagg.ds.R       77  92)     return(output)
f855a782 R/granovagg.ds.R       78  93)   }
f855a782 R/granovagg.ds.R       79  94)   
544a88ef R/granovagg.ds.R       62  95)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  96)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  97)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  98)     }
544a88ef R/granovagg.ds.R       66  99)   }
544a88ef R/granovagg.ds.R       67 100) 
544a88ef R/granovagg.ds.R       68 101)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 102)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 103)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 104)       stop(message)
544a88ef R/granovagg.ds.R       72 105)     }
544a88ef R/granovagg.ds.R       73 106)     
544a88ef R/granovagg.ds.R       74 107)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 108)       stop(message)
544a88ef R/granovagg.ds.R       76 109)     }
544a88ef R/granovagg.ds.R       77 110)   }
544a88ef R/granovagg.ds.R       78 111)   
544a88ef R/granovagg.ds.R       79 112)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 113)     output &lt;- data
544a88ef R/granovagg.ds.R       81 114)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 115)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 116)     }
544a88ef R/granovagg.ds.R       84 117)     return(output)
544a88ef R/granovagg.ds.R       85 118)   }
544a88ef R/granovagg.ds.R       86 119)   
794c4b70 R/granova.ds.ggplot.R   9 120)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 121)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 122)   }
a806fcaa R/granova.ds.bd.R      15 123) 
794c4b70 R/granova.ds.ggplot.R  13 124)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 125)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 126)   }
e589a242 R/granova.ds.bd.R      17 127) 
794c4b70 R/granova.ds.ggplot.R  17 128)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 129)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 130)   }
c2605051 R/granova.ds.bd.R     182 131)   
794c4b70 R/granova.ds.ggplot.R  21 132)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 133)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 134)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 135)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 136)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 137)                  )
a71441d3 R/granova.ds.ggplot.R  27 138)           )
863d348b R/granova.ds.ggplot.R  30 139)   }
c2605051 R/granova.ds.bd.R     187 140)   
794c4b70 R/granova.ds.ggplot.R  30 141)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 142)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 143)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 144)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 145)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 146)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 147)                      )
a71441d3 R/granova.ds.ggplot.R  38 148)           )
863d348b R/granova.ds.ggplot.R  41 149)   }
c2605051 R/granova.ds.bd.R     191 150)   
794c4b70 R/granova.ds.ggplot.R  41 151)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 152)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 153)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 154)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 155)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 156)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 157)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 158)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 159)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 160)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 161)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 162)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 163)   
a71441d3 R/granova.ds.ggplot.R  54 164)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 165)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 166)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 167)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 168)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 169)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 170)                )
a71441d3 R/granova.ds.ggplot.R  61 171)           )
863d348b R/granova.ds.ggplot.R  64 172)   }
c2605051 R/granova.ds.bd.R     199 173)   
794c4b70 R/granova.ds.ggplot.R  64 174)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 175)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 176)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 177)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 178)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 179)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 180)   }
863d348b R/granova.ds.ggplot.R  73 181) 
794c4b70 R/granova.ds.ggplot.R  72 182)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 183)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 184)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 185)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 186)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 187)                      )
a71441d3 R/granova.ds.ggplot.R  78 188)           )  
863d348b R/granova.ds.ggplot.R  82 189)   }
c2605051 R/granova.ds.bd.R     209 190)   
794c4b70 R/granova.ds.ggplot.R  82 191)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 192)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 193)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 194)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 195)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 196)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 197)                      )
a71441d3 R/granova.ds.ggplot.R  88 198)           )
5f570d2d R/granova.ds.bd.R     190 199)     
863d348b R/granova.ds.ggplot.R  94 200)   }
c2605051 R/granova.ds.bd.R     224 201)   
794c4b70 R/granova.ds.ggplot.R  94 202)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 203)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 204)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 205)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 206)                      )
a71441d3 R/granova.ds.ggplot.R  97 207)           )
863d348b R/granova.ds.ggplot.R 103 208)   }
863d348b R/granova.ds.ggplot.R 104 209) 
754a8540 R/granovagg.ds.R      177 210)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 211)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 212)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 213)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 214)     return(output)
754a8540 R/granovagg.ds.R      182 215)   }
754a8540 R/granovagg.ds.R      183 216) 
73167de2 R/granovagg.ds.R      184 217)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 218)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 219)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 220)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 221)                )
73167de2 R/granovagg.ds.R      189 222)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 223)   }
73167de2 R/granovagg.ds.R      191 224)   
794c4b70 R/granova.ds.ggplot.R 103 225)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 226)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 227)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 228)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 229)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 230)                      )
a71441d3 R/granova.ds.ggplot.R 106 231)           )
863d348b R/granova.ds.ggplot.R 114 232)   }
c2605051 R/granova.ds.bd.R     239 233)   
794c4b70 R/granova.ds.ggplot.R 114 234)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 235)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 236)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 237)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 238)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 239)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 240)                )
a71441d3 R/granova.ds.ggplot.R 116 241)           )         
863d348b R/granova.ds.ggplot.R 125 242)   }
863d348b R/granova.ds.ggplot.R 126 243) 
f855a782 R/granovagg.ds.R      229 244)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 245)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 246)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 247)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 248)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 249)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 250)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 251)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 252)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 253)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 254)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 255)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 256)     
c2605051 R/granova.ds.bd.R     256 257)   
863d348b R/granova.ds.ggplot.R 139 258) 
863d348b R/granova.ds.ggplot.R 140 259)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 260)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 261) 
863d348b R/granova.ds.ggplot.R 143 262)   
3eb0e1f7 R/granova.ds.ggplot.R 142 263)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 264)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 265)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 266)                             ),
a71441d3 R/granova.ds.ggplot.R 140 267)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 268)                  )
863d348b R/granova.ds.ggplot.R 151 269)           )
863d348b R/granova.ds.ggplot.R 152 270)   }
e60e59e1 R/granova.ds.bd.R     241 271)     
794c4b70 R/granova.ds.ggplot.R 152 272)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 273)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 274)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 275)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 276)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 277)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 278)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 279)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 280)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 281)                       )
a71441d3 R/granova.ds.ggplot.R 154 282)           )
863d348b R/granova.ds.ggplot.R 166 283)   }
863d348b R/granova.ds.ggplot.R 167 284) 
794c4b70 R/granova.ds.ggplot.R 166 285)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 286)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 287)   }
863d348b R/granova.ds.ggplot.R 174 288) 
3eb0e1f7 R/granova.ds.ggplot.R 173 289)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 290)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 291)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 292)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 293)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 294)                       )
a71441d3 R/granova.ds.ggplot.R 166 295)           )
863d348b R/granova.ds.ggplot.R 183 296)   }
863d348b R/granova.ds.ggplot.R 184 297) 
794c4b70 R/granova.ds.ggplot.R 183 298)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 299)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 300)   }
863d348b R/granova.ds.ggplot.R 188 301) 
794c4b70 R/granova.ds.ggplot.R 187 302)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 303)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 304)   }
863d348b R/granova.ds.ggplot.R 192 305) 
794c4b70 R/granova.ds.ggplot.R 191 306)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 307)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 308)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 309)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 310)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 311)                    )  
a71441d3 R/granova.ds.ggplot.R 183 312)           )
863d348b R/granova.ds.ggplot.R 202 313)   }
863d348b R/granova.ds.ggplot.R 203 314) 
794c4b70 R/granova.ds.ggplot.R 202 315)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 316)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 317)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 318)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 319)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 320)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 321)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 322)           )
863d348b R/granova.ds.ggplot.R 213 323)   }
c2605051 R/granova.ds.bd.R     271 324)   
794c4b70 R/granova.ds.ggplot.R 213 325)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 326)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 327)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 328)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 329)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 330)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 331)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 332)           )
aaeade58 R/granova.ds.bd.R     274 333)     
863d348b R/granova.ds.ggplot.R 225 334)   }
863d348b R/granova.ds.ggplot.R 226 335) 
794c4b70 R/granova.ds.ggplot.R 225 336)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 337)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 338)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 339)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 340)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 341)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 342)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 343)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 344)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 345)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 346)                        )  
a71441d3 R/granova.ds.ggplot.R 216 347)           )
863d348b R/granova.ds.ggplot.R 242 348)   }
863d348b R/granova.ds.ggplot.R 243 349) 
794c4b70 R/granova.ds.ggplot.R 242 350)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 351)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 352)                             y     = y,
0d72518f R/granovagg.ds.R      303 353)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 354)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 355)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 356)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 357)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 358)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 359)                        )
a71441d3 R/granova.ds.ggplot.R 229 360)           )
863d348b R/granova.ds.ggplot.R 258 361)   }
863d348b R/granova.ds.ggplot.R 259 362) 
794c4b70 R/granova.ds.ggplot.R 258 363)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 364)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 365)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 366)                          ),
a71441d3 R/granova.ds.ggplot.R 236 367)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 368)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 369)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 370)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 371)                      )
a71441d3 R/granova.ds.ggplot.R 240 372)           )
863d348b R/granova.ds.ggplot.R 272 373)   }
863d348b R/granova.ds.ggplot.R 273 374) 
794c4b70 R/granova.ds.ggplot.R 272 375)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 376)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 377)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 378)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 379)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 380)                            ),
a71441d3 R/granova.ds.ggplot.R 249 381)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 382)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 383)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 384)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 385)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 386)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 387)           )
863d348b R/granova.ds.ggplot.R 290 388)   }
863d348b R/granova.ds.ggplot.R 291 389) 
ef841aa1 R/granova.ds.ggplot.R 257 390)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 391)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 392)   
a71441d3 R/granova.ds.ggplot.R 261 393)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 394)   }
863d348b R/granova.ds.ggplot.R 297 395) 
0afa3a38 R/granovagg.ds.R      306 396)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 397)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 398)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 399)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 400)     }
0afa3a38 R/granovagg.ds.R      311 401)     
0afa3a38 R/granovagg.ds.R      312 402)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 403)   }
0afa3a38 R/granovagg.ds.R      314 404)   
485d5f02 R/granovagg.ds.R      317 405)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 406)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 407)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 408)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 409)     }
485d5f02 R/granovagg.ds.R      322 410)     
485d5f02 R/granovagg.ds.R      323 411)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 412)   }
485d5f02 R/granovagg.ds.R      325 413)   
794c4b70 R/granova.ds.ggplot.R 296 414)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 415)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 416)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 417)     }
a2b6fe7d R/granovagg.ds.R      320 418)     
a2b6fe7d R/granovagg.ds.R      321 419)     else {
a2b6fe7d R/granovagg.ds.R      322 420)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 421)     }
863d348b R/granova.ds.ggplot.R 304 422)   }
b5b60529 R/granova.ds.ggplot.R 270 423)   
b5b60529 R/granova.ds.ggplot.R 271 424)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 425)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 426)   }
b5b60529 R/granova.ds.ggplot.R 274 427)   
3b102930 R/granova.ds.ggplot.R 275 428)           
3eb0e1f7 R/granova.ds.ggplot.R 304 429)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 430)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 431)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 432)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 433)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 434)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 435)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 436)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 437)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 438)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 439)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 440)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 441)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 442)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 443)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 444)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 445)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 446) 
a71441d3 R/granova.ds.ggplot.R 288 447)   return(p)
5d58b37c R/granova.ds.bd.R     314 448) 
b3a74c98 R/granova.ds.bd.R     301 449) }
</pre>
<div class="compileroutput">
Update granovagg.ds documentation to reflect visual changes to the graphic since the original granova incarnation.<p>Closes #96<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="4b3a4c5"></a>
4b3a4c5 2011-09-03 11:39:57 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
<span class="changed">4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown</span>
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
19d1b011 R/granovagg.ds.R       42  58) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  59) #' @export
2b0c8b84 R/granovagg.ds.R       71  60) 
f855a782 R/granovagg.ds.R       46  61) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  62)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  63)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  64)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  65)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  66)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  67)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  68)                          ...
e55d776c R/granovagg.ds.R       42  69)                 ) 
be2e6fbd R/granova.ds.bd.R      19  70) 
be2e6fbd R/granova.ds.bd.R      20  71) {
d6c27487 R/granova.ds.bd.R      12  72)   
f855a782 R/granovagg.ds.R       58  73)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  74)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  75)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  76)     return(output)
f855a782 R/granovagg.ds.R       62  77)   }
f855a782 R/granovagg.ds.R       63  78)   
f855a782 R/granovagg.ds.R       64  79)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  80)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  81)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  82)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  83)   }
544a88ef R/granovagg.ds.R       61  84)   
f855a782 R/granovagg.ds.R       70  85)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  86)     output &lt;- data
f855a782 R/granovagg.ds.R       72  87)     if (revc) {
f855a782 R/granovagg.ds.R       73  88)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  89)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  90)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  91)     }
f855a782 R/granovagg.ds.R       77  92)     return(output)
f855a782 R/granovagg.ds.R       78  93)   }
f855a782 R/granovagg.ds.R       79  94)   
544a88ef R/granovagg.ds.R       62  95)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  96)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  97)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  98)     }
544a88ef R/granovagg.ds.R       66  99)   }
544a88ef R/granovagg.ds.R       67 100) 
544a88ef R/granovagg.ds.R       68 101)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 102)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 103)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 104)       stop(message)
544a88ef R/granovagg.ds.R       72 105)     }
544a88ef R/granovagg.ds.R       73 106)     
544a88ef R/granovagg.ds.R       74 107)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 108)       stop(message)
544a88ef R/granovagg.ds.R       76 109)     }
544a88ef R/granovagg.ds.R       77 110)   }
544a88ef R/granovagg.ds.R       78 111)   
544a88ef R/granovagg.ds.R       79 112)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 113)     output &lt;- data
544a88ef R/granovagg.ds.R       81 114)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 115)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 116)     }
544a88ef R/granovagg.ds.R       84 117)     return(output)
544a88ef R/granovagg.ds.R       85 118)   }
544a88ef R/granovagg.ds.R       86 119)   
794c4b70 R/granova.ds.ggplot.R   9 120)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 121)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 122)   }
a806fcaa R/granova.ds.bd.R      15 123) 
794c4b70 R/granova.ds.ggplot.R  13 124)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 125)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 126)   }
e589a242 R/granova.ds.bd.R      17 127) 
794c4b70 R/granova.ds.ggplot.R  17 128)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 129)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 130)   }
c2605051 R/granova.ds.bd.R     182 131)   
794c4b70 R/granova.ds.ggplot.R  21 132)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 133)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 134)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 135)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 136)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 137)                  )
a71441d3 R/granova.ds.ggplot.R  27 138)           )
863d348b R/granova.ds.ggplot.R  30 139)   }
c2605051 R/granova.ds.bd.R     187 140)   
794c4b70 R/granova.ds.ggplot.R  30 141)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 142)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 143)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 144)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 145)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 146)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 147)                      )
a71441d3 R/granova.ds.ggplot.R  38 148)           )
863d348b R/granova.ds.ggplot.R  41 149)   }
c2605051 R/granova.ds.bd.R     191 150)   
794c4b70 R/granova.ds.ggplot.R  41 151)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 152)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 153)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 154)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 155)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 156)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 157)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 158)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 159)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 160)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 161)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 162)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 163)   
a71441d3 R/granova.ds.ggplot.R  54 164)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 165)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 166)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 167)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 168)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 169)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 170)                )
a71441d3 R/granova.ds.ggplot.R  61 171)           )
863d348b R/granova.ds.ggplot.R  64 172)   }
c2605051 R/granova.ds.bd.R     199 173)   
794c4b70 R/granova.ds.ggplot.R  64 174)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 175)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 176)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 177)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 178)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 179)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 180)   }
863d348b R/granova.ds.ggplot.R  73 181) 
794c4b70 R/granova.ds.ggplot.R  72 182)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 183)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 184)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 185)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 186)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 187)                      )
a71441d3 R/granova.ds.ggplot.R  78 188)           )  
863d348b R/granova.ds.ggplot.R  82 189)   }
c2605051 R/granova.ds.bd.R     209 190)   
794c4b70 R/granova.ds.ggplot.R  82 191)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 192)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 193)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 194)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 195)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 196)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 197)                      )
a71441d3 R/granova.ds.ggplot.R  88 198)           )
5f570d2d R/granova.ds.bd.R     190 199)     
863d348b R/granova.ds.ggplot.R  94 200)   }
c2605051 R/granova.ds.bd.R     224 201)   
794c4b70 R/granova.ds.ggplot.R  94 202)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 203)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 204)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 205)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 206)                      )
a71441d3 R/granova.ds.ggplot.R  97 207)           )
863d348b R/granova.ds.ggplot.R 103 208)   }
863d348b R/granova.ds.ggplot.R 104 209) 
754a8540 R/granovagg.ds.R      177 210)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 211)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 212)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 213)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 214)     return(output)
754a8540 R/granovagg.ds.R      182 215)   }
754a8540 R/granovagg.ds.R      183 216) 
73167de2 R/granovagg.ds.R      184 217)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 218)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 219)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 220)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 221)                )
73167de2 R/granovagg.ds.R      189 222)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 223)   }
73167de2 R/granovagg.ds.R      191 224)   
794c4b70 R/granova.ds.ggplot.R 103 225)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 226)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 227)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 228)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 229)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 230)                      )
a71441d3 R/granova.ds.ggplot.R 106 231)           )
863d348b R/granova.ds.ggplot.R 114 232)   }
c2605051 R/granova.ds.bd.R     239 233)   
794c4b70 R/granova.ds.ggplot.R 114 234)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 235)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 236)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 237)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 238)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 239)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 240)                )
a71441d3 R/granova.ds.ggplot.R 116 241)           )         
863d348b R/granova.ds.ggplot.R 125 242)   }
863d348b R/granova.ds.ggplot.R 126 243) 
f855a782 R/granovagg.ds.R      229 244)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 245)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 246)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 247)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 248)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 249)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 250)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 251)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 252)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 253)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 254)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 255)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 256)     
c2605051 R/granova.ds.bd.R     256 257)   
863d348b R/granova.ds.ggplot.R 139 258) 
863d348b R/granova.ds.ggplot.R 140 259)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 260)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 261) 
863d348b R/granova.ds.ggplot.R 143 262)   
3eb0e1f7 R/granova.ds.ggplot.R 142 263)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 264)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 265)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 266)                             ),
a71441d3 R/granova.ds.ggplot.R 140 267)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 268)                  )
863d348b R/granova.ds.ggplot.R 151 269)           )
863d348b R/granova.ds.ggplot.R 152 270)   }
e60e59e1 R/granova.ds.bd.R     241 271)     
794c4b70 R/granova.ds.ggplot.R 152 272)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 273)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 274)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 275)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 276)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 277)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 278)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 279)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 280)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 281)                       )
a71441d3 R/granova.ds.ggplot.R 154 282)           )
863d348b R/granova.ds.ggplot.R 166 283)   }
863d348b R/granova.ds.ggplot.R 167 284) 
794c4b70 R/granova.ds.ggplot.R 166 285)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 286)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 287)   }
863d348b R/granova.ds.ggplot.R 174 288) 
3eb0e1f7 R/granova.ds.ggplot.R 173 289)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 290)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 291)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 292)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 293)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 294)                       )
a71441d3 R/granova.ds.ggplot.R 166 295)           )
863d348b R/granova.ds.ggplot.R 183 296)   }
863d348b R/granova.ds.ggplot.R 184 297) 
794c4b70 R/granova.ds.ggplot.R 183 298)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 299)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 300)   }
863d348b R/granova.ds.ggplot.R 188 301) 
794c4b70 R/granova.ds.ggplot.R 187 302)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 303)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 304)   }
863d348b R/granova.ds.ggplot.R 192 305) 
794c4b70 R/granova.ds.ggplot.R 191 306)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 307)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 308)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 309)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 310)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 311)                    )  
a71441d3 R/granova.ds.ggplot.R 183 312)           )
863d348b R/granova.ds.ggplot.R 202 313)   }
863d348b R/granova.ds.ggplot.R 203 314) 
794c4b70 R/granova.ds.ggplot.R 202 315)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 316)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 317)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 318)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 319)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 320)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 321)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 322)           )
863d348b R/granova.ds.ggplot.R 213 323)   }
c2605051 R/granova.ds.bd.R     271 324)   
794c4b70 R/granova.ds.ggplot.R 213 325)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 326)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 327)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 328)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 329)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 330)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 331)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 332)           )
aaeade58 R/granova.ds.bd.R     274 333)     
863d348b R/granova.ds.ggplot.R 225 334)   }
863d348b R/granova.ds.ggplot.R 226 335) 
794c4b70 R/granova.ds.ggplot.R 225 336)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 337)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 338)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 339)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 340)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 341)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 342)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 343)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 344)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 345)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 346)                        )  
a71441d3 R/granova.ds.ggplot.R 216 347)           )
863d348b R/granova.ds.ggplot.R 242 348)   }
863d348b R/granova.ds.ggplot.R 243 349) 
794c4b70 R/granova.ds.ggplot.R 242 350)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 351)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 352)                             y     = y,
0d72518f R/granovagg.ds.R      303 353)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 354)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 355)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 356)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 357)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 358)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 359)                        )
a71441d3 R/granova.ds.ggplot.R 229 360)           )
863d348b R/granova.ds.ggplot.R 258 361)   }
863d348b R/granova.ds.ggplot.R 259 362) 
794c4b70 R/granova.ds.ggplot.R 258 363)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 364)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 365)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 366)                          ),
a71441d3 R/granova.ds.ggplot.R 236 367)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 368)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 369)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 370)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 371)                      )
a71441d3 R/granova.ds.ggplot.R 240 372)           )
863d348b R/granova.ds.ggplot.R 272 373)   }
863d348b R/granova.ds.ggplot.R 273 374) 
794c4b70 R/granova.ds.ggplot.R 272 375)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 376)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 377)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 378)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 379)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 380)                            ),
a71441d3 R/granova.ds.ggplot.R 249 381)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 382)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 383)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 384)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 385)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 386)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 387)           )
863d348b R/granova.ds.ggplot.R 290 388)   }
863d348b R/granova.ds.ggplot.R 291 389) 
ef841aa1 R/granova.ds.ggplot.R 257 390)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 391)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 392)   
a71441d3 R/granova.ds.ggplot.R 261 393)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 394)   }
863d348b R/granova.ds.ggplot.R 297 395) 
0afa3a38 R/granovagg.ds.R      306 396)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 397)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 398)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 399)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 400)     }
0afa3a38 R/granovagg.ds.R      311 401)     
0afa3a38 R/granovagg.ds.R      312 402)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 403)   }
0afa3a38 R/granovagg.ds.R      314 404)   
485d5f02 R/granovagg.ds.R      317 405)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 406)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 407)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 408)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 409)     }
485d5f02 R/granovagg.ds.R      322 410)     
485d5f02 R/granovagg.ds.R      323 411)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 412)   }
485d5f02 R/granovagg.ds.R      325 413)   
794c4b70 R/granova.ds.ggplot.R 296 414)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 415)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 416)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 417)     }
a2b6fe7d R/granovagg.ds.R      320 418)     
a2b6fe7d R/granovagg.ds.R      321 419)     else {
a2b6fe7d R/granovagg.ds.R      322 420)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 421)     }
863d348b R/granova.ds.ggplot.R 304 422)   }
b5b60529 R/granova.ds.ggplot.R 270 423)   
b5b60529 R/granova.ds.ggplot.R 271 424)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 425)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 426)   }
b5b60529 R/granova.ds.ggplot.R 274 427)   
3b102930 R/granova.ds.ggplot.R 275 428)           
3eb0e1f7 R/granova.ds.ggplot.R 304 429)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 430)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 431)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 432)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 433)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 434)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 435)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 436)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 437)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 438)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 439)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 440)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 441)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 442)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 443)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 444)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 445)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 446) 
a71441d3 R/granova.ds.ggplot.R 288 447)   return(p)
5d58b37c R/granova.ds.bd.R     314 448) 
b3a74c98 R/granova.ds.bd.R     301 449) }
</pre>
<div class="compileroutput">
Fix "95%" error in granovagg.ds by escaping the percent sign. Fix references to Leland Wilkinson's grammar of graphics.<p>Closes #115<br>
Closes #113<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="795b19d"></a>
795b19d 2011-09-03 11:43:44 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
19d1b011 R/granovagg.ds.R       42  58) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  59) #' @export
<span class="changed">795b19d3 R/granovagg.ds.R       60  60) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.</span>
<span class="changed">795b19d3 R/granovagg.ds.R       61  61) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.</span>
f855a782 R/granovagg.ds.R       46  62) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  63)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  64)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  65)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  66)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  67)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  68)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  69)                          ...
e55d776c R/granovagg.ds.R       42  70)                 ) 
be2e6fbd R/granova.ds.bd.R      19  71) 
be2e6fbd R/granova.ds.bd.R      20  72) {
d6c27487 R/granova.ds.bd.R      12  73)   
f855a782 R/granovagg.ds.R       58  74)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  75)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  76)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  77)     return(output)
f855a782 R/granovagg.ds.R       62  78)   }
f855a782 R/granovagg.ds.R       63  79)   
f855a782 R/granovagg.ds.R       64  80)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  81)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  82)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  83)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  84)   }
544a88ef R/granovagg.ds.R       61  85)   
f855a782 R/granovagg.ds.R       70  86)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  87)     output &lt;- data
f855a782 R/granovagg.ds.R       72  88)     if (revc) {
f855a782 R/granovagg.ds.R       73  89)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  90)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  91)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  92)     }
f855a782 R/granovagg.ds.R       77  93)     return(output)
f855a782 R/granovagg.ds.R       78  94)   }
f855a782 R/granovagg.ds.R       79  95)   
544a88ef R/granovagg.ds.R       62  96)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63  97)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64  98)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65  99)     }
544a88ef R/granovagg.ds.R       66 100)   }
544a88ef R/granovagg.ds.R       67 101) 
544a88ef R/granovagg.ds.R       68 102)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 103)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 104)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 105)       stop(message)
544a88ef R/granovagg.ds.R       72 106)     }
544a88ef R/granovagg.ds.R       73 107)     
544a88ef R/granovagg.ds.R       74 108)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 109)       stop(message)
544a88ef R/granovagg.ds.R       76 110)     }
544a88ef R/granovagg.ds.R       77 111)   }
544a88ef R/granovagg.ds.R       78 112)   
544a88ef R/granovagg.ds.R       79 113)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 114)     output &lt;- data
544a88ef R/granovagg.ds.R       81 115)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 116)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 117)     }
544a88ef R/granovagg.ds.R       84 118)     return(output)
544a88ef R/granovagg.ds.R       85 119)   }
544a88ef R/granovagg.ds.R       86 120)   
794c4b70 R/granova.ds.ggplot.R   9 121)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 122)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 123)   }
a806fcaa R/granova.ds.bd.R      15 124) 
794c4b70 R/granova.ds.ggplot.R  13 125)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 126)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 127)   }
e589a242 R/granova.ds.bd.R      17 128) 
794c4b70 R/granova.ds.ggplot.R  17 129)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 130)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 131)   }
c2605051 R/granova.ds.bd.R     182 132)   
794c4b70 R/granova.ds.ggplot.R  21 133)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 134)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 135)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 136)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 137)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 138)                  )
a71441d3 R/granova.ds.ggplot.R  27 139)           )
863d348b R/granova.ds.ggplot.R  30 140)   }
c2605051 R/granova.ds.bd.R     187 141)   
794c4b70 R/granova.ds.ggplot.R  30 142)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 143)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 144)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 145)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 146)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 147)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 148)                      )
a71441d3 R/granova.ds.ggplot.R  38 149)           )
863d348b R/granova.ds.ggplot.R  41 150)   }
c2605051 R/granova.ds.bd.R     191 151)   
794c4b70 R/granova.ds.ggplot.R  41 152)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 153)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 154)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 155)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 156)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 157)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 158)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 159)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 160)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 161)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 162)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 163)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 164)   
a71441d3 R/granova.ds.ggplot.R  54 165)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 166)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 167)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 168)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 169)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 170)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 171)                )
a71441d3 R/granova.ds.ggplot.R  61 172)           )
863d348b R/granova.ds.ggplot.R  64 173)   }
c2605051 R/granova.ds.bd.R     199 174)   
794c4b70 R/granova.ds.ggplot.R  64 175)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 176)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 177)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 178)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 179)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 180)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 181)   }
863d348b R/granova.ds.ggplot.R  73 182) 
794c4b70 R/granova.ds.ggplot.R  72 183)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 184)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 185)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 186)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 187)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 188)                      )
a71441d3 R/granova.ds.ggplot.R  78 189)           )  
863d348b R/granova.ds.ggplot.R  82 190)   }
c2605051 R/granova.ds.bd.R     209 191)   
794c4b70 R/granova.ds.ggplot.R  82 192)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 193)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 194)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 195)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 196)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 197)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 198)                      )
a71441d3 R/granova.ds.ggplot.R  88 199)           )
5f570d2d R/granova.ds.bd.R     190 200)     
863d348b R/granova.ds.ggplot.R  94 201)   }
c2605051 R/granova.ds.bd.R     224 202)   
794c4b70 R/granova.ds.ggplot.R  94 203)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 204)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 205)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 206)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 207)                      )
a71441d3 R/granova.ds.ggplot.R  97 208)           )
863d348b R/granova.ds.ggplot.R 103 209)   }
863d348b R/granova.ds.ggplot.R 104 210) 
754a8540 R/granovagg.ds.R      177 211)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 212)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 213)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 214)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 215)     return(output)
754a8540 R/granovagg.ds.R      182 216)   }
754a8540 R/granovagg.ds.R      183 217) 
73167de2 R/granovagg.ds.R      184 218)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 219)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 220)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 221)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 222)                )
73167de2 R/granovagg.ds.R      189 223)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 224)   }
73167de2 R/granovagg.ds.R      191 225)   
794c4b70 R/granova.ds.ggplot.R 103 226)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 227)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 228)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 229)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 230)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 231)                      )
a71441d3 R/granova.ds.ggplot.R 106 232)           )
863d348b R/granova.ds.ggplot.R 114 233)   }
c2605051 R/granova.ds.bd.R     239 234)   
794c4b70 R/granova.ds.ggplot.R 114 235)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 236)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 237)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 238)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 239)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 240)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 241)                )
a71441d3 R/granova.ds.ggplot.R 116 242)           )         
863d348b R/granova.ds.ggplot.R 125 243)   }
863d348b R/granova.ds.ggplot.R 126 244) 
f855a782 R/granovagg.ds.R      229 245)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 246)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 247)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 248)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 249)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 250)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 251)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 252)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 253)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 254)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 255)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 256)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 257)     
c2605051 R/granova.ds.bd.R     256 258)   
863d348b R/granova.ds.ggplot.R 139 259) 
863d348b R/granova.ds.ggplot.R 140 260)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 261)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 262) 
863d348b R/granova.ds.ggplot.R 143 263)   
3eb0e1f7 R/granova.ds.ggplot.R 142 264)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 265)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 266)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 267)                             ),
a71441d3 R/granova.ds.ggplot.R 140 268)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 269)                  )
863d348b R/granova.ds.ggplot.R 151 270)           )
863d348b R/granova.ds.ggplot.R 152 271)   }
e60e59e1 R/granova.ds.bd.R     241 272)     
794c4b70 R/granova.ds.ggplot.R 152 273)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 274)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 275)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 276)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 277)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 278)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 279)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 280)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 281)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 282)                       )
a71441d3 R/granova.ds.ggplot.R 154 283)           )
863d348b R/granova.ds.ggplot.R 166 284)   }
863d348b R/granova.ds.ggplot.R 167 285) 
794c4b70 R/granova.ds.ggplot.R 166 286)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 287)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 288)   }
863d348b R/granova.ds.ggplot.R 174 289) 
3eb0e1f7 R/granova.ds.ggplot.R 173 290)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 291)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 292)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 293)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 294)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 295)                       )
a71441d3 R/granova.ds.ggplot.R 166 296)           )
863d348b R/granova.ds.ggplot.R 183 297)   }
863d348b R/granova.ds.ggplot.R 184 298) 
794c4b70 R/granova.ds.ggplot.R 183 299)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 300)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 301)   }
863d348b R/granova.ds.ggplot.R 188 302) 
794c4b70 R/granova.ds.ggplot.R 187 303)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 304)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 305)   }
863d348b R/granova.ds.ggplot.R 192 306) 
794c4b70 R/granova.ds.ggplot.R 191 307)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 308)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 309)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 310)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 311)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 312)                    )  
a71441d3 R/granova.ds.ggplot.R 183 313)           )
863d348b R/granova.ds.ggplot.R 202 314)   }
863d348b R/granova.ds.ggplot.R 203 315) 
794c4b70 R/granova.ds.ggplot.R 202 316)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 317)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 318)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 319)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 320)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 321)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 322)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 323)           )
863d348b R/granova.ds.ggplot.R 213 324)   }
c2605051 R/granova.ds.bd.R     271 325)   
794c4b70 R/granova.ds.ggplot.R 213 326)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 327)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 328)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 329)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 330)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 331)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 332)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 333)           )
aaeade58 R/granova.ds.bd.R     274 334)     
863d348b R/granova.ds.ggplot.R 225 335)   }
863d348b R/granova.ds.ggplot.R 226 336) 
794c4b70 R/granova.ds.ggplot.R 225 337)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 338)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 339)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 340)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 341)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 342)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 343)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 344)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 345)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 346)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 347)                        )  
a71441d3 R/granova.ds.ggplot.R 216 348)           )
863d348b R/granova.ds.ggplot.R 242 349)   }
863d348b R/granova.ds.ggplot.R 243 350) 
794c4b70 R/granova.ds.ggplot.R 242 351)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 352)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 353)                             y     = y,
0d72518f R/granovagg.ds.R      303 354)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 355)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 356)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 357)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 358)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 359)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 360)                        )
a71441d3 R/granova.ds.ggplot.R 229 361)           )
863d348b R/granova.ds.ggplot.R 258 362)   }
863d348b R/granova.ds.ggplot.R 259 363) 
794c4b70 R/granova.ds.ggplot.R 258 364)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 365)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 366)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 367)                          ),
a71441d3 R/granova.ds.ggplot.R 236 368)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 369)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 370)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 371)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 372)                      )
a71441d3 R/granova.ds.ggplot.R 240 373)           )
863d348b R/granova.ds.ggplot.R 272 374)   }
863d348b R/granova.ds.ggplot.R 273 375) 
794c4b70 R/granova.ds.ggplot.R 272 376)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 377)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 378)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 379)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 380)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 381)                            ),
a71441d3 R/granova.ds.ggplot.R 249 382)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 383)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 384)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 385)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 386)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 387)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 388)           )
863d348b R/granova.ds.ggplot.R 290 389)   }
863d348b R/granova.ds.ggplot.R 291 390) 
ef841aa1 R/granova.ds.ggplot.R 257 391)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 392)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 393)   
a71441d3 R/granova.ds.ggplot.R 261 394)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 395)   }
863d348b R/granova.ds.ggplot.R 297 396) 
0afa3a38 R/granovagg.ds.R      306 397)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 398)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 399)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 400)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 401)     }
0afa3a38 R/granovagg.ds.R      311 402)     
0afa3a38 R/granovagg.ds.R      312 403)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 404)   }
0afa3a38 R/granovagg.ds.R      314 405)   
485d5f02 R/granovagg.ds.R      317 406)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 407)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 408)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 409)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 410)     }
485d5f02 R/granovagg.ds.R      322 411)     
485d5f02 R/granovagg.ds.R      323 412)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 413)   }
485d5f02 R/granovagg.ds.R      325 414)   
794c4b70 R/granova.ds.ggplot.R 296 415)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 416)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 417)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 418)     }
a2b6fe7d R/granovagg.ds.R      320 419)     
a2b6fe7d R/granovagg.ds.R      321 420)     else {
a2b6fe7d R/granovagg.ds.R      322 421)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 422)     }
863d348b R/granova.ds.ggplot.R 304 423)   }
b5b60529 R/granova.ds.ggplot.R 270 424)   
b5b60529 R/granova.ds.ggplot.R 271 425)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 426)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 427)   }
b5b60529 R/granova.ds.ggplot.R 274 428)   
3b102930 R/granova.ds.ggplot.R 275 429)           
3eb0e1f7 R/granova.ds.ggplot.R 304 430)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 431)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 432)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 433)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 434)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 435)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 436)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 437)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 438)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 439)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 440)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 441)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 442)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 443)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 444)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 445)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 446)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 447) 
a71441d3 R/granova.ds.ggplot.R 288 448)   return(p)
5d58b37c R/granova.ds.bd.R     314 449) 
b3a74c98 R/granova.ds.bd.R     301 450) }
</pre>
<div class="compileroutput">
Added book references to Wilkinson (1999) and Wickham (2009)<p></p><p><br>
</p></div>
</td>
<td>
<a name="4826596"></a>
4826596 2011-09-03 11:55:39 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
<span class="changed">48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},</span>
<span class="changed">48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},</span>
<span class="changed">48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}</span>
<span class="changed">48265964 R/granovagg.ds.R       61  61) #'</span>
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
795b19d3 R/granovagg.ds.R       60  64) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  65) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  66) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  67)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  68)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  69)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  70)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  71)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  72)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  73)                          ...
e55d776c R/granovagg.ds.R       42  74)                 ) 
be2e6fbd R/granova.ds.bd.R      19  75) 
be2e6fbd R/granova.ds.bd.R      20  76) {
d6c27487 R/granova.ds.bd.R      12  77)   
f855a782 R/granovagg.ds.R       58  78)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  79)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  80)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  81)     return(output)
f855a782 R/granovagg.ds.R       62  82)   }
f855a782 R/granovagg.ds.R       63  83)   
f855a782 R/granovagg.ds.R       64  84)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  85)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  86)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  87)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  88)   }
544a88ef R/granovagg.ds.R       61  89)   
f855a782 R/granovagg.ds.R       70  90)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  91)     output &lt;- data
f855a782 R/granovagg.ds.R       72  92)     if (revc) {
f855a782 R/granovagg.ds.R       73  93)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  94)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  95)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  96)     }
f855a782 R/granovagg.ds.R       77  97)     return(output)
f855a782 R/granovagg.ds.R       78  98)   }
f855a782 R/granovagg.ds.R       79  99)   
544a88ef R/granovagg.ds.R       62 100)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 101)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 102)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 103)     }
544a88ef R/granovagg.ds.R       66 104)   }
544a88ef R/granovagg.ds.R       67 105) 
544a88ef R/granovagg.ds.R       68 106)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 107)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 108)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 109)       stop(message)
544a88ef R/granovagg.ds.R       72 110)     }
544a88ef R/granovagg.ds.R       73 111)     
544a88ef R/granovagg.ds.R       74 112)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 113)       stop(message)
544a88ef R/granovagg.ds.R       76 114)     }
544a88ef R/granovagg.ds.R       77 115)   }
544a88ef R/granovagg.ds.R       78 116)   
544a88ef R/granovagg.ds.R       79 117)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 118)     output &lt;- data
544a88ef R/granovagg.ds.R       81 119)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 120)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 121)     }
544a88ef R/granovagg.ds.R       84 122)     return(output)
544a88ef R/granovagg.ds.R       85 123)   }
544a88ef R/granovagg.ds.R       86 124)   
794c4b70 R/granova.ds.ggplot.R   9 125)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 126)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 127)   }
a806fcaa R/granova.ds.bd.R      15 128) 
794c4b70 R/granova.ds.ggplot.R  13 129)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 130)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 131)   }
e589a242 R/granova.ds.bd.R      17 132) 
794c4b70 R/granova.ds.ggplot.R  17 133)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 134)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 135)   }
c2605051 R/granova.ds.bd.R     182 136)   
794c4b70 R/granova.ds.ggplot.R  21 137)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 138)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 139)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 140)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 141)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 142)                  )
a71441d3 R/granova.ds.ggplot.R  27 143)           )
863d348b R/granova.ds.ggplot.R  30 144)   }
c2605051 R/granova.ds.bd.R     187 145)   
794c4b70 R/granova.ds.ggplot.R  30 146)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 147)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 148)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 149)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 150)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 151)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 152)                      )
a71441d3 R/granova.ds.ggplot.R  38 153)           )
863d348b R/granova.ds.ggplot.R  41 154)   }
c2605051 R/granova.ds.bd.R     191 155)   
794c4b70 R/granova.ds.ggplot.R  41 156)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 157)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 158)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 159)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 160)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 161)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 162)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 163)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 164)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 165)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 166)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 167)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 168)   
a71441d3 R/granova.ds.ggplot.R  54 169)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 170)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 171)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 172)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 173)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 174)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 175)                )
a71441d3 R/granova.ds.ggplot.R  61 176)           )
863d348b R/granova.ds.ggplot.R  64 177)   }
c2605051 R/granova.ds.bd.R     199 178)   
794c4b70 R/granova.ds.ggplot.R  64 179)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 180)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 181)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 182)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 183)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 184)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 185)   }
863d348b R/granova.ds.ggplot.R  73 186) 
794c4b70 R/granova.ds.ggplot.R  72 187)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 188)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 189)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 190)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 191)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 192)                      )
a71441d3 R/granova.ds.ggplot.R  78 193)           )  
863d348b R/granova.ds.ggplot.R  82 194)   }
c2605051 R/granova.ds.bd.R     209 195)   
794c4b70 R/granova.ds.ggplot.R  82 196)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 197)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 198)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 199)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 200)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 201)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 202)                      )
a71441d3 R/granova.ds.ggplot.R  88 203)           )
5f570d2d R/granova.ds.bd.R     190 204)     
863d348b R/granova.ds.ggplot.R  94 205)   }
c2605051 R/granova.ds.bd.R     224 206)   
794c4b70 R/granova.ds.ggplot.R  94 207)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 208)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 209)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 210)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 211)                      )
a71441d3 R/granova.ds.ggplot.R  97 212)           )
863d348b R/granova.ds.ggplot.R 103 213)   }
863d348b R/granova.ds.ggplot.R 104 214) 
754a8540 R/granovagg.ds.R      177 215)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 216)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 217)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 218)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 219)     return(output)
754a8540 R/granovagg.ds.R      182 220)   }
754a8540 R/granovagg.ds.R      183 221) 
73167de2 R/granovagg.ds.R      184 222)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 223)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 224)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 225)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 226)                )
73167de2 R/granovagg.ds.R      189 227)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 228)   }
73167de2 R/granovagg.ds.R      191 229)   
794c4b70 R/granova.ds.ggplot.R 103 230)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 231)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 232)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 233)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 234)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 235)                      )
a71441d3 R/granova.ds.ggplot.R 106 236)           )
863d348b R/granova.ds.ggplot.R 114 237)   }
c2605051 R/granova.ds.bd.R     239 238)   
794c4b70 R/granova.ds.ggplot.R 114 239)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 240)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 241)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 242)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 243)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 244)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 245)                )
a71441d3 R/granova.ds.ggplot.R 116 246)           )         
863d348b R/granova.ds.ggplot.R 125 247)   }
863d348b R/granova.ds.ggplot.R 126 248) 
f855a782 R/granovagg.ds.R      229 249)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 250)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 251)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 252)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 253)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 254)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 255)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 256)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 257)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 258)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 259)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 260)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 261)     
c2605051 R/granova.ds.bd.R     256 262)   
863d348b R/granova.ds.ggplot.R 139 263) 
863d348b R/granova.ds.ggplot.R 140 264)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 265)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 266) 
863d348b R/granova.ds.ggplot.R 143 267)   
3eb0e1f7 R/granova.ds.ggplot.R 142 268)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 269)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 270)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 271)                             ),
a71441d3 R/granova.ds.ggplot.R 140 272)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 273)                  )
863d348b R/granova.ds.ggplot.R 151 274)           )
863d348b R/granova.ds.ggplot.R 152 275)   }
e60e59e1 R/granova.ds.bd.R     241 276)     
794c4b70 R/granova.ds.ggplot.R 152 277)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 278)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 279)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 280)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 281)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 282)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 283)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 284)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 285)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 286)                       )
a71441d3 R/granova.ds.ggplot.R 154 287)           )
863d348b R/granova.ds.ggplot.R 166 288)   }
863d348b R/granova.ds.ggplot.R 167 289) 
794c4b70 R/granova.ds.ggplot.R 166 290)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 291)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 292)   }
863d348b R/granova.ds.ggplot.R 174 293) 
3eb0e1f7 R/granova.ds.ggplot.R 173 294)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 295)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 296)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 297)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 298)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 299)                       )
a71441d3 R/granova.ds.ggplot.R 166 300)           )
863d348b R/granova.ds.ggplot.R 183 301)   }
863d348b R/granova.ds.ggplot.R 184 302) 
794c4b70 R/granova.ds.ggplot.R 183 303)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 304)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 305)   }
863d348b R/granova.ds.ggplot.R 188 306) 
794c4b70 R/granova.ds.ggplot.R 187 307)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 308)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 309)   }
863d348b R/granova.ds.ggplot.R 192 310) 
794c4b70 R/granova.ds.ggplot.R 191 311)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 312)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 313)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 314)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 315)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 316)                    )  
a71441d3 R/granova.ds.ggplot.R 183 317)           )
863d348b R/granova.ds.ggplot.R 202 318)   }
863d348b R/granova.ds.ggplot.R 203 319) 
794c4b70 R/granova.ds.ggplot.R 202 320)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 321)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 322)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 323)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 324)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 325)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 326)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 327)           )
863d348b R/granova.ds.ggplot.R 213 328)   }
c2605051 R/granova.ds.bd.R     271 329)   
794c4b70 R/granova.ds.ggplot.R 213 330)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 331)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 332)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 333)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 334)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 335)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 336)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 337)           )
aaeade58 R/granova.ds.bd.R     274 338)     
863d348b R/granova.ds.ggplot.R 225 339)   }
863d348b R/granova.ds.ggplot.R 226 340) 
794c4b70 R/granova.ds.ggplot.R 225 341)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 342)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 343)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 344)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 345)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 346)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 347)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 348)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 349)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 350)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 351)                        )  
a71441d3 R/granova.ds.ggplot.R 216 352)           )
863d348b R/granova.ds.ggplot.R 242 353)   }
863d348b R/granova.ds.ggplot.R 243 354) 
794c4b70 R/granova.ds.ggplot.R 242 355)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 356)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 357)                             y     = y,
0d72518f R/granovagg.ds.R      303 358)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 359)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 360)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 361)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 362)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 363)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 364)                        )
a71441d3 R/granova.ds.ggplot.R 229 365)           )
863d348b R/granova.ds.ggplot.R 258 366)   }
863d348b R/granova.ds.ggplot.R 259 367) 
794c4b70 R/granova.ds.ggplot.R 258 368)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 369)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 370)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 371)                          ),
a71441d3 R/granova.ds.ggplot.R 236 372)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 373)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 374)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 375)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 376)                      )
a71441d3 R/granova.ds.ggplot.R 240 377)           )
863d348b R/granova.ds.ggplot.R 272 378)   }
863d348b R/granova.ds.ggplot.R 273 379) 
794c4b70 R/granova.ds.ggplot.R 272 380)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 381)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 382)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 383)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 384)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 385)                            ),
a71441d3 R/granova.ds.ggplot.R 249 386)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 387)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 388)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 389)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 390)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 391)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 392)           )
863d348b R/granova.ds.ggplot.R 290 393)   }
863d348b R/granova.ds.ggplot.R 291 394) 
ef841aa1 R/granova.ds.ggplot.R 257 395)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 396)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 397)   
a71441d3 R/granova.ds.ggplot.R 261 398)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 399)   }
863d348b R/granova.ds.ggplot.R 297 400) 
0afa3a38 R/granovagg.ds.R      306 401)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 402)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 403)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 404)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 405)     }
0afa3a38 R/granovagg.ds.R      311 406)     
0afa3a38 R/granovagg.ds.R      312 407)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 408)   }
0afa3a38 R/granovagg.ds.R      314 409)   
485d5f02 R/granovagg.ds.R      317 410)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 411)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 412)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 413)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 414)     }
485d5f02 R/granovagg.ds.R      322 415)     
485d5f02 R/granovagg.ds.R      323 416)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 417)   }
485d5f02 R/granovagg.ds.R      325 418)   
794c4b70 R/granova.ds.ggplot.R 296 419)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 420)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 421)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 422)     }
a2b6fe7d R/granovagg.ds.R      320 423)     
a2b6fe7d R/granovagg.ds.R      321 424)     else {
a2b6fe7d R/granovagg.ds.R      322 425)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 426)     }
863d348b R/granova.ds.ggplot.R 304 427)   }
b5b60529 R/granova.ds.ggplot.R 270 428)   
b5b60529 R/granova.ds.ggplot.R 271 429)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 430)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 431)   }
b5b60529 R/granova.ds.ggplot.R 274 432)   
3b102930 R/granova.ds.ggplot.R 275 433)           
3eb0e1f7 R/granova.ds.ggplot.R 304 434)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 435)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 436)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 437)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 438)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 439)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 440)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 441)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 442)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 443)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 444)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 445)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 446)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 447)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 448)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 449)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 450)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 451) 
a71441d3 R/granova.ds.ggplot.R 288 452)   return(p)
5d58b37c R/granova.ds.bd.R     314 453) 
b3a74c98 R/granova.ds.bd.R     301 454) }
</pre>
<div class="compileroutput">
Improve cross-linking in function documentation. Add alias for ?geom_rug_alt.<p>Fixes #112<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="be5c4c1"></a>
be5c4c1 2011-10-01 20:03:11 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
<span class="changed">be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.</span>
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
863d348b R/granova.ds.ggplot.R 126 249) 
f855a782 R/granovagg.ds.R      229 250)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 251)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 252)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 253)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 254)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 255)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 256)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 257)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 258)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 259)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 260)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 261)   dsp$colors         &lt;- GetColors(dsp)
863d348b R/granova.ds.ggplot.R 137 262)     
c2605051 R/granova.ds.bd.R     256 263)   
863d348b R/granova.ds.ggplot.R 139 264) 
863d348b R/granova.ds.ggplot.R 140 265)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 266)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 267) 
863d348b R/granova.ds.ggplot.R 143 268)   
3eb0e1f7 R/granova.ds.ggplot.R 142 269)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 270)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 271)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 272)                             ),
a71441d3 R/granova.ds.ggplot.R 140 273)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 274)                  )
863d348b R/granova.ds.ggplot.R 151 275)           )
863d348b R/granova.ds.ggplot.R 152 276)   }
e60e59e1 R/granova.ds.bd.R     241 277)     
794c4b70 R/granova.ds.ggplot.R 152 278)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 279)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 280)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 281)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 282)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 283)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 284)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 285)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 286)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 287)                       )
a71441d3 R/granova.ds.ggplot.R 154 288)           )
863d348b R/granova.ds.ggplot.R 166 289)   }
863d348b R/granova.ds.ggplot.R 167 290) 
794c4b70 R/granova.ds.ggplot.R 166 291)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 292)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 293)   }
863d348b R/granova.ds.ggplot.R 174 294) 
3eb0e1f7 R/granova.ds.ggplot.R 173 295)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 296)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 297)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 298)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 299)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 300)                       )
a71441d3 R/granova.ds.ggplot.R 166 301)           )
863d348b R/granova.ds.ggplot.R 183 302)   }
863d348b R/granova.ds.ggplot.R 184 303) 
794c4b70 R/granova.ds.ggplot.R 183 304)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 305)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 306)   }
863d348b R/granova.ds.ggplot.R 188 307) 
794c4b70 R/granova.ds.ggplot.R 187 308)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 309)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 310)   }
863d348b R/granova.ds.ggplot.R 192 311) 
794c4b70 R/granova.ds.ggplot.R 191 312)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 313)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 314)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 315)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 316)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 317)                    )  
a71441d3 R/granova.ds.ggplot.R 183 318)           )
863d348b R/granova.ds.ggplot.R 202 319)   }
863d348b R/granova.ds.ggplot.R 203 320) 
794c4b70 R/granova.ds.ggplot.R 202 321)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 322)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 323)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 324)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 325)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 326)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 327)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 328)           )
863d348b R/granova.ds.ggplot.R 213 329)   }
c2605051 R/granova.ds.bd.R     271 330)   
794c4b70 R/granova.ds.ggplot.R 213 331)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 332)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 333)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 334)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 335)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 336)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 337)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 338)           )
aaeade58 R/granova.ds.bd.R     274 339)     
863d348b R/granova.ds.ggplot.R 225 340)   }
863d348b R/granova.ds.ggplot.R 226 341) 
794c4b70 R/granova.ds.ggplot.R 225 342)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 343)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 344)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 345)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 346)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 347)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 348)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 349)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 350)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 351)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 352)                        )  
a71441d3 R/granova.ds.ggplot.R 216 353)           )
863d348b R/granova.ds.ggplot.R 242 354)   }
863d348b R/granova.ds.ggplot.R 243 355) 
794c4b70 R/granova.ds.ggplot.R 242 356)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 357)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 358)                             y     = y,
0d72518f R/granovagg.ds.R      303 359)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 360)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 361)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 362)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 363)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 364)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 365)                        )
a71441d3 R/granova.ds.ggplot.R 229 366)           )
863d348b R/granova.ds.ggplot.R 258 367)   }
863d348b R/granova.ds.ggplot.R 259 368) 
794c4b70 R/granova.ds.ggplot.R 258 369)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 370)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 371)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 372)                          ),
a71441d3 R/granova.ds.ggplot.R 236 373)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 374)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 375)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 376)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 377)                      )
a71441d3 R/granova.ds.ggplot.R 240 378)           )
863d348b R/granova.ds.ggplot.R 272 379)   }
863d348b R/granova.ds.ggplot.R 273 380) 
794c4b70 R/granova.ds.ggplot.R 272 381)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 382)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 383)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 384)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 385)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 386)                            ),
a71441d3 R/granova.ds.ggplot.R 249 387)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 388)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 389)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 390)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 391)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 392)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 393)           )
863d348b R/granova.ds.ggplot.R 290 394)   }
863d348b R/granova.ds.ggplot.R 291 395) 
ef841aa1 R/granova.ds.ggplot.R 257 396)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 397)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 398)   
a71441d3 R/granova.ds.ggplot.R 261 399)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 400)   }
863d348b R/granova.ds.ggplot.R 297 401) 
0afa3a38 R/granovagg.ds.R      306 402)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 403)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 404)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 405)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 406)     }
0afa3a38 R/granovagg.ds.R      311 407)     
0afa3a38 R/granovagg.ds.R      312 408)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 409)   }
0afa3a38 R/granovagg.ds.R      314 410)   
485d5f02 R/granovagg.ds.R      317 411)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 412)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 413)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 414)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 415)     }
485d5f02 R/granovagg.ds.R      322 416)     
485d5f02 R/granovagg.ds.R      323 417)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 418)   }
485d5f02 R/granovagg.ds.R      325 419)   
794c4b70 R/granova.ds.ggplot.R 296 420)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 421)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 422)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 423)     }
a2b6fe7d R/granovagg.ds.R      320 424)     
a2b6fe7d R/granovagg.ds.R      321 425)     else {
a2b6fe7d R/granovagg.ds.R      322 426)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 427)     }
863d348b R/granova.ds.ggplot.R 304 428)   }
b5b60529 R/granova.ds.ggplot.R 270 429)   
b5b60529 R/granova.ds.ggplot.R 271 430)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 431)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 432)   }
b5b60529 R/granova.ds.ggplot.R 274 433)   
3b102930 R/granova.ds.ggplot.R 275 434)           
3eb0e1f7 R/granova.ds.ggplot.R 304 435)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 436)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 437)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 438)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 439)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 440)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 441)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 442)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 443)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 444)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 445)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 446)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 447)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 448)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 449)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 450)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 451)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 452) 
a71441d3 R/granova.ds.ggplot.R 288 453)   return(p)
5d58b37c R/granova.ds.bd.R     314 454) 
b3a74c98 R/granova.ds.bd.R     301 455) }
</pre>
<div class="compileroutput">
Add Pruzek and Helmreich (2009) reference to granovagg.ds documentation.<p>Fixes #124<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="5e0fcbf"></a>
5e0fcbf 2011-10-01 20:17:26 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
<span class="changed">5e0fcbf9 R/granovagg.ds.R      249 249)   </span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {</span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]</span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      252 252)     </span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      253 253)     output &lt;- paste("\nn = ", n, sep = "")</span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      254 254)     print(output)</span>
<span class="changed">5e0fcbf9 R/granovagg.ds.R      255 255)   }</span>
863d348b R/granova.ds.ggplot.R 126 256) 
f855a782 R/granovagg.ds.R      229 257)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 258)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 259)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 260)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 261)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 262)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 263)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 264)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 265)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 266)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 267)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 268)   dsp$colors         &lt;- GetColors(dsp)
<span class="changed">5e0fcbf9 R/granovagg.ds.R      269 269)   PrintSummary(dsp)</span>
863d348b R/granova.ds.ggplot.R 137 270)     
c2605051 R/granova.ds.bd.R     256 271)   
863d348b R/granova.ds.ggplot.R 139 272) 
863d348b R/granova.ds.ggplot.R 140 273)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 274)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 275) 
863d348b R/granova.ds.ggplot.R 143 276)   
3eb0e1f7 R/granova.ds.ggplot.R 142 277)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 278)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 279)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 280)                             ),
a71441d3 R/granova.ds.ggplot.R 140 281)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 282)                  )
863d348b R/granova.ds.ggplot.R 151 283)           )
863d348b R/granova.ds.ggplot.R 152 284)   }
e60e59e1 R/granova.ds.bd.R     241 285)     
794c4b70 R/granova.ds.ggplot.R 152 286)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 287)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 288)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 289)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 290)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 291)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 292)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 293)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 294)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 295)                       )
a71441d3 R/granova.ds.ggplot.R 154 296)           )
863d348b R/granova.ds.ggplot.R 166 297)   }
863d348b R/granova.ds.ggplot.R 167 298) 
794c4b70 R/granova.ds.ggplot.R 166 299)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 300)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 301)   }
863d348b R/granova.ds.ggplot.R 174 302) 
3eb0e1f7 R/granova.ds.ggplot.R 173 303)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 304)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 305)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 306)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 307)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 308)                       )
a71441d3 R/granova.ds.ggplot.R 166 309)           )
863d348b R/granova.ds.ggplot.R 183 310)   }
863d348b R/granova.ds.ggplot.R 184 311) 
794c4b70 R/granova.ds.ggplot.R 183 312)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 313)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 314)   }
863d348b R/granova.ds.ggplot.R 188 315) 
794c4b70 R/granova.ds.ggplot.R 187 316)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 317)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 318)   }
863d348b R/granova.ds.ggplot.R 192 319) 
794c4b70 R/granova.ds.ggplot.R 191 320)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 321)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 322)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 323)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 324)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 325)                    )  
a71441d3 R/granova.ds.ggplot.R 183 326)           )
863d348b R/granova.ds.ggplot.R 202 327)   }
863d348b R/granova.ds.ggplot.R 203 328) 
794c4b70 R/granova.ds.ggplot.R 202 329)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 330)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 331)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 332)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 333)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 334)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 335)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 336)           )
863d348b R/granova.ds.ggplot.R 213 337)   }
c2605051 R/granova.ds.bd.R     271 338)   
794c4b70 R/granova.ds.ggplot.R 213 339)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 340)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 341)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 342)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 343)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 344)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 345)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 346)           )
aaeade58 R/granova.ds.bd.R     274 347)     
863d348b R/granova.ds.ggplot.R 225 348)   }
863d348b R/granova.ds.ggplot.R 226 349) 
794c4b70 R/granova.ds.ggplot.R 225 350)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 351)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 352)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 353)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 354)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 355)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 356)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 357)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 358)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 359)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 360)                        )  
a71441d3 R/granova.ds.ggplot.R 216 361)           )
863d348b R/granova.ds.ggplot.R 242 362)   }
863d348b R/granova.ds.ggplot.R 243 363) 
794c4b70 R/granova.ds.ggplot.R 242 364)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 365)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 366)                             y     = y,
0d72518f R/granovagg.ds.R      303 367)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 368)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 369)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 370)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 371)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 372)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 373)                        )
a71441d3 R/granova.ds.ggplot.R 229 374)           )
863d348b R/granova.ds.ggplot.R 258 375)   }
863d348b R/granova.ds.ggplot.R 259 376) 
794c4b70 R/granova.ds.ggplot.R 258 377)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 378)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 379)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 380)                          ),
a71441d3 R/granova.ds.ggplot.R 236 381)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 382)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 383)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 384)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 385)                      )
a71441d3 R/granova.ds.ggplot.R 240 386)           )
863d348b R/granova.ds.ggplot.R 272 387)   }
863d348b R/granova.ds.ggplot.R 273 388) 
794c4b70 R/granova.ds.ggplot.R 272 389)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 390)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 391)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 392)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 393)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 394)                            ),
a71441d3 R/granova.ds.ggplot.R 249 395)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 396)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 397)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 398)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 399)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 400)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 401)           )
863d348b R/granova.ds.ggplot.R 290 402)   }
863d348b R/granova.ds.ggplot.R 291 403) 
ef841aa1 R/granova.ds.ggplot.R 257 404)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 405)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 406)   
a71441d3 R/granova.ds.ggplot.R 261 407)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 408)   }
863d348b R/granova.ds.ggplot.R 297 409) 
0afa3a38 R/granovagg.ds.R      306 410)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 411)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 412)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 413)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 414)     }
0afa3a38 R/granovagg.ds.R      311 415)     
0afa3a38 R/granovagg.ds.R      312 416)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 417)   }
0afa3a38 R/granovagg.ds.R      314 418)   
485d5f02 R/granovagg.ds.R      317 419)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 420)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 421)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 422)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 423)     }
485d5f02 R/granovagg.ds.R      322 424)     
485d5f02 R/granovagg.ds.R      323 425)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 426)   }
485d5f02 R/granovagg.ds.R      325 427)   
794c4b70 R/granova.ds.ggplot.R 296 428)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 429)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 430)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 431)     }
a2b6fe7d R/granovagg.ds.R      320 432)     
a2b6fe7d R/granovagg.ds.R      321 433)     else {
a2b6fe7d R/granovagg.ds.R      322 434)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 435)     }
863d348b R/granova.ds.ggplot.R 304 436)   }
b5b60529 R/granova.ds.ggplot.R 270 437)   
b5b60529 R/granova.ds.ggplot.R 271 438)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 439)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 440)   }
b5b60529 R/granova.ds.ggplot.R 274 441)   
3b102930 R/granova.ds.ggplot.R 275 442)           
3eb0e1f7 R/granova.ds.ggplot.R 304 443)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 444)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 445)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 446)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 447)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 448)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 449)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 450)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 451)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 452)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 453)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 454)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 455)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 456)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 457)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 458)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 459)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 460) 
a71441d3 R/granova.ds.ggplot.R 288 461)   return(p)
5d58b37c R/granova.ds.bd.R     314 462) 
b3a74c98 R/granova.ds.bd.R     301 463) }
</pre>
<div class="compileroutput">
Add basic PrintSummary() function to granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="c663469"></a>
c663469 2011-10-01 20:26:53 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
<span class="changed">c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])</span>
<span class="changed">c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])</span>
5e0fcbf9 R/granovagg.ds.R      252 254)     
<span class="changed">c6634692 R/granovagg.ds.R      255 255)     output &lt;- matrix(c(n, mean.1, mean.2), ncol = 1)</span>
<span class="changed">c6634692 R/granovagg.ds.R      256 256)     dimnames(output) &lt;- list(</span>
<span class="changed">c6634692 R/granovagg.ds.R      257 257)       c("n", </span>
<span class="changed">c6634692 R/granovagg.ds.R      258 258)         paste(colnames(dsp$data)[1], "mean"), </span>
<span class="changed">c6634692 R/granovagg.ds.R      259 259)         paste(colnames(dsp$data)[2], "mean")</span>
<span class="changed">c6634692 R/granovagg.ds.R      260 260)       ), "Summary Statistics")</span>
5e0fcbf9 R/granovagg.ds.R      254 261)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 262)   }
863d348b R/granova.ds.ggplot.R 126 263) 
f855a782 R/granovagg.ds.R      229 264)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 265)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 266)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 267)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 268)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 269)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 270)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 271)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 272)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 273)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 274)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 275)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 276)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 277)     
c2605051 R/granova.ds.bd.R     256 278)   
863d348b R/granova.ds.ggplot.R 139 279) 
863d348b R/granova.ds.ggplot.R 140 280)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 281)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 282) 
863d348b R/granova.ds.ggplot.R 143 283)   
3eb0e1f7 R/granova.ds.ggplot.R 142 284)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 285)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 286)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 287)                             ),
a71441d3 R/granova.ds.ggplot.R 140 288)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 289)                  )
863d348b R/granova.ds.ggplot.R 151 290)           )
863d348b R/granova.ds.ggplot.R 152 291)   }
e60e59e1 R/granova.ds.bd.R     241 292)     
794c4b70 R/granova.ds.ggplot.R 152 293)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 294)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 295)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 296)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 297)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 298)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 299)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 300)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 301)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 302)                       )
a71441d3 R/granova.ds.ggplot.R 154 303)           )
863d348b R/granova.ds.ggplot.R 166 304)   }
863d348b R/granova.ds.ggplot.R 167 305) 
794c4b70 R/granova.ds.ggplot.R 166 306)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 307)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 308)   }
863d348b R/granova.ds.ggplot.R 174 309) 
3eb0e1f7 R/granova.ds.ggplot.R 173 310)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 311)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 312)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 313)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 314)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 315)                       )
a71441d3 R/granova.ds.ggplot.R 166 316)           )
863d348b R/granova.ds.ggplot.R 183 317)   }
863d348b R/granova.ds.ggplot.R 184 318) 
794c4b70 R/granova.ds.ggplot.R 183 319)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 320)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 321)   }
863d348b R/granova.ds.ggplot.R 188 322) 
794c4b70 R/granova.ds.ggplot.R 187 323)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 324)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 325)   }
863d348b R/granova.ds.ggplot.R 192 326) 
794c4b70 R/granova.ds.ggplot.R 191 327)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 328)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 329)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 330)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 331)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 332)                    )  
a71441d3 R/granova.ds.ggplot.R 183 333)           )
863d348b R/granova.ds.ggplot.R 202 334)   }
863d348b R/granova.ds.ggplot.R 203 335) 
794c4b70 R/granova.ds.ggplot.R 202 336)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 337)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 338)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 339)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 340)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 341)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 342)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 343)           )
863d348b R/granova.ds.ggplot.R 213 344)   }
c2605051 R/granova.ds.bd.R     271 345)   
794c4b70 R/granova.ds.ggplot.R 213 346)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 347)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 348)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 349)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 350)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 351)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 352)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 353)           )
aaeade58 R/granova.ds.bd.R     274 354)     
863d348b R/granova.ds.ggplot.R 225 355)   }
863d348b R/granova.ds.ggplot.R 226 356) 
794c4b70 R/granova.ds.ggplot.R 225 357)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 358)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 359)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 360)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 361)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 362)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 363)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 364)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 365)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 366)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 367)                        )  
a71441d3 R/granova.ds.ggplot.R 216 368)           )
863d348b R/granova.ds.ggplot.R 242 369)   }
863d348b R/granova.ds.ggplot.R 243 370) 
794c4b70 R/granova.ds.ggplot.R 242 371)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 372)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 373)                             y     = y,
0d72518f R/granovagg.ds.R      303 374)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 375)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 376)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 377)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 378)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 379)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 380)                        )
a71441d3 R/granova.ds.ggplot.R 229 381)           )
863d348b R/granova.ds.ggplot.R 258 382)   }
863d348b R/granova.ds.ggplot.R 259 383) 
794c4b70 R/granova.ds.ggplot.R 258 384)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 385)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 386)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 387)                          ),
a71441d3 R/granova.ds.ggplot.R 236 388)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 389)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 390)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 391)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 392)                      )
a71441d3 R/granova.ds.ggplot.R 240 393)           )
863d348b R/granova.ds.ggplot.R 272 394)   }
863d348b R/granova.ds.ggplot.R 273 395) 
794c4b70 R/granova.ds.ggplot.R 272 396)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 397)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 398)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 399)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 400)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 401)                            ),
a71441d3 R/granova.ds.ggplot.R 249 402)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 403)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 404)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 405)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 406)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 407)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 408)           )
863d348b R/granova.ds.ggplot.R 290 409)   }
863d348b R/granova.ds.ggplot.R 291 410) 
ef841aa1 R/granova.ds.ggplot.R 257 411)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 412)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 413)   
a71441d3 R/granova.ds.ggplot.R 261 414)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 415)   }
863d348b R/granova.ds.ggplot.R 297 416) 
0afa3a38 R/granovagg.ds.R      306 417)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 418)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 419)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 420)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 421)     }
0afa3a38 R/granovagg.ds.R      311 422)     
0afa3a38 R/granovagg.ds.R      312 423)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 424)   }
0afa3a38 R/granovagg.ds.R      314 425)   
485d5f02 R/granovagg.ds.R      317 426)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 427)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 428)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 429)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 430)     }
485d5f02 R/granovagg.ds.R      322 431)     
485d5f02 R/granovagg.ds.R      323 432)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 433)   }
485d5f02 R/granovagg.ds.R      325 434)   
794c4b70 R/granova.ds.ggplot.R 296 435)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 436)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 437)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 438)     }
a2b6fe7d R/granovagg.ds.R      320 439)     
a2b6fe7d R/granovagg.ds.R      321 440)     else {
a2b6fe7d R/granovagg.ds.R      322 441)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 442)     }
863d348b R/granova.ds.ggplot.R 304 443)   }
b5b60529 R/granova.ds.ggplot.R 270 444)   
b5b60529 R/granova.ds.ggplot.R 271 445)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 446)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 447)   }
b5b60529 R/granova.ds.ggplot.R 274 448)   
3b102930 R/granova.ds.ggplot.R 275 449)           
3eb0e1f7 R/granova.ds.ggplot.R 304 450)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 451)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 452)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 453)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 454)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 455)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 456)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 457)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 458)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 459)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 460)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 461)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 462)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 463)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 464)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 465)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 466)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 467) 
<span class="changed">c6634692 R/granovagg.ds.R      468 468)   return(dsp)</span>
5d58b37c R/granova.ds.bd.R     314 469) 
b3a74c98 R/granova.ds.bd.R     301 470) }
</pre>
<div class="compileroutput">
Add group means to printed summary output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="06ce662"></a>
06ce662 2011-10-01 20:38:38 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
<span class="changed">06ce662a R/granovagg.ds.R      254 254)     mean.d &lt;- mean.2 - mean.1</span>
5e0fcbf9 R/granovagg.ds.R      252 255)     
<span class="changed">06ce662a R/granovagg.ds.R      256 256)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 257)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 258)       c("n", 
c6634692 R/granovagg.ds.R      258 259)         paste(colnames(dsp$data)[1], "mean"), 
<span class="changed">06ce662a R/granovagg.ds.R      260 260)         paste(colnames(dsp$data)[2], "mean"),</span>
<span class="changed">06ce662a R/granovagg.ds.R      261 261)         paste("mean difference (", colnames(dsp$data)[2], " - ", colnames(dsp$data)[1], ")",  sep = "")</span>
c6634692 R/granovagg.ds.R      260 262)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 263)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 264)   }
863d348b R/granova.ds.ggplot.R 126 265) 
f855a782 R/granovagg.ds.R      229 266)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 267)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 268)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 269)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 270)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 271)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 272)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 273)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 274)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 275)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 276)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 277)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 278)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 279)     
c2605051 R/granova.ds.bd.R     256 280)   
863d348b R/granova.ds.ggplot.R 139 281) 
863d348b R/granova.ds.ggplot.R 140 282)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 283)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 284) 
863d348b R/granova.ds.ggplot.R 143 285)   
3eb0e1f7 R/granova.ds.ggplot.R 142 286)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 287)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 288)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 289)                             ),
a71441d3 R/granova.ds.ggplot.R 140 290)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 291)                  )
863d348b R/granova.ds.ggplot.R 151 292)           )
863d348b R/granova.ds.ggplot.R 152 293)   }
e60e59e1 R/granova.ds.bd.R     241 294)     
794c4b70 R/granova.ds.ggplot.R 152 295)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 296)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 297)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 298)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 299)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 300)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 301)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 302)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 303)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 304)                       )
a71441d3 R/granova.ds.ggplot.R 154 305)           )
863d348b R/granova.ds.ggplot.R 166 306)   }
863d348b R/granova.ds.ggplot.R 167 307) 
794c4b70 R/granova.ds.ggplot.R 166 308)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 309)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 310)   }
863d348b R/granova.ds.ggplot.R 174 311) 
3eb0e1f7 R/granova.ds.ggplot.R 173 312)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 313)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 314)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 315)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 316)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 317)                       )
a71441d3 R/granova.ds.ggplot.R 166 318)           )
863d348b R/granova.ds.ggplot.R 183 319)   }
863d348b R/granova.ds.ggplot.R 184 320) 
794c4b70 R/granova.ds.ggplot.R 183 321)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 322)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 323)   }
863d348b R/granova.ds.ggplot.R 188 324) 
794c4b70 R/granova.ds.ggplot.R 187 325)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 326)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 327)   }
863d348b R/granova.ds.ggplot.R 192 328) 
794c4b70 R/granova.ds.ggplot.R 191 329)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 330)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 331)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 332)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 333)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 334)                    )  
a71441d3 R/granova.ds.ggplot.R 183 335)           )
863d348b R/granova.ds.ggplot.R 202 336)   }
863d348b R/granova.ds.ggplot.R 203 337) 
794c4b70 R/granova.ds.ggplot.R 202 338)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 339)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 340)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 341)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 342)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 343)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 344)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 345)           )
863d348b R/granova.ds.ggplot.R 213 346)   }
c2605051 R/granova.ds.bd.R     271 347)   
794c4b70 R/granova.ds.ggplot.R 213 348)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 349)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 350)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 351)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 352)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 353)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 354)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 355)           )
aaeade58 R/granova.ds.bd.R     274 356)     
863d348b R/granova.ds.ggplot.R 225 357)   }
863d348b R/granova.ds.ggplot.R 226 358) 
794c4b70 R/granova.ds.ggplot.R 225 359)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 360)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 361)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 362)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 363)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 364)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 365)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 366)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 367)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 368)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 369)                        )  
a71441d3 R/granova.ds.ggplot.R 216 370)           )
863d348b R/granova.ds.ggplot.R 242 371)   }
863d348b R/granova.ds.ggplot.R 243 372) 
794c4b70 R/granova.ds.ggplot.R 242 373)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 374)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 375)                             y     = y,
0d72518f R/granovagg.ds.R      303 376)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 377)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 378)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 379)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 380)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 381)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 382)                        )
a71441d3 R/granova.ds.ggplot.R 229 383)           )
863d348b R/granova.ds.ggplot.R 258 384)   }
863d348b R/granova.ds.ggplot.R 259 385) 
794c4b70 R/granova.ds.ggplot.R 258 386)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 387)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 388)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 389)                          ),
a71441d3 R/granova.ds.ggplot.R 236 390)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 391)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 392)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 393)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 394)                      )
a71441d3 R/granova.ds.ggplot.R 240 395)           )
863d348b R/granova.ds.ggplot.R 272 396)   }
863d348b R/granova.ds.ggplot.R 273 397) 
794c4b70 R/granova.ds.ggplot.R 272 398)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 399)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 400)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 401)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 402)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 403)                            ),
a71441d3 R/granova.ds.ggplot.R 249 404)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 405)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 406)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 407)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 408)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 409)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 410)           )
863d348b R/granova.ds.ggplot.R 290 411)   }
863d348b R/granova.ds.ggplot.R 291 412) 
ef841aa1 R/granova.ds.ggplot.R 257 413)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 414)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 415)   
a71441d3 R/granova.ds.ggplot.R 261 416)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 417)   }
863d348b R/granova.ds.ggplot.R 297 418) 
0afa3a38 R/granovagg.ds.R      306 419)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 420)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 421)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 422)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 423)     }
0afa3a38 R/granovagg.ds.R      311 424)     
0afa3a38 R/granovagg.ds.R      312 425)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 426)   }
0afa3a38 R/granovagg.ds.R      314 427)   
485d5f02 R/granovagg.ds.R      317 428)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 429)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 430)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 431)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 432)     }
485d5f02 R/granovagg.ds.R      322 433)     
485d5f02 R/granovagg.ds.R      323 434)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 435)   }
485d5f02 R/granovagg.ds.R      325 436)   
794c4b70 R/granova.ds.ggplot.R 296 437)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 438)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 439)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 440)     }
a2b6fe7d R/granovagg.ds.R      320 441)     
a2b6fe7d R/granovagg.ds.R      321 442)     else {
a2b6fe7d R/granovagg.ds.R      322 443)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 444)     }
863d348b R/granova.ds.ggplot.R 304 445)   }
b5b60529 R/granova.ds.ggplot.R 270 446)   
b5b60529 R/granova.ds.ggplot.R 271 447)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 448)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 449)   }
b5b60529 R/granova.ds.ggplot.R 274 450)   
3b102930 R/granova.ds.ggplot.R 275 451)           
3eb0e1f7 R/granova.ds.ggplot.R 304 452)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 453)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 454)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 455)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 456)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 457)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 458)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 459)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 460)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 461)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 462)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 463)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 464)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 465)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 466)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 467)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 468)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 469) 
c6634692 R/granovagg.ds.R      468 470)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 471) 
b3a74c98 R/granova.ds.bd.R     301 472) }
</pre>
<div class="compileroutput">
Add printed output for mean difference in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="172aab9"></a>
172aab9 2011-10-01 20:41:32 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
06ce662a R/granovagg.ds.R      254 254)     mean.d &lt;- mean.2 - mean.1
<span class="changed">172aab9d R/granovagg.ds.R      255 255)     sd.d &lt;- sd(dsp$data[, 2] - dsp$data[, 1])</span>
5e0fcbf9 R/granovagg.ds.R      252 256)     
<span class="changed">172aab9d R/granovagg.ds.R      257 257)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, sd.d), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 258)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 259)       c("n", 
c6634692 R/granovagg.ds.R      258 260)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 261)         paste(colnames(dsp$data)[2], "mean"),
<span class="changed">172aab9d R/granovagg.ds.R      262 262)         paste("mean(D = ", colnames(dsp$data)[2], " - ", colnames(dsp$data)[1], ")",  sep = ""),</span>
<span class="changed">172aab9d R/granovagg.ds.R      263 263)         paste("SD(D)")</span>
c6634692 R/granovagg.ds.R      260 264)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 265)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 266)   }
863d348b R/granova.ds.ggplot.R 126 267) 
f855a782 R/granovagg.ds.R      229 268)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 269)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 270)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 271)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 272)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 273)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 274)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 275)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 276)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 277)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 278)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 279)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 280)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 281)     
c2605051 R/granova.ds.bd.R     256 282)   
863d348b R/granova.ds.ggplot.R 139 283) 
863d348b R/granova.ds.ggplot.R 140 284)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 285)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 286) 
863d348b R/granova.ds.ggplot.R 143 287)   
3eb0e1f7 R/granova.ds.ggplot.R 142 288)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 289)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 290)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 291)                             ),
a71441d3 R/granova.ds.ggplot.R 140 292)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 293)                  )
863d348b R/granova.ds.ggplot.R 151 294)           )
863d348b R/granova.ds.ggplot.R 152 295)   }
e60e59e1 R/granova.ds.bd.R     241 296)     
794c4b70 R/granova.ds.ggplot.R 152 297)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 298)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 299)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 300)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 301)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 302)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 303)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 304)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 305)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 306)                       )
a71441d3 R/granova.ds.ggplot.R 154 307)           )
863d348b R/granova.ds.ggplot.R 166 308)   }
863d348b R/granova.ds.ggplot.R 167 309) 
794c4b70 R/granova.ds.ggplot.R 166 310)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 311)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 312)   }
863d348b R/granova.ds.ggplot.R 174 313) 
3eb0e1f7 R/granova.ds.ggplot.R 173 314)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 315)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 316)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 317)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 318)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 319)                       )
a71441d3 R/granova.ds.ggplot.R 166 320)           )
863d348b R/granova.ds.ggplot.R 183 321)   }
863d348b R/granova.ds.ggplot.R 184 322) 
794c4b70 R/granova.ds.ggplot.R 183 323)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 324)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 325)   }
863d348b R/granova.ds.ggplot.R 188 326) 
794c4b70 R/granova.ds.ggplot.R 187 327)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 328)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 329)   }
863d348b R/granova.ds.ggplot.R 192 330) 
794c4b70 R/granova.ds.ggplot.R 191 331)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 332)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 333)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 334)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 335)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 336)                    )  
a71441d3 R/granova.ds.ggplot.R 183 337)           )
863d348b R/granova.ds.ggplot.R 202 338)   }
863d348b R/granova.ds.ggplot.R 203 339) 
794c4b70 R/granova.ds.ggplot.R 202 340)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 341)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 342)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 343)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 344)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 345)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 346)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 347)           )
863d348b R/granova.ds.ggplot.R 213 348)   }
c2605051 R/granova.ds.bd.R     271 349)   
794c4b70 R/granova.ds.ggplot.R 213 350)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 351)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 352)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 353)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 354)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 355)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 356)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 357)           )
aaeade58 R/granova.ds.bd.R     274 358)     
863d348b R/granova.ds.ggplot.R 225 359)   }
863d348b R/granova.ds.ggplot.R 226 360) 
794c4b70 R/granova.ds.ggplot.R 225 361)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 362)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 363)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 364)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 365)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 366)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 367)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 368)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 369)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 370)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 371)                        )  
a71441d3 R/granova.ds.ggplot.R 216 372)           )
863d348b R/granova.ds.ggplot.R 242 373)   }
863d348b R/granova.ds.ggplot.R 243 374) 
794c4b70 R/granova.ds.ggplot.R 242 375)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 376)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 377)                             y     = y,
0d72518f R/granovagg.ds.R      303 378)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 379)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 380)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 381)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 382)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 383)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 384)                        )
a71441d3 R/granova.ds.ggplot.R 229 385)           )
863d348b R/granova.ds.ggplot.R 258 386)   }
863d348b R/granova.ds.ggplot.R 259 387) 
794c4b70 R/granova.ds.ggplot.R 258 388)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 389)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 390)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 391)                          ),
a71441d3 R/granova.ds.ggplot.R 236 392)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 393)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 394)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 395)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 396)                      )
a71441d3 R/granova.ds.ggplot.R 240 397)           )
863d348b R/granova.ds.ggplot.R 272 398)   }
863d348b R/granova.ds.ggplot.R 273 399) 
794c4b70 R/granova.ds.ggplot.R 272 400)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 401)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 402)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 403)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 404)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 405)                            ),
a71441d3 R/granova.ds.ggplot.R 249 406)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 407)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 408)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 409)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 410)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 411)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 412)           )
863d348b R/granova.ds.ggplot.R 290 413)   }
863d348b R/granova.ds.ggplot.R 291 414) 
ef841aa1 R/granova.ds.ggplot.R 257 415)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 416)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 417)   
a71441d3 R/granova.ds.ggplot.R 261 418)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 419)   }
863d348b R/granova.ds.ggplot.R 297 420) 
0afa3a38 R/granovagg.ds.R      306 421)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 422)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 423)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 424)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 425)     }
0afa3a38 R/granovagg.ds.R      311 426)     
0afa3a38 R/granovagg.ds.R      312 427)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 428)   }
0afa3a38 R/granovagg.ds.R      314 429)   
485d5f02 R/granovagg.ds.R      317 430)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 431)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 432)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 433)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 434)     }
485d5f02 R/granovagg.ds.R      322 435)     
485d5f02 R/granovagg.ds.R      323 436)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 437)   }
485d5f02 R/granovagg.ds.R      325 438)   
794c4b70 R/granova.ds.ggplot.R 296 439)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 440)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 441)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 442)     }
a2b6fe7d R/granovagg.ds.R      320 443)     
a2b6fe7d R/granovagg.ds.R      321 444)     else {
a2b6fe7d R/granovagg.ds.R      322 445)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 446)     }
863d348b R/granova.ds.ggplot.R 304 447)   }
b5b60529 R/granova.ds.ggplot.R 270 448)   
b5b60529 R/granova.ds.ggplot.R 271 449)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 450)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 451)   }
b5b60529 R/granova.ds.ggplot.R 274 452)   
3b102930 R/granova.ds.ggplot.R 275 453)           
3eb0e1f7 R/granova.ds.ggplot.R 304 454)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 455)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 456)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 457)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 458)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 459)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 460)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 461)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 462)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 463)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 464)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 465)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 466)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 467)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 468)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 469)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 470)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 471) 
c6634692 R/granovagg.ds.R      468 472)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 473) 
b3a74c98 R/granova.ds.bd.R     301 474) }
</pre>
<div class="compileroutput">
Add standard deviation of differences to printed summary output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="4859323"></a>
4859323 2011-10-01 20:44:17 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
06ce662a R/granovagg.ds.R      254 254)     mean.d &lt;- mean.2 - mean.1
<span class="changed">48593231 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 2] - dsp$data[, 1])</span>
<span class="changed">48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)</span>
5e0fcbf9 R/granovagg.ds.R      252 257)     
<span class="changed">48593231 R/granovagg.ds.R      258 258)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 259)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 260)       c("n", 
c6634692 R/granovagg.ds.R      258 261)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 262)         paste(colnames(dsp$data)[2], "mean"),
172aab9d R/granovagg.ds.R      262 263)         paste("mean(D = ", colnames(dsp$data)[2], " - ", colnames(dsp$data)[1], ")",  sep = ""),
<span class="changed">48593231 R/granovagg.ds.R      264 264)         paste("SD(D)"),</span>
<span class="changed">48593231 R/granovagg.ds.R      265 265)         paste("Effect Size")</span>
c6634692 R/granovagg.ds.R      260 266)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 267)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 268)   }
863d348b R/granova.ds.ggplot.R 126 269) 
f855a782 R/granovagg.ds.R      229 270)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 271)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 272)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 273)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 274)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 275)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 276)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 277)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 278)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 279)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 280)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 281)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 282)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 283)     
c2605051 R/granova.ds.bd.R     256 284)   
863d348b R/granova.ds.ggplot.R 139 285) 
863d348b R/granova.ds.ggplot.R 140 286)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 287)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 288) 
863d348b R/granova.ds.ggplot.R 143 289)   
3eb0e1f7 R/granova.ds.ggplot.R 142 290)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 291)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 292)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 293)                             ),
a71441d3 R/granova.ds.ggplot.R 140 294)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 295)                  )
863d348b R/granova.ds.ggplot.R 151 296)           )
863d348b R/granova.ds.ggplot.R 152 297)   }
e60e59e1 R/granova.ds.bd.R     241 298)     
794c4b70 R/granova.ds.ggplot.R 152 299)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 300)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 301)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 302)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 303)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 304)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 305)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 306)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 307)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 308)                       )
a71441d3 R/granova.ds.ggplot.R 154 309)           )
863d348b R/granova.ds.ggplot.R 166 310)   }
863d348b R/granova.ds.ggplot.R 167 311) 
794c4b70 R/granova.ds.ggplot.R 166 312)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 313)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 314)   }
863d348b R/granova.ds.ggplot.R 174 315) 
3eb0e1f7 R/granova.ds.ggplot.R 173 316)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 317)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 318)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 319)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 320)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 321)                       )
a71441d3 R/granova.ds.ggplot.R 166 322)           )
863d348b R/granova.ds.ggplot.R 183 323)   }
863d348b R/granova.ds.ggplot.R 184 324) 
794c4b70 R/granova.ds.ggplot.R 183 325)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 326)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 327)   }
863d348b R/granova.ds.ggplot.R 188 328) 
794c4b70 R/granova.ds.ggplot.R 187 329)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 330)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 331)   }
863d348b R/granova.ds.ggplot.R 192 332) 
794c4b70 R/granova.ds.ggplot.R 191 333)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 334)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 335)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 336)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 337)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 338)                    )  
a71441d3 R/granova.ds.ggplot.R 183 339)           )
863d348b R/granova.ds.ggplot.R 202 340)   }
863d348b R/granova.ds.ggplot.R 203 341) 
794c4b70 R/granova.ds.ggplot.R 202 342)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 343)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 344)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 345)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 346)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 347)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 348)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 349)           )
863d348b R/granova.ds.ggplot.R 213 350)   }
c2605051 R/granova.ds.bd.R     271 351)   
794c4b70 R/granova.ds.ggplot.R 213 352)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 353)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 354)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 355)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 356)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 357)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 358)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 359)           )
aaeade58 R/granova.ds.bd.R     274 360)     
863d348b R/granova.ds.ggplot.R 225 361)   }
863d348b R/granova.ds.ggplot.R 226 362) 
794c4b70 R/granova.ds.ggplot.R 225 363)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 364)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 365)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 366)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 367)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 368)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 369)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 370)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 371)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 372)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 373)                        )  
a71441d3 R/granova.ds.ggplot.R 216 374)           )
863d348b R/granova.ds.ggplot.R 242 375)   }
863d348b R/granova.ds.ggplot.R 243 376) 
794c4b70 R/granova.ds.ggplot.R 242 377)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 378)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 379)                             y     = y,
0d72518f R/granovagg.ds.R      303 380)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 381)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 382)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 383)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 384)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 385)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 386)                        )
a71441d3 R/granova.ds.ggplot.R 229 387)           )
863d348b R/granova.ds.ggplot.R 258 388)   }
863d348b R/granova.ds.ggplot.R 259 389) 
794c4b70 R/granova.ds.ggplot.R 258 390)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 391)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 392)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 393)                          ),
a71441d3 R/granova.ds.ggplot.R 236 394)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 395)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 396)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 397)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 398)                      )
a71441d3 R/granova.ds.ggplot.R 240 399)           )
863d348b R/granova.ds.ggplot.R 272 400)   }
863d348b R/granova.ds.ggplot.R 273 401) 
794c4b70 R/granova.ds.ggplot.R 272 402)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 403)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 404)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 405)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 406)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 407)                            ),
a71441d3 R/granova.ds.ggplot.R 249 408)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 409)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 410)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 411)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 412)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 413)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 414)           )
863d348b R/granova.ds.ggplot.R 290 415)   }
863d348b R/granova.ds.ggplot.R 291 416) 
ef841aa1 R/granova.ds.ggplot.R 257 417)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 418)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 419)   
a71441d3 R/granova.ds.ggplot.R 261 420)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 421)   }
863d348b R/granova.ds.ggplot.R 297 422) 
0afa3a38 R/granovagg.ds.R      306 423)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 424)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 425)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 426)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 427)     }
0afa3a38 R/granovagg.ds.R      311 428)     
0afa3a38 R/granovagg.ds.R      312 429)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 430)   }
0afa3a38 R/granovagg.ds.R      314 431)   
485d5f02 R/granovagg.ds.R      317 432)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 433)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 434)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 435)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 436)     }
485d5f02 R/granovagg.ds.R      322 437)     
485d5f02 R/granovagg.ds.R      323 438)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 439)   }
485d5f02 R/granovagg.ds.R      325 440)   
794c4b70 R/granova.ds.ggplot.R 296 441)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 442)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 443)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 444)     }
a2b6fe7d R/granovagg.ds.R      320 445)     
a2b6fe7d R/granovagg.ds.R      321 446)     else {
a2b6fe7d R/granovagg.ds.R      322 447)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 448)     }
863d348b R/granova.ds.ggplot.R 304 449)   }
b5b60529 R/granova.ds.ggplot.R 270 450)   
b5b60529 R/granova.ds.ggplot.R 271 451)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 452)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 453)   }
b5b60529 R/granova.ds.ggplot.R 274 454)   
3b102930 R/granova.ds.ggplot.R 275 455)           
3eb0e1f7 R/granova.ds.ggplot.R 304 456)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 457)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 458)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 459)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 460)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 461)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 462)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 463)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 464)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 465)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 466)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 467)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 468)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 469)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 470)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 471)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 472)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 473) 
c6634692 R/granovagg.ds.R      468 474)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 475) 
b3a74c98 R/granova.ds.bd.R     301 476) }
</pre>
<div class="compileroutput">
Add effect size to printed summary output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="eaf5611"></a>
eaf5611 2011-10-01 20:49:07 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
06ce662a R/granovagg.ds.R      254 254)     mean.d &lt;- mean.2 - mean.1
48593231 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 2] - dsp$data[, 1])
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
<span class="changed">eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])</span>
5e0fcbf9 R/granovagg.ds.R      252 258)     
<span class="changed">eaf5611d R/granovagg.ds.R      259 259)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 260)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 261)       c("n", 
c6634692 R/granovagg.ds.R      258 262)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 263)         paste(colnames(dsp$data)[2], "mean"),
172aab9d R/granovagg.ds.R      262 264)         paste("mean(D = ", colnames(dsp$data)[2], " - ", colnames(dsp$data)[1], ")",  sep = ""),
48593231 R/granovagg.ds.R      264 265)         paste("SD(D)"),
<span class="changed">eaf5611d R/granovagg.ds.R      266 266)         paste("Effect Size"),</span>
<span class="changed">eaf5611d R/granovagg.ds.R      267 267)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = "")</span>
c6634692 R/granovagg.ds.R      260 268)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 269)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 270)   }
863d348b R/granova.ds.ggplot.R 126 271) 
f855a782 R/granovagg.ds.R      229 272)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 273)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 274)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 275)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 276)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 277)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 278)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 279)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 280)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 281)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 282)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 283)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 284)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 285)     
c2605051 R/granova.ds.bd.R     256 286)   
863d348b R/granova.ds.ggplot.R 139 287) 
863d348b R/granova.ds.ggplot.R 140 288)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 289)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 290) 
863d348b R/granova.ds.ggplot.R 143 291)   
3eb0e1f7 R/granova.ds.ggplot.R 142 292)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 293)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 294)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 295)                             ),
a71441d3 R/granova.ds.ggplot.R 140 296)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 297)                  )
863d348b R/granova.ds.ggplot.R 151 298)           )
863d348b R/granova.ds.ggplot.R 152 299)   }
e60e59e1 R/granova.ds.bd.R     241 300)     
794c4b70 R/granova.ds.ggplot.R 152 301)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 302)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 303)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 304)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 305)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 306)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 307)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 308)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 309)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 310)                       )
a71441d3 R/granova.ds.ggplot.R 154 311)           )
863d348b R/granova.ds.ggplot.R 166 312)   }
863d348b R/granova.ds.ggplot.R 167 313) 
794c4b70 R/granova.ds.ggplot.R 166 314)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 315)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 316)   }
863d348b R/granova.ds.ggplot.R 174 317) 
3eb0e1f7 R/granova.ds.ggplot.R 173 318)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 319)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 320)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 321)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 322)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 323)                       )
a71441d3 R/granova.ds.ggplot.R 166 324)           )
863d348b R/granova.ds.ggplot.R 183 325)   }
863d348b R/granova.ds.ggplot.R 184 326) 
794c4b70 R/granova.ds.ggplot.R 183 327)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 328)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 329)   }
863d348b R/granova.ds.ggplot.R 188 330) 
794c4b70 R/granova.ds.ggplot.R 187 331)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 332)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 333)   }
863d348b R/granova.ds.ggplot.R 192 334) 
794c4b70 R/granova.ds.ggplot.R 191 335)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 336)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 337)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 338)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 339)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 340)                    )  
a71441d3 R/granova.ds.ggplot.R 183 341)           )
863d348b R/granova.ds.ggplot.R 202 342)   }
863d348b R/granova.ds.ggplot.R 203 343) 
794c4b70 R/granova.ds.ggplot.R 202 344)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 345)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 346)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 347)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 348)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 349)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 350)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 351)           )
863d348b R/granova.ds.ggplot.R 213 352)   }
c2605051 R/granova.ds.bd.R     271 353)   
794c4b70 R/granova.ds.ggplot.R 213 354)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 355)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 356)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 357)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 358)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 359)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 360)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 361)           )
aaeade58 R/granova.ds.bd.R     274 362)     
863d348b R/granova.ds.ggplot.R 225 363)   }
863d348b R/granova.ds.ggplot.R 226 364) 
794c4b70 R/granova.ds.ggplot.R 225 365)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 366)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 367)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 368)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 369)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 370)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 371)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 372)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 373)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 374)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 375)                        )  
a71441d3 R/granova.ds.ggplot.R 216 376)           )
863d348b R/granova.ds.ggplot.R 242 377)   }
863d348b R/granova.ds.ggplot.R 243 378) 
794c4b70 R/granova.ds.ggplot.R 242 379)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 380)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 381)                             y     = y,
0d72518f R/granovagg.ds.R      303 382)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 383)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 384)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 385)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 386)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 387)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 388)                        )
a71441d3 R/granova.ds.ggplot.R 229 389)           )
863d348b R/granova.ds.ggplot.R 258 390)   }
863d348b R/granova.ds.ggplot.R 259 391) 
794c4b70 R/granova.ds.ggplot.R 258 392)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 393)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 394)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 395)                          ),
a71441d3 R/granova.ds.ggplot.R 236 396)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 397)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 398)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 399)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 400)                      )
a71441d3 R/granova.ds.ggplot.R 240 401)           )
863d348b R/granova.ds.ggplot.R 272 402)   }
863d348b R/granova.ds.ggplot.R 273 403) 
794c4b70 R/granova.ds.ggplot.R 272 404)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 405)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 406)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 407)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 408)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 409)                            ),
a71441d3 R/granova.ds.ggplot.R 249 410)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 411)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 412)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 413)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 414)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 415)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 416)           )
863d348b R/granova.ds.ggplot.R 290 417)   }
863d348b R/granova.ds.ggplot.R 291 418) 
ef841aa1 R/granova.ds.ggplot.R 257 419)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 420)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 421)   
a71441d3 R/granova.ds.ggplot.R 261 422)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 423)   }
863d348b R/granova.ds.ggplot.R 297 424) 
0afa3a38 R/granovagg.ds.R      306 425)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 426)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 427)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 428)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 429)     }
0afa3a38 R/granovagg.ds.R      311 430)     
0afa3a38 R/granovagg.ds.R      312 431)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 432)   }
0afa3a38 R/granovagg.ds.R      314 433)   
485d5f02 R/granovagg.ds.R      317 434)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 435)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 436)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 437)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 438)     }
485d5f02 R/granovagg.ds.R      322 439)     
485d5f02 R/granovagg.ds.R      323 440)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 441)   }
485d5f02 R/granovagg.ds.R      325 442)   
794c4b70 R/granova.ds.ggplot.R 296 443)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 444)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 445)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 446)     }
a2b6fe7d R/granovagg.ds.R      320 447)     
a2b6fe7d R/granovagg.ds.R      321 448)     else {
a2b6fe7d R/granovagg.ds.R      322 449)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 450)     }
863d348b R/granova.ds.ggplot.R 304 451)   }
b5b60529 R/granova.ds.ggplot.R 270 452)   
b5b60529 R/granova.ds.ggplot.R 271 453)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 454)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 455)   }
b5b60529 R/granova.ds.ggplot.R 274 456)   
3b102930 R/granova.ds.ggplot.R 275 457)           
3eb0e1f7 R/granova.ds.ggplot.R 304 458)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 459)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 460)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 461)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 462)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 463)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 464)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 465)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 466)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 467)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 468)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 469)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 470)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 471)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 472)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 473)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 474)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 475) 
c6634692 R/granovagg.ds.R      468 476)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 477) 
b3a74c98 R/granova.ds.bd.R     301 478) }
</pre>
<div class="compileroutput">
Add effect size to printed summary output for granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="d7e5851"></a>
d7e5851 2011-10-01 20:51:19 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
<span class="changed">d7e58513 R/granovagg.ds.R      254 254)     mean.d &lt;- mean.1 - mean.2</span>
<span class="changed">d7e58513 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])</span>
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
5e0fcbf9 R/granovagg.ds.R      252 258)     
eaf5611d R/granovagg.ds.R      259 259)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy), ncol = 1)
c6634692 R/granovagg.ds.R      256 260)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 261)       c("n", 
c6634692 R/granovagg.ds.R      258 262)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 263)         paste(colnames(dsp$data)[2], "mean"),
<span class="changed">d7e58513 R/granovagg.ds.R      264 264)         paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),</span>
48593231 R/granovagg.ds.R      264 265)         paste("SD(D)"),
eaf5611d R/granovagg.ds.R      266 266)         paste("Effect Size"),
eaf5611d R/granovagg.ds.R      267 267)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = "")
c6634692 R/granovagg.ds.R      260 268)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 269)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 270)   }
863d348b R/granova.ds.ggplot.R 126 271) 
f855a782 R/granovagg.ds.R      229 272)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 273)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 274)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 275)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 276)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 277)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 278)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 279)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 280)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 281)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 282)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 283)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 284)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 285)     
c2605051 R/granova.ds.bd.R     256 286)   
863d348b R/granova.ds.ggplot.R 139 287) 
863d348b R/granova.ds.ggplot.R 140 288)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 289)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 290) 
863d348b R/granova.ds.ggplot.R 143 291)   
3eb0e1f7 R/granova.ds.ggplot.R 142 292)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 293)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 294)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 295)                             ),
a71441d3 R/granova.ds.ggplot.R 140 296)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 297)                  )
863d348b R/granova.ds.ggplot.R 151 298)           )
863d348b R/granova.ds.ggplot.R 152 299)   }
e60e59e1 R/granova.ds.bd.R     241 300)     
794c4b70 R/granova.ds.ggplot.R 152 301)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 302)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 303)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 304)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 305)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 306)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 307)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 308)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 309)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 310)                       )
a71441d3 R/granova.ds.ggplot.R 154 311)           )
863d348b R/granova.ds.ggplot.R 166 312)   }
863d348b R/granova.ds.ggplot.R 167 313) 
794c4b70 R/granova.ds.ggplot.R 166 314)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 315)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 316)   }
863d348b R/granova.ds.ggplot.R 174 317) 
3eb0e1f7 R/granova.ds.ggplot.R 173 318)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 319)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 320)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 321)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 322)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 323)                       )
a71441d3 R/granova.ds.ggplot.R 166 324)           )
863d348b R/granova.ds.ggplot.R 183 325)   }
863d348b R/granova.ds.ggplot.R 184 326) 
794c4b70 R/granova.ds.ggplot.R 183 327)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 328)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 329)   }
863d348b R/granova.ds.ggplot.R 188 330) 
794c4b70 R/granova.ds.ggplot.R 187 331)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 332)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 333)   }
863d348b R/granova.ds.ggplot.R 192 334) 
794c4b70 R/granova.ds.ggplot.R 191 335)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 336)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 337)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 338)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 339)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 340)                    )  
a71441d3 R/granova.ds.ggplot.R 183 341)           )
863d348b R/granova.ds.ggplot.R 202 342)   }
863d348b R/granova.ds.ggplot.R 203 343) 
794c4b70 R/granova.ds.ggplot.R 202 344)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 345)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 346)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 347)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 348)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 349)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 350)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 351)           )
863d348b R/granova.ds.ggplot.R 213 352)   }
c2605051 R/granova.ds.bd.R     271 353)   
794c4b70 R/granova.ds.ggplot.R 213 354)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 355)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 356)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 357)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 358)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 359)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 360)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 361)           )
aaeade58 R/granova.ds.bd.R     274 362)     
863d348b R/granova.ds.ggplot.R 225 363)   }
863d348b R/granova.ds.ggplot.R 226 364) 
794c4b70 R/granova.ds.ggplot.R 225 365)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 366)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 367)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 368)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 369)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 370)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 371)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 372)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 373)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 374)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 375)                        )  
a71441d3 R/granova.ds.ggplot.R 216 376)           )
863d348b R/granova.ds.ggplot.R 242 377)   }
863d348b R/granova.ds.ggplot.R 243 378) 
794c4b70 R/granova.ds.ggplot.R 242 379)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 380)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 381)                             y     = y,
0d72518f R/granovagg.ds.R      303 382)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 383)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 384)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 385)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 386)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 387)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 388)                        )
a71441d3 R/granova.ds.ggplot.R 229 389)           )
863d348b R/granova.ds.ggplot.R 258 390)   }
863d348b R/granova.ds.ggplot.R 259 391) 
794c4b70 R/granova.ds.ggplot.R 258 392)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 393)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 394)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 395)                          ),
a71441d3 R/granova.ds.ggplot.R 236 396)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 397)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 398)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 399)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 400)                      )
a71441d3 R/granova.ds.ggplot.R 240 401)           )
863d348b R/granova.ds.ggplot.R 272 402)   }
863d348b R/granova.ds.ggplot.R 273 403) 
794c4b70 R/granova.ds.ggplot.R 272 404)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 405)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 406)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 407)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 408)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 409)                            ),
a71441d3 R/granova.ds.ggplot.R 249 410)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 411)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 412)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 413)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 414)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 415)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 416)           )
863d348b R/granova.ds.ggplot.R 290 417)   }
863d348b R/granova.ds.ggplot.R 291 418) 
ef841aa1 R/granova.ds.ggplot.R 257 419)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 420)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 421)   
a71441d3 R/granova.ds.ggplot.R 261 422)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 423)   }
863d348b R/granova.ds.ggplot.R 297 424) 
0afa3a38 R/granovagg.ds.R      306 425)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 426)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 427)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 428)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 429)     }
0afa3a38 R/granovagg.ds.R      311 430)     
0afa3a38 R/granovagg.ds.R      312 431)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 432)   }
0afa3a38 R/granovagg.ds.R      314 433)   
485d5f02 R/granovagg.ds.R      317 434)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 435)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 436)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 437)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 438)     }
485d5f02 R/granovagg.ds.R      322 439)     
485d5f02 R/granovagg.ds.R      323 440)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 441)   }
485d5f02 R/granovagg.ds.R      325 442)   
794c4b70 R/granova.ds.ggplot.R 296 443)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 444)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 445)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 446)     }
a2b6fe7d R/granovagg.ds.R      320 447)     
a2b6fe7d R/granovagg.ds.R      321 448)     else {
a2b6fe7d R/granovagg.ds.R      322 449)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 450)     }
863d348b R/granova.ds.ggplot.R 304 451)   }
b5b60529 R/granova.ds.ggplot.R 270 452)   
b5b60529 R/granova.ds.ggplot.R 271 453)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 454)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 455)   }
b5b60529 R/granova.ds.ggplot.R 274 456)   
3b102930 R/granova.ds.ggplot.R 275 457)           
3eb0e1f7 R/granova.ds.ggplot.R 304 458)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 459)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 460)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 461)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 462)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 463)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 464)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 465)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 466)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 467)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 468)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 469)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 470)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 471)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 472)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 473)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 474)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 475) 
c6634692 R/granovagg.ds.R      468 476)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 477) 
b3a74c98 R/granova.ds.bd.R     301 478) }
</pre>
<div class="compileroutput">
reverse subtraction order for mean difference printed output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="129861a"></a>
129861a 2011-10-01 20:54:48 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 254)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
<span class="changed">129861a6 R/granovagg.ds.R      258 258)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))</span>
5e0fcbf9 R/granovagg.ds.R      252 259)     
<span class="changed">129861a6 R/granovagg.ds.R      260 260)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy, r.x.plus.y.d), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 261)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 262)       c("n", 
c6634692 R/granovagg.ds.R      258 263)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 264)         paste(colnames(dsp$data)[2], "mean"),
d7e58513 R/granovagg.ds.R      264 265)         paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
48593231 R/granovagg.ds.R      264 266)         paste("SD(D)"),
eaf5611d R/granovagg.ds.R      266 267)         paste("Effect Size"),
<span class="changed">129861a6 R/granovagg.ds.R      268 268)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),</span>
<span class="changed">129861a6 R/granovagg.ds.R      269 269)         paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = "")</span>
c6634692 R/granovagg.ds.R      260 270)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 271)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 272)   }
863d348b R/granova.ds.ggplot.R 126 273) 
f855a782 R/granovagg.ds.R      229 274)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 275)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 276)   dsp$stats          &lt;- GetStats(dsp, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 277)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 278)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 279)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 280)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 281)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 282)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 283)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 284)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 285)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 286)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 287)     
c2605051 R/granova.ds.bd.R     256 288)   
863d348b R/granova.ds.ggplot.R 139 289) 
863d348b R/granova.ds.ggplot.R 140 290)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 291)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 292) 
863d348b R/granova.ds.ggplot.R 143 293)   
3eb0e1f7 R/granova.ds.ggplot.R 142 294)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 295)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 296)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 297)                             ),
a71441d3 R/granova.ds.ggplot.R 140 298)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 299)                  )
863d348b R/granova.ds.ggplot.R 151 300)           )
863d348b R/granova.ds.ggplot.R 152 301)   }
e60e59e1 R/granova.ds.bd.R     241 302)     
794c4b70 R/granova.ds.ggplot.R 152 303)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 304)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 305)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 306)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 307)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 308)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 309)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 310)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 311)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 312)                       )
a71441d3 R/granova.ds.ggplot.R 154 313)           )
863d348b R/granova.ds.ggplot.R 166 314)   }
863d348b R/granova.ds.ggplot.R 167 315) 
794c4b70 R/granova.ds.ggplot.R 166 316)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 317)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 318)   }
863d348b R/granova.ds.ggplot.R 174 319) 
3eb0e1f7 R/granova.ds.ggplot.R 173 320)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 321)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 322)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 323)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 324)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 325)                       )
a71441d3 R/granova.ds.ggplot.R 166 326)           )
863d348b R/granova.ds.ggplot.R 183 327)   }
863d348b R/granova.ds.ggplot.R 184 328) 
794c4b70 R/granova.ds.ggplot.R 183 329)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 330)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 331)   }
863d348b R/granova.ds.ggplot.R 188 332) 
794c4b70 R/granova.ds.ggplot.R 187 333)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 334)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 335)   }
863d348b R/granova.ds.ggplot.R 192 336) 
794c4b70 R/granova.ds.ggplot.R 191 337)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 338)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 339)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 340)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 341)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 342)                    )  
a71441d3 R/granova.ds.ggplot.R 183 343)           )
863d348b R/granova.ds.ggplot.R 202 344)   }
863d348b R/granova.ds.ggplot.R 203 345) 
794c4b70 R/granova.ds.ggplot.R 202 346)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 347)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 348)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 349)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 350)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 351)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 352)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 353)           )
863d348b R/granova.ds.ggplot.R 213 354)   }
c2605051 R/granova.ds.bd.R     271 355)   
794c4b70 R/granova.ds.ggplot.R 213 356)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 357)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 358)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 359)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 360)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 361)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 362)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 363)           )
aaeade58 R/granova.ds.bd.R     274 364)     
863d348b R/granova.ds.ggplot.R 225 365)   }
863d348b R/granova.ds.ggplot.R 226 366) 
794c4b70 R/granova.ds.ggplot.R 225 367)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 368)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 369)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 370)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 371)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 372)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 373)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 374)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 375)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 376)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 377)                        )  
a71441d3 R/granova.ds.ggplot.R 216 378)           )
863d348b R/granova.ds.ggplot.R 242 379)   }
863d348b R/granova.ds.ggplot.R 243 380) 
794c4b70 R/granova.ds.ggplot.R 242 381)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 382)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 383)                             y     = y,
0d72518f R/granovagg.ds.R      303 384)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 385)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 386)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 387)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 388)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 389)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 390)                        )
a71441d3 R/granova.ds.ggplot.R 229 391)           )
863d348b R/granova.ds.ggplot.R 258 392)   }
863d348b R/granova.ds.ggplot.R 259 393) 
794c4b70 R/granova.ds.ggplot.R 258 394)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 395)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 396)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 397)                          ),
a71441d3 R/granova.ds.ggplot.R 236 398)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 399)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 400)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 401)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 402)                      )
a71441d3 R/granova.ds.ggplot.R 240 403)           )
863d348b R/granova.ds.ggplot.R 272 404)   }
863d348b R/granova.ds.ggplot.R 273 405) 
794c4b70 R/granova.ds.ggplot.R 272 406)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 407)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 408)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 409)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 410)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 411)                            ),
a71441d3 R/granova.ds.ggplot.R 249 412)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 413)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 414)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 415)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 416)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 417)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 418)           )
863d348b R/granova.ds.ggplot.R 290 419)   }
863d348b R/granova.ds.ggplot.R 291 420) 
ef841aa1 R/granova.ds.ggplot.R 257 421)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 422)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 423)   
a71441d3 R/granova.ds.ggplot.R 261 424)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 425)   }
863d348b R/granova.ds.ggplot.R 297 426) 
0afa3a38 R/granovagg.ds.R      306 427)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 428)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 429)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 430)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 431)     }
0afa3a38 R/granovagg.ds.R      311 432)     
0afa3a38 R/granovagg.ds.R      312 433)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 434)   }
0afa3a38 R/granovagg.ds.R      314 435)   
485d5f02 R/granovagg.ds.R      317 436)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 437)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 438)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 439)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 440)     }
485d5f02 R/granovagg.ds.R      322 441)     
485d5f02 R/granovagg.ds.R      323 442)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 443)   }
485d5f02 R/granovagg.ds.R      325 444)   
794c4b70 R/granova.ds.ggplot.R 296 445)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 446)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 447)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 448)     }
a2b6fe7d R/granovagg.ds.R      320 449)     
a2b6fe7d R/granovagg.ds.R      321 450)     else {
a2b6fe7d R/granovagg.ds.R      322 451)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 452)     }
863d348b R/granova.ds.ggplot.R 304 453)   }
b5b60529 R/granova.ds.ggplot.R 270 454)   
b5b60529 R/granova.ds.ggplot.R 271 455)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 456)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 457)   }
b5b60529 R/granova.ds.ggplot.R 274 458)   
3b102930 R/granova.ds.ggplot.R 275 459)           
3eb0e1f7 R/granova.ds.ggplot.R 304 460)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 461)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 462)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 463)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 464)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 465)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 466)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 467)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 468)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 469)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 470)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 471)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 472)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 473)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 474)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 475)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 476)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 477) 
c6634692 R/granovagg.ds.R      468 478)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 479) 
b3a74c98 R/granova.ds.bd.R     301 480) }
</pre>
<div class="compileroutput">
Add r(x + y, d) to printed output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="b36b624"></a>
b36b624 2011-10-01 21:42:10 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 254)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 258)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
<span class="changed">b36b6241 R/granovagg.ds.R      259 259)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect</span>
5e0fcbf9 R/granovagg.ds.R      252 260)     
<span class="changed">b36b6241 R/granovagg.ds.R      261 261)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy, r.x.plus.y.d, lower.treatment.confidence), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 262)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 263)       c("n", 
c6634692 R/granovagg.ds.R      258 264)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 265)         paste(colnames(dsp$data)[2], "mean"),
d7e58513 R/granovagg.ds.R      264 266)         paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
48593231 R/granovagg.ds.R      264 267)         paste("SD(D)"),
eaf5611d R/granovagg.ds.R      266 268)         paste("Effect Size"),
129861a6 R/granovagg.ds.R      268 269)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
<span class="changed">b36b6241 R/granovagg.ds.R      270 270)         paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),</span>
<span class="changed">b36b6241 R/granovagg.ds.R      271 271)         paste("Lower 95% CI Treatment Effect")</span>
c6634692 R/granovagg.ds.R      260 272)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 273)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 274)   }
863d348b R/granova.ds.ggplot.R 126 275) 
f855a782 R/granovagg.ds.R      229 276)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 277)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 278)   dsp$stats          &lt;- GetStats(dsp, conf.level)
<span class="changed">b36b6241 R/granovagg.ds.R      279 279)   dsp$t.test         &lt;- t.test(dsp$data[, 1], dsp$data[, 2])</span>
e5f6a588 R/granova.ds.ggplot.R 122 280)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 281)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 282)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 283)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 284)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 285)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 286)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 287)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 288)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 289)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 290)     
c2605051 R/granova.ds.bd.R     256 291)   
863d348b R/granova.ds.ggplot.R 139 292) 
863d348b R/granova.ds.ggplot.R 140 293)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 294)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 295) 
863d348b R/granova.ds.ggplot.R 143 296)   
3eb0e1f7 R/granova.ds.ggplot.R 142 297)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 298)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 299)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 300)                             ),
a71441d3 R/granova.ds.ggplot.R 140 301)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 302)                  )
863d348b R/granova.ds.ggplot.R 151 303)           )
863d348b R/granova.ds.ggplot.R 152 304)   }
e60e59e1 R/granova.ds.bd.R     241 305)     
794c4b70 R/granova.ds.ggplot.R 152 306)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 307)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 308)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 309)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 310)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 311)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 312)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 313)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 314)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 315)                       )
a71441d3 R/granova.ds.ggplot.R 154 316)           )
863d348b R/granova.ds.ggplot.R 166 317)   }
863d348b R/granova.ds.ggplot.R 167 318) 
794c4b70 R/granova.ds.ggplot.R 166 319)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 320)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 321)   }
863d348b R/granova.ds.ggplot.R 174 322) 
3eb0e1f7 R/granova.ds.ggplot.R 173 323)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 324)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 325)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 326)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 327)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 328)                       )
a71441d3 R/granova.ds.ggplot.R 166 329)           )
863d348b R/granova.ds.ggplot.R 183 330)   }
863d348b R/granova.ds.ggplot.R 184 331) 
794c4b70 R/granova.ds.ggplot.R 183 332)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 333)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 334)   }
863d348b R/granova.ds.ggplot.R 188 335) 
794c4b70 R/granova.ds.ggplot.R 187 336)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 337)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 338)   }
863d348b R/granova.ds.ggplot.R 192 339) 
794c4b70 R/granova.ds.ggplot.R 191 340)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 341)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 342)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 343)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 344)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 345)                    )  
a71441d3 R/granova.ds.ggplot.R 183 346)           )
863d348b R/granova.ds.ggplot.R 202 347)   }
863d348b R/granova.ds.ggplot.R 203 348) 
794c4b70 R/granova.ds.ggplot.R 202 349)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 350)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 351)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 352)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 353)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 354)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 355)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 356)           )
863d348b R/granova.ds.ggplot.R 213 357)   }
c2605051 R/granova.ds.bd.R     271 358)   
794c4b70 R/granova.ds.ggplot.R 213 359)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 360)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 361)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 362)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 363)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 364)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 365)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 366)           )
aaeade58 R/granova.ds.bd.R     274 367)     
863d348b R/granova.ds.ggplot.R 225 368)   }
863d348b R/granova.ds.ggplot.R 226 369) 
794c4b70 R/granova.ds.ggplot.R 225 370)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 371)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 372)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 373)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 374)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 375)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 376)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 377)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 378)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 379)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 380)                        )  
a71441d3 R/granova.ds.ggplot.R 216 381)           )
863d348b R/granova.ds.ggplot.R 242 382)   }
863d348b R/granova.ds.ggplot.R 243 383) 
794c4b70 R/granova.ds.ggplot.R 242 384)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 385)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 386)                             y     = y,
0d72518f R/granovagg.ds.R      303 387)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 388)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 389)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 390)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 391)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 392)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 393)                        )
a71441d3 R/granova.ds.ggplot.R 229 394)           )
863d348b R/granova.ds.ggplot.R 258 395)   }
863d348b R/granova.ds.ggplot.R 259 396) 
794c4b70 R/granova.ds.ggplot.R 258 397)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 398)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 399)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 400)                          ),
a71441d3 R/granova.ds.ggplot.R 236 401)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 402)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 403)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 404)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 405)                      )
a71441d3 R/granova.ds.ggplot.R 240 406)           )
863d348b R/granova.ds.ggplot.R 272 407)   }
863d348b R/granova.ds.ggplot.R 273 408) 
794c4b70 R/granova.ds.ggplot.R 272 409)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 410)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 411)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 412)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 413)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 414)                            ),
a71441d3 R/granova.ds.ggplot.R 249 415)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 416)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 417)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 418)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 419)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 420)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 421)           )
863d348b R/granova.ds.ggplot.R 290 422)   }
863d348b R/granova.ds.ggplot.R 291 423) 
ef841aa1 R/granova.ds.ggplot.R 257 424)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 425)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 426)   
a71441d3 R/granova.ds.ggplot.R 261 427)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 428)   }
863d348b R/granova.ds.ggplot.R 297 429) 
0afa3a38 R/granovagg.ds.R      306 430)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 431)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 432)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 433)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 434)     }
0afa3a38 R/granovagg.ds.R      311 435)     
0afa3a38 R/granovagg.ds.R      312 436)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 437)   }
0afa3a38 R/granovagg.ds.R      314 438)   
485d5f02 R/granovagg.ds.R      317 439)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 440)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 441)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 442)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 443)     }
485d5f02 R/granovagg.ds.R      322 444)     
485d5f02 R/granovagg.ds.R      323 445)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 446)   }
485d5f02 R/granovagg.ds.R      325 447)   
794c4b70 R/granova.ds.ggplot.R 296 448)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 449)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 450)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 451)     }
a2b6fe7d R/granovagg.ds.R      320 452)     
a2b6fe7d R/granovagg.ds.R      321 453)     else {
a2b6fe7d R/granovagg.ds.R      322 454)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 455)     }
863d348b R/granova.ds.ggplot.R 304 456)   }
b5b60529 R/granova.ds.ggplot.R 270 457)   
b5b60529 R/granova.ds.ggplot.R 271 458)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 459)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 460)   }
b5b60529 R/granova.ds.ggplot.R 274 461)   
3b102930 R/granova.ds.ggplot.R 275 462)           
3eb0e1f7 R/granova.ds.ggplot.R 304 463)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 464)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 465)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 466)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 467)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 468)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 469)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 470)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 471)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 472)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 473)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 474)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 475)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 476)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 477)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 478)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 479)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 480) 
c6634692 R/granovagg.ds.R      468 481)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 482) 
b3a74c98 R/granova.ds.bd.R     301 483) }
</pre>
<div class="compileroutput">
Add upper 95% CI Treatment effect to printed output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="2595918"></a>
2595918 2011-10-01 22:02:33 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 254)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 258)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 259)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
<span class="changed">2595918e R/granovagg.ds.R      260 260)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect</span>
5e0fcbf9 R/granovagg.ds.R      252 261)     
<span class="changed">2595918e R/granovagg.ds.R      262 262)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy, r.x.plus.y.d, lower.treatment.confidence, upper.treatment.confidence), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 263)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 264)       c("n", 
c6634692 R/granovagg.ds.R      258 265)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 266)         paste(colnames(dsp$data)[2], "mean"),
d7e58513 R/granovagg.ds.R      264 267)         paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
48593231 R/granovagg.ds.R      264 268)         paste("SD(D)"),
eaf5611d R/granovagg.ds.R      266 269)         paste("Effect Size"),
129861a6 R/granovagg.ds.R      268 270)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
b36b6241 R/granovagg.ds.R      270 271)         paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
<span class="changed">2595918e R/granovagg.ds.R      272 272)         paste("Lower 95% CI Treatment Effect"),</span>
<span class="changed">2595918e R/granovagg.ds.R      273 273)         paste("Upper 95% CI Treatment Effect")</span>
c6634692 R/granovagg.ds.R      260 274)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 275)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 276)   }
863d348b R/granova.ds.ggplot.R 126 277) 
f855a782 R/granovagg.ds.R      229 278)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 279)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 280)   dsp$stats          &lt;- GetStats(dsp, conf.level)
b36b6241 R/granovagg.ds.R      279 281)   dsp$t.test         &lt;- t.test(dsp$data[, 1], dsp$data[, 2])
e5f6a588 R/granova.ds.ggplot.R 122 282)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 283)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 284)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 285)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 286)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 287)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 288)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 289)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 290)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 291)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 292)     
c2605051 R/granova.ds.bd.R     256 293)   
863d348b R/granova.ds.ggplot.R 139 294) 
863d348b R/granova.ds.ggplot.R 140 295)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 296)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 297) 
863d348b R/granova.ds.ggplot.R 143 298)   
3eb0e1f7 R/granova.ds.ggplot.R 142 299)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 300)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 301)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 302)                             ),
a71441d3 R/granova.ds.ggplot.R 140 303)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 304)                  )
863d348b R/granova.ds.ggplot.R 151 305)           )
863d348b R/granova.ds.ggplot.R 152 306)   }
e60e59e1 R/granova.ds.bd.R     241 307)     
794c4b70 R/granova.ds.ggplot.R 152 308)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 309)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 310)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 311)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 312)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 313)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 314)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 315)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 316)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 317)                       )
a71441d3 R/granova.ds.ggplot.R 154 318)           )
863d348b R/granova.ds.ggplot.R 166 319)   }
863d348b R/granova.ds.ggplot.R 167 320) 
794c4b70 R/granova.ds.ggplot.R 166 321)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 322)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 323)   }
863d348b R/granova.ds.ggplot.R 174 324) 
3eb0e1f7 R/granova.ds.ggplot.R 173 325)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 326)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 327)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 328)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 329)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 330)                       )
a71441d3 R/granova.ds.ggplot.R 166 331)           )
863d348b R/granova.ds.ggplot.R 183 332)   }
863d348b R/granova.ds.ggplot.R 184 333) 
794c4b70 R/granova.ds.ggplot.R 183 334)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 335)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 336)   }
863d348b R/granova.ds.ggplot.R 188 337) 
794c4b70 R/granova.ds.ggplot.R 187 338)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 339)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 340)   }
863d348b R/granova.ds.ggplot.R 192 341) 
794c4b70 R/granova.ds.ggplot.R 191 342)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 343)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 344)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 345)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 346)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 347)                    )  
a71441d3 R/granova.ds.ggplot.R 183 348)           )
863d348b R/granova.ds.ggplot.R 202 349)   }
863d348b R/granova.ds.ggplot.R 203 350) 
794c4b70 R/granova.ds.ggplot.R 202 351)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 352)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 353)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 354)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 355)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 356)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 357)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 358)           )
863d348b R/granova.ds.ggplot.R 213 359)   }
c2605051 R/granova.ds.bd.R     271 360)   
794c4b70 R/granova.ds.ggplot.R 213 361)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 362)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 363)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 364)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 365)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 366)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 367)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 368)           )
aaeade58 R/granova.ds.bd.R     274 369)     
863d348b R/granova.ds.ggplot.R 225 370)   }
863d348b R/granova.ds.ggplot.R 226 371) 
794c4b70 R/granova.ds.ggplot.R 225 372)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 373)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 374)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 375)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 376)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 377)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 378)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 379)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 380)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 381)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 382)                        )  
a71441d3 R/granova.ds.ggplot.R 216 383)           )
863d348b R/granova.ds.ggplot.R 242 384)   }
863d348b R/granova.ds.ggplot.R 243 385) 
794c4b70 R/granova.ds.ggplot.R 242 386)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 387)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 388)                             y     = y,
0d72518f R/granovagg.ds.R      303 389)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 390)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 391)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 392)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 393)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 394)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 395)                        )
a71441d3 R/granova.ds.ggplot.R 229 396)           )
863d348b R/granova.ds.ggplot.R 258 397)   }
863d348b R/granova.ds.ggplot.R 259 398) 
794c4b70 R/granova.ds.ggplot.R 258 399)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 400)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 401)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 402)                          ),
a71441d3 R/granova.ds.ggplot.R 236 403)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 404)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 405)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 406)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 407)                      )
a71441d3 R/granova.ds.ggplot.R 240 408)           )
863d348b R/granova.ds.ggplot.R 272 409)   }
863d348b R/granova.ds.ggplot.R 273 410) 
794c4b70 R/granova.ds.ggplot.R 272 411)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 412)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 413)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 414)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 415)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 416)                            ),
a71441d3 R/granova.ds.ggplot.R 249 417)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 418)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 419)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 420)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 421)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 422)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 423)           )
863d348b R/granova.ds.ggplot.R 290 424)   }
863d348b R/granova.ds.ggplot.R 291 425) 
ef841aa1 R/granova.ds.ggplot.R 257 426)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 427)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 428)   
a71441d3 R/granova.ds.ggplot.R 261 429)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 430)   }
863d348b R/granova.ds.ggplot.R 297 431) 
0afa3a38 R/granovagg.ds.R      306 432)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 433)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 434)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 435)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 436)     }
0afa3a38 R/granovagg.ds.R      311 437)     
0afa3a38 R/granovagg.ds.R      312 438)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 439)   }
0afa3a38 R/granovagg.ds.R      314 440)   
485d5f02 R/granovagg.ds.R      317 441)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 442)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 443)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 444)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 445)     }
485d5f02 R/granovagg.ds.R      322 446)     
485d5f02 R/granovagg.ds.R      323 447)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 448)   }
485d5f02 R/granovagg.ds.R      325 449)   
794c4b70 R/granova.ds.ggplot.R 296 450)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 451)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 452)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 453)     }
a2b6fe7d R/granovagg.ds.R      320 454)     
a2b6fe7d R/granovagg.ds.R      321 455)     else {
a2b6fe7d R/granovagg.ds.R      322 456)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 457)     }
863d348b R/granova.ds.ggplot.R 304 458)   }
b5b60529 R/granova.ds.ggplot.R 270 459)   
b5b60529 R/granova.ds.ggplot.R 271 460)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 461)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 462)   }
b5b60529 R/granova.ds.ggplot.R 274 463)   
3b102930 R/granova.ds.ggplot.R 275 464)           
3eb0e1f7 R/granova.ds.ggplot.R 304 465)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 466)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 467)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 468)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 469)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 470)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 471)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 472)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 473)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 474)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 475)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 476)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 477)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 478)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 479)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 480)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 481)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 482) 
c6634692 R/granovagg.ds.R      468 483)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 484) 
b3a74c98 R/granova.ds.bd.R     301 485) }
</pre>
<div class="compileroutput">
Add Upper 95% CI Treatment Effect to granovagg.ds printed output.<p></p><p><br>
</p></div>
</td>
<td>
<a name="d543180"></a>
d543180 2011-10-01 22:15:11 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 254)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 258)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 259)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 260)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
<span class="changed">d543180b R/granovagg.ds.R      261 261)     t.value &lt;- dsp$t.test$statistic</span>
5e0fcbf9 R/granovagg.ds.R      252 262)     
<span class="changed">d543180b R/granovagg.ds.R      263 263)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy, r.x.plus.y.d, lower.treatment.confidence, upper.treatment.confidence, t.value), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 264)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 265)       c("n", 
c6634692 R/granovagg.ds.R      258 266)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 267)         paste(colnames(dsp$data)[2], "mean"),
d7e58513 R/granovagg.ds.R      264 268)         paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
48593231 R/granovagg.ds.R      264 269)         paste("SD(D)"),
eaf5611d R/granovagg.ds.R      266 270)         paste("Effect Size"),
129861a6 R/granovagg.ds.R      268 271)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
b36b6241 R/granovagg.ds.R      270 272)         paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
<span class="changed">d543180b R/granovagg.ds.R      273 273)         paste("Lower ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),</span>
<span class="changed">d543180b R/granovagg.ds.R      274 274)         paste("Upper ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),</span>
<span class="changed">d543180b R/granovagg.ds.R      275 275)         paste("t (D-bar)")</span>
c6634692 R/granovagg.ds.R      260 276)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 277)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 278)   }
863d348b R/granova.ds.ggplot.R 126 279) 
f855a782 R/granovagg.ds.R      229 280)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 281)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 282)   dsp$stats          &lt;- GetStats(dsp, conf.level)
<span class="changed">d543180b R/granovagg.ds.R      283 283)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)</span>
e5f6a588 R/granova.ds.ggplot.R 122 284)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 285)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 286)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 287)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 288)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 289)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 290)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 291)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 292)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 293)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 294)     
c2605051 R/granova.ds.bd.R     256 295)   
863d348b R/granova.ds.ggplot.R 139 296) 
863d348b R/granova.ds.ggplot.R 140 297)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 298)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 299) 
863d348b R/granova.ds.ggplot.R 143 300)   
3eb0e1f7 R/granova.ds.ggplot.R 142 301)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 302)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 303)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 304)                             ),
a71441d3 R/granova.ds.ggplot.R 140 305)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 306)                  )
863d348b R/granova.ds.ggplot.R 151 307)           )
863d348b R/granova.ds.ggplot.R 152 308)   }
e60e59e1 R/granova.ds.bd.R     241 309)     
794c4b70 R/granova.ds.ggplot.R 152 310)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 311)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 312)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 313)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 314)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 315)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 316)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 317)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 318)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 319)                       )
a71441d3 R/granova.ds.ggplot.R 154 320)           )
863d348b R/granova.ds.ggplot.R 166 321)   }
863d348b R/granova.ds.ggplot.R 167 322) 
794c4b70 R/granova.ds.ggplot.R 166 323)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 324)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 325)   }
863d348b R/granova.ds.ggplot.R 174 326) 
3eb0e1f7 R/granova.ds.ggplot.R 173 327)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 328)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 329)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 330)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 331)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 332)                       )
a71441d3 R/granova.ds.ggplot.R 166 333)           )
863d348b R/granova.ds.ggplot.R 183 334)   }
863d348b R/granova.ds.ggplot.R 184 335) 
794c4b70 R/granova.ds.ggplot.R 183 336)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 337)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 338)   }
863d348b R/granova.ds.ggplot.R 188 339) 
794c4b70 R/granova.ds.ggplot.R 187 340)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 341)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 342)   }
863d348b R/granova.ds.ggplot.R 192 343) 
794c4b70 R/granova.ds.ggplot.R 191 344)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 345)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 346)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 347)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 348)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 349)                    )  
a71441d3 R/granova.ds.ggplot.R 183 350)           )
863d348b R/granova.ds.ggplot.R 202 351)   }
863d348b R/granova.ds.ggplot.R 203 352) 
794c4b70 R/granova.ds.ggplot.R 202 353)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 354)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 355)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 356)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 357)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 358)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 359)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 360)           )
863d348b R/granova.ds.ggplot.R 213 361)   }
c2605051 R/granova.ds.bd.R     271 362)   
794c4b70 R/granova.ds.ggplot.R 213 363)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 364)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 365)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 366)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 367)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 368)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 369)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 370)           )
aaeade58 R/granova.ds.bd.R     274 371)     
863d348b R/granova.ds.ggplot.R 225 372)   }
863d348b R/granova.ds.ggplot.R 226 373) 
794c4b70 R/granova.ds.ggplot.R 225 374)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 375)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 376)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 377)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 378)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 379)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 380)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 381)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 382)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 383)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 384)                        )  
a71441d3 R/granova.ds.ggplot.R 216 385)           )
863d348b R/granova.ds.ggplot.R 242 386)   }
863d348b R/granova.ds.ggplot.R 243 387) 
794c4b70 R/granova.ds.ggplot.R 242 388)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 389)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 390)                             y     = y,
0d72518f R/granovagg.ds.R      303 391)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 392)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 393)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 394)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 395)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 396)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 397)                        )
a71441d3 R/granova.ds.ggplot.R 229 398)           )
863d348b R/granova.ds.ggplot.R 258 399)   }
863d348b R/granova.ds.ggplot.R 259 400) 
794c4b70 R/granova.ds.ggplot.R 258 401)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 402)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 403)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 404)                          ),
a71441d3 R/granova.ds.ggplot.R 236 405)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 406)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 407)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 408)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 409)                      )
a71441d3 R/granova.ds.ggplot.R 240 410)           )
863d348b R/granova.ds.ggplot.R 272 411)   }
863d348b R/granova.ds.ggplot.R 273 412) 
794c4b70 R/granova.ds.ggplot.R 272 413)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 414)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 415)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 416)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 417)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 418)                            ),
a71441d3 R/granova.ds.ggplot.R 249 419)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 420)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 421)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 422)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 423)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 424)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 425)           )
863d348b R/granova.ds.ggplot.R 290 426)   }
863d348b R/granova.ds.ggplot.R 291 427) 
ef841aa1 R/granova.ds.ggplot.R 257 428)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 429)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 430)   
a71441d3 R/granova.ds.ggplot.R 261 431)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 432)   }
863d348b R/granova.ds.ggplot.R 297 433) 
0afa3a38 R/granovagg.ds.R      306 434)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 435)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 436)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 437)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 438)     }
0afa3a38 R/granovagg.ds.R      311 439)     
0afa3a38 R/granovagg.ds.R      312 440)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 441)   }
0afa3a38 R/granovagg.ds.R      314 442)   
485d5f02 R/granovagg.ds.R      317 443)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 444)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 445)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 446)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 447)     }
485d5f02 R/granovagg.ds.R      322 448)     
485d5f02 R/granovagg.ds.R      323 449)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 450)   }
485d5f02 R/granovagg.ds.R      325 451)   
794c4b70 R/granova.ds.ggplot.R 296 452)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 453)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 454)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 455)     }
a2b6fe7d R/granovagg.ds.R      320 456)     
a2b6fe7d R/granovagg.ds.R      321 457)     else {
a2b6fe7d R/granovagg.ds.R      322 458)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 459)     }
863d348b R/granova.ds.ggplot.R 304 460)   }
b5b60529 R/granova.ds.ggplot.R 270 461)   
b5b60529 R/granova.ds.ggplot.R 271 462)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 463)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 464)   }
b5b60529 R/granova.ds.ggplot.R 274 465)   
3b102930 R/granova.ds.ggplot.R 275 466)           
3eb0e1f7 R/granova.ds.ggplot.R 304 467)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 468)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 469)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 470)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 471)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 472)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 473)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 474)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 475)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 476)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 477)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 478)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 479)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 480)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 481)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 482)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 483)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 484) 
c6634692 R/granovagg.ds.R      468 485)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 486) 
b3a74c98 R/granova.ds.bd.R     301 487) }
</pre>
<div class="compileroutput">
Add t-test value to printed output in granovagg.ds<p>Force labels for treatment confidence intervals to respect conf.level parameter in granovagg.ds printed output.<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="f4c75a5"></a>
f4c75a5 2011-10-01 22:18:34 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 254)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 258)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 259)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 260)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 261)     t.value &lt;- dsp$t.test$statistic
<span class="changed">f4c75a58 R/granovagg.ds.R      262 262)     degrees.of.freedom &lt;- dsp$t.test$parameter</span>
5e0fcbf9 R/granovagg.ds.R      252 263)     
<span class="changed">f4c75a58 R/granovagg.ds.R      264 264)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy, r.x.plus.y.d, lower.treatment.confidence, upper.treatment.confidence, t.value, degrees.of.freedom), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 265)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 266)       c("n", 
c6634692 R/granovagg.ds.R      258 267)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 268)         paste(colnames(dsp$data)[2], "mean"),
d7e58513 R/granovagg.ds.R      264 269)         paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
48593231 R/granovagg.ds.R      264 270)         paste("SD(D)"),
eaf5611d R/granovagg.ds.R      266 271)         paste("Effect Size"),
129861a6 R/granovagg.ds.R      268 272)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
b36b6241 R/granovagg.ds.R      270 273)         paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
d543180b R/granovagg.ds.R      273 274)         paste("Lower ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
d543180b R/granovagg.ds.R      274 275)         paste("Upper ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
<span class="changed">f4c75a58 R/granovagg.ds.R      276 276)         paste("t (D-bar)"),</span>
<span class="changed">f4c75a58 R/granovagg.ds.R      277 277)         paste("df.t")</span>
c6634692 R/granovagg.ds.R      260 278)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 279)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 280)   }
863d348b R/granova.ds.ggplot.R 126 281) 
f855a782 R/granovagg.ds.R      229 282)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 283)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 284)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 285)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 286)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 287)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 288)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 289)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 290)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 291)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 292)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 293)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 294)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 295)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 296)     
c2605051 R/granova.ds.bd.R     256 297)   
863d348b R/granova.ds.ggplot.R 139 298) 
863d348b R/granova.ds.ggplot.R 140 299)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 300)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 301) 
863d348b R/granova.ds.ggplot.R 143 302)   
3eb0e1f7 R/granova.ds.ggplot.R 142 303)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 304)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 305)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 306)                             ),
a71441d3 R/granova.ds.ggplot.R 140 307)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 308)                  )
863d348b R/granova.ds.ggplot.R 151 309)           )
863d348b R/granova.ds.ggplot.R 152 310)   }
e60e59e1 R/granova.ds.bd.R     241 311)     
794c4b70 R/granova.ds.ggplot.R 152 312)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 313)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 314)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 315)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 316)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 317)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 318)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 319)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 320)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 321)                       )
a71441d3 R/granova.ds.ggplot.R 154 322)           )
863d348b R/granova.ds.ggplot.R 166 323)   }
863d348b R/granova.ds.ggplot.R 167 324) 
794c4b70 R/granova.ds.ggplot.R 166 325)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 326)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 327)   }
863d348b R/granova.ds.ggplot.R 174 328) 
3eb0e1f7 R/granova.ds.ggplot.R 173 329)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 330)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 331)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 332)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 333)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 334)                       )
a71441d3 R/granova.ds.ggplot.R 166 335)           )
863d348b R/granova.ds.ggplot.R 183 336)   }
863d348b R/granova.ds.ggplot.R 184 337) 
794c4b70 R/granova.ds.ggplot.R 183 338)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 339)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 340)   }
863d348b R/granova.ds.ggplot.R 188 341) 
794c4b70 R/granova.ds.ggplot.R 187 342)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 343)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 344)   }
863d348b R/granova.ds.ggplot.R 192 345) 
794c4b70 R/granova.ds.ggplot.R 191 346)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 347)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 348)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 349)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 350)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 351)                    )  
a71441d3 R/granova.ds.ggplot.R 183 352)           )
863d348b R/granova.ds.ggplot.R 202 353)   }
863d348b R/granova.ds.ggplot.R 203 354) 
794c4b70 R/granova.ds.ggplot.R 202 355)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 356)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 357)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 358)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 359)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 360)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 361)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 362)           )
863d348b R/granova.ds.ggplot.R 213 363)   }
c2605051 R/granova.ds.bd.R     271 364)   
794c4b70 R/granova.ds.ggplot.R 213 365)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 366)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 367)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 368)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 369)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 370)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 371)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 372)           )
aaeade58 R/granova.ds.bd.R     274 373)     
863d348b R/granova.ds.ggplot.R 225 374)   }
863d348b R/granova.ds.ggplot.R 226 375) 
794c4b70 R/granova.ds.ggplot.R 225 376)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 377)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 378)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 379)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 380)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 381)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 382)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 383)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 384)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 385)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 386)                        )  
a71441d3 R/granova.ds.ggplot.R 216 387)           )
863d348b R/granova.ds.ggplot.R 242 388)   }
863d348b R/granova.ds.ggplot.R 243 389) 
794c4b70 R/granova.ds.ggplot.R 242 390)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 391)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 392)                             y     = y,
0d72518f R/granovagg.ds.R      303 393)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 394)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 395)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 396)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 397)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 398)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 399)                        )
a71441d3 R/granova.ds.ggplot.R 229 400)           )
863d348b R/granova.ds.ggplot.R 258 401)   }
863d348b R/granova.ds.ggplot.R 259 402) 
794c4b70 R/granova.ds.ggplot.R 258 403)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 404)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 405)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 406)                          ),
a71441d3 R/granova.ds.ggplot.R 236 407)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 408)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 409)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 410)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 411)                      )
a71441d3 R/granova.ds.ggplot.R 240 412)           )
863d348b R/granova.ds.ggplot.R 272 413)   }
863d348b R/granova.ds.ggplot.R 273 414) 
794c4b70 R/granova.ds.ggplot.R 272 415)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 416)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 417)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 418)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 419)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 420)                            ),
a71441d3 R/granova.ds.ggplot.R 249 421)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 422)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 423)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 424)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 425)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 426)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 427)           )
863d348b R/granova.ds.ggplot.R 290 428)   }
863d348b R/granova.ds.ggplot.R 291 429) 
ef841aa1 R/granova.ds.ggplot.R 257 430)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 431)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 432)   
a71441d3 R/granova.ds.ggplot.R 261 433)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 434)   }
863d348b R/granova.ds.ggplot.R 297 435) 
0afa3a38 R/granovagg.ds.R      306 436)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 437)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 438)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 439)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 440)     }
0afa3a38 R/granovagg.ds.R      311 441)     
0afa3a38 R/granovagg.ds.R      312 442)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 443)   }
0afa3a38 R/granovagg.ds.R      314 444)   
485d5f02 R/granovagg.ds.R      317 445)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 446)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 447)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 448)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 449)     }
485d5f02 R/granovagg.ds.R      322 450)     
485d5f02 R/granovagg.ds.R      323 451)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 452)   }
485d5f02 R/granovagg.ds.R      325 453)   
794c4b70 R/granova.ds.ggplot.R 296 454)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 455)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 456)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 457)     }
a2b6fe7d R/granovagg.ds.R      320 458)     
a2b6fe7d R/granovagg.ds.R      321 459)     else {
a2b6fe7d R/granovagg.ds.R      322 460)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 461)     }
863d348b R/granova.ds.ggplot.R 304 462)   }
b5b60529 R/granova.ds.ggplot.R 270 463)   
b5b60529 R/granova.ds.ggplot.R 271 464)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 465)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 466)   }
b5b60529 R/granova.ds.ggplot.R 274 467)   
3b102930 R/granova.ds.ggplot.R 275 468)           
3eb0e1f7 R/granova.ds.ggplot.R 304 469)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 470)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 471)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 472)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 473)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 474)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 475)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 476)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 477)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 478)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 479)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 480)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 481)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 482)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 483)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 484)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 485)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 486) 
c6634692 R/granovagg.ds.R      468 487)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 488) 
b3a74c98 R/granova.ds.bd.R     301 489) }
</pre>
<div class="compileroutput">
Add degrees of freedom to printed output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="d63415a"></a>
d63415a 2011-10-01 22:24:20 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 251)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 252)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 253)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 254)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 255)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 256)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 257)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 258)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 259)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 260)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 261)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 262)     degrees.of.freedom &lt;- dsp$t.test$parameter
<span class="changed">d63415a6 R/granovagg.ds.R      263 263)     p.value &lt;- dsp$t.test$p.value</span>
5e0fcbf9 R/granovagg.ds.R      252 264)     
<span class="changed">d63415a6 R/granovagg.ds.R      265 265)     output &lt;- matrix(c(n, mean.1, mean.2, mean.d, standard.deviation.d, effect.size, r.xy, r.x.plus.y.d, lower.treatment.confidence, upper.treatment.confidence, t.value, degrees.of.freedom, p.value), ncol = 1)</span>
c6634692 R/granovagg.ds.R      256 266)     dimnames(output) &lt;- list(
c6634692 R/granovagg.ds.R      257 267)       c("n", 
c6634692 R/granovagg.ds.R      258 268)         paste(colnames(dsp$data)[1], "mean"), 
06ce662a R/granovagg.ds.R      260 269)         paste(colnames(dsp$data)[2], "mean"),
d7e58513 R/granovagg.ds.R      264 270)         paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
48593231 R/granovagg.ds.R      264 271)         paste("SD(D)"),
eaf5611d R/granovagg.ds.R      266 272)         paste("Effect Size"),
129861a6 R/granovagg.ds.R      268 273)         paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
b36b6241 R/granovagg.ds.R      270 274)         paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
d543180b R/granovagg.ds.R      273 275)         paste("Lower ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
d543180b R/granovagg.ds.R      274 276)         paste("Upper ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
f4c75a58 R/granovagg.ds.R      276 277)         paste("t (D-bar)"),
<span class="changed">d63415a6 R/granovagg.ds.R      278 278)         paste("df.t"),</span>
<span class="changed">d63415a6 R/granovagg.ds.R      279 279)         paste("p-value (t-test)")</span>
c6634692 R/granovagg.ds.R      260 280)       ), "Summary Statistics")
5e0fcbf9 R/granovagg.ds.R      254 281)     print(output)
5e0fcbf9 R/granovagg.ds.R      255 282)   }
863d348b R/granova.ds.ggplot.R 126 283) 
f855a782 R/granovagg.ds.R      229 284)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 285)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 286)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 287)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 288)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 289)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 290)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 291)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 292)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 293)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 294)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 295)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 296)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 297)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 298)     
c2605051 R/granova.ds.bd.R     256 299)   
863d348b R/granova.ds.ggplot.R 139 300) 
863d348b R/granova.ds.ggplot.R 140 301)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 302)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 303) 
863d348b R/granova.ds.ggplot.R 143 304)   
3eb0e1f7 R/granova.ds.ggplot.R 142 305)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 306)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 307)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 308)                             ),
a71441d3 R/granova.ds.ggplot.R 140 309)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 310)                  )
863d348b R/granova.ds.ggplot.R 151 311)           )
863d348b R/granova.ds.ggplot.R 152 312)   }
e60e59e1 R/granova.ds.bd.R     241 313)     
794c4b70 R/granova.ds.ggplot.R 152 314)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 315)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 316)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 317)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 318)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 319)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 320)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 321)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 322)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 323)                       )
a71441d3 R/granova.ds.ggplot.R 154 324)           )
863d348b R/granova.ds.ggplot.R 166 325)   }
863d348b R/granova.ds.ggplot.R 167 326) 
794c4b70 R/granova.ds.ggplot.R 166 327)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 328)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 329)   }
863d348b R/granova.ds.ggplot.R 174 330) 
3eb0e1f7 R/granova.ds.ggplot.R 173 331)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 332)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 333)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 334)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 335)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 336)                       )
a71441d3 R/granova.ds.ggplot.R 166 337)           )
863d348b R/granova.ds.ggplot.R 183 338)   }
863d348b R/granova.ds.ggplot.R 184 339) 
794c4b70 R/granova.ds.ggplot.R 183 340)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 341)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 342)   }
863d348b R/granova.ds.ggplot.R 188 343) 
794c4b70 R/granova.ds.ggplot.R 187 344)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 345)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 346)   }
863d348b R/granova.ds.ggplot.R 192 347) 
794c4b70 R/granova.ds.ggplot.R 191 348)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 349)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 350)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 351)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 352)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 353)                    )  
a71441d3 R/granova.ds.ggplot.R 183 354)           )
863d348b R/granova.ds.ggplot.R 202 355)   }
863d348b R/granova.ds.ggplot.R 203 356) 
794c4b70 R/granova.ds.ggplot.R 202 357)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 358)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 359)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 360)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 361)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 362)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 363)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 364)           )
863d348b R/granova.ds.ggplot.R 213 365)   }
c2605051 R/granova.ds.bd.R     271 366)   
794c4b70 R/granova.ds.ggplot.R 213 367)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 368)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 369)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 370)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 371)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 372)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 373)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 374)           )
aaeade58 R/granova.ds.bd.R     274 375)     
863d348b R/granova.ds.ggplot.R 225 376)   }
863d348b R/granova.ds.ggplot.R 226 377) 
794c4b70 R/granova.ds.ggplot.R 225 378)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 379)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 380)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 381)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 382)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 383)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 384)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 385)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 386)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 387)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 388)                        )  
a71441d3 R/granova.ds.ggplot.R 216 389)           )
863d348b R/granova.ds.ggplot.R 242 390)   }
863d348b R/granova.ds.ggplot.R 243 391) 
794c4b70 R/granova.ds.ggplot.R 242 392)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 393)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 394)                             y     = y,
0d72518f R/granovagg.ds.R      303 395)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 396)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 397)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 398)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 399)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 400)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 401)                        )
a71441d3 R/granova.ds.ggplot.R 229 402)           )
863d348b R/granova.ds.ggplot.R 258 403)   }
863d348b R/granova.ds.ggplot.R 259 404) 
794c4b70 R/granova.ds.ggplot.R 258 405)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 406)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 407)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 408)                          ),
a71441d3 R/granova.ds.ggplot.R 236 409)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 410)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 411)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 412)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 413)                      )
a71441d3 R/granova.ds.ggplot.R 240 414)           )
863d348b R/granova.ds.ggplot.R 272 415)   }
863d348b R/granova.ds.ggplot.R 273 416) 
794c4b70 R/granova.ds.ggplot.R 272 417)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 418)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 419)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 420)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 421)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 422)                            ),
a71441d3 R/granova.ds.ggplot.R 249 423)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 424)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 425)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 426)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 427)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 428)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 429)           )
863d348b R/granova.ds.ggplot.R 290 430)   }
863d348b R/granova.ds.ggplot.R 291 431) 
ef841aa1 R/granova.ds.ggplot.R 257 432)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 433)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 434)   
a71441d3 R/granova.ds.ggplot.R 261 435)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 436)   }
863d348b R/granova.ds.ggplot.R 297 437) 
0afa3a38 R/granovagg.ds.R      306 438)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 439)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 440)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 441)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 442)     }
0afa3a38 R/granovagg.ds.R      311 443)     
0afa3a38 R/granovagg.ds.R      312 444)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 445)   }
0afa3a38 R/granovagg.ds.R      314 446)   
485d5f02 R/granovagg.ds.R      317 447)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 448)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 449)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 450)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 451)     }
485d5f02 R/granovagg.ds.R      322 452)     
485d5f02 R/granovagg.ds.R      323 453)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 454)   }
485d5f02 R/granovagg.ds.R      325 455)   
794c4b70 R/granova.ds.ggplot.R 296 456)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 457)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 458)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 459)     }
a2b6fe7d R/granovagg.ds.R      320 460)     
a2b6fe7d R/granovagg.ds.R      321 461)     else {
a2b6fe7d R/granovagg.ds.R      322 462)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 463)     }
863d348b R/granova.ds.ggplot.R 304 464)   }
b5b60529 R/granova.ds.ggplot.R 270 465)   
b5b60529 R/granova.ds.ggplot.R 271 466)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 467)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 468)   }
b5b60529 R/granova.ds.ggplot.R 274 469)   
3b102930 R/granova.ds.ggplot.R 275 470)           
3eb0e1f7 R/granova.ds.ggplot.R 304 471)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 472)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 473)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 474)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 475)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 476)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 477)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 478)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 479)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 480)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 481)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 482)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 483)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 484)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 485)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 486)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 487)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 488) 
c6634692 R/granovagg.ds.R      468 489)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 490) 
b3a74c98 R/granova.ds.bd.R     301 491) }
</pre>
<div class="compileroutput">
Add p-value to printed output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="1d932c7"></a>
1d932c7 2011-10-01 22:37:14 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
<span class="changed">1d932c76 R/granovagg.ds.R      251 251)     summary &lt;- GetPrintedSummary(dsp)</span>
<span class="changed">1d932c76 R/granovagg.ds.R      252 252)     summary &lt;- RenamePrintedSummaryRows(summary)</span>
<span class="changed">1d932c76 R/granovagg.ds.R      253 253)     </span>
<span class="changed">1d932c76 R/granovagg.ds.R      254 254)     print(summary)</span>
<span class="changed">1d932c76 R/granovagg.ds.R      255 255)   }</span>
<span class="changed">1d932c76 R/granovagg.ds.R      256 256)   </span>
<span class="changed">1d932c76 R/granovagg.ds.R      257 257)   GetPrintedSummary &lt;- function(dsp) {</span>
5e0fcbf9 R/granovagg.ds.R      251 258)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 259)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 260)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 261)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 262)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 263)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 264)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 265)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 266)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 267)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 268)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 269)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 270)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 271)     
<span class="changed">1d932c76 R/granovagg.ds.R      272 272)     return(matrix(c(n, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      273 273)                     mean.1, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      274 274)                     mean.2, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      275 275)                     mean.d, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      276 276)                     standard.deviation.d, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      277 277)                     effect.size, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      278 278)                     r.xy, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      279 279)                     r.x.plus.y.d, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      280 280)                     lower.treatment.confidence, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      281 281)                     upper.treatment.confidence, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      282 282)                     t.value, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      283 283)                     degrees.of.freedom, </span>
<span class="changed">1d932c76 R/granovagg.ds.R      284 284)                     p.value</span>
<span class="changed">1d932c76 R/granovagg.ds.R      285 285)                   ), </span>
<span class="changed">1d932c76 R/granovagg.ds.R      286 286)                  ncol = 1</span>
<span class="changed">1d932c76 R/granovagg.ds.R      287 287)            )</span>
<span class="changed">1d932c76 R/granovagg.ds.R      288 288)     )</span>
5e0fcbf9 R/granovagg.ds.R      255 289)   }
<span class="changed">1d932c76 R/granovagg.ds.R      290 290)   </span>
<span class="changed">1d932c76 R/granovagg.ds.R      291 291)   RenamePrintedSummaryRows &lt;- function(summary) {</span>
<span class="changed">1d932c76 R/granovagg.ds.R      292 292)     dimnames(summary) &lt;- list(</span>
<span class="changed">1d932c76 R/granovagg.ds.R      293 293)                            c("n", </span>
<span class="changed">1d932c76 R/granovagg.ds.R      294 294)                              paste(colnames(dsp$data)[1], "mean"), </span>
<span class="changed">1d932c76 R/granovagg.ds.R      295 295)                              paste(colnames(dsp$data)[2], "mean"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      296 296)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      297 297)                              paste("SD(D)"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      298 298)                              paste("Effect Size"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      299 299)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      300 300)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      301 301)                              paste("Lower ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      302 302)                              paste("Upper ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      303 303)                              paste("t (D-bar)"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      304 304)                              paste("df.t"),</span>
<span class="changed">1d932c76 R/granovagg.ds.R      305 305)                              paste("p-value (t-test)")</span>
<span class="changed">1d932c76 R/granovagg.ds.R      306 306)                            ), "Summary Statistics")</span>
<span class="changed">1d932c76 R/granovagg.ds.R      307 307)                          </span>
<span class="changed">1d932c76 R/granovagg.ds.R      308 308)     return(summary)</span>
<span class="changed">1d932c76 R/granovagg.ds.R      309 309)   }</span>
<span class="changed">1d932c76 R/granovagg.ds.R      310 310)   </span>
f855a782 R/granovagg.ds.R      229 311)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 312)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 313)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 314)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 315)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 316)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 317)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 318)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 319)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 320)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 321)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 322)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 323)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 324)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 325)     
c2605051 R/granova.ds.bd.R     256 326)   
863d348b R/granova.ds.ggplot.R 139 327) 
863d348b R/granova.ds.ggplot.R 140 328)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 329)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 330) 
863d348b R/granova.ds.ggplot.R 143 331)   
3eb0e1f7 R/granova.ds.ggplot.R 142 332)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 333)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 334)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 335)                             ),
a71441d3 R/granova.ds.ggplot.R 140 336)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 337)                  )
863d348b R/granova.ds.ggplot.R 151 338)           )
863d348b R/granova.ds.ggplot.R 152 339)   }
e60e59e1 R/granova.ds.bd.R     241 340)     
794c4b70 R/granova.ds.ggplot.R 152 341)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 342)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 343)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 344)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 345)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 346)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 347)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 348)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 349)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 350)                       )
a71441d3 R/granova.ds.ggplot.R 154 351)           )
863d348b R/granova.ds.ggplot.R 166 352)   }
863d348b R/granova.ds.ggplot.R 167 353) 
794c4b70 R/granova.ds.ggplot.R 166 354)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 355)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 356)   }
863d348b R/granova.ds.ggplot.R 174 357) 
3eb0e1f7 R/granova.ds.ggplot.R 173 358)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 359)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 360)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 361)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 362)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 363)                       )
a71441d3 R/granova.ds.ggplot.R 166 364)           )
863d348b R/granova.ds.ggplot.R 183 365)   }
863d348b R/granova.ds.ggplot.R 184 366) 
794c4b70 R/granova.ds.ggplot.R 183 367)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 368)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 369)   }
863d348b R/granova.ds.ggplot.R 188 370) 
794c4b70 R/granova.ds.ggplot.R 187 371)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 372)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 373)   }
863d348b R/granova.ds.ggplot.R 192 374) 
794c4b70 R/granova.ds.ggplot.R 191 375)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 376)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 377)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 378)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 379)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 380)                    )  
a71441d3 R/granova.ds.ggplot.R 183 381)           )
863d348b R/granova.ds.ggplot.R 202 382)   }
863d348b R/granova.ds.ggplot.R 203 383) 
794c4b70 R/granova.ds.ggplot.R 202 384)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 385)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 386)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 387)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 388)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 389)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 390)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 391)           )
863d348b R/granova.ds.ggplot.R 213 392)   }
c2605051 R/granova.ds.bd.R     271 393)   
794c4b70 R/granova.ds.ggplot.R 213 394)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 395)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 396)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 397)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 398)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 399)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 400)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 401)           )
aaeade58 R/granova.ds.bd.R     274 402)     
863d348b R/granova.ds.ggplot.R 225 403)   }
863d348b R/granova.ds.ggplot.R 226 404) 
794c4b70 R/granova.ds.ggplot.R 225 405)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 406)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 407)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 408)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 409)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 410)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 411)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 412)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 413)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 414)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 415)                        )  
a71441d3 R/granova.ds.ggplot.R 216 416)           )
863d348b R/granova.ds.ggplot.R 242 417)   }
863d348b R/granova.ds.ggplot.R 243 418) 
794c4b70 R/granova.ds.ggplot.R 242 419)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 420)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 421)                             y     = y,
0d72518f R/granovagg.ds.R      303 422)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 423)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 424)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 425)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 426)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 427)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 428)                        )
a71441d3 R/granova.ds.ggplot.R 229 429)           )
863d348b R/granova.ds.ggplot.R 258 430)   }
863d348b R/granova.ds.ggplot.R 259 431) 
794c4b70 R/granova.ds.ggplot.R 258 432)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 433)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 434)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 435)                          ),
a71441d3 R/granova.ds.ggplot.R 236 436)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 437)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 438)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 439)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 440)                      )
a71441d3 R/granova.ds.ggplot.R 240 441)           )
863d348b R/granova.ds.ggplot.R 272 442)   }
863d348b R/granova.ds.ggplot.R 273 443) 
794c4b70 R/granova.ds.ggplot.R 272 444)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 445)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 446)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 447)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 448)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 449)                            ),
a71441d3 R/granova.ds.ggplot.R 249 450)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 451)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 452)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 453)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 454)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 455)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 456)           )
863d348b R/granova.ds.ggplot.R 290 457)   }
863d348b R/granova.ds.ggplot.R 291 458) 
ef841aa1 R/granova.ds.ggplot.R 257 459)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 460)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 461)   
a71441d3 R/granova.ds.ggplot.R 261 462)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 463)   }
863d348b R/granova.ds.ggplot.R 297 464) 
0afa3a38 R/granovagg.ds.R      306 465)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 466)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 467)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 468)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 469)     }
0afa3a38 R/granovagg.ds.R      311 470)     
0afa3a38 R/granovagg.ds.R      312 471)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 472)   }
0afa3a38 R/granovagg.ds.R      314 473)   
485d5f02 R/granovagg.ds.R      317 474)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 475)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 476)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 477)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 478)     }
485d5f02 R/granovagg.ds.R      322 479)     
485d5f02 R/granovagg.ds.R      323 480)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 481)   }
485d5f02 R/granovagg.ds.R      325 482)   
794c4b70 R/granova.ds.ggplot.R 296 483)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 484)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 485)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 486)     }
a2b6fe7d R/granovagg.ds.R      320 487)     
a2b6fe7d R/granovagg.ds.R      321 488)     else {
a2b6fe7d R/granovagg.ds.R      322 489)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 490)     }
863d348b R/granova.ds.ggplot.R 304 491)   }
b5b60529 R/granova.ds.ggplot.R 270 492)   
b5b60529 R/granova.ds.ggplot.R 271 493)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 494)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 495)   }
b5b60529 R/granova.ds.ggplot.R 274 496)   
3b102930 R/granova.ds.ggplot.R 275 497)           
3eb0e1f7 R/granova.ds.ggplot.R 304 498)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 499)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 500)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 501)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 502)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 503)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 504)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 505)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 506)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 507)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 508)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 509)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 510)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 511)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 512)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 513)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 514)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 515) 
c6634692 R/granovagg.ds.R      468 516)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 517) 
b3a74c98 R/granova.ds.bd.R     301 518) }
</pre>
<div class="compileroutput">
Refactor PrintSummary to call two subfunctions in granovagg.ds<p>PrintSummary now calls GetPrintedSummary and RenamePrintedSummaryRows<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="7315d68"></a>
7315d68 2011-10-01 22:48:26 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
f855a782 R/granovagg.ds.R       59  80)     output &lt;- CheckData(data)
3146f39f R/granovagg.ds.R       60  81)     output &lt;- ReverseXAndY(output)
f855a782 R/granovagg.ds.R       61  82)     return(output)
f855a782 R/granovagg.ds.R       62  83)   }
f855a782 R/granovagg.ds.R       63  84)   
f855a782 R/granovagg.ds.R       64  85)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  86)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  87)     IsDataInTwoColumnFormat(data)
544a88ef R/granovagg.ds.R       59  88)     return(EnsureDataIsADataFrame(data))
544a88ef R/granovagg.ds.R       60  89)   }
544a88ef R/granovagg.ds.R       61  90)   
f855a782 R/granovagg.ds.R       70  91)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  92)     output &lt;- data
f855a782 R/granovagg.ds.R       72  93)     if (revc) {
f855a782 R/granovagg.ds.R       73  94)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  95)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  96)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  97)     }
f855a782 R/granovagg.ds.R       77  98)     return(output)
f855a782 R/granovagg.ds.R       78  99)   }
f855a782 R/granovagg.ds.R       79 100)   
544a88ef R/granovagg.ds.R       62 101)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 102)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 103)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 104)     }
544a88ef R/granovagg.ds.R       66 105)   }
544a88ef R/granovagg.ds.R       67 106) 
544a88ef R/granovagg.ds.R       68 107)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 108)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 109)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 110)       stop(message)
544a88ef R/granovagg.ds.R       72 111)     }
544a88ef R/granovagg.ds.R       73 112)     
544a88ef R/granovagg.ds.R       74 113)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 114)       stop(message)
544a88ef R/granovagg.ds.R       76 115)     }
544a88ef R/granovagg.ds.R       77 116)   }
544a88ef R/granovagg.ds.R       78 117)   
544a88ef R/granovagg.ds.R       79 118)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 119)     output &lt;- data
544a88ef R/granovagg.ds.R       81 120)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 121)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 122)     }
544a88ef R/granovagg.ds.R       84 123)     return(output)
544a88ef R/granovagg.ds.R       85 124)   }
544a88ef R/granovagg.ds.R       86 125)   
794c4b70 R/granova.ds.ggplot.R   9 126)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 127)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 128)   }
a806fcaa R/granova.ds.bd.R      15 129) 
794c4b70 R/granova.ds.ggplot.R  13 130)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 131)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 132)   }
e589a242 R/granova.ds.bd.R      17 133) 
794c4b70 R/granova.ds.ggplot.R  17 134)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 135)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 136)   }
c2605051 R/granova.ds.bd.R     182 137)   
794c4b70 R/granova.ds.ggplot.R  21 138)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 139)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 140)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 141)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 142)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 143)                  )
a71441d3 R/granova.ds.ggplot.R  27 144)           )
863d348b R/granova.ds.ggplot.R  30 145)   }
c2605051 R/granova.ds.bd.R     187 146)   
794c4b70 R/granova.ds.ggplot.R  30 147)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 148)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 149)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 150)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 151)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 152)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 153)                      )
a71441d3 R/granova.ds.ggplot.R  38 154)           )
863d348b R/granova.ds.ggplot.R  41 155)   }
c2605051 R/granova.ds.bd.R     191 156)   
794c4b70 R/granova.ds.ggplot.R  41 157)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 158)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 159)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 160)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 161)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 162)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 163)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 164)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 165)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 166)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 167)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 168)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 169)   
a71441d3 R/granova.ds.ggplot.R  54 170)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 171)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 172)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 173)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 174)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 175)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 176)                )
a71441d3 R/granova.ds.ggplot.R  61 177)           )
863d348b R/granova.ds.ggplot.R  64 178)   }
c2605051 R/granova.ds.bd.R     199 179)   
794c4b70 R/granova.ds.ggplot.R  64 180)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 181)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 182)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 183)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 184)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 185)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 186)   }
863d348b R/granova.ds.ggplot.R  73 187) 
794c4b70 R/granova.ds.ggplot.R  72 188)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 189)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 190)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 191)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 192)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 193)                      )
a71441d3 R/granova.ds.ggplot.R  78 194)           )  
863d348b R/granova.ds.ggplot.R  82 195)   }
c2605051 R/granova.ds.bd.R     209 196)   
794c4b70 R/granova.ds.ggplot.R  82 197)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 198)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 199)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 200)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 201)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 202)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 203)                      )
a71441d3 R/granova.ds.ggplot.R  88 204)           )
5f570d2d R/granova.ds.bd.R     190 205)     
863d348b R/granova.ds.ggplot.R  94 206)   }
c2605051 R/granova.ds.bd.R     224 207)   
794c4b70 R/granova.ds.ggplot.R  94 208)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 209)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 210)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 211)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 212)                      )
a71441d3 R/granova.ds.ggplot.R  97 213)           )
863d348b R/granova.ds.ggplot.R 103 214)   }
863d348b R/granova.ds.ggplot.R 104 215) 
754a8540 R/granovagg.ds.R      177 216)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 217)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 218)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 219)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 220)     return(output)
754a8540 R/granovagg.ds.R      182 221)   }
754a8540 R/granovagg.ds.R      183 222) 
73167de2 R/granovagg.ds.R      184 223)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 224)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 225)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 226)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 227)                )
73167de2 R/granovagg.ds.R      189 228)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 229)   }
73167de2 R/granovagg.ds.R      191 230)   
794c4b70 R/granova.ds.ggplot.R 103 231)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 232)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 233)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 234)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 235)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 236)                      )
a71441d3 R/granova.ds.ggplot.R 106 237)           )
863d348b R/granova.ds.ggplot.R 114 238)   }
c2605051 R/granova.ds.bd.R     239 239)   
794c4b70 R/granova.ds.ggplot.R 114 240)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 241)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 242)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 243)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 244)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 245)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 246)                )
a71441d3 R/granova.ds.ggplot.R 116 247)           )         
863d348b R/granova.ds.ggplot.R 125 248)   }
5e0fcbf9 R/granovagg.ds.R      249 249)   
5e0fcbf9 R/granovagg.ds.R      250 250)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 251)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 252)     summary &lt;- RenamePrintedSummaryRows(summary)
<span class="changed">7315d685 R/granovagg.ds.R      253 253)     summary &lt;- round(summary, digits = 3)</span>
1d932c76 R/granovagg.ds.R      253 254)     
1d932c76 R/granovagg.ds.R      254 255)     print(summary)
1d932c76 R/granovagg.ds.R      255 256)   }
1d932c76 R/granovagg.ds.R      256 257)   
1d932c76 R/granovagg.ds.R      257 258)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 259)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 260)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 261)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 262)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 263)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 264)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 265)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 266)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 267)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 268)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 269)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 270)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 271)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 272)     
1d932c76 R/granovagg.ds.R      272 273)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 274)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 275)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 276)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 277)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 278)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 279)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 280)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 281)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 282)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 283)                     t.value, 
1d932c76 R/granovagg.ds.R      283 284)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 285)                     p.value
1d932c76 R/granovagg.ds.R      285 286)                   ), 
1d932c76 R/granovagg.ds.R      286 287)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 288)            )
1d932c76 R/granovagg.ds.R      288 289)     )
5e0fcbf9 R/granovagg.ds.R      255 290)   }
1d932c76 R/granovagg.ds.R      290 291)   
1d932c76 R/granovagg.ds.R      291 292)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 293)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 294)                            c("n", 
1d932c76 R/granovagg.ds.R      294 295)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 296)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 297)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 298)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 299)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 300)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 301)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
1d932c76 R/granovagg.ds.R      301 302)                              paste("Lower ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
1d932c76 R/granovagg.ds.R      302 303)                              paste("Upper ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
1d932c76 R/granovagg.ds.R      303 304)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 305)                              paste("df.t"),
1d932c76 R/granovagg.ds.R      305 306)                              paste("p-value (t-test)")
1d932c76 R/granovagg.ds.R      306 307)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 308)                          
1d932c76 R/granovagg.ds.R      308 309)     return(summary)
1d932c76 R/granovagg.ds.R      309 310)   }
1d932c76 R/granovagg.ds.R      310 311)   
f855a782 R/granovagg.ds.R      229 312)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 313)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 314)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 315)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 316)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 317)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 318)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 319)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 320)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 321)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 322)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 323)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 324)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 325)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 326)     
c2605051 R/granova.ds.bd.R     256 327)   
863d348b R/granova.ds.ggplot.R 139 328) 
863d348b R/granova.ds.ggplot.R 140 329)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 330)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 331) 
863d348b R/granova.ds.ggplot.R 143 332)   
3eb0e1f7 R/granova.ds.ggplot.R 142 333)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 334)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 335)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 336)                             ),
a71441d3 R/granova.ds.ggplot.R 140 337)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 338)                  )
863d348b R/granova.ds.ggplot.R 151 339)           )
863d348b R/granova.ds.ggplot.R 152 340)   }
e60e59e1 R/granova.ds.bd.R     241 341)     
794c4b70 R/granova.ds.ggplot.R 152 342)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 343)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 344)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 345)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 346)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 347)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 348)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 349)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 350)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 351)                       )
a71441d3 R/granova.ds.ggplot.R 154 352)           )
863d348b R/granova.ds.ggplot.R 166 353)   }
863d348b R/granova.ds.ggplot.R 167 354) 
794c4b70 R/granova.ds.ggplot.R 166 355)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 356)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 357)   }
863d348b R/granova.ds.ggplot.R 174 358) 
3eb0e1f7 R/granova.ds.ggplot.R 173 359)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 360)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 361)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 362)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 363)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 364)                       )
a71441d3 R/granova.ds.ggplot.R 166 365)           )
863d348b R/granova.ds.ggplot.R 183 366)   }
863d348b R/granova.ds.ggplot.R 184 367) 
794c4b70 R/granova.ds.ggplot.R 183 368)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 369)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 370)   }
863d348b R/granova.ds.ggplot.R 188 371) 
794c4b70 R/granova.ds.ggplot.R 187 372)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 373)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 374)   }
863d348b R/granova.ds.ggplot.R 192 375) 
794c4b70 R/granova.ds.ggplot.R 191 376)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 377)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 378)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 379)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 380)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 381)                    )  
a71441d3 R/granova.ds.ggplot.R 183 382)           )
863d348b R/granova.ds.ggplot.R 202 383)   }
863d348b R/granova.ds.ggplot.R 203 384) 
794c4b70 R/granova.ds.ggplot.R 202 385)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 386)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 387)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 388)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 389)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 390)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 391)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 392)           )
863d348b R/granova.ds.ggplot.R 213 393)   }
c2605051 R/granova.ds.bd.R     271 394)   
794c4b70 R/granova.ds.ggplot.R 213 395)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 396)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 397)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 398)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 399)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 400)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 401)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 402)           )
aaeade58 R/granova.ds.bd.R     274 403)     
863d348b R/granova.ds.ggplot.R 225 404)   }
863d348b R/granova.ds.ggplot.R 226 405) 
794c4b70 R/granova.ds.ggplot.R 225 406)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 407)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 408)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 409)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 410)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 411)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 412)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 413)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 414)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 415)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 416)                        )  
a71441d3 R/granova.ds.ggplot.R 216 417)           )
863d348b R/granova.ds.ggplot.R 242 418)   }
863d348b R/granova.ds.ggplot.R 243 419) 
794c4b70 R/granova.ds.ggplot.R 242 420)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 421)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 422)                             y     = y,
0d72518f R/granovagg.ds.R      303 423)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 424)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 425)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 426)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 427)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 428)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 429)                        )
a71441d3 R/granova.ds.ggplot.R 229 430)           )
863d348b R/granova.ds.ggplot.R 258 431)   }
863d348b R/granova.ds.ggplot.R 259 432) 
794c4b70 R/granova.ds.ggplot.R 258 433)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 434)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 435)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 436)                          ),
a71441d3 R/granova.ds.ggplot.R 236 437)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 438)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 439)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 440)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 441)                      )
a71441d3 R/granova.ds.ggplot.R 240 442)           )
863d348b R/granova.ds.ggplot.R 272 443)   }
863d348b R/granova.ds.ggplot.R 273 444) 
794c4b70 R/granova.ds.ggplot.R 272 445)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 446)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 447)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 448)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 449)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 450)                            ),
a71441d3 R/granova.ds.ggplot.R 249 451)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 452)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 453)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 454)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 455)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 456)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 457)           )
863d348b R/granova.ds.ggplot.R 290 458)   }
863d348b R/granova.ds.ggplot.R 291 459) 
ef841aa1 R/granova.ds.ggplot.R 257 460)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 461)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 462)   
a71441d3 R/granova.ds.ggplot.R 261 463)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 464)   }
863d348b R/granova.ds.ggplot.R 297 465) 
0afa3a38 R/granovagg.ds.R      306 466)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 467)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 468)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 469)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 470)     }
0afa3a38 R/granovagg.ds.R      311 471)     
0afa3a38 R/granovagg.ds.R      312 472)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 473)   }
0afa3a38 R/granovagg.ds.R      314 474)   
485d5f02 R/granovagg.ds.R      317 475)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 476)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 477)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 478)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 479)     }
485d5f02 R/granovagg.ds.R      322 480)     
485d5f02 R/granovagg.ds.R      323 481)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 482)   }
485d5f02 R/granovagg.ds.R      325 483)   
794c4b70 R/granova.ds.ggplot.R 296 484)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 485)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 486)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 487)     }
a2b6fe7d R/granovagg.ds.R      320 488)     
a2b6fe7d R/granovagg.ds.R      321 489)     else {
a2b6fe7d R/granovagg.ds.R      322 490)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 491)     }
863d348b R/granova.ds.ggplot.R 304 492)   }
b5b60529 R/granova.ds.ggplot.R 270 493)   
b5b60529 R/granova.ds.ggplot.R 271 494)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 495)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 496)   }
b5b60529 R/granova.ds.ggplot.R 274 497)   
3b102930 R/granova.ds.ggplot.R 275 498)           
3eb0e1f7 R/granova.ds.ggplot.R 304 499)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 500)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 501)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 502)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 503)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 504)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 505)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 506)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 507)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 508)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 509)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 510)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 511)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 512)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 513)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 514)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 515)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 516) 
c6634692 R/granovagg.ds.R      468 517)   return(dsp)
5d58b37c R/granova.ds.bd.R     314 518) 
b3a74c98 R/granova.ds.bd.R     301 519) }
</pre>
<div class="compileroutput">
Round printed output to three digits for granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="482de62"></a>
482de62 2011-10-03 23:53:45 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
<span class="changed">482de62f R/granovagg.ds.R       80  80)     data &lt;- CheckData(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       81  81)     data &lt;- ReverseXAndY(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       82  82)     data &lt;- EnsureDataHasColumnNames(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       83  83)     data &lt;- EnsureDataIsADataFrame(data)</span>
<span class="changed">482de62f R/granovagg.ds.R       84  84)     return(data)</span>
f855a782 R/granovagg.ds.R       62  85)   }
f855a782 R/granovagg.ds.R       63  86)   
f855a782 R/granovagg.ds.R       64  87)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  88)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  89)     IsDataInTwoColumnFormat(data)
<span class="changed">482de62f R/granovagg.ds.R       90  90)     return(data)</span>
544a88ef R/granovagg.ds.R       60  91)   }
544a88ef R/granovagg.ds.R       61  92)   
f855a782 R/granovagg.ds.R       70  93)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  94)     output &lt;- data
f855a782 R/granovagg.ds.R       72  95)     if (revc) {
f855a782 R/granovagg.ds.R       73  96)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  97)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  98)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  99)     }
f855a782 R/granovagg.ds.R       77 100)     return(output)
f855a782 R/granovagg.ds.R       78 101)   }
f855a782 R/granovagg.ds.R       79 102)   
544a88ef R/granovagg.ds.R       62 103)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 104)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 105)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 106)     }
544a88ef R/granovagg.ds.R       66 107)   }
544a88ef R/granovagg.ds.R       67 108) 
544a88ef R/granovagg.ds.R       68 109)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 110)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 111)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 112)       stop(message)
544a88ef R/granovagg.ds.R       72 113)     }
544a88ef R/granovagg.ds.R       73 114)     
544a88ef R/granovagg.ds.R       74 115)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 116)       stop(message)
544a88ef R/granovagg.ds.R       76 117)     }
544a88ef R/granovagg.ds.R       77 118)   }
544a88ef R/granovagg.ds.R       78 119)   
544a88ef R/granovagg.ds.R       79 120)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 121)     output &lt;- data
544a88ef R/granovagg.ds.R       81 122)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 123)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 124)     }
544a88ef R/granovagg.ds.R       84 125)     return(output)
544a88ef R/granovagg.ds.R       85 126)   }
544a88ef R/granovagg.ds.R       86 127)   
<span class="changed">482de62f R/granovagg.ds.R      128 128)   EnsureDataHasColumnNames &lt;- function(data) {</span>
<span class="changed">482de62f R/granovagg.ds.R      129 129)     output &lt;- data</span>
<span class="changed">482de62f R/granovagg.ds.R      130 130)     if (is.null(colnames(data))) {</span>
<span class="changed">482de62f R/granovagg.ds.R      131 131)       colnames(data) &lt;- c("x", "y")</span>
<span class="changed">482de62f R/granovagg.ds.R      132 132)     }</span>
<span class="changed">482de62f R/granovagg.ds.R      133 133)     </span>
<span class="changed">482de62f R/granovagg.ds.R      134 134)     return(data)</span>
<span class="changed">482de62f R/granovagg.ds.R      135 135)   }</span>
<span class="changed">482de62f R/granovagg.ds.R      136 136)   </span>
794c4b70 R/granova.ds.ggplot.R   9 137)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 138)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 139)   }
a806fcaa R/granova.ds.bd.R      15 140) 
794c4b70 R/granova.ds.ggplot.R  13 141)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 142)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 143)   }
e589a242 R/granova.ds.bd.R      17 144) 
794c4b70 R/granova.ds.ggplot.R  17 145)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 146)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 147)   }
c2605051 R/granova.ds.bd.R     182 148)   
794c4b70 R/granova.ds.ggplot.R  21 149)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 150)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 151)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 152)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 153)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 154)                  )
a71441d3 R/granova.ds.ggplot.R  27 155)           )
863d348b R/granova.ds.ggplot.R  30 156)   }
c2605051 R/granova.ds.bd.R     187 157)   
794c4b70 R/granova.ds.ggplot.R  30 158)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 159)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 160)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 161)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 162)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 163)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 164)                      )
a71441d3 R/granova.ds.ggplot.R  38 165)           )
863d348b R/granova.ds.ggplot.R  41 166)   }
c2605051 R/granova.ds.bd.R     191 167)   
794c4b70 R/granova.ds.ggplot.R  41 168)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 169)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 170)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 171)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 172)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 173)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 174)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 175)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 176)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 177)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 178)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 179)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 180)   
a71441d3 R/granova.ds.ggplot.R  54 181)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 182)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 183)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 184)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 185)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 186)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 187)                )
a71441d3 R/granova.ds.ggplot.R  61 188)           )
863d348b R/granova.ds.ggplot.R  64 189)   }
c2605051 R/granova.ds.bd.R     199 190)   
794c4b70 R/granova.ds.ggplot.R  64 191)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 192)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 193)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 194)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 195)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 196)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 197)   }
863d348b R/granova.ds.ggplot.R  73 198) 
794c4b70 R/granova.ds.ggplot.R  72 199)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 200)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 201)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 202)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 203)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 204)                      )
a71441d3 R/granova.ds.ggplot.R  78 205)           )  
863d348b R/granova.ds.ggplot.R  82 206)   }
c2605051 R/granova.ds.bd.R     209 207)   
794c4b70 R/granova.ds.ggplot.R  82 208)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 209)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 210)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 211)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 212)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 213)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 214)                      )
a71441d3 R/granova.ds.ggplot.R  88 215)           )
5f570d2d R/granova.ds.bd.R     190 216)     
863d348b R/granova.ds.ggplot.R  94 217)   }
c2605051 R/granova.ds.bd.R     224 218)   
794c4b70 R/granova.ds.ggplot.R  94 219)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 220)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 221)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 222)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 223)                      )
a71441d3 R/granova.ds.ggplot.R  97 224)           )
863d348b R/granova.ds.ggplot.R 103 225)   }
863d348b R/granova.ds.ggplot.R 104 226) 
754a8540 R/granovagg.ds.R      177 227)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 228)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 229)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 230)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 231)     return(output)
754a8540 R/granovagg.ds.R      182 232)   }
754a8540 R/granovagg.ds.R      183 233) 
73167de2 R/granovagg.ds.R      184 234)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 235)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 236)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 237)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 238)                )
73167de2 R/granovagg.ds.R      189 239)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 240)   }
73167de2 R/granovagg.ds.R      191 241)   
794c4b70 R/granova.ds.ggplot.R 103 242)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 243)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 244)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 245)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 246)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 247)                      )
a71441d3 R/granova.ds.ggplot.R 106 248)           )
863d348b R/granova.ds.ggplot.R 114 249)   }
c2605051 R/granova.ds.bd.R     239 250)   
794c4b70 R/granova.ds.ggplot.R 114 251)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 252)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 253)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 254)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 255)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 256)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 257)                )
a71441d3 R/granova.ds.ggplot.R 116 258)           )         
863d348b R/granova.ds.ggplot.R 125 259)   }
5e0fcbf9 R/granovagg.ds.R      249 260)   
5e0fcbf9 R/granovagg.ds.R      250 261)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 262)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 263)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 264)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 265)     
1d932c76 R/granovagg.ds.R      254 266)     print(summary)
1d932c76 R/granovagg.ds.R      255 267)   }
1d932c76 R/granovagg.ds.R      256 268)   
1d932c76 R/granovagg.ds.R      257 269)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 270)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 271)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 272)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 273)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 274)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 275)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 276)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 277)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 278)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 279)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 280)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 281)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 282)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 283)     
1d932c76 R/granovagg.ds.R      272 284)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 285)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 286)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 287)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 288)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 289)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 290)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 291)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 292)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 293)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 294)                     t.value, 
1d932c76 R/granovagg.ds.R      283 295)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 296)                     p.value
1d932c76 R/granovagg.ds.R      285 297)                   ), 
1d932c76 R/granovagg.ds.R      286 298)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 299)            )
1d932c76 R/granovagg.ds.R      288 300)     )
5e0fcbf9 R/granovagg.ds.R      255 301)   }
1d932c76 R/granovagg.ds.R      290 302)   
1d932c76 R/granovagg.ds.R      291 303)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 304)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 305)                            c("n", 
1d932c76 R/granovagg.ds.R      294 306)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 307)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 308)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 309)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 310)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 311)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 312)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
1d932c76 R/granovagg.ds.R      301 313)                              paste("Lower ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
1d932c76 R/granovagg.ds.R      302 314)                              paste("Upper ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
1d932c76 R/granovagg.ds.R      303 315)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 316)                              paste("df.t"),
1d932c76 R/granovagg.ds.R      305 317)                              paste("p-value (t-test)")
1d932c76 R/granovagg.ds.R      306 318)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 319)                          
1d932c76 R/granovagg.ds.R      308 320)     return(summary)
1d932c76 R/granovagg.ds.R      309 321)   }
1d932c76 R/granovagg.ds.R      310 322)   
f855a782 R/granovagg.ds.R      229 323)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 324)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 325)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 326)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 327)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 328)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 329)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 330)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 331)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 332)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 333)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 334)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 335)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 336)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 337)     
c2605051 R/granova.ds.bd.R     256 338)   
863d348b R/granova.ds.ggplot.R 139 339) 
863d348b R/granova.ds.ggplot.R 140 340)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 341)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 342) 
863d348b R/granova.ds.ggplot.R 143 343)   
3eb0e1f7 R/granova.ds.ggplot.R 142 344)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 345)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 346)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 347)                             ),
a71441d3 R/granova.ds.ggplot.R 140 348)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 349)                  )
863d348b R/granova.ds.ggplot.R 151 350)           )
863d348b R/granova.ds.ggplot.R 152 351)   }
e60e59e1 R/granova.ds.bd.R     241 352)     
794c4b70 R/granova.ds.ggplot.R 152 353)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 354)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 355)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 356)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 357)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 358)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 359)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 360)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 361)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 362)                       )
a71441d3 R/granova.ds.ggplot.R 154 363)           )
863d348b R/granova.ds.ggplot.R 166 364)   }
863d348b R/granova.ds.ggplot.R 167 365) 
794c4b70 R/granova.ds.ggplot.R 166 366)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 367)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 368)   }
863d348b R/granova.ds.ggplot.R 174 369) 
3eb0e1f7 R/granova.ds.ggplot.R 173 370)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 371)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 372)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 373)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 374)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 375)                       )
a71441d3 R/granova.ds.ggplot.R 166 376)           )
863d348b R/granova.ds.ggplot.R 183 377)   }
863d348b R/granova.ds.ggplot.R 184 378) 
794c4b70 R/granova.ds.ggplot.R 183 379)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 380)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 381)   }
863d348b R/granova.ds.ggplot.R 188 382) 
794c4b70 R/granova.ds.ggplot.R 187 383)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 384)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 385)   }
863d348b R/granova.ds.ggplot.R 192 386) 
794c4b70 R/granova.ds.ggplot.R 191 387)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 388)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 389)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 390)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 391)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 392)                    )  
a71441d3 R/granova.ds.ggplot.R 183 393)           )
863d348b R/granova.ds.ggplot.R 202 394)   }
863d348b R/granova.ds.ggplot.R 203 395) 
794c4b70 R/granova.ds.ggplot.R 202 396)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 397)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 398)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 399)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 400)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 401)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 402)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 403)           )
863d348b R/granova.ds.ggplot.R 213 404)   }
c2605051 R/granova.ds.bd.R     271 405)   
794c4b70 R/granova.ds.ggplot.R 213 406)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 407)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 408)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 409)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 410)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 411)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 412)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 413)           )
aaeade58 R/granova.ds.bd.R     274 414)     
863d348b R/granova.ds.ggplot.R 225 415)   }
863d348b R/granova.ds.ggplot.R 226 416) 
794c4b70 R/granova.ds.ggplot.R 225 417)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 418)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 419)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 420)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 421)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 422)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 423)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 424)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 425)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 426)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 427)                        )  
a71441d3 R/granova.ds.ggplot.R 216 428)           )
863d348b R/granova.ds.ggplot.R 242 429)   }
863d348b R/granova.ds.ggplot.R 243 430) 
794c4b70 R/granova.ds.ggplot.R 242 431)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 432)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 433)                             y     = y,
0d72518f R/granovagg.ds.R      303 434)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 435)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 436)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 437)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 438)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 439)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 440)                        )
a71441d3 R/granova.ds.ggplot.R 229 441)           )
863d348b R/granova.ds.ggplot.R 258 442)   }
863d348b R/granova.ds.ggplot.R 259 443) 
794c4b70 R/granova.ds.ggplot.R 258 444)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 445)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 446)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 447)                          ),
a71441d3 R/granova.ds.ggplot.R 236 448)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 449)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 450)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 451)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 452)                      )
a71441d3 R/granova.ds.ggplot.R 240 453)           )
863d348b R/granova.ds.ggplot.R 272 454)   }
863d348b R/granova.ds.ggplot.R 273 455) 
794c4b70 R/granova.ds.ggplot.R 272 456)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 457)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 458)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 459)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 460)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 461)                            ),
a71441d3 R/granova.ds.ggplot.R 249 462)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 463)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 464)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 465)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 466)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 467)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 468)           )
863d348b R/granova.ds.ggplot.R 290 469)   }
863d348b R/granova.ds.ggplot.R 291 470) 
ef841aa1 R/granova.ds.ggplot.R 257 471)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 472)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 473)   
a71441d3 R/granova.ds.ggplot.R 261 474)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 475)   }
863d348b R/granova.ds.ggplot.R 297 476) 
0afa3a38 R/granovagg.ds.R      306 477)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 478)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 479)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 480)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 481)     }
0afa3a38 R/granovagg.ds.R      311 482)     
0afa3a38 R/granovagg.ds.R      312 483)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 484)   }
0afa3a38 R/granovagg.ds.R      314 485)   
485d5f02 R/granovagg.ds.R      317 486)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 487)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 488)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 489)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 490)     }
485d5f02 R/granovagg.ds.R      322 491)     
485d5f02 R/granovagg.ds.R      323 492)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 493)   }
485d5f02 R/granovagg.ds.R      325 494)   
794c4b70 R/granova.ds.ggplot.R 296 495)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 496)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 497)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 498)     }
a2b6fe7d R/granovagg.ds.R      320 499)     
a2b6fe7d R/granovagg.ds.R      321 500)     else {
a2b6fe7d R/granovagg.ds.R      322 501)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 502)     }
863d348b R/granova.ds.ggplot.R 304 503)   }
b5b60529 R/granova.ds.ggplot.R 270 504)   
b5b60529 R/granova.ds.ggplot.R 271 505)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 506)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 507)   }
b5b60529 R/granova.ds.ggplot.R 274 508)   
3b102930 R/granova.ds.ggplot.R 275 509)           
3eb0e1f7 R/granova.ds.ggplot.R 304 510)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 511)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 512)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 513)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 514)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 515)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 516)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 517)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 518)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 519)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 520)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 521)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 522)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 523)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 524)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 525)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 526)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 527) 
<span class="changed">482de62f R/granovagg.ds.R      528 528)   return(p)</span>
5d58b37c R/granova.ds.bd.R     314 529) 
b3a74c98 R/granova.ds.bd.R     301 530) }
</pre>
<div class="compileroutput">
Ensure data gets column names if none are supplied in granovagg.ds<p>Add EnsureDataHasColumnNames. Refactor GetData so the pattern is check -&gt; reverse X and y -&gt; Ensure data has column names -&gt; Ensure data is a data frame.<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="85bdd70"></a>
85bdd70 2011-10-04 00:15:40 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  80)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  81)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  82)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  83)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  84)     return(data)
f855a782 R/granovagg.ds.R       62  85)   }
f855a782 R/granovagg.ds.R       63  86)   
f855a782 R/granovagg.ds.R       64  87)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  88)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  89)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  90)     return(data)
544a88ef R/granovagg.ds.R       60  91)   }
544a88ef R/granovagg.ds.R       61  92)   
f855a782 R/granovagg.ds.R       70  93)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  94)     output &lt;- data
f855a782 R/granovagg.ds.R       72  95)     if (revc) {
f855a782 R/granovagg.ds.R       73  96)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  97)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  98)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  99)     }
f855a782 R/granovagg.ds.R       77 100)     return(output)
f855a782 R/granovagg.ds.R       78 101)   }
f855a782 R/granovagg.ds.R       79 102)   
544a88ef R/granovagg.ds.R       62 103)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 104)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 105)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 106)     }
544a88ef R/granovagg.ds.R       66 107)   }
544a88ef R/granovagg.ds.R       67 108) 
544a88ef R/granovagg.ds.R       68 109)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 110)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 111)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 112)       stop(message)
544a88ef R/granovagg.ds.R       72 113)     }
544a88ef R/granovagg.ds.R       73 114)     
544a88ef R/granovagg.ds.R       74 115)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 116)       stop(message)
544a88ef R/granovagg.ds.R       76 117)     }
544a88ef R/granovagg.ds.R       77 118)   }
544a88ef R/granovagg.ds.R       78 119)   
544a88ef R/granovagg.ds.R       79 120)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 121)     output &lt;- data
544a88ef R/granovagg.ds.R       81 122)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 123)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 124)     }
544a88ef R/granovagg.ds.R       84 125)     return(output)
544a88ef R/granovagg.ds.R       85 126)   }
544a88ef R/granovagg.ds.R       86 127)   
482de62f R/granovagg.ds.R      128 128)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 129)     output &lt;- data
482de62f R/granovagg.ds.R      130 130)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 131)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 132)     }
482de62f R/granovagg.ds.R      133 133)     
482de62f R/granovagg.ds.R      134 134)     return(data)
482de62f R/granovagg.ds.R      135 135)   }
482de62f R/granovagg.ds.R      136 136)   
794c4b70 R/granova.ds.ggplot.R   9 137)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 138)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 139)   }
a806fcaa R/granova.ds.bd.R      15 140) 
794c4b70 R/granova.ds.ggplot.R  13 141)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 142)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 143)   }
e589a242 R/granova.ds.bd.R      17 144) 
794c4b70 R/granova.ds.ggplot.R  17 145)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 146)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 147)   }
c2605051 R/granova.ds.bd.R     182 148)   
794c4b70 R/granova.ds.ggplot.R  21 149)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 150)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 151)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 152)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 153)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 154)                  )
a71441d3 R/granova.ds.ggplot.R  27 155)           )
863d348b R/granova.ds.ggplot.R  30 156)   }
c2605051 R/granova.ds.bd.R     187 157)   
794c4b70 R/granova.ds.ggplot.R  30 158)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 159)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 160)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 161)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 162)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 163)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 164)                      )
a71441d3 R/granova.ds.ggplot.R  38 165)           )
863d348b R/granova.ds.ggplot.R  41 166)   }
c2605051 R/granova.ds.bd.R     191 167)   
794c4b70 R/granova.ds.ggplot.R  41 168)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 169)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 170)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 171)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 172)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 173)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 174)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 175)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 176)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 177)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 178)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 179)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 180)   
a71441d3 R/granova.ds.ggplot.R  54 181)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 182)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 183)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 184)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 185)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 186)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 187)                )
a71441d3 R/granova.ds.ggplot.R  61 188)           )
863d348b R/granova.ds.ggplot.R  64 189)   }
c2605051 R/granova.ds.bd.R     199 190)   
794c4b70 R/granova.ds.ggplot.R  64 191)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 192)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 193)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 194)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 195)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 196)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 197)   }
863d348b R/granova.ds.ggplot.R  73 198) 
794c4b70 R/granova.ds.ggplot.R  72 199)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 200)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 201)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 202)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 203)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 204)                      )
a71441d3 R/granova.ds.ggplot.R  78 205)           )  
863d348b R/granova.ds.ggplot.R  82 206)   }
c2605051 R/granova.ds.bd.R     209 207)   
794c4b70 R/granova.ds.ggplot.R  82 208)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 209)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 210)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 211)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 212)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 213)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 214)                      )
a71441d3 R/granova.ds.ggplot.R  88 215)           )
5f570d2d R/granova.ds.bd.R     190 216)     
863d348b R/granova.ds.ggplot.R  94 217)   }
c2605051 R/granova.ds.bd.R     224 218)   
794c4b70 R/granova.ds.ggplot.R  94 219)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 220)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 221)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 222)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 223)                      )
a71441d3 R/granova.ds.ggplot.R  97 224)           )
863d348b R/granova.ds.ggplot.R 103 225)   }
863d348b R/granova.ds.ggplot.R 104 226) 
754a8540 R/granovagg.ds.R      177 227)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 228)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 229)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 230)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 231)     return(output)
754a8540 R/granovagg.ds.R      182 232)   }
754a8540 R/granovagg.ds.R      183 233) 
73167de2 R/granovagg.ds.R      184 234)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 235)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 236)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 237)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 238)                )
73167de2 R/granovagg.ds.R      189 239)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 240)   }
73167de2 R/granovagg.ds.R      191 241)   
794c4b70 R/granova.ds.ggplot.R 103 242)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 243)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 244)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 245)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 246)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 247)                      )
a71441d3 R/granova.ds.ggplot.R 106 248)           )
863d348b R/granova.ds.ggplot.R 114 249)   }
c2605051 R/granova.ds.bd.R     239 250)   
794c4b70 R/granova.ds.ggplot.R 114 251)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 252)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 253)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 254)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 255)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 256)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 257)                )
a71441d3 R/granova.ds.ggplot.R 116 258)           )         
863d348b R/granova.ds.ggplot.R 125 259)   }
5e0fcbf9 R/granovagg.ds.R      249 260)   
5e0fcbf9 R/granovagg.ds.R      250 261)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 262)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 263)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 264)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 265)     
1d932c76 R/granovagg.ds.R      254 266)     print(summary)
1d932c76 R/granovagg.ds.R      255 267)   }
1d932c76 R/granovagg.ds.R      256 268)   
1d932c76 R/granovagg.ds.R      257 269)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 270)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 271)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 272)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 273)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 274)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 275)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 276)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 277)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 278)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 279)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 280)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 281)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 282)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 283)     
1d932c76 R/granovagg.ds.R      272 284)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 285)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 286)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 287)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 288)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 289)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 290)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 291)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 292)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 293)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 294)                     t.value, 
1d932c76 R/granovagg.ds.R      283 295)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 296)                     p.value
1d932c76 R/granovagg.ds.R      285 297)                   ), 
1d932c76 R/granovagg.ds.R      286 298)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 299)            )
1d932c76 R/granovagg.ds.R      288 300)     )
5e0fcbf9 R/granovagg.ds.R      255 301)   }
1d932c76 R/granovagg.ds.R      290 302)   
1d932c76 R/granovagg.ds.R      291 303)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 304)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 305)                            c("n", 
1d932c76 R/granovagg.ds.R      294 306)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 307)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 308)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 309)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 310)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 311)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 312)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
1d932c76 R/granovagg.ds.R      301 313)                              paste("Lower ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
1d932c76 R/granovagg.ds.R      302 314)                              paste("Upper ", (100 * conf.level), "% ", "CI Treatment Effect", sep = ""),
1d932c76 R/granovagg.ds.R      303 315)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 316)                              paste("df.t"),
<span class="changed">85bdd70d R/granovagg.ds.R      317 317)                              paste("p-value (t-statistic)")</span>
1d932c76 R/granovagg.ds.R      306 318)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 319)                          
1d932c76 R/granovagg.ds.R      308 320)     return(summary)
1d932c76 R/granovagg.ds.R      309 321)   }
1d932c76 R/granovagg.ds.R      310 322)   
f855a782 R/granovagg.ds.R      229 323)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 324)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 325)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 326)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 327)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 328)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 329)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 330)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 331)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 332)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 333)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 334)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 335)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 336)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 337)     
c2605051 R/granova.ds.bd.R     256 338)   
863d348b R/granova.ds.ggplot.R 139 339) 
863d348b R/granova.ds.ggplot.R 140 340)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 341)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 342) 
863d348b R/granova.ds.ggplot.R 143 343)   
3eb0e1f7 R/granova.ds.ggplot.R 142 344)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 345)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 346)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 347)                             ),
a71441d3 R/granova.ds.ggplot.R 140 348)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 349)                  )
863d348b R/granova.ds.ggplot.R 151 350)           )
863d348b R/granova.ds.ggplot.R 152 351)   }
e60e59e1 R/granova.ds.bd.R     241 352)     
794c4b70 R/granova.ds.ggplot.R 152 353)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 354)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 355)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 356)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 357)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 358)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 359)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 360)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 361)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 362)                       )
a71441d3 R/granova.ds.ggplot.R 154 363)           )
863d348b R/granova.ds.ggplot.R 166 364)   }
863d348b R/granova.ds.ggplot.R 167 365) 
794c4b70 R/granova.ds.ggplot.R 166 366)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 367)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 368)   }
863d348b R/granova.ds.ggplot.R 174 369) 
3eb0e1f7 R/granova.ds.ggplot.R 173 370)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 371)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 372)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 373)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 374)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 375)                       )
a71441d3 R/granova.ds.ggplot.R 166 376)           )
863d348b R/granova.ds.ggplot.R 183 377)   }
863d348b R/granova.ds.ggplot.R 184 378) 
794c4b70 R/granova.ds.ggplot.R 183 379)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 380)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 381)   }
863d348b R/granova.ds.ggplot.R 188 382) 
794c4b70 R/granova.ds.ggplot.R 187 383)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 384)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 385)   }
863d348b R/granova.ds.ggplot.R 192 386) 
794c4b70 R/granova.ds.ggplot.R 191 387)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 388)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 389)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 390)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 391)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 392)                    )  
a71441d3 R/granova.ds.ggplot.R 183 393)           )
863d348b R/granova.ds.ggplot.R 202 394)   }
863d348b R/granova.ds.ggplot.R 203 395) 
794c4b70 R/granova.ds.ggplot.R 202 396)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 397)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 398)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 399)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 400)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 401)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 402)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 403)           )
863d348b R/granova.ds.ggplot.R 213 404)   }
c2605051 R/granova.ds.bd.R     271 405)   
794c4b70 R/granova.ds.ggplot.R 213 406)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 407)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 408)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 409)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 410)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 411)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 412)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 413)           )
aaeade58 R/granova.ds.bd.R     274 414)     
863d348b R/granova.ds.ggplot.R 225 415)   }
863d348b R/granova.ds.ggplot.R 226 416) 
794c4b70 R/granova.ds.ggplot.R 225 417)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 418)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 419)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 420)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 421)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 422)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 423)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 424)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 425)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 426)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 427)                        )  
a71441d3 R/granova.ds.ggplot.R 216 428)           )
863d348b R/granova.ds.ggplot.R 242 429)   }
863d348b R/granova.ds.ggplot.R 243 430) 
794c4b70 R/granova.ds.ggplot.R 242 431)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 432)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 433)                             y     = y,
0d72518f R/granovagg.ds.R      303 434)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 435)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 436)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 437)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 438)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 439)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 440)                        )
a71441d3 R/granova.ds.ggplot.R 229 441)           )
863d348b R/granova.ds.ggplot.R 258 442)   }
863d348b R/granova.ds.ggplot.R 259 443) 
794c4b70 R/granova.ds.ggplot.R 258 444)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 445)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 446)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 447)                          ),
a71441d3 R/granova.ds.ggplot.R 236 448)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 449)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 450)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 451)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 452)                      )
a71441d3 R/granova.ds.ggplot.R 240 453)           )
863d348b R/granova.ds.ggplot.R 272 454)   }
863d348b R/granova.ds.ggplot.R 273 455) 
794c4b70 R/granova.ds.ggplot.R 272 456)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 457)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 458)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 459)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 460)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 461)                            ),
a71441d3 R/granova.ds.ggplot.R 249 462)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 463)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 464)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 465)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 466)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 467)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 468)           )
863d348b R/granova.ds.ggplot.R 290 469)   }
863d348b R/granova.ds.ggplot.R 291 470) 
ef841aa1 R/granova.ds.ggplot.R 257 471)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 472)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 473)   
a71441d3 R/granova.ds.ggplot.R 261 474)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 475)   }
863d348b R/granova.ds.ggplot.R 297 476) 
0afa3a38 R/granovagg.ds.R      306 477)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 478)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 479)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 480)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 481)     }
0afa3a38 R/granovagg.ds.R      311 482)     
0afa3a38 R/granovagg.ds.R      312 483)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 484)   }
0afa3a38 R/granovagg.ds.R      314 485)   
485d5f02 R/granovagg.ds.R      317 486)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 487)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 488)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 489)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 490)     }
485d5f02 R/granovagg.ds.R      322 491)     
485d5f02 R/granovagg.ds.R      323 492)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 493)   }
485d5f02 R/granovagg.ds.R      325 494)   
794c4b70 R/granova.ds.ggplot.R 296 495)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 496)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 497)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 498)     }
a2b6fe7d R/granovagg.ds.R      320 499)     
a2b6fe7d R/granovagg.ds.R      321 500)     else {
a2b6fe7d R/granovagg.ds.R      322 501)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 502)     }
863d348b R/granova.ds.ggplot.R 304 503)   }
b5b60529 R/granova.ds.ggplot.R 270 504)   
b5b60529 R/granova.ds.ggplot.R 271 505)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 506)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 507)   }
b5b60529 R/granova.ds.ggplot.R 274 508)   
3b102930 R/granova.ds.ggplot.R 275 509)           
3eb0e1f7 R/granova.ds.ggplot.R 304 510)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 511)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 512)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 513)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 514)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 515)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 516)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 517)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 518)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 519)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 520)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 521)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 522)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 523)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 524)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 525)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 526)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 527) 
482de62f R/granovagg.ds.R      528 528)   return(p)
5d58b37c R/granova.ds.bd.R     314 529) 
b3a74c98 R/granova.ds.bd.R     301 530) }
</pre>
<div class="compileroutput">
Rename p-value for t-statistic in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="bf3b02c"></a>
bf3b02c 2011-10-04 00:19:22 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  80)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  81)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  82)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  83)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  84)     return(data)
f855a782 R/granovagg.ds.R       62  85)   }
f855a782 R/granovagg.ds.R       63  86)   
f855a782 R/granovagg.ds.R       64  87)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  88)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  89)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  90)     return(data)
544a88ef R/granovagg.ds.R       60  91)   }
544a88ef R/granovagg.ds.R       61  92)   
f855a782 R/granovagg.ds.R       70  93)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  94)     output &lt;- data
f855a782 R/granovagg.ds.R       72  95)     if (revc) {
f855a782 R/granovagg.ds.R       73  96)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  97)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  98)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  99)     }
f855a782 R/granovagg.ds.R       77 100)     return(output)
f855a782 R/granovagg.ds.R       78 101)   }
f855a782 R/granovagg.ds.R       79 102)   
544a88ef R/granovagg.ds.R       62 103)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 104)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 105)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 106)     }
544a88ef R/granovagg.ds.R       66 107)   }
544a88ef R/granovagg.ds.R       67 108) 
544a88ef R/granovagg.ds.R       68 109)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 110)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 111)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 112)       stop(message)
544a88ef R/granovagg.ds.R       72 113)     }
544a88ef R/granovagg.ds.R       73 114)     
544a88ef R/granovagg.ds.R       74 115)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 116)       stop(message)
544a88ef R/granovagg.ds.R       76 117)     }
544a88ef R/granovagg.ds.R       77 118)   }
544a88ef R/granovagg.ds.R       78 119)   
544a88ef R/granovagg.ds.R       79 120)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 121)     output &lt;- data
544a88ef R/granovagg.ds.R       81 122)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 123)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 124)     }
544a88ef R/granovagg.ds.R       84 125)     return(output)
544a88ef R/granovagg.ds.R       85 126)   }
544a88ef R/granovagg.ds.R       86 127)   
482de62f R/granovagg.ds.R      128 128)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 129)     output &lt;- data
482de62f R/granovagg.ds.R      130 130)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 131)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 132)     }
482de62f R/granovagg.ds.R      133 133)     
482de62f R/granovagg.ds.R      134 134)     return(data)
482de62f R/granovagg.ds.R      135 135)   }
482de62f R/granovagg.ds.R      136 136)   
794c4b70 R/granova.ds.ggplot.R   9 137)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 138)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 139)   }
a806fcaa R/granova.ds.bd.R      15 140) 
794c4b70 R/granova.ds.ggplot.R  13 141)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 142)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 143)   }
e589a242 R/granova.ds.bd.R      17 144) 
794c4b70 R/granova.ds.ggplot.R  17 145)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 146)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 147)   }
c2605051 R/granova.ds.bd.R     182 148)   
794c4b70 R/granova.ds.ggplot.R  21 149)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 150)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 151)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 152)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 153)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 154)                  )
a71441d3 R/granova.ds.ggplot.R  27 155)           )
863d348b R/granova.ds.ggplot.R  30 156)   }
c2605051 R/granova.ds.bd.R     187 157)   
794c4b70 R/granova.ds.ggplot.R  30 158)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 159)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 160)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 161)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 162)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 163)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 164)                      )
a71441d3 R/granova.ds.ggplot.R  38 165)           )
863d348b R/granova.ds.ggplot.R  41 166)   }
c2605051 R/granova.ds.bd.R     191 167)   
794c4b70 R/granova.ds.ggplot.R  41 168)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 169)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 170)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 171)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 172)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 173)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 174)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 175)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 176)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 177)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 178)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 179)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 180)   
a71441d3 R/granova.ds.ggplot.R  54 181)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 182)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 183)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 184)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 185)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 186)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 187)                )
a71441d3 R/granova.ds.ggplot.R  61 188)           )
863d348b R/granova.ds.ggplot.R  64 189)   }
c2605051 R/granova.ds.bd.R     199 190)   
794c4b70 R/granova.ds.ggplot.R  64 191)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 192)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 193)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 194)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 195)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 196)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 197)   }
863d348b R/granova.ds.ggplot.R  73 198) 
794c4b70 R/granova.ds.ggplot.R  72 199)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 200)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 201)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 202)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 203)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 204)                      )
a71441d3 R/granova.ds.ggplot.R  78 205)           )  
863d348b R/granova.ds.ggplot.R  82 206)   }
c2605051 R/granova.ds.bd.R     209 207)   
794c4b70 R/granova.ds.ggplot.R  82 208)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 209)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 210)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 211)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 212)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 213)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 214)                      )
a71441d3 R/granova.ds.ggplot.R  88 215)           )
5f570d2d R/granova.ds.bd.R     190 216)     
863d348b R/granova.ds.ggplot.R  94 217)   }
c2605051 R/granova.ds.bd.R     224 218)   
794c4b70 R/granova.ds.ggplot.R  94 219)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 220)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 221)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 222)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 223)                      )
a71441d3 R/granova.ds.ggplot.R  97 224)           )
863d348b R/granova.ds.ggplot.R 103 225)   }
863d348b R/granova.ds.ggplot.R 104 226) 
754a8540 R/granovagg.ds.R      177 227)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 228)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 229)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 230)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 231)     return(output)
754a8540 R/granovagg.ds.R      182 232)   }
754a8540 R/granovagg.ds.R      183 233) 
73167de2 R/granovagg.ds.R      184 234)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 235)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 236)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 237)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 238)                )
73167de2 R/granovagg.ds.R      189 239)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 240)   }
73167de2 R/granovagg.ds.R      191 241)   
794c4b70 R/granova.ds.ggplot.R 103 242)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 243)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 244)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 245)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 246)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 247)                      )
a71441d3 R/granova.ds.ggplot.R 106 248)           )
863d348b R/granova.ds.ggplot.R 114 249)   }
c2605051 R/granova.ds.bd.R     239 250)   
794c4b70 R/granova.ds.ggplot.R 114 251)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 252)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 253)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 254)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 255)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 256)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 257)                )
a71441d3 R/granova.ds.ggplot.R 116 258)           )         
863d348b R/granova.ds.ggplot.R 125 259)   }
5e0fcbf9 R/granovagg.ds.R      249 260)   
5e0fcbf9 R/granovagg.ds.R      250 261)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 262)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 263)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 264)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 265)     
1d932c76 R/granovagg.ds.R      254 266)     print(summary)
1d932c76 R/granovagg.ds.R      255 267)   }
1d932c76 R/granovagg.ds.R      256 268)   
1d932c76 R/granovagg.ds.R      257 269)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 270)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 271)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 272)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 273)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 274)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 275)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 276)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 277)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 278)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 279)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 280)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 281)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 282)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 283)     
1d932c76 R/granovagg.ds.R      272 284)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 285)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 286)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 287)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 288)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 289)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 290)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 291)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 292)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 293)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 294)                     t.value, 
1d932c76 R/granovagg.ds.R      283 295)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 296)                     p.value
1d932c76 R/granovagg.ds.R      285 297)                   ), 
1d932c76 R/granovagg.ds.R      286 298)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 299)            )
1d932c76 R/granovagg.ds.R      288 300)     )
5e0fcbf9 R/granovagg.ds.R      255 301)   }
1d932c76 R/granovagg.ds.R      290 302)   
1d932c76 R/granovagg.ds.R      291 303)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 304)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 305)                            c("n", 
1d932c76 R/granovagg.ds.R      294 306)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 307)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 308)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 309)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 310)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 311)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 312)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
<span class="changed">bf3b02cb R/granovagg.ds.R      313 313)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),</span>
<span class="changed">bf3b02cb R/granovagg.ds.R      314 314)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),</span>
1d932c76 R/granovagg.ds.R      303 315)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 316)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 317)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 318)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 319)                          
1d932c76 R/granovagg.ds.R      308 320)     return(summary)
1d932c76 R/granovagg.ds.R      309 321)   }
1d932c76 R/granovagg.ds.R      310 322)   
f855a782 R/granovagg.ds.R      229 323)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 324)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 325)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 326)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 327)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 328)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 329)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 330)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 331)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 332)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 333)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 334)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 335)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 336)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 337)     
c2605051 R/granova.ds.bd.R     256 338)   
863d348b R/granova.ds.ggplot.R 139 339) 
863d348b R/granova.ds.ggplot.R 140 340)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 341)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 342) 
863d348b R/granova.ds.ggplot.R 143 343)   
3eb0e1f7 R/granova.ds.ggplot.R 142 344)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 345)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 346)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 347)                             ),
a71441d3 R/granova.ds.ggplot.R 140 348)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 349)                  )
863d348b R/granova.ds.ggplot.R 151 350)           )
863d348b R/granova.ds.ggplot.R 152 351)   }
e60e59e1 R/granova.ds.bd.R     241 352)     
794c4b70 R/granova.ds.ggplot.R 152 353)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 354)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 355)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 356)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 357)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 358)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 359)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 360)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 361)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 362)                       )
a71441d3 R/granova.ds.ggplot.R 154 363)           )
863d348b R/granova.ds.ggplot.R 166 364)   }
863d348b R/granova.ds.ggplot.R 167 365) 
794c4b70 R/granova.ds.ggplot.R 166 366)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 367)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 368)   }
863d348b R/granova.ds.ggplot.R 174 369) 
3eb0e1f7 R/granova.ds.ggplot.R 173 370)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 371)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 372)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 373)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 374)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 375)                       )
a71441d3 R/granova.ds.ggplot.R 166 376)           )
863d348b R/granova.ds.ggplot.R 183 377)   }
863d348b R/granova.ds.ggplot.R 184 378) 
794c4b70 R/granova.ds.ggplot.R 183 379)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 380)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 381)   }
863d348b R/granova.ds.ggplot.R 188 382) 
794c4b70 R/granova.ds.ggplot.R 187 383)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 384)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 385)   }
863d348b R/granova.ds.ggplot.R 192 386) 
794c4b70 R/granova.ds.ggplot.R 191 387)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 388)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 389)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 390)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 391)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 392)                    )  
a71441d3 R/granova.ds.ggplot.R 183 393)           )
863d348b R/granova.ds.ggplot.R 202 394)   }
863d348b R/granova.ds.ggplot.R 203 395) 
794c4b70 R/granova.ds.ggplot.R 202 396)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 397)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 398)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 399)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 400)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 401)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 402)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 403)           )
863d348b R/granova.ds.ggplot.R 213 404)   }
c2605051 R/granova.ds.bd.R     271 405)   
794c4b70 R/granova.ds.ggplot.R 213 406)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 407)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 408)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 409)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 410)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 411)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 412)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 413)           )
aaeade58 R/granova.ds.bd.R     274 414)     
863d348b R/granova.ds.ggplot.R 225 415)   }
863d348b R/granova.ds.ggplot.R 226 416) 
794c4b70 R/granova.ds.ggplot.R 225 417)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 418)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 419)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 420)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 421)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 422)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 423)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 424)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 425)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 426)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 427)                        )  
a71441d3 R/granova.ds.ggplot.R 216 428)           )
863d348b R/granova.ds.ggplot.R 242 429)   }
863d348b R/granova.ds.ggplot.R 243 430) 
794c4b70 R/granova.ds.ggplot.R 242 431)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 432)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 433)                             y     = y,
0d72518f R/granovagg.ds.R      303 434)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 435)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 436)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 437)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 438)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 439)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 440)                        )
a71441d3 R/granova.ds.ggplot.R 229 441)           )
863d348b R/granova.ds.ggplot.R 258 442)   }
863d348b R/granova.ds.ggplot.R 259 443) 
794c4b70 R/granova.ds.ggplot.R 258 444)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 445)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 446)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 447)                          ),
a71441d3 R/granova.ds.ggplot.R 236 448)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 449)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 450)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 451)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 452)                      )
a71441d3 R/granova.ds.ggplot.R 240 453)           )
863d348b R/granova.ds.ggplot.R 272 454)   }
863d348b R/granova.ds.ggplot.R 273 455) 
794c4b70 R/granova.ds.ggplot.R 272 456)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 457)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 458)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 459)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 460)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 461)                            ),
a71441d3 R/granova.ds.ggplot.R 249 462)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 463)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 464)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 465)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 466)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 467)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 468)           )
863d348b R/granova.ds.ggplot.R 290 469)   }
863d348b R/granova.ds.ggplot.R 291 470) 
ef841aa1 R/granova.ds.ggplot.R 257 471)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 472)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 473)   
a71441d3 R/granova.ds.ggplot.R 261 474)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 475)   }
863d348b R/granova.ds.ggplot.R 297 476) 
0afa3a38 R/granovagg.ds.R      306 477)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 478)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 479)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 480)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 481)     }
0afa3a38 R/granovagg.ds.R      311 482)     
0afa3a38 R/granovagg.ds.R      312 483)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 484)   }
0afa3a38 R/granovagg.ds.R      314 485)   
485d5f02 R/granovagg.ds.R      317 486)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 487)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 488)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 489)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 490)     }
485d5f02 R/granovagg.ds.R      322 491)     
485d5f02 R/granovagg.ds.R      323 492)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 493)   }
485d5f02 R/granovagg.ds.R      325 494)   
794c4b70 R/granova.ds.ggplot.R 296 495)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 496)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 497)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 498)     }
a2b6fe7d R/granovagg.ds.R      320 499)     
a2b6fe7d R/granovagg.ds.R      321 500)     else {
a2b6fe7d R/granovagg.ds.R      322 501)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 502)     }
863d348b R/granova.ds.ggplot.R 304 503)   }
b5b60529 R/granova.ds.ggplot.R 270 504)   
b5b60529 R/granova.ds.ggplot.R 271 505)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 506)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 507)   }
b5b60529 R/granova.ds.ggplot.R 274 508)   
3b102930 R/granova.ds.ggplot.R 275 509)           
3eb0e1f7 R/granova.ds.ggplot.R 304 510)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 511)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 512)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 513)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 514)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 515)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 516)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 517)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 518)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 519)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 520)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 521)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 522)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 523)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 524)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 525)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 526)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 527) 
482de62f R/granovagg.ds.R      528 528)   return(p)
5d58b37c R/granova.ds.bd.R     314 529) 
b3a74c98 R/granova.ds.bd.R     301 530) }
</pre>
<div class="compileroutput">
Rename confidence interval printed output in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="c5a6731"></a>
c5a6731 2011-10-08 22:08:40 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  80)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  81)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  82)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  83)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  84)     return(data)
f855a782 R/granovagg.ds.R       62  85)   }
f855a782 R/granovagg.ds.R       63  86)   
f855a782 R/granovagg.ds.R       64  87)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  88)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  89)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  90)     return(data)
544a88ef R/granovagg.ds.R       60  91)   }
544a88ef R/granovagg.ds.R       61  92)   
f855a782 R/granovagg.ds.R       70  93)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  94)     output &lt;- data
f855a782 R/granovagg.ds.R       72  95)     if (revc) {
f855a782 R/granovagg.ds.R       73  96)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  97)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  98)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  99)     }
f855a782 R/granovagg.ds.R       77 100)     return(output)
f855a782 R/granovagg.ds.R       78 101)   }
f855a782 R/granovagg.ds.R       79 102)   
544a88ef R/granovagg.ds.R       62 103)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 104)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 105)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 106)     }
544a88ef R/granovagg.ds.R       66 107)   }
544a88ef R/granovagg.ds.R       67 108) 
544a88ef R/granovagg.ds.R       68 109)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 110)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 111)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 112)       stop(message)
544a88ef R/granovagg.ds.R       72 113)     }
544a88ef R/granovagg.ds.R       73 114)     
544a88ef R/granovagg.ds.R       74 115)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 116)       stop(message)
544a88ef R/granovagg.ds.R       76 117)     }
544a88ef R/granovagg.ds.R       77 118)   }
544a88ef R/granovagg.ds.R       78 119)   
544a88ef R/granovagg.ds.R       79 120)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 121)     output &lt;- data
544a88ef R/granovagg.ds.R       81 122)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 123)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 124)     }
544a88ef R/granovagg.ds.R       84 125)     return(output)
544a88ef R/granovagg.ds.R       85 126)   }
544a88ef R/granovagg.ds.R       86 127)   
482de62f R/granovagg.ds.R      128 128)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 129)     output &lt;- data
482de62f R/granovagg.ds.R      130 130)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 131)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 132)     }
482de62f R/granovagg.ds.R      133 133)     
482de62f R/granovagg.ds.R      134 134)     return(data)
482de62f R/granovagg.ds.R      135 135)   }
482de62f R/granovagg.ds.R      136 136)   
794c4b70 R/granova.ds.ggplot.R   9 137)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 138)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 139)   }
a806fcaa R/granova.ds.bd.R      15 140) 
794c4b70 R/granova.ds.ggplot.R  13 141)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 142)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 143)   }
e589a242 R/granova.ds.bd.R      17 144) 
794c4b70 R/granova.ds.ggplot.R  17 145)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 146)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 147)   }
c2605051 R/granova.ds.bd.R     182 148)   
794c4b70 R/granova.ds.ggplot.R  21 149)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 150)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 151)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 152)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 153)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 154)                  )
a71441d3 R/granova.ds.ggplot.R  27 155)           )
863d348b R/granova.ds.ggplot.R  30 156)   }
c2605051 R/granova.ds.bd.R     187 157)   
794c4b70 R/granova.ds.ggplot.R  30 158)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 159)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 160)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 161)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 162)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 163)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 164)                      )
a71441d3 R/granova.ds.ggplot.R  38 165)           )
863d348b R/granova.ds.ggplot.R  41 166)   }
c2605051 R/granova.ds.bd.R     191 167)   
794c4b70 R/granova.ds.ggplot.R  41 168)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 169)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 170)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 171)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 172)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 173)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 174)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 175)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 176)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 177)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 178)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 179)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 180)   
a71441d3 R/granova.ds.ggplot.R  54 181)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 182)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 183)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 184)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 185)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 186)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 187)                )
a71441d3 R/granova.ds.ggplot.R  61 188)           )
863d348b R/granova.ds.ggplot.R  64 189)   }
c2605051 R/granova.ds.bd.R     199 190)   
794c4b70 R/granova.ds.ggplot.R  64 191)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 192)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 193)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 194)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 195)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 196)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 197)   }
863d348b R/granova.ds.ggplot.R  73 198) 
794c4b70 R/granova.ds.ggplot.R  72 199)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 200)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 201)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 202)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 203)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 204)                      )
a71441d3 R/granova.ds.ggplot.R  78 205)           )  
863d348b R/granova.ds.ggplot.R  82 206)   }
c2605051 R/granova.ds.bd.R     209 207)   
794c4b70 R/granova.ds.ggplot.R  82 208)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 209)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 210)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 211)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 212)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 213)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 214)                      )
a71441d3 R/granova.ds.ggplot.R  88 215)           )
5f570d2d R/granova.ds.bd.R     190 216)     
863d348b R/granova.ds.ggplot.R  94 217)   }
c2605051 R/granova.ds.bd.R     224 218)   
794c4b70 R/granova.ds.ggplot.R  94 219)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 220)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 221)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 222)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 223)                      )
a71441d3 R/granova.ds.ggplot.R  97 224)           )
863d348b R/granova.ds.ggplot.R 103 225)   }
863d348b R/granova.ds.ggplot.R 104 226) 
754a8540 R/granovagg.ds.R      177 227)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 228)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 229)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 230)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 231)     return(output)
754a8540 R/granovagg.ds.R      182 232)   }
754a8540 R/granovagg.ds.R      183 233) 
73167de2 R/granovagg.ds.R      184 234)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 235)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 236)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 237)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 238)                )
73167de2 R/granovagg.ds.R      189 239)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 240)   }
73167de2 R/granovagg.ds.R      191 241)   
794c4b70 R/granova.ds.ggplot.R 103 242)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 243)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 244)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 245)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 246)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 247)                      )
a71441d3 R/granova.ds.ggplot.R 106 248)           )
863d348b R/granova.ds.ggplot.R 114 249)   }
c2605051 R/granova.ds.bd.R     239 250)   
794c4b70 R/granova.ds.ggplot.R 114 251)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 252)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 253)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 254)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 255)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 256)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 257)                )
a71441d3 R/granova.ds.ggplot.R 116 258)           )         
863d348b R/granova.ds.ggplot.R 125 259)   }
5e0fcbf9 R/granovagg.ds.R      249 260)   
5e0fcbf9 R/granovagg.ds.R      250 261)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 262)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 263)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 264)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 265)     
1d932c76 R/granovagg.ds.R      254 266)     print(summary)
1d932c76 R/granovagg.ds.R      255 267)   }
1d932c76 R/granovagg.ds.R      256 268)   
1d932c76 R/granovagg.ds.R      257 269)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 270)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 271)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 272)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 273)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 274)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 275)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 276)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 277)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 278)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 279)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 280)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 281)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 282)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 283)     
1d932c76 R/granovagg.ds.R      272 284)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 285)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 286)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 287)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 288)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 289)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 290)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 291)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 292)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 293)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 294)                     t.value, 
1d932c76 R/granovagg.ds.R      283 295)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 296)                     p.value
1d932c76 R/granovagg.ds.R      285 297)                   ), 
1d932c76 R/granovagg.ds.R      286 298)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 299)            )
1d932c76 R/granovagg.ds.R      288 300)     )
5e0fcbf9 R/granovagg.ds.R      255 301)   }
1d932c76 R/granovagg.ds.R      290 302)   
1d932c76 R/granovagg.ds.R      291 303)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 304)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 305)                            c("n", 
1d932c76 R/granovagg.ds.R      294 306)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 307)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 308)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 309)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 310)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 311)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 312)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 313)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 314)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 315)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 316)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 317)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 318)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 319)                          
1d932c76 R/granovagg.ds.R      308 320)     return(summary)
1d932c76 R/granovagg.ds.R      309 321)   }
1d932c76 R/granovagg.ds.R      310 322)   
f855a782 R/granovagg.ds.R      229 323)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 324)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 325)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 326)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 327)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 328)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 329)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 330)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 331)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 332)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 333)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 334)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 335)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 336)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 337)     
c2605051 R/granova.ds.bd.R     256 338)   
863d348b R/granova.ds.ggplot.R 139 339) 
863d348b R/granova.ds.ggplot.R 140 340)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 341)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 342) 
863d348b R/granova.ds.ggplot.R 143 343)   
3eb0e1f7 R/granova.ds.ggplot.R 142 344)   InitializeGgplot &lt;- function(dsp) {
<span class="changed">c5a67319 R/granovagg.ds.R      345 345)     return(</span>
<span class="changed">c5a67319 R/granovagg.ds.R      346 346)       ggplot(</span>
<span class="changed">c5a67319 R/granovagg.ds.R      347 347)         aes_string(x = dsp$data[1], </span>
<span class="changed">c5a67319 R/granovagg.ds.R      348 348)                    y = dsp$data[2]</span>
<span class="changed">c5a67319 R/granovagg.ds.R      349 349)         ), data = dsp$data</span>
<span class="changed">c5a67319 R/granovagg.ds.R      350 350)       )</span>
<span class="changed">c5a67319 R/granovagg.ds.R      351 351)     )</span>
863d348b R/granova.ds.ggplot.R 152 352)   }
e60e59e1 R/granova.ds.bd.R     241 353)     
794c4b70 R/granova.ds.ggplot.R 152 354)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 355)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 356)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 357)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 358)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 359)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 360)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 361)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 362)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 363)                       )
a71441d3 R/granova.ds.ggplot.R 154 364)           )
863d348b R/granova.ds.ggplot.R 166 365)   }
863d348b R/granova.ds.ggplot.R 167 366) 
794c4b70 R/granova.ds.ggplot.R 166 367)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 368)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 369)   }
863d348b R/granova.ds.ggplot.R 174 370) 
3eb0e1f7 R/granova.ds.ggplot.R 173 371)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 372)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 373)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 374)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 375)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 376)                       )
a71441d3 R/granova.ds.ggplot.R 166 377)           )
863d348b R/granova.ds.ggplot.R 183 378)   }
863d348b R/granova.ds.ggplot.R 184 379) 
794c4b70 R/granova.ds.ggplot.R 183 380)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 381)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 382)   }
863d348b R/granova.ds.ggplot.R 188 383) 
794c4b70 R/granova.ds.ggplot.R 187 384)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 385)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 386)   }
863d348b R/granova.ds.ggplot.R 192 387) 
794c4b70 R/granova.ds.ggplot.R 191 388)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 389)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 390)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 391)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 392)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 393)                    )  
a71441d3 R/granova.ds.ggplot.R 183 394)           )
863d348b R/granova.ds.ggplot.R 202 395)   }
863d348b R/granova.ds.ggplot.R 203 396) 
794c4b70 R/granova.ds.ggplot.R 202 397)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 398)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 399)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 400)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 401)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 402)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 403)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 404)           )
863d348b R/granova.ds.ggplot.R 213 405)   }
c2605051 R/granova.ds.bd.R     271 406)   
794c4b70 R/granova.ds.ggplot.R 213 407)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 408)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 409)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 410)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 411)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 412)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 413)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 414)           )
aaeade58 R/granova.ds.bd.R     274 415)     
863d348b R/granova.ds.ggplot.R 225 416)   }
863d348b R/granova.ds.ggplot.R 226 417) 
794c4b70 R/granova.ds.ggplot.R 225 418)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 419)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 420)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 421)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 422)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 423)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 424)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 425)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 426)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 427)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 428)                        )  
a71441d3 R/granova.ds.ggplot.R 216 429)           )
863d348b R/granova.ds.ggplot.R 242 430)   }
863d348b R/granova.ds.ggplot.R 243 431) 
794c4b70 R/granova.ds.ggplot.R 242 432)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 433)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 434)                             y     = y,
0d72518f R/granovagg.ds.R      303 435)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 436)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 437)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 438)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 439)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 440)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 441)                        )
a71441d3 R/granova.ds.ggplot.R 229 442)           )
863d348b R/granova.ds.ggplot.R 258 443)   }
863d348b R/granova.ds.ggplot.R 259 444) 
794c4b70 R/granova.ds.ggplot.R 258 445)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 446)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 447)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 448)                          ),
a71441d3 R/granova.ds.ggplot.R 236 449)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 450)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 451)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 452)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 453)                      )
a71441d3 R/granova.ds.ggplot.R 240 454)           )
863d348b R/granova.ds.ggplot.R 272 455)   }
863d348b R/granova.ds.ggplot.R 273 456) 
794c4b70 R/granova.ds.ggplot.R 272 457)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 458)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 459)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 460)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 461)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 462)                            ),
a71441d3 R/granova.ds.ggplot.R 249 463)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 464)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 465)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 466)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 467)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 468)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 469)           )
863d348b R/granova.ds.ggplot.R 290 470)   }
863d348b R/granova.ds.ggplot.R 291 471) 
ef841aa1 R/granova.ds.ggplot.R 257 472)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 473)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 474)   
a71441d3 R/granova.ds.ggplot.R 261 475)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 476)   }
863d348b R/granova.ds.ggplot.R 297 477) 
0afa3a38 R/granovagg.ds.R      306 478)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 479)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 480)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 481)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 482)     }
0afa3a38 R/granovagg.ds.R      311 483)     
0afa3a38 R/granovagg.ds.R      312 484)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 485)   }
0afa3a38 R/granovagg.ds.R      314 486)   
485d5f02 R/granovagg.ds.R      317 487)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 488)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 489)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 490)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 491)     }
485d5f02 R/granovagg.ds.R      322 492)     
485d5f02 R/granovagg.ds.R      323 493)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 494)   }
485d5f02 R/granovagg.ds.R      325 495)   
794c4b70 R/granova.ds.ggplot.R 296 496)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 497)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 498)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 499)     }
a2b6fe7d R/granovagg.ds.R      320 500)     
a2b6fe7d R/granovagg.ds.R      321 501)     else {
a2b6fe7d R/granovagg.ds.R      322 502)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 503)     }
863d348b R/granova.ds.ggplot.R 304 504)   }
b5b60529 R/granova.ds.ggplot.R 270 505)   
b5b60529 R/granova.ds.ggplot.R 271 506)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 507)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 508)   }
b5b60529 R/granova.ds.ggplot.R 274 509)   
3b102930 R/granova.ds.ggplot.R 275 510)           
3eb0e1f7 R/granova.ds.ggplot.R 304 511)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 512)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 513)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 514)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 515)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 516)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 517)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 518)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 519)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 520)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 521)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 522)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 523)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 524)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 525)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 526)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 527)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 528) 
482de62f R/granovagg.ds.R      528 529)   return(p)
5d58b37c R/granova.ds.bd.R     314 530) 
b3a74c98 R/granova.ds.bd.R     301 531) }
</pre>
<div class="compileroutput">
Remove explicit names() calls in granovagg.ds InitializeGgplot<p>They seemed to introduce errors when names were more than one word long.<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="122dd44"></a>
122dd44 2011-10-09 19:34:20 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
3329011e R/granovagg.ds.R       35  47) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  48) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  49) #'
80f8f002 R/granovagg.ds.R       39  50) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  51) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  52) #'
80f8f002 R/granovagg.ds.R       42  53) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  54) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  55) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  56) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  57) #'
48265964 R/granovagg.ds.R       58  58) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  59) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  60) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  61) #'
19d1b011 R/granovagg.ds.R       42  62) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  63) #' @export
be5c4c16 R/granovagg.ds.R       64  64) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  65) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  66) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  67) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  68)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  69)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  70)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  71)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  72)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  73)                          plot.theme = "theme_granova_ds",
3329011e R/granovagg.ds.R       51  74)                          ...
e55d776c R/granovagg.ds.R       42  75)                 ) 
be2e6fbd R/granova.ds.bd.R      19  76) 
be2e6fbd R/granova.ds.bd.R      20  77) {
d6c27487 R/granova.ds.bd.R      12  78)   
f855a782 R/granovagg.ds.R       58  79)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  80)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  81)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  82)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  83)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  84)     return(data)
f855a782 R/granovagg.ds.R       62  85)   }
f855a782 R/granovagg.ds.R       63  86)   
f855a782 R/granovagg.ds.R       64  87)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  88)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  89)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  90)     return(data)
544a88ef R/granovagg.ds.R       60  91)   }
544a88ef R/granovagg.ds.R       61  92)   
f855a782 R/granovagg.ds.R       70  93)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71  94)     output &lt;- data
f855a782 R/granovagg.ds.R       72  95)     if (revc) {
f855a782 R/granovagg.ds.R       73  96)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74  97)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75  98)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76  99)     }
f855a782 R/granovagg.ds.R       77 100)     return(output)
f855a782 R/granovagg.ds.R       78 101)   }
f855a782 R/granovagg.ds.R       79 102)   
544a88ef R/granovagg.ds.R       62 103)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 104)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 105)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 106)     }
544a88ef R/granovagg.ds.R       66 107)   }
544a88ef R/granovagg.ds.R       67 108) 
544a88ef R/granovagg.ds.R       68 109)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 110)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 111)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 112)       stop(message)
544a88ef R/granovagg.ds.R       72 113)     }
544a88ef R/granovagg.ds.R       73 114)     
544a88ef R/granovagg.ds.R       74 115)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 116)       stop(message)
544a88ef R/granovagg.ds.R       76 117)     }
544a88ef R/granovagg.ds.R       77 118)   }
544a88ef R/granovagg.ds.R       78 119)   
544a88ef R/granovagg.ds.R       79 120)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 121)     output &lt;- data
544a88ef R/granovagg.ds.R       81 122)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 123)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 124)     }
544a88ef R/granovagg.ds.R       84 125)     return(output)
544a88ef R/granovagg.ds.R       85 126)   }
544a88ef R/granovagg.ds.R       86 127)   
482de62f R/granovagg.ds.R      128 128)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 129)     output &lt;- data
482de62f R/granovagg.ds.R      130 130)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 131)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 132)     }
482de62f R/granovagg.ds.R      133 133)     
482de62f R/granovagg.ds.R      134 134)     return(data)
482de62f R/granovagg.ds.R      135 135)   }
482de62f R/granovagg.ds.R      136 136)   
794c4b70 R/granova.ds.ggplot.R   9 137)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 138)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 139)   }
a806fcaa R/granova.ds.bd.R      15 140) 
794c4b70 R/granova.ds.ggplot.R  13 141)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 142)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 143)   }
e589a242 R/granova.ds.bd.R      17 144) 
794c4b70 R/granova.ds.ggplot.R  17 145)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 146)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 147)   }
c2605051 R/granova.ds.bd.R     182 148)   
794c4b70 R/granova.ds.ggplot.R  21 149)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 150)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 151)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 152)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 153)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 154)                  )
a71441d3 R/granova.ds.ggplot.R  27 155)           )
863d348b R/granova.ds.ggplot.R  30 156)   }
c2605051 R/granova.ds.bd.R     187 157)   
794c4b70 R/granova.ds.ggplot.R  30 158)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 159)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 160)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 161)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 162)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 163)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 164)                      )
a71441d3 R/granova.ds.ggplot.R  38 165)           )
863d348b R/granova.ds.ggplot.R  41 166)   }
c2605051 R/granova.ds.bd.R     191 167)   
794c4b70 R/granova.ds.ggplot.R  41 168)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 169)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 170)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 171)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 172)     .southwest.padding     &lt;- (65/100) * .square.data.range
cf6bd46f R/granova.ds.ggplot.R  45 173)     .north.east.padding    &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 174)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
e603b053 R/granova.ds.ggplot.R  48 175)     .upper.graphical.bound &lt;- max(.extrema) + .north.east.padding
a71441d3 R/granova.ds.ggplot.R  49 176)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 177)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 178)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 179)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 180)   
a71441d3 R/granova.ds.ggplot.R  54 181)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 182)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 183)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 184)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 185)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 186)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 187)                )
a71441d3 R/granova.ds.ggplot.R  61 188)           )
863d348b R/granova.ds.ggplot.R  64 189)   }
c2605051 R/granova.ds.bd.R     199 190)   
794c4b70 R/granova.ds.ggplot.R  64 191)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 192)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 193)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 194)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 195)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 196)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 197)   }
863d348b R/granova.ds.ggplot.R  73 198) 
794c4b70 R/granova.ds.ggplot.R  72 199)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 200)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 201)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 202)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 203)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 204)                      )
a71441d3 R/granova.ds.ggplot.R  78 205)           )  
863d348b R/granova.ds.ggplot.R  82 206)   }
c2605051 R/granova.ds.bd.R     209 207)   
794c4b70 R/granova.ds.ggplot.R  82 208)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 209)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 210)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 211)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 212)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 213)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 214)                      )
a71441d3 R/granova.ds.ggplot.R  88 215)           )
5f570d2d R/granova.ds.bd.R     190 216)     
863d348b R/granova.ds.ggplot.R  94 217)   }
c2605051 R/granova.ds.bd.R     224 218)   
794c4b70 R/granova.ds.ggplot.R  94 219)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 220)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 221)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 222)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 223)                      )
a71441d3 R/granova.ds.ggplot.R  97 224)           )
863d348b R/granova.ds.ggplot.R 103 225)   }
863d348b R/granova.ds.ggplot.R 104 226) 
754a8540 R/granovagg.ds.R      177 227)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 228)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 229)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 230)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 231)     return(output)
754a8540 R/granovagg.ds.R      182 232)   }
754a8540 R/granovagg.ds.R      183 233) 
73167de2 R/granovagg.ds.R      184 234)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 235)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 236)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 237)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 238)                )
73167de2 R/granovagg.ds.R      189 239)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 240)   }
73167de2 R/granovagg.ds.R      191 241)   
794c4b70 R/granova.ds.ggplot.R 103 242)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 243)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 244)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 245)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 246)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 247)                      )
a71441d3 R/granova.ds.ggplot.R 106 248)           )
863d348b R/granova.ds.ggplot.R 114 249)   }
c2605051 R/granova.ds.bd.R     239 250)   
794c4b70 R/granova.ds.ggplot.R 114 251)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 252)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 253)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 254)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 255)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 256)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 257)                )
a71441d3 R/granova.ds.ggplot.R 116 258)           )         
863d348b R/granova.ds.ggplot.R 125 259)   }
5e0fcbf9 R/granovagg.ds.R      249 260)   
5e0fcbf9 R/granovagg.ds.R      250 261)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 262)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 263)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 264)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 265)     
1d932c76 R/granovagg.ds.R      254 266)     print(summary)
1d932c76 R/granovagg.ds.R      255 267)   }
1d932c76 R/granovagg.ds.R      256 268)   
1d932c76 R/granovagg.ds.R      257 269)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 270)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 271)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 272)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 273)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 274)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 275)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 276)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 277)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 278)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 279)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 280)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 281)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 282)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 283)     
1d932c76 R/granovagg.ds.R      272 284)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 285)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 286)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 287)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 288)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 289)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 290)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 291)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 292)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 293)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 294)                     t.value, 
1d932c76 R/granovagg.ds.R      283 295)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 296)                     p.value
1d932c76 R/granovagg.ds.R      285 297)                   ), 
1d932c76 R/granovagg.ds.R      286 298)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 299)            )
1d932c76 R/granovagg.ds.R      288 300)     )
5e0fcbf9 R/granovagg.ds.R      255 301)   }
1d932c76 R/granovagg.ds.R      290 302)   
1d932c76 R/granovagg.ds.R      291 303)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 304)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 305)                            c("n", 
1d932c76 R/granovagg.ds.R      294 306)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 307)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 308)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 309)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 310)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 311)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 312)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 313)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 314)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 315)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 316)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 317)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 318)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 319)                          
1d932c76 R/granovagg.ds.R      308 320)     return(summary)
1d932c76 R/granovagg.ds.R      309 321)   }
1d932c76 R/granovagg.ds.R      310 322)   
f855a782 R/granovagg.ds.R      229 323)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 324)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 325)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 326)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 327)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 328)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 329)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 330)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 331)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 332)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 333)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 334)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 335)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 336)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 337)     
c2605051 R/granova.ds.bd.R     256 338)   
863d348b R/granova.ds.ggplot.R 139 339) 
863d348b R/granova.ds.ggplot.R 140 340)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 341)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 342) 
863d348b R/granova.ds.ggplot.R 143 343)   
3eb0e1f7 R/granova.ds.ggplot.R 142 344)   InitializeGgplot &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 137 345)     return(ggplot(aes_string(x = names(dsp$data)[1], 
a71441d3 R/granova.ds.ggplot.R 138 346)                              y = names(dsp$data)[2]
a71441d3 R/granova.ds.ggplot.R 139 347)                             ),
a71441d3 R/granova.ds.ggplot.R 140 348)                   data = dsp$data
a71441d3 R/granova.ds.ggplot.R 141 349)                  )
863d348b R/granova.ds.ggplot.R 151 350)           )
863d348b R/granova.ds.ggplot.R 152 351)   }
e60e59e1 R/granova.ds.bd.R     241 352)     
794c4b70 R/granova.ds.ggplot.R 152 353)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 354)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 355)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 356)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 357)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 358)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 359)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 360)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 361)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 362)                       )
a71441d3 R/granova.ds.ggplot.R 154 363)           )
863d348b R/granova.ds.ggplot.R 166 364)   }
863d348b R/granova.ds.ggplot.R 167 365) 
794c4b70 R/granova.ds.ggplot.R 166 366)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 367)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 368)   }
863d348b R/granova.ds.ggplot.R 174 369) 
3eb0e1f7 R/granova.ds.ggplot.R 173 370)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 371)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 372)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 373)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 374)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 375)                       )
a71441d3 R/granova.ds.ggplot.R 166 376)           )
863d348b R/granova.ds.ggplot.R 183 377)   }
863d348b R/granova.ds.ggplot.R 184 378) 
794c4b70 R/granova.ds.ggplot.R 183 379)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 380)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 381)   }
863d348b R/granova.ds.ggplot.R 188 382) 
794c4b70 R/granova.ds.ggplot.R 187 383)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 384)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 385)   }
863d348b R/granova.ds.ggplot.R 192 386) 
794c4b70 R/granova.ds.ggplot.R 191 387)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 388)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 389)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 390)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 391)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 392)                    )  
a71441d3 R/granova.ds.ggplot.R 183 393)           )
863d348b R/granova.ds.ggplot.R 202 394)   }
863d348b R/granova.ds.ggplot.R 203 395) 
794c4b70 R/granova.ds.ggplot.R 202 396)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 397)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 398)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 399)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 400)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 401)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 402)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 403)           )
863d348b R/granova.ds.ggplot.R 213 404)   }
c2605051 R/granova.ds.bd.R     271 405)   
794c4b70 R/granova.ds.ggplot.R 213 406)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 407)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 408)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 409)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 410)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 411)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 412)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 413)           )
aaeade58 R/granova.ds.bd.R     274 414)     
863d348b R/granova.ds.ggplot.R 225 415)   }
863d348b R/granova.ds.ggplot.R 226 416) 
794c4b70 R/granova.ds.ggplot.R 225 417)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 418)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 419)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 420)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 421)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 422)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 423)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 424)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 425)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 426)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 427)                        )  
a71441d3 R/granova.ds.ggplot.R 216 428)           )
863d348b R/granova.ds.ggplot.R 242 429)   }
863d348b R/granova.ds.ggplot.R 243 430) 
794c4b70 R/granova.ds.ggplot.R 242 431)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 432)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 433)                             y     = y,
0d72518f R/granovagg.ds.R      303 434)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 435)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 436)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 437)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 438)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 439)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 440)                        )
a71441d3 R/granova.ds.ggplot.R 229 441)           )
863d348b R/granova.ds.ggplot.R 258 442)   }
863d348b R/granova.ds.ggplot.R 259 443) 
794c4b70 R/granova.ds.ggplot.R 258 444)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 445)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 446)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 447)                          ),
a71441d3 R/granova.ds.ggplot.R 236 448)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 449)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 450)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 451)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 452)                      )
a71441d3 R/granova.ds.ggplot.R 240 453)           )
863d348b R/granova.ds.ggplot.R 272 454)   }
863d348b R/granova.ds.ggplot.R 273 455) 
794c4b70 R/granova.ds.ggplot.R 272 456)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 457)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 458)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 459)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 460)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 461)                            ),
a71441d3 R/granova.ds.ggplot.R 249 462)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 463)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 464)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 465)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 466)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 467)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 468)           )
863d348b R/granova.ds.ggplot.R 290 469)   }
863d348b R/granova.ds.ggplot.R 291 470) 
ef841aa1 R/granova.ds.ggplot.R 257 471)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 472)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 473)   
a71441d3 R/granova.ds.ggplot.R 261 474)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 475)   }
863d348b R/granova.ds.ggplot.R 297 476) 
0afa3a38 R/granovagg.ds.R      306 477)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 478)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 479)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 480)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 481)     }
0afa3a38 R/granovagg.ds.R      311 482)     
0afa3a38 R/granovagg.ds.R      312 483)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 484)   }
0afa3a38 R/granovagg.ds.R      314 485)   
485d5f02 R/granovagg.ds.R      317 486)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 487)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 488)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 489)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 490)     }
485d5f02 R/granovagg.ds.R      322 491)     
485d5f02 R/granovagg.ds.R      323 492)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 493)   }
485d5f02 R/granovagg.ds.R      325 494)   
794c4b70 R/granova.ds.ggplot.R 296 495)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 496)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 497)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 498)     }
a2b6fe7d R/granovagg.ds.R      320 499)     
a2b6fe7d R/granovagg.ds.R      321 500)     else {
a2b6fe7d R/granovagg.ds.R      322 501)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 502)     }
863d348b R/granova.ds.ggplot.R 304 503)   }
b5b60529 R/granova.ds.ggplot.R 270 504)   
b5b60529 R/granova.ds.ggplot.R 271 505)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 506)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 507)   }
b5b60529 R/granova.ds.ggplot.R 274 508)   
3b102930 R/granova.ds.ggplot.R 275 509)           
3eb0e1f7 R/granova.ds.ggplot.R 304 510)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 511)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 512)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 513)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 514)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 515)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 516)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 517)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 518)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 519)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 520)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 521)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 522)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 523)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 524)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 525)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 526)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 527) 
482de62f R/granovagg.ds.R      528 528)   return(p)
5d58b37c R/granova.ds.bd.R     314 529) 
<span class="changed">122dd442 R/granovagg.ds.R      530 530) }</span>
</pre>
<div class="compileroutput">
Whitespace change in granovagg.ds<p></p><p><br>
</p></div>
</td>
<td>
<a name="0ae8f52"></a>
0ae8f52 2011-11-27 00:09:33 -0500
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
892e6c44 R/granovagg.ds.R       32  37) #'   \code{"default_granova_title"}, which leads to printing of a generic title for graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
<span class="changed">0ae8f524 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left, </span>
<span class="changed">0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart, </span>
<span class="changed">0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.</span>
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  54) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  55) #'
80f8f002 R/granovagg.ds.R       39  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  74)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
<span class="changed">0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,</span>
3329011e R/granovagg.ds.R       51  82)                          ...
e55d776c R/granovagg.ds.R       42  83)                 ) 
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
d6c27487 R/granova.ds.bd.R      12  86)   
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
f855a782 R/granovagg.ds.R       63  94)   
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
544a88ef R/granovagg.ds.R       61 100)   
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
f855a782 R/granovagg.ds.R       79 110)   
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
544a88ef R/granovagg.ds.R       73 122)     
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
544a88ef R/granovagg.ds.R       78 127)   
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
544a88ef R/granovagg.ds.R       86 135)   
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
482de62f R/granovagg.ds.R      133 141)     
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
482de62f R/granovagg.ds.R      136 144)   
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
c2605051 R/granova.ds.bd.R     182 156)   
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 158)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 159)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
c2605051 R/granova.ds.bd.R     187 165)   
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
c2605051 R/granova.ds.bd.R     191 175)   
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
<span class="changed">0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range</span>
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
<span class="changed">0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding</span>
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 188)   
a71441d3 R/granova.ds.ggplot.R  54 189)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 190)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 193)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 194)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
c2605051 R/granova.ds.bd.R     199 198)   
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 200)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a71441d3 R/granova.ds.ggplot.R  78 213)           )  
863d348b R/granova.ds.ggplot.R  82 214)   }
c2605051 R/granova.ds.bd.R     209 215)   
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
5f570d2d R/granova.ds.bd.R     190 224)     
863d348b R/granova.ds.ggplot.R  94 225)   }
c2605051 R/granova.ds.bd.R     224 226)   
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
73167de2 R/granovagg.ds.R      191 249)   
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 251)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 253)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
c2605051 R/granova.ds.bd.R     239 258)   
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a71441d3 R/granova.ds.ggplot.R 116 266)           )         
863d348b R/granova.ds.ggplot.R 125 267)   }
5e0fcbf9 R/granovagg.ds.R      249 268)   
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 273)     
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
1d932c76 R/granovagg.ds.R      256 276)   
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 291)     
1d932c76 R/granovagg.ds.R      272 292)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 293)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 294)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 295)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 296)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 297)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 298)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 299)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 300)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 301)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 302)                     t.value, 
1d932c76 R/granovagg.ds.R      283 303)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 304)                     p.value
1d932c76 R/granovagg.ds.R      285 305)                   ), 
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
1d932c76 R/granovagg.ds.R      290 310)   
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 313)                            c("n", 
1d932c76 R/granovagg.ds.R      294 314)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 327)                          
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
1d932c76 R/granovagg.ds.R      310 330)   
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 345)     
c2605051 R/granova.ds.bd.R     256 346)   
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
863d348b R/granova.ds.ggplot.R 143 351)   
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
c5a67319 R/granovagg.ds.R      347 355)         aes_string(x = dsp$data[1], 
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
e60e59e1 R/granova.ds.bd.R     241 361)     
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 380)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
<span class="changed">0ae8f524 R/granovagg.ds.R      395 395)   </span>
<span class="changed">0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      400 400)     </span>
<span class="changed">0ae8f524 R/granovagg.ds.R      401 401)     return(</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      404 404)       )</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      405 405)     )</span>
<span class="changed">0ae8f524 R/granovagg.ds.R      406 406)   } </span>
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 413)                    )  
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 423)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
c2605051 R/granova.ds.bd.R     271 426)   
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 433)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 434)           )
aaeade58 R/granova.ds.bd.R     274 435)     
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 443)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 448)                        )  
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 456)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 458)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
a71441d3 R/granova.ds.ggplot.R 236 469)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 472)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 487)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 488)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 494)   
a71441d3 R/granova.ds.ggplot.R 261 495)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
0afa3a38 R/granovagg.ds.R      311 503)     
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
0afa3a38 R/granovagg.ds.R      314 506)   
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
485d5f02 R/granovagg.ds.R      322 512)     
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
485d5f02 R/granovagg.ds.R      325 515)   
794c4b70 R/granova.ds.ggplot.R 296 516)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 517)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 518)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 519)     }
a2b6fe7d R/granovagg.ds.R      320 520)     
a2b6fe7d R/granovagg.ds.R      321 521)     else {
a2b6fe7d R/granovagg.ds.R      322 522)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 523)     }
863d348b R/granova.ds.ggplot.R 304 524)   }
b5b60529 R/granova.ds.ggplot.R 270 525)   
b5b60529 R/granova.ds.ggplot.R 271 526)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 527)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 528)   }
b5b60529 R/granova.ds.ggplot.R 274 529)   
3b102930 R/granova.ds.ggplot.R 275 530)           
3eb0e1f7 R/granova.ds.ggplot.R 304 531)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 532)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 533)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 534)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 535)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 536)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 537)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 538)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 539)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 540)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 541)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 542)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 543)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 544)   p &lt;- p + ForceCoordinateAxesToBeEqual()
<span class="changed">0ae8f524 R/granovagg.ds.R      545 545)   p &lt;- p + PadViewingWindow(dsp$params)</span>
3eb0e1f7 R/granova.ds.ggplot.R 318 546)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 547)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 548)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 549) 
482de62f R/granovagg.ds.R      528 550)   return(p)
5d58b37c R/granova.ds.bd.R     314 551) 
b3a74c98 R/granova.ds.bd.R     301 552) }
</pre>
<div class="compileroutput">
Add northeast.padding and southwest.padding parameters to granovagg.ds<p>Refs #65<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="1825be6"></a>
1825be6 2011-11-27 13:13:41 -0500
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
<span class="changed">1825be63 R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for graphic.</span>
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
0ae8f524 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left, 
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart, 
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  54) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  55) #'
80f8f002 R/granovagg.ds.R       39  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  74)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
e55d776c R/granovagg.ds.R       42  83)                 ) 
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
d6c27487 R/granova.ds.bd.R      12  86)   
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
f855a782 R/granovagg.ds.R       63  94)   
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
544a88ef R/granovagg.ds.R       61 100)   
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
f855a782 R/granovagg.ds.R       79 110)   
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
544a88ef R/granovagg.ds.R       73 122)     
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
544a88ef R/granovagg.ds.R       78 127)   
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
544a88ef R/granovagg.ds.R       86 135)   
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
482de62f R/granovagg.ds.R      133 141)     
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
482de62f R/granovagg.ds.R      136 144)   
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
c2605051 R/granova.ds.bd.R     182 156)   
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 158)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 159)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
c2605051 R/granova.ds.bd.R     187 165)   
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
c2605051 R/granova.ds.bd.R     191 175)   
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 188)   
a71441d3 R/granova.ds.ggplot.R  54 189)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 190)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 193)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 194)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
c2605051 R/granova.ds.bd.R     199 198)   
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 200)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a71441d3 R/granova.ds.ggplot.R  78 213)           )  
863d348b R/granova.ds.ggplot.R  82 214)   }
c2605051 R/granova.ds.bd.R     209 215)   
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
5f570d2d R/granova.ds.bd.R     190 224)     
863d348b R/granova.ds.ggplot.R  94 225)   }
c2605051 R/granova.ds.bd.R     224 226)   
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
73167de2 R/granovagg.ds.R      191 249)   
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 251)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 253)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
c2605051 R/granova.ds.bd.R     239 258)   
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a71441d3 R/granova.ds.ggplot.R 116 266)           )         
863d348b R/granova.ds.ggplot.R 125 267)   }
5e0fcbf9 R/granovagg.ds.R      249 268)   
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 273)     
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
1d932c76 R/granovagg.ds.R      256 276)   
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 291)     
1d932c76 R/granovagg.ds.R      272 292)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 293)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 294)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 295)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 296)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 297)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 298)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 299)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 300)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 301)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 302)                     t.value, 
1d932c76 R/granovagg.ds.R      283 303)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 304)                     p.value
1d932c76 R/granovagg.ds.R      285 305)                   ), 
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
1d932c76 R/granovagg.ds.R      290 310)   
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 313)                            c("n", 
1d932c76 R/granovagg.ds.R      294 314)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 327)                          
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
1d932c76 R/granovagg.ds.R      310 330)   
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 345)     
c2605051 R/granova.ds.bd.R     256 346)   
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
863d348b R/granova.ds.ggplot.R 143 351)   
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
c5a67319 R/granovagg.ds.R      347 355)         aes_string(x = dsp$data[1], 
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
e60e59e1 R/granova.ds.bd.R     241 361)     
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 380)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
0ae8f524 R/granovagg.ds.R      395 395)   
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
0ae8f524 R/granovagg.ds.R      400 400)     
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
0ae8f524 R/granovagg.ds.R      406 406)   } 
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 413)                    )  
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 423)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
c2605051 R/granova.ds.bd.R     271 426)   
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 433)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 434)           )
aaeade58 R/granova.ds.bd.R     274 435)     
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 443)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 448)                        )  
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 456)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 458)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
a71441d3 R/granova.ds.ggplot.R 236 469)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 472)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 487)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 488)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 494)   
a71441d3 R/granova.ds.ggplot.R 261 495)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
0afa3a38 R/granovagg.ds.R      311 503)     
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
0afa3a38 R/granovagg.ds.R      314 506)   
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
485d5f02 R/granovagg.ds.R      322 512)     
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
485d5f02 R/granovagg.ds.R      325 515)   
794c4b70 R/granova.ds.ggplot.R 296 516)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 517)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 518)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 519)     }
a2b6fe7d R/granovagg.ds.R      320 520)     
a2b6fe7d R/granovagg.ds.R      321 521)     else {
a2b6fe7d R/granovagg.ds.R      322 522)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 523)     }
863d348b R/granova.ds.ggplot.R 304 524)   }
b5b60529 R/granova.ds.ggplot.R 270 525)   
b5b60529 R/granova.ds.ggplot.R 271 526)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 527)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 528)   }
b5b60529 R/granova.ds.ggplot.R 274 529)   
3b102930 R/granova.ds.ggplot.R 275 530)           
3eb0e1f7 R/granova.ds.ggplot.R 304 531)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 532)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 533)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 534)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 535)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 536)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 537)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 538)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 539)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 540)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 541)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 542)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 543)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 544)   p &lt;- p + ForceCoordinateAxesToBeEqual()
0ae8f524 R/granovagg.ds.R      545 545)   p &lt;- p + PadViewingWindow(dsp$params)
3eb0e1f7 R/granova.ds.ggplot.R 318 546)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 547)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 548)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 549) 
482de62f R/granovagg.ds.R      528 550)   return(p)
5d58b37c R/granova.ds.bd.R     314 551) 
b3a74c98 R/granova.ds.bd.R     301 552) }
</pre>
<div class="compileroutput">
Update documentation to allow NULL setting of plot labels<p>Remove remains of merge conflict resolution<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="d9ace94"></a>
d9ace94 2011-12-21 18:43:24 -0500
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
<span class="changed">d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.</span>
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
0ae8f524 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left, 
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart, 
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  54) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  55) #'
80f8f002 R/granovagg.ds.R       39  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  74)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
e55d776c R/granovagg.ds.R       42  83)                 ) 
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
d6c27487 R/granova.ds.bd.R      12  86)   
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
f855a782 R/granovagg.ds.R       63  94)   
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
544a88ef R/granovagg.ds.R       61 100)   
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
f855a782 R/granovagg.ds.R       79 110)   
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
544a88ef R/granovagg.ds.R       73 122)     
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
544a88ef R/granovagg.ds.R       78 127)   
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
544a88ef R/granovagg.ds.R       86 135)   
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
482de62f R/granovagg.ds.R      133 141)     
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
482de62f R/granovagg.ds.R      136 144)   
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
c2605051 R/granova.ds.bd.R     182 156)   
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 158)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 159)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
c2605051 R/granova.ds.bd.R     187 165)   
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
c2605051 R/granova.ds.bd.R     191 175)   
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 188)   
a71441d3 R/granova.ds.ggplot.R  54 189)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 190)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 193)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 194)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
c2605051 R/granova.ds.bd.R     199 198)   
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 200)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a71441d3 R/granova.ds.ggplot.R  78 213)           )  
863d348b R/granova.ds.ggplot.R  82 214)   }
c2605051 R/granova.ds.bd.R     209 215)   
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
5f570d2d R/granova.ds.bd.R     190 224)     
863d348b R/granova.ds.ggplot.R  94 225)   }
c2605051 R/granova.ds.bd.R     224 226)   
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
73167de2 R/granovagg.ds.R      191 249)   
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 251)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 253)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
c2605051 R/granova.ds.bd.R     239 258)   
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a71441d3 R/granova.ds.ggplot.R 116 266)           )         
863d348b R/granova.ds.ggplot.R 125 267)   }
5e0fcbf9 R/granovagg.ds.R      249 268)   
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 273)     
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
1d932c76 R/granovagg.ds.R      256 276)   
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 291)     
1d932c76 R/granovagg.ds.R      272 292)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 293)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 294)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 295)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 296)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 297)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 298)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 299)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 300)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 301)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 302)                     t.value, 
1d932c76 R/granovagg.ds.R      283 303)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 304)                     p.value
1d932c76 R/granovagg.ds.R      285 305)                   ), 
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
1d932c76 R/granovagg.ds.R      290 310)   
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 313)                            c("n", 
1d932c76 R/granovagg.ds.R      294 314)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 327)                          
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
1d932c76 R/granovagg.ds.R      310 330)   
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 345)     
c2605051 R/granova.ds.bd.R     256 346)   
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
863d348b R/granova.ds.ggplot.R 143 351)   
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
c5a67319 R/granovagg.ds.R      347 355)         aes_string(x = dsp$data[1], 
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
e60e59e1 R/granova.ds.bd.R     241 361)     
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 380)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
0ae8f524 R/granovagg.ds.R      395 395)   
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
0ae8f524 R/granovagg.ds.R      400 400)     
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
0ae8f524 R/granovagg.ds.R      406 406)   } 
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 413)                    )  
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 423)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
c2605051 R/granova.ds.bd.R     271 426)   
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 433)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 434)           )
aaeade58 R/granova.ds.bd.R     274 435)     
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 443)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 448)                        )  
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 456)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 458)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
a71441d3 R/granova.ds.ggplot.R 236 469)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 472)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 487)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 488)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 494)   
a71441d3 R/granova.ds.ggplot.R 261 495)     return(scale_color_manual(value = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
0afa3a38 R/granovagg.ds.R      311 503)     
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
0afa3a38 R/granovagg.ds.R      314 506)   
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
485d5f02 R/granovagg.ds.R      322 512)     
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
485d5f02 R/granovagg.ds.R      325 515)   
794c4b70 R/granova.ds.ggplot.R 296 516)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 517)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 518)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 519)     }
a2b6fe7d R/granovagg.ds.R      320 520)     
a2b6fe7d R/granovagg.ds.R      321 521)     else {
a2b6fe7d R/granovagg.ds.R      322 522)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 523)     }
863d348b R/granova.ds.ggplot.R 304 524)   }
b5b60529 R/granova.ds.ggplot.R 270 525)   
b5b60529 R/granova.ds.ggplot.R 271 526)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 527)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 528)   }
b5b60529 R/granova.ds.ggplot.R 274 529)   
3b102930 R/granova.ds.ggplot.R 275 530)           
3eb0e1f7 R/granova.ds.ggplot.R 304 531)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 532)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 533)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 534)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 535)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 536)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 537)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 538)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 539)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 540)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 541)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 542)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 543)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 544)   p &lt;- p + ForceCoordinateAxesToBeEqual()
0ae8f524 R/granovagg.ds.R      545 545)   p &lt;- p + PadViewingWindow(dsp$params)
3eb0e1f7 R/granova.ds.ggplot.R 318 546)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 547)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 548)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 549) 
482de62f R/granovagg.ds.R      528 550)   return(p)
5d58b37c R/granova.ds.bd.R     314 551) 
b3a74c98 R/granova.ds.bd.R     301 552) }
</pre>
<div class="compileroutput">
Remove deprecated parameters from examples in help<p>Parameters like `ident` and `size.lines` were implemented in granova<br>
(classic), but are no longer functional in granovaGG.<br>
<br>
Re-roxygenise documentation under roxygen 2.2.2<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="52d9cc4"></a>
52d9cc4 2012-01-29 22:49:33 -0500
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
0ae8f524 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left, 
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart, 
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  54) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  55) #'
80f8f002 R/granovagg.ds.R       39  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  74)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
e55d776c R/granovagg.ds.R       42  83)                 ) 
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
d6c27487 R/granova.ds.bd.R      12  86)   
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
f855a782 R/granovagg.ds.R       63  94)   
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
544a88ef R/granovagg.ds.R       61 100)   
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
f855a782 R/granovagg.ds.R       79 110)   
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
544a88ef R/granovagg.ds.R       73 122)     
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
544a88ef R/granovagg.ds.R       78 127)   
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
544a88ef R/granovagg.ds.R       86 135)   
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
482de62f R/granovagg.ds.R      133 141)     
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
482de62f R/granovagg.ds.R      136 144)   
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
c2605051 R/granova.ds.bd.R     182 156)   
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 158)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 159)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
c2605051 R/granova.ds.bd.R     187 165)   
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
c2605051 R/granova.ds.bd.R     191 175)   
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 188)   
a71441d3 R/granova.ds.ggplot.R  54 189)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 190)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 193)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 194)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
c2605051 R/granova.ds.bd.R     199 198)   
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 200)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a71441d3 R/granova.ds.ggplot.R  78 213)           )  
863d348b R/granova.ds.ggplot.R  82 214)   }
c2605051 R/granova.ds.bd.R     209 215)   
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
5f570d2d R/granova.ds.bd.R     190 224)     
863d348b R/granova.ds.ggplot.R  94 225)   }
c2605051 R/granova.ds.bd.R     224 226)   
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
73167de2 R/granovagg.ds.R      191 249)   
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 251)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 253)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
c2605051 R/granova.ds.bd.R     239 258)   
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a71441d3 R/granova.ds.ggplot.R 116 266)           )         
863d348b R/granova.ds.ggplot.R 125 267)   }
5e0fcbf9 R/granovagg.ds.R      249 268)   
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 273)     
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
1d932c76 R/granovagg.ds.R      256 276)   
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 291)     
1d932c76 R/granovagg.ds.R      272 292)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 293)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 294)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 295)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 296)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 297)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 298)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 299)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 300)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 301)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 302)                     t.value, 
1d932c76 R/granovagg.ds.R      283 303)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 304)                     p.value
1d932c76 R/granovagg.ds.R      285 305)                   ), 
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
1d932c76 R/granovagg.ds.R      290 310)   
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 313)                            c("n", 
1d932c76 R/granovagg.ds.R      294 314)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 327)                          
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
1d932c76 R/granovagg.ds.R      310 330)   
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 345)     
c2605051 R/granova.ds.bd.R     256 346)   
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
863d348b R/granova.ds.ggplot.R 143 351)   
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
c5a67319 R/granovagg.ds.R      347 355)         aes_string(x = dsp$data[1], 
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
e60e59e1 R/granova.ds.bd.R     241 361)     
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 380)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
0ae8f524 R/granovagg.ds.R      395 395)   
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
0ae8f524 R/granovagg.ds.R      400 400)     
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
0ae8f524 R/granovagg.ds.R      406 406)   } 
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 413)                    )  
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 423)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
c2605051 R/granova.ds.bd.R     271 426)   
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 433)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 434)           )
aaeade58 R/granova.ds.bd.R     274 435)     
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 443)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 448)                        )  
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 456)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 458)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
a71441d3 R/granova.ds.ggplot.R 236 469)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 472)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 487)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 488)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 494)   
<span class="changed">52d9cc47 R/granovagg.ds.R      495 495)     return(scale_color_manual(values = colors, name = ""))</span>
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
0afa3a38 R/granovagg.ds.R      311 503)     
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
0afa3a38 R/granovagg.ds.R      314 506)   
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
485d5f02 R/granovagg.ds.R      322 512)     
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
485d5f02 R/granovagg.ds.R      325 515)   
794c4b70 R/granova.ds.ggplot.R 296 516)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 517)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 518)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 519)     }
a2b6fe7d R/granovagg.ds.R      320 520)     
a2b6fe7d R/granovagg.ds.R      321 521)     else {
a2b6fe7d R/granovagg.ds.R      322 522)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 523)     }
863d348b R/granova.ds.ggplot.R 304 524)   }
b5b60529 R/granova.ds.ggplot.R 270 525)   
b5b60529 R/granova.ds.ggplot.R 271 526)   ForceCoordinateAxesToBeEqual &lt;- function() {
b5b60529 R/granova.ds.ggplot.R 272 527)     return(coord_fixed())
b5b60529 R/granova.ds.ggplot.R 273 528)   }
b5b60529 R/granova.ds.ggplot.R 274 529)   
3b102930 R/granova.ds.ggplot.R 275 530)           
3eb0e1f7 R/granova.ds.ggplot.R 304 531)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 532)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 533)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 534)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 535)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 536)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 537)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 538)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 539)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 540)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 541)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 542)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 543)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
64d0ca23 R/granova.ds.ggplot.R 284 544)   p &lt;- p + ForceCoordinateAxesToBeEqual()
0ae8f524 R/granovagg.ds.R      545 545)   p &lt;- p + PadViewingWindow(dsp$params)
3eb0e1f7 R/granova.ds.ggplot.R 318 546)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 547)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 548)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 549) 
482de62f R/granovagg.ds.R      528 550)   return(p)
5d58b37c R/granova.ds.bd.R     314 551) 
b3a74c98 R/granova.ds.bd.R     301 552) }
</pre>
<div class="compileroutput">
Replace "value" parameter with "values" in color scale calls<p>Fix trailing comma error in Scale function (thanks @koshke!)<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="9d25974"></a>
9d25974 2012-02-21 11:50:19 -0500
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
0ae8f524 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left, 
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart, 
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  54) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  55) #'
80f8f002 R/granovagg.ds.R       39  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  74)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
e55d776c R/granovagg.ds.R       42  83)                 ) 
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
d6c27487 R/granova.ds.bd.R      12  86)   
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
f855a782 R/granovagg.ds.R       63  94)   
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
544a88ef R/granovagg.ds.R       61 100)   
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
f855a782 R/granovagg.ds.R       79 110)   
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
544a88ef R/granovagg.ds.R       73 122)     
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
544a88ef R/granovagg.ds.R       78 127)   
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
544a88ef R/granovagg.ds.R       86 135)   
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
482de62f R/granovagg.ds.R      133 141)     
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
482de62f R/granovagg.ds.R      136 144)   
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
c2605051 R/granova.ds.bd.R     182 156)   
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 158)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 159)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
c2605051 R/granova.ds.bd.R     187 165)   
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
c2605051 R/granova.ds.bd.R     191 175)   
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 188)   
a71441d3 R/granova.ds.ggplot.R  54 189)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 190)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
b9014281 R/granova.ds.ggplot.R  57 193)                 point.size        = I(2),
a71441d3 R/granova.ds.ggplot.R  59 194)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
c2605051 R/granova.ds.bd.R     199 198)   
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 200)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a71441d3 R/granova.ds.ggplot.R  78 213)           )  
863d348b R/granova.ds.ggplot.R  82 214)   }
c2605051 R/granova.ds.bd.R     209 215)   
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
5f570d2d R/granova.ds.bd.R     190 224)     
863d348b R/granova.ds.ggplot.R  94 225)   }
c2605051 R/granova.ds.bd.R     224 226)   
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
73167de2 R/granovagg.ds.R      191 249)   
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 251)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 253)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
c2605051 R/granova.ds.bd.R     239 258)   
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a71441d3 R/granova.ds.ggplot.R 116 266)           )         
863d348b R/granova.ds.ggplot.R 125 267)   }
5e0fcbf9 R/granovagg.ds.R      249 268)   
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 273)     
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
1d932c76 R/granovagg.ds.R      256 276)   
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 291)     
1d932c76 R/granovagg.ds.R      272 292)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 293)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 294)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 295)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 296)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 297)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 298)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 299)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 300)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 301)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 302)                     t.value, 
1d932c76 R/granovagg.ds.R      283 303)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 304)                     p.value
1d932c76 R/granovagg.ds.R      285 305)                   ), 
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
1d932c76 R/granovagg.ds.R      290 310)   
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 313)                            c("n", 
1d932c76 R/granovagg.ds.R      294 314)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 327)                          
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
1d932c76 R/granovagg.ds.R      310 330)   
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 345)     
c2605051 R/granova.ds.bd.R     256 346)   
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
863d348b R/granova.ds.ggplot.R 143 351)   
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
c5a67319 R/granovagg.ds.R      347 355)         aes_string(x = dsp$data[1], 
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
e60e59e1 R/granova.ds.bd.R     241 361)     
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 380)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
0ae8f524 R/granovagg.ds.R      395 395)   
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
0ae8f524 R/granovagg.ds.R      400 400)     
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
0ae8f524 R/granovagg.ds.R      406 406)   } 
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 413)                    )  
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 423)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
c2605051 R/granova.ds.bd.R     271 426)   
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 433)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 434)           )
aaeade58 R/granova.ds.bd.R     274 435)     
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 443)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 448)                        )  
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 456)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 458)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
a71441d3 R/granova.ds.ggplot.R 236 469)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
a71441d3 R/granova.ds.ggplot.R 238 472)                       alpha = I(1/4) 
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 487)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 488)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 494)   
52d9cc47 R/granovagg.ds.R      495 495)     return(scale_color_manual(values = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
0afa3a38 R/granovagg.ds.R      311 503)     
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
0afa3a38 R/granovagg.ds.R      314 506)   
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
485d5f02 R/granovagg.ds.R      322 512)     
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
485d5f02 R/granovagg.ds.R      325 515)   
794c4b70 R/granova.ds.ggplot.R 296 516)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 517)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 518)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 519)     }
a2b6fe7d R/granovagg.ds.R      320 520)     
a2b6fe7d R/granovagg.ds.R      321 521)     else {
a2b6fe7d R/granovagg.ds.R      322 522)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 523)     }
863d348b R/granova.ds.ggplot.R 304 524)   }
b5b60529 R/granova.ds.ggplot.R 270 525)   
b5b60529 R/granova.ds.ggplot.R 271 526)   ForceCoordinateAxesToBeEqual &lt;- function() {
<span class="changed">9d259747 R/granovagg.ds.R      527 527)     return(coord_fixed(ratio = 1))</span>
b5b60529 R/granova.ds.ggplot.R 273 528)   }
b5b60529 R/granova.ds.ggplot.R 274 529)   
3b102930 R/granova.ds.ggplot.R 275 530)           
3eb0e1f7 R/granova.ds.ggplot.R 304 531)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 532)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 533)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 534)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 535)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 536)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 537)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 538)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 539)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 540)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 541)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 542)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 543)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
0ae8f524 R/granovagg.ds.R      545 544)   p &lt;- p + PadViewingWindow(dsp$params)
<span class="changed">9d259747 R/granovagg.ds.R      545 545)   p &lt;- p + ForceCoordinateAxesToBeEqual()</span>
3eb0e1f7 R/granova.ds.ggplot.R 318 546)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 547)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 548)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 549) 
482de62f R/granovagg.ds.R      528 550)   return(p)
5d58b37c R/granova.ds.bd.R     314 551) 
b3a74c98 R/granova.ds.bd.R     301 552) }
</pre>
<div class="compileroutput">
Make .ds axes equal *after* padding the viewing window<p>Fixes #144<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="8dc6cf2"></a>
8dc6cf2 2012-02-21 12:33:38 -0500
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
743b4d68 R/granovagg.ds.R        2   2) #' 
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
743b4d68 R/granovagg.ds.R        5   6) #' 
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
61fb56e0 R/granovagg.ds.R       23  23) #' accommodated. 
61fb56e0 R/granovagg.ds.R       24  24) #' 
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
743b4d68 R/granovagg.ds.R       29  33) #' 
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
d6884e47 R/granovagg.ds.R       34  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test. 
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
0ae8f524 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left, 
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart, 
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
485d5f02 R/granovagg.ds.R       35  54) #' @return Returns a plot object of class \code{ggplot}. 
80f8f002 R/granovagg.ds.R       38  55) #'
80f8f002 R/granovagg.ds.R       39  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr 
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
80f8f002 R/granovagg.ds.R       43  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr 
80f8f002 R/granovagg.ds.R       44  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr 
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
f855a782 R/granovagg.ds.R       47  74)                          revc       = FALSE, 
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
e55d776c R/granovagg.ds.R       42  83)                 ) 
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
d6c27487 R/granova.ds.bd.R      12  86)   
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
f855a782 R/granovagg.ds.R       63  94)   
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
544a88ef R/granovagg.ds.R       61 100)   
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
f855a782 R/granovagg.ds.R       79 110)   
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
544a88ef R/granovagg.ds.R       73 122)     
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
544a88ef R/granovagg.ds.R       78 127)   
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
544a88ef R/granovagg.ds.R       86 135)   
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
482de62f R/granovagg.ds.R      133 141)     
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
482de62f R/granovagg.ds.R      136 144)   
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
c2605051 R/granova.ds.bd.R     182 156)   
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a71441d3 R/granova.ds.ggplot.R  22 158)     return(t.test(data[, 1], 
a71441d3 R/granova.ds.ggplot.R  23 159)                   data[, 2], 
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
c2605051 R/granova.ds.bd.R     187 165)   
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
c2605051 R/granova.ds.bd.R     191 175)   
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a71441d3 R/granova.ds.ggplot.R  43 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))    
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
c2605051 R/granova.ds.bd.R     195 188)   
a71441d3 R/granova.ds.ggplot.R  54 189)     return(list(square.data.range = .square.data.range,    
a71441d3 R/granova.ds.ggplot.R  55 190)                 bounds            = .bounds,  
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
<span class="changed">8dc6cf2b R/granovagg.ds.R      193 193)                 point.size        = I(2.5),</span>
a71441d3 R/granova.ds.ggplot.R  59 194)                 mean.line.size    = I(1/2)      
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
c2605051 R/granova.ds.bd.R     199 198)   
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  65 200)     x.shadow &lt;- (dsp$effect / 2) + 
48638496 R/granova.ds.ggplot.R  66 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 + 
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a71441d3 R/granova.ds.ggplot.R  78 213)           )  
863d348b R/granova.ds.ggplot.R  82 214)   }
c2605051 R/granova.ds.bd.R     209 215)   
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
5f570d2d R/granova.ds.bd.R     190 224)     
863d348b R/granova.ds.ggplot.R  94 225)   }
c2605051 R/granova.ds.bd.R     224 226)   
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
73167de2 R/granovagg.ds.R      191 249)   
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 101 251)     return(data.frame(x.trail.start = GetXs(dsp$data), 
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 103 253)                       x.trail.end   = GetXs(dsp$shadow), 
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
c2605051 R/granova.ds.bd.R     239 258)   
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a71441d3 R/granova.ds.ggplot.R 116 266)           )         
863d348b R/granova.ds.ggplot.R 125 267)   }
5e0fcbf9 R/granovagg.ds.R      249 268)   
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
1d932c76 R/granovagg.ds.R      253 273)     
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
1d932c76 R/granovagg.ds.R      256 276)   
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
5e0fcbf9 R/granovagg.ds.R      252 291)     
1d932c76 R/granovagg.ds.R      272 292)     return(matrix(c(n, 
1d932c76 R/granovagg.ds.R      273 293)                     mean.1, 
1d932c76 R/granovagg.ds.R      274 294)                     mean.2, 
1d932c76 R/granovagg.ds.R      275 295)                     mean.d, 
1d932c76 R/granovagg.ds.R      276 296)                     standard.deviation.d, 
1d932c76 R/granovagg.ds.R      277 297)                     effect.size, 
1d932c76 R/granovagg.ds.R      278 298)                     r.xy, 
1d932c76 R/granovagg.ds.R      279 299)                     r.x.plus.y.d, 
1d932c76 R/granovagg.ds.R      280 300)                     lower.treatment.confidence, 
1d932c76 R/granovagg.ds.R      281 301)                     upper.treatment.confidence, 
1d932c76 R/granovagg.ds.R      282 302)                     t.value, 
1d932c76 R/granovagg.ds.R      283 303)                     degrees.of.freedom, 
1d932c76 R/granovagg.ds.R      284 304)                     p.value
1d932c76 R/granovagg.ds.R      285 305)                   ), 
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
1d932c76 R/granovagg.ds.R      290 310)   
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
1d932c76 R/granovagg.ds.R      293 313)                            c("n", 
1d932c76 R/granovagg.ds.R      294 314)                              paste(colnames(dsp$data)[1], "mean"), 
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
1d932c76 R/granovagg.ds.R      307 327)                          
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
1d932c76 R/granovagg.ds.R      310 330)   
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
863d348b R/granova.ds.ggplot.R 137 345)     
c2605051 R/granova.ds.bd.R     256 346)   
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
863d348b R/granova.ds.ggplot.R 143 351)   
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
c5a67319 R/granovagg.ds.R      347 355)         aes_string(x = dsp$data[1], 
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
e60e59e1 R/granova.ds.bd.R     241 361)     
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a71441d3 R/granova.ds.ggplot.R 162 380)     return(geom_abline(slope     = 1, 
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
0ae8f524 R/granovagg.ds.R      395 395)   
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
0ae8f524 R/granovagg.ds.R      400 400)     
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
0ae8f524 R/granovagg.ds.R      406 406)   } 
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
a71441d3 R/granova.ds.ggplot.R 182 413)                    )  
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 191 423)                      ) 
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
c2605051 R/granova.ds.bd.R     271 426)   
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
a71441d3 R/granova.ds.ggplot.R 200 433)                      ) 
a71441d3 R/granova.ds.ggplot.R 201 434)           )
aaeade58 R/granova.ds.bd.R     274 435)     
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
a71441d3 R/granova.ds.ggplot.R 210 443)                            ), 
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
a71441d3 R/granova.ds.ggplot.R 215 448)                        )  
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
0d72518f R/granovagg.ds.R      304 456)                             yend  = y.end,                        
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
a71441d3 R/granova.ds.ggplot.R 225 458)                            ), 
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
a71441d3 R/granova.ds.ggplot.R 236 469)                       data  = dsp$shadow, 
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
<span class="changed">8dc6cf2b R/granovagg.ds.R      472 472)                       alpha = I(1/2) </span>
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
a71441d3 R/granova.ds.ggplot.R 253 487)                         alpha    = I(1/10)              
a71441d3 R/granova.ds.ggplot.R 254 488)                        ) 
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
863d348b R/granova.ds.ggplot.R 294 494)   
52d9cc47 R/granovagg.ds.R      495 495)     return(scale_color_manual(values = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
0afa3a38 R/granovagg.ds.R      311 503)     
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
0afa3a38 R/granovagg.ds.R      314 506)   
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
485d5f02 R/granovagg.ds.R      322 512)     
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
485d5f02 R/granovagg.ds.R      325 515)   
794c4b70 R/granova.ds.ggplot.R 296 516)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 517)     if (main == "default_granova_title") {
a2b6fe7d R/granovagg.ds.R      318 518)       return(opts(title = "Dependent Sample Assessment Plot"))
a2b6fe7d R/granovagg.ds.R      319 519)     }
a2b6fe7d R/granovagg.ds.R      320 520)     
a2b6fe7d R/granovagg.ds.R      321 521)     else {
a2b6fe7d R/granovagg.ds.R      322 522)       return(opts(title = main))
a2b6fe7d R/granovagg.ds.R      323 523)     }
863d348b R/granova.ds.ggplot.R 304 524)   }
b5b60529 R/granova.ds.ggplot.R 270 525)   
b5b60529 R/granova.ds.ggplot.R 271 526)   ForceCoordinateAxesToBeEqual &lt;- function() {
9d259747 R/granovagg.ds.R      527 527)     return(coord_fixed(ratio = 1))
b5b60529 R/granova.ds.ggplot.R 273 528)   }
b5b60529 R/granova.ds.ggplot.R 274 529)   
3b102930 R/granova.ds.ggplot.R 275 530)           
3eb0e1f7 R/granova.ds.ggplot.R 304 531)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 532)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 533)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 534)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 535)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 536)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 537)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 538)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 539)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 540)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 541)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 542)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 543)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
0ae8f524 R/granovagg.ds.R      545 544)   p &lt;- p + PadViewingWindow(dsp$params)
9d259747 R/granovagg.ds.R      545 545)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 546)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 547)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 548)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 549) 
482de62f R/granovagg.ds.R      528 550)   return(p)
5d58b37c R/granova.ds.bd.R     314 551) 
b3a74c98 R/granova.ds.bd.R     301 552) }
</pre>
<div class="compileroutput">
Enlarge points in .ds graphic; Make difference points more opaque<p>Fixes #145<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="a711483"></a>
a711483 2012-08-10 11:18:19 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
<span class="changed">a7114834 R/granovagg.ds.R        2   2) #'</span>
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
<span class="changed">a7114834 R/granovagg.ds.R        6   6) #'</span>
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
<span class="changed">a7114834 R/granovagg.ds.R       23  23) #' accommodated.</span>
<span class="changed">a7114834 R/granovagg.ds.R       24  24) #'</span>
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
<span class="changed">a7114834 R/granovagg.ds.R       33  33) #'</span>
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
<span class="changed">a7114834 R/granovagg.ds.R       43  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test.</span>
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
<span class="changed">a7114834 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left,</span>
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
<span class="changed">a7114834 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart,</span>
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
<span class="changed">a7114834 R/granovagg.ds.R       54  54) #' @return Returns a plot object of class \code{ggplot}.</span>
80f8f002 R/granovagg.ds.R       38  55) #'
<span class="changed">a7114834 R/granovagg.ds.R       56  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr</span>
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
<span class="changed">a7114834 R/granovagg.ds.R       60  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr</span>
<span class="changed">a7114834 R/granovagg.ds.R       61  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr</span>
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
<span class="changed">a7114834 R/granovagg.ds.R       74  74)                          revc       = FALSE,</span>
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
<span class="changed">a7114834 R/granovagg.ds.R       83  83)                 )</span>
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
<span class="changed">a7114834 R/granovagg.ds.R       86  86) </span>
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
<span class="changed">a7114834 R/granovagg.ds.R       94  94) </span>
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
<span class="changed">a7114834 R/granovagg.ds.R      100 100) </span>
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
<span class="changed">a7114834 R/granovagg.ds.R      110 110) </span>
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
<span class="changed">a7114834 R/granovagg.ds.R      122 122) </span>
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
<span class="changed">a7114834 R/granovagg.ds.R      127 127) </span>
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
<span class="changed">a7114834 R/granovagg.ds.R      135 135) </span>
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
<span class="changed">a7114834 R/granovagg.ds.R      141 141) </span>
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
<span class="changed">a7114834 R/granovagg.ds.R      144 144) </span>
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
<span class="changed">a7114834 R/granovagg.ds.R      156 156) </span>
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
<span class="changed">a7114834 R/granovagg.ds.R      158 158)     return(t.test(data[, 1],</span>
<span class="changed">a7114834 R/granovagg.ds.R      159 159)                   data[, 2],</span>
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
<span class="changed">a7114834 R/granovagg.ds.R      165 165) </span>
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
<span class="changed">a7114834 R/granovagg.ds.R      175 175) </span>
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
<span class="changed">a7114834 R/granovagg.ds.R      178 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))</span>
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
<span class="changed">a7114834 R/granovagg.ds.R      188 188) </span>
<span class="changed">a7114834 R/granovagg.ds.R      189 189)     return(list(square.data.range = .square.data.range,</span>
<span class="changed">a7114834 R/granovagg.ds.R      190 190)                 bounds            = .bounds,</span>
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
8dc6cf2b R/granovagg.ds.R      193 193)                 point.size        = I(2.5),
<span class="changed">a7114834 R/granovagg.ds.R      194 194)                 mean.line.size    = I(1/2)</span>
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
<span class="changed">a7114834 R/granovagg.ds.R      198 198) </span>
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
<span class="changed">a7114834 R/granovagg.ds.R      200 200)     x.shadow &lt;- (dsp$effect / 2) +</span>
<span class="changed">a7114834 R/granovagg.ds.R      201 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 +</span>
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
<span class="changed">a7114834 R/granovagg.ds.R      213 213)           )</span>
863d348b R/granova.ds.ggplot.R  82 214)   }
<span class="changed">a7114834 R/granovagg.ds.R      215 215) </span>
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
<span class="changed">a7114834 R/granovagg.ds.R      224 224) </span>
863d348b R/granova.ds.ggplot.R  94 225)   }
<span class="changed">a7114834 R/granovagg.ds.R      226 226) </span>
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
<span class="changed">a7114834 R/granovagg.ds.R      249 249) </span>
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
<span class="changed">a7114834 R/granovagg.ds.R      251 251)     return(data.frame(x.trail.start = GetXs(dsp$data),</span>
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
<span class="changed">a7114834 R/granovagg.ds.R      253 253)                       x.trail.end   = GetXs(dsp$shadow),</span>
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
<span class="changed">a7114834 R/granovagg.ds.R      258 258) </span>
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
<span class="changed">a7114834 R/granovagg.ds.R      266 266)           )</span>
863d348b R/granova.ds.ggplot.R 125 267)   }
<span class="changed">a7114834 R/granovagg.ds.R      268 268) </span>
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
<span class="changed">a7114834 R/granovagg.ds.R      273 273) </span>
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
<span class="changed">a7114834 R/granovagg.ds.R      276 276) </span>
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
<span class="changed">a7114834 R/granovagg.ds.R      291 291) </span>
<span class="changed">a7114834 R/granovagg.ds.R      292 292)     return(matrix(c(n,</span>
<span class="changed">a7114834 R/granovagg.ds.R      293 293)                     mean.1,</span>
<span class="changed">a7114834 R/granovagg.ds.R      294 294)                     mean.2,</span>
<span class="changed">a7114834 R/granovagg.ds.R      295 295)                     mean.d,</span>
<span class="changed">a7114834 R/granovagg.ds.R      296 296)                     standard.deviation.d,</span>
<span class="changed">a7114834 R/granovagg.ds.R      297 297)                     effect.size,</span>
<span class="changed">a7114834 R/granovagg.ds.R      298 298)                     r.xy,</span>
<span class="changed">a7114834 R/granovagg.ds.R      299 299)                     r.x.plus.y.d,</span>
<span class="changed">a7114834 R/granovagg.ds.R      300 300)                     lower.treatment.confidence,</span>
<span class="changed">a7114834 R/granovagg.ds.R      301 301)                     upper.treatment.confidence,</span>
<span class="changed">a7114834 R/granovagg.ds.R      302 302)                     t.value,</span>
<span class="changed">a7114834 R/granovagg.ds.R      303 303)                     degrees.of.freedom,</span>
1d932c76 R/granovagg.ds.R      284 304)                     p.value
<span class="changed">a7114834 R/granovagg.ds.R      305 305)                   ),</span>
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
<span class="changed">a7114834 R/granovagg.ds.R      310 310) </span>
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
<span class="changed">a7114834 R/granovagg.ds.R      313 313)                            c("n",</span>
<span class="changed">a7114834 R/granovagg.ds.R      314 314)                              paste(colnames(dsp$data)[1], "mean"),</span>
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
<span class="changed">a7114834 R/granovagg.ds.R      327 327) </span>
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
<span class="changed">a7114834 R/granovagg.ds.R      330 330) </span>
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
<span class="changed">a7114834 R/granovagg.ds.R      345 345) </span>
<span class="changed">a7114834 R/granovagg.ds.R      346 346) </span>
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
<span class="changed">a7114834 R/granovagg.ds.R      351 351) </span>
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
<span class="changed">a7114834 R/granovagg.ds.R      355 355)         aes_string(x = dsp$data[1],</span>
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
<span class="changed">a7114834 R/granovagg.ds.R      361 361) </span>
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
<span class="changed">a7114834 R/granovagg.ds.R      380 380)     return(geom_abline(slope     = 1,</span>
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
<span class="changed">a7114834 R/granovagg.ds.R      395 395) </span>
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
<span class="changed">a7114834 R/granovagg.ds.R      400 400) </span>
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
<span class="changed">a7114834 R/granovagg.ds.R      406 406)   }</span>
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
<span class="changed">a7114834 R/granovagg.ds.R      413 413)                    )</span>
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
<span class="changed">a7114834 R/granovagg.ds.R      423 423)                      )</span>
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
<span class="changed">a7114834 R/granovagg.ds.R      426 426) </span>
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
<span class="changed">a7114834 R/granovagg.ds.R      433 433)                      )</span>
a71441d3 R/granova.ds.ggplot.R 201 434)           )
<span class="changed">a7114834 R/granovagg.ds.R      435 435) </span>
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
<span class="changed">a7114834 R/granovagg.ds.R      443 443)                            ),</span>
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
<span class="changed">a7114834 R/granovagg.ds.R      448 448)                        )</span>
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
<span class="changed">a7114834 R/granovagg.ds.R      456 456)                             yend  = y.end,</span>
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
<span class="changed">a7114834 R/granovagg.ds.R      458 458)                            ),</span>
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
<span class="changed">a7114834 R/granovagg.ds.R      469 469)                       data  = dsp$shadow,</span>
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
<span class="changed">a7114834 R/granovagg.ds.R      472 472)                       alpha = I(1/2)</span>
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
<span class="changed">a7114834 R/granovagg.ds.R      487 487)                         alpha    = I(1/10)</span>
<span class="changed">a7114834 R/granovagg.ds.R      488 488)                        )</span>
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
<span class="changed">a7114834 R/granovagg.ds.R      494 494) </span>
52d9cc47 R/granovagg.ds.R      495 495)     return(scale_color_manual(values = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
<span class="changed">a7114834 R/granovagg.ds.R      503 503) </span>
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
<span class="changed">a7114834 R/granovagg.ds.R      506 506) </span>
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
<span class="changed">a7114834 R/granovagg.ds.R      512 512) </span>
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
<span class="changed">a7114834 R/granovagg.ds.R      515 515) </span>
794c4b70 R/granova.ds.ggplot.R 296 516)   Title &lt;- function() {
a2b6fe7d R/granovagg.ds.R      317 517)     if (main == "default_granova_title") {
<span class="changed">a7114834 R/granovagg.ds.R      518 518)       return(theme(title = "Dependent Sample Assessment Plot"))</span>
a2b6fe7d R/granovagg.ds.R      319 519)     }
<span class="changed">a7114834 R/granovagg.ds.R      520 520) </span>
a2b6fe7d R/granovagg.ds.R      321 521)     else {
<span class="changed">a7114834 R/granovagg.ds.R      522 522)       return(theme(title = main))</span>
a2b6fe7d R/granovagg.ds.R      323 523)     }
863d348b R/granova.ds.ggplot.R 304 524)   }
<span class="changed">a7114834 R/granovagg.ds.R      525 525) </span>
b5b60529 R/granova.ds.ggplot.R 271 526)   ForceCoordinateAxesToBeEqual &lt;- function() {
9d259747 R/granovagg.ds.R      527 527)     return(coord_fixed(ratio = 1))
b5b60529 R/granova.ds.ggplot.R 273 528)   }
<span class="changed">a7114834 R/granovagg.ds.R      529 529) </span>
<span class="changed">a7114834 R/granovagg.ds.R      530 530) </span>
3eb0e1f7 R/granova.ds.ggplot.R 304 531)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 532)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 533)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 534)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 535)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 536)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 537)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 538)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 539)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 540)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 541)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 542)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 543)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
0ae8f524 R/granovagg.ds.R      545 544)   p &lt;- p + PadViewingWindow(dsp$params)
9d259747 R/granovagg.ds.R      545 545)   p &lt;- p + ForceCoordinateAxesToBeEqual()
3eb0e1f7 R/granova.ds.ggplot.R 318 546)   p &lt;- p + Title()
0afa3a38 R/granovagg.ds.R      345 547)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 548)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 549) 
482de62f R/granovagg.ds.R      528 550)   return(p)
5d58b37c R/granova.ds.bd.R     314 551) 
b3a74c98 R/granova.ds.bd.R     301 552) }
</pre>
<div class="compileroutput">
Replace "opts()" calls with "theme()" calls<p>Part of accommodating the new ggplot2 0.9.2 theme system changes<br>
<br>
Also: whitespace changes<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="74d74c4"></a>
74d74c4 2012-08-10 11:33:57 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
a7114834 R/granovagg.ds.R        2   2) #'
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
a7114834 R/granovagg.ds.R        6   6) #'
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
a7114834 R/granovagg.ds.R       23  23) #' accommodated.
a7114834 R/granovagg.ds.R       24  24) #'
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
a7114834 R/granovagg.ds.R       33  33) #'
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
a7114834 R/granovagg.ds.R       43  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test.
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
a7114834 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left,
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
a7114834 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart,
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
a7114834 R/granovagg.ds.R       54  54) #' @return Returns a plot object of class \code{ggplot}.
80f8f002 R/granovagg.ds.R       38  55) #'
a7114834 R/granovagg.ds.R       56  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
a7114834 R/granovagg.ds.R       60  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr
a7114834 R/granovagg.ds.R       61  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
a7114834 R/granovagg.ds.R       74  74)                          revc       = FALSE,
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
a7114834 R/granovagg.ds.R       83  83)                 )
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
a7114834 R/granovagg.ds.R       86  86) 
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
a7114834 R/granovagg.ds.R       94  94) 
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
a7114834 R/granovagg.ds.R      100 100) 
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
a7114834 R/granovagg.ds.R      110 110) 
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
a7114834 R/granovagg.ds.R      122 122) 
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
a7114834 R/granovagg.ds.R      127 127) 
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
a7114834 R/granovagg.ds.R      135 135) 
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
a7114834 R/granovagg.ds.R      141 141) 
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
a7114834 R/granovagg.ds.R      144 144) 
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
a7114834 R/granovagg.ds.R      156 156) 
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a7114834 R/granovagg.ds.R      158 158)     return(t.test(data[, 1],
a7114834 R/granovagg.ds.R      159 159)                   data[, 2],
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
a7114834 R/granovagg.ds.R      165 165) 
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
a7114834 R/granovagg.ds.R      175 175) 
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a7114834 R/granovagg.ds.R      178 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
a7114834 R/granovagg.ds.R      188 188) 
a7114834 R/granovagg.ds.R      189 189)     return(list(square.data.range = .square.data.range,
a7114834 R/granovagg.ds.R      190 190)                 bounds            = .bounds,
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
8dc6cf2b R/granovagg.ds.R      193 193)                 point.size        = I(2.5),
a7114834 R/granovagg.ds.R      194 194)                 mean.line.size    = I(1/2)
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
a7114834 R/granovagg.ds.R      198 198) 
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
a7114834 R/granovagg.ds.R      200 200)     x.shadow &lt;- (dsp$effect / 2) +
a7114834 R/granovagg.ds.R      201 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 +
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a7114834 R/granovagg.ds.R      213 213)           )
863d348b R/granova.ds.ggplot.R  82 214)   }
a7114834 R/granovagg.ds.R      215 215) 
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
a7114834 R/granovagg.ds.R      224 224) 
863d348b R/granova.ds.ggplot.R  94 225)   }
a7114834 R/granovagg.ds.R      226 226) 
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
a7114834 R/granovagg.ds.R      249 249) 
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a7114834 R/granovagg.ds.R      251 251)     return(data.frame(x.trail.start = GetXs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a7114834 R/granovagg.ds.R      253 253)                       x.trail.end   = GetXs(dsp$shadow),
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
a7114834 R/granovagg.ds.R      258 258) 
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a7114834 R/granovagg.ds.R      266 266)           )
863d348b R/granova.ds.ggplot.R 125 267)   }
a7114834 R/granovagg.ds.R      268 268) 
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
a7114834 R/granovagg.ds.R      273 273) 
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
a7114834 R/granovagg.ds.R      276 276) 
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
a7114834 R/granovagg.ds.R      291 291) 
a7114834 R/granovagg.ds.R      292 292)     return(matrix(c(n,
a7114834 R/granovagg.ds.R      293 293)                     mean.1,
a7114834 R/granovagg.ds.R      294 294)                     mean.2,
a7114834 R/granovagg.ds.R      295 295)                     mean.d,
a7114834 R/granovagg.ds.R      296 296)                     standard.deviation.d,
a7114834 R/granovagg.ds.R      297 297)                     effect.size,
a7114834 R/granovagg.ds.R      298 298)                     r.xy,
a7114834 R/granovagg.ds.R      299 299)                     r.x.plus.y.d,
a7114834 R/granovagg.ds.R      300 300)                     lower.treatment.confidence,
a7114834 R/granovagg.ds.R      301 301)                     upper.treatment.confidence,
a7114834 R/granovagg.ds.R      302 302)                     t.value,
a7114834 R/granovagg.ds.R      303 303)                     degrees.of.freedom,
1d932c76 R/granovagg.ds.R      284 304)                     p.value
a7114834 R/granovagg.ds.R      305 305)                   ),
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
a7114834 R/granovagg.ds.R      310 310) 
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
a7114834 R/granovagg.ds.R      313 313)                            c("n",
a7114834 R/granovagg.ds.R      314 314)                              paste(colnames(dsp$data)[1], "mean"),
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
a7114834 R/granovagg.ds.R      327 327) 
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
a7114834 R/granovagg.ds.R      330 330) 
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
a7114834 R/granovagg.ds.R      345 345) 
a7114834 R/granovagg.ds.R      346 346) 
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
a7114834 R/granovagg.ds.R      351 351) 
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
a7114834 R/granovagg.ds.R      355 355)         aes_string(x = dsp$data[1],
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
a7114834 R/granovagg.ds.R      361 361) 
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a7114834 R/granovagg.ds.R      380 380)     return(geom_abline(slope     = 1,
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
a7114834 R/granovagg.ds.R      395 395) 
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
a7114834 R/granovagg.ds.R      400 400) 
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
a7114834 R/granovagg.ds.R      406 406)   }
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
35c32862 R/granova.ds.ggplot.R 179 409)     return(geom_rug_alt(size  = I(1/2),
35c32862 R/granova.ds.ggplot.R 180 410)                         alpha = I(1/3),
35c32862 R/granova.ds.ggplot.R 181 411)                         color = dsp$colors$rugplot,
35c32862 R/granova.ds.ggplot.R 182 412)                         data  = dsp$data
a7114834 R/granovagg.ds.R      413 413)                    )
a71441d3 R/granova.ds.ggplot.R 183 414)           )
863d348b R/granova.ds.ggplot.R 202 415)   }
863d348b R/granova.ds.ggplot.R 203 416) 
794c4b70 R/granova.ds.ggplot.R 202 417)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 418)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 419)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 420)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 421)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 422)                       alpha      = I(1/2)
a7114834 R/granovagg.ds.R      423 423)                      )
a71441d3 R/granova.ds.ggplot.R 192 424)           )
863d348b R/granova.ds.ggplot.R 213 425)   }
a7114834 R/granovagg.ds.R      426 426) 
794c4b70 R/granova.ds.ggplot.R 213 427)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 428)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 429)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 430)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 431)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 432)                       alpha      = I(1/2)
a7114834 R/granovagg.ds.R      433 433)                      )
a71441d3 R/granova.ds.ggplot.R 201 434)           )
a7114834 R/granovagg.ds.R      435 435) 
863d348b R/granova.ds.ggplot.R 225 436)   }
863d348b R/granova.ds.ggplot.R 226 437) 
794c4b70 R/granova.ds.ggplot.R 225 438)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 439)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 440)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 441)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 442)                             yend = y.end
a7114834 R/granovagg.ds.R      443 443)                            ),
a71441d3 R/granova.ds.ggplot.R 211 444)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 445)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 446)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 447)                         data  = dsp$crossbow
a7114834 R/granovagg.ds.R      448 448)                        )
a71441d3 R/granova.ds.ggplot.R 216 449)           )
863d348b R/granova.ds.ggplot.R 242 450)   }
863d348b R/granova.ds.ggplot.R 243 451) 
794c4b70 R/granova.ds.ggplot.R 242 452)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 453)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 454)                             y     = y,
0d72518f R/granovagg.ds.R      303 455)                             xend  = x.end,
a7114834 R/granovagg.ds.R      456 456)                             yend  = y.end,
a71441d3 R/granova.ds.ggplot.R 224 457)                             color = color
a7114834 R/granovagg.ds.R      458 458)                            ),
a71441d3 R/granova.ds.ggplot.R 226 459)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 460)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 461)                        )
a71441d3 R/granova.ds.ggplot.R 229 462)           )
863d348b R/granova.ds.ggplot.R 258 463)   }
863d348b R/granova.ds.ggplot.R 259 464) 
794c4b70 R/granova.ds.ggplot.R 258 465)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 466)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 467)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 468)                          ),
a7114834 R/granovagg.ds.R      469 469)                       data  = dsp$shadow,
48638496 R/granova.ds.ggplot.R 237 470)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 471)                       shape = 16,
a7114834 R/granovagg.ds.R      472 472)                       alpha = I(1/2)
a71441d3 R/granova.ds.ggplot.R 239 473)                      )
a71441d3 R/granova.ds.ggplot.R 240 474)           )
863d348b R/granova.ds.ggplot.R 272 475)   }
863d348b R/granova.ds.ggplot.R 273 476) 
794c4b70 R/granova.ds.ggplot.R 272 477)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 478)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 479)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 480)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 481)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 482)                            ),
a71441d3 R/granova.ds.ggplot.R 249 483)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 484)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 485)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 486)                         linetype = 1,
a7114834 R/granovagg.ds.R      487 487)                         alpha    = I(1/10)
a7114834 R/granovagg.ds.R      488 488)                        )
a71441d3 R/granova.ds.ggplot.R 255 489)           )
863d348b R/granova.ds.ggplot.R 290 490)   }
863d348b R/granova.ds.ggplot.R 291 491) 
ef841aa1 R/granova.ds.ggplot.R 257 492)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 493)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
a7114834 R/granovagg.ds.R      494 494) 
52d9cc47 R/granovagg.ds.R      495 495)     return(scale_color_manual(values = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 496)   }
863d348b R/granova.ds.ggplot.R 297 497) 
0afa3a38 R/granovagg.ds.R      306 498)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 499)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 500)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 501)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 502)     }
a7114834 R/granovagg.ds.R      503 503) 
0afa3a38 R/granovagg.ds.R      312 504)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 505)   }
a7114834 R/granovagg.ds.R      506 506) 
485d5f02 R/granovagg.ds.R      317 507)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 508)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 509)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 510)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 511)     }
a7114834 R/granovagg.ds.R      512 512) 
485d5f02 R/granovagg.ds.R      323 513)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 514)   }
a7114834 R/granovagg.ds.R      515 515) 
<span class="changed">74d74c41 R/granovagg.ds.R      516 516)   Title &lt;- function(main) {</span>
<span class="changed">74d74c41 R/granovagg.ds.R      517 517)     output.title &lt;- "Dependent Sample Assessment Plot"</span>
<span class="changed">74d74c41 R/granovagg.ds.R      518 518)     if (main != "default_granova_title") {</span>
<span class="changed">74d74c41 R/granovagg.ds.R      519 519)       output.title &lt;- main</span>
a2b6fe7d R/granovagg.ds.R      319 520)     }
a7114834 R/granovagg.ds.R      520 521) 
<span class="changed">74d74c41 R/granovagg.ds.R      522 522)     return(</span>
<span class="changed">74d74c41 R/granovagg.ds.R      523 523)       ggtitle(output.title)</span>
<span class="changed">74d74c41 R/granovagg.ds.R      524 524)     )</span>
<span class="changed">74d74c41 R/granovagg.ds.R      525 525) </span>
863d348b R/granova.ds.ggplot.R 304 526)   }
a7114834 R/granovagg.ds.R      525 527) 
b5b60529 R/granova.ds.ggplot.R 271 528)   ForceCoordinateAxesToBeEqual &lt;- function() {
9d259747 R/granovagg.ds.R      527 529)     return(coord_fixed(ratio = 1))
b5b60529 R/granova.ds.ggplot.R 273 530)   }
a7114834 R/granovagg.ds.R      529 531) 
a7114834 R/granovagg.ds.R      530 532) 
3eb0e1f7 R/granova.ds.ggplot.R 304 533)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 534)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 535)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 536)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 537)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 538)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 539)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 540)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 541)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 542)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 543)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 544)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 545)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
0ae8f524 R/granovagg.ds.R      545 546)   p &lt;- p + PadViewingWindow(dsp$params)
9d259747 R/granovagg.ds.R      545 547)   p &lt;- p + ForceCoordinateAxesToBeEqual()
<span class="changed">74d74c41 R/granovagg.ds.R      548 548)   p &lt;- p + Title(main)</span>
0afa3a38 R/granovagg.ds.R      345 549)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 550)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 551) 
482de62f R/granovagg.ds.R      528 552)   return(p)
5d58b37c R/granova.ds.bd.R     314 553) 
b3a74c98 R/granova.ds.bd.R     301 554) }
</pre>
<div class="compileroutput">
Reimplement Titling behavior in granovagg.ds<p>For compliance with the new theming system in ggplot2<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="1656d5b"></a>
1656d5b 2012-08-16 15:42:25 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
a7114834 R/granovagg.ds.R        2   2) #'
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
a7114834 R/granovagg.ds.R        6   6) #'
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
a7114834 R/granovagg.ds.R       23  23) #' accommodated.
a7114834 R/granovagg.ds.R       24  24) #'
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
a7114834 R/granovagg.ds.R       33  33) #'
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
a7114834 R/granovagg.ds.R       43  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test.
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
a7114834 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left,
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
a7114834 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart,
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
a7114834 R/granovagg.ds.R       54  54) #' @return Returns a plot object of class \code{ggplot}.
80f8f002 R/granovagg.ds.R       38  55) #'
a7114834 R/granovagg.ds.R       56  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
a7114834 R/granovagg.ds.R       60  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr
a7114834 R/granovagg.ds.R       61  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
48265964 R/granovagg.ds.R       59  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}},
48265964 R/granovagg.ds.R       60  66) #'   \code{\link{geom_rug_alt}}
48265964 R/granovagg.ds.R       61  67) #'
19d1b011 R/granovagg.ds.R       42  68) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  69) #' @export
be5c4c16 R/granovagg.ds.R       64  70) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  71) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  72) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  73) granovagg.ds &lt;- function(data       = NULL,
a7114834 R/granovagg.ds.R       74  74)                          revc       = FALSE,
e55d776c R/granovagg.ds.R       39  75)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  76)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  77)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  78)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  79)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  80)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  81)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  82)                          ...
a7114834 R/granovagg.ds.R       83  83)                 )
be2e6fbd R/granova.ds.bd.R      19  84) 
be2e6fbd R/granova.ds.bd.R      20  85) {
a7114834 R/granovagg.ds.R       86  86) 
f855a782 R/granovagg.ds.R       58  87)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  88)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  89)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  90)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  91)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  92)     return(data)
f855a782 R/granovagg.ds.R       62  93)   }
a7114834 R/granovagg.ds.R       94  94) 
f855a782 R/granovagg.ds.R       64  95)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  96)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  97)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  98)     return(data)
544a88ef R/granovagg.ds.R       60  99)   }
a7114834 R/granovagg.ds.R      100 100) 
f855a782 R/granovagg.ds.R       70 101)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 102)     output &lt;- data
f855a782 R/granovagg.ds.R       72 103)     if (revc) {
f855a782 R/granovagg.ds.R       73 104)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 105)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 106)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 107)     }
f855a782 R/granovagg.ds.R       77 108)     return(output)
f855a782 R/granovagg.ds.R       78 109)   }
a7114834 R/granovagg.ds.R      110 110) 
544a88ef R/granovagg.ds.R       62 111)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 112)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 113)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 114)     }
544a88ef R/granovagg.ds.R       66 115)   }
544a88ef R/granovagg.ds.R       67 116) 
544a88ef R/granovagg.ds.R       68 117)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 118)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 119)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 120)       stop(message)
544a88ef R/granovagg.ds.R       72 121)     }
a7114834 R/granovagg.ds.R      122 122) 
544a88ef R/granovagg.ds.R       74 123)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 124)       stop(message)
544a88ef R/granovagg.ds.R       76 125)     }
544a88ef R/granovagg.ds.R       77 126)   }
a7114834 R/granovagg.ds.R      127 127) 
544a88ef R/granovagg.ds.R       79 128)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 129)     output &lt;- data
544a88ef R/granovagg.ds.R       81 130)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 131)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 132)     }
544a88ef R/granovagg.ds.R       84 133)     return(output)
544a88ef R/granovagg.ds.R       85 134)   }
a7114834 R/granovagg.ds.R      135 135) 
482de62f R/granovagg.ds.R      128 136)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 137)     output &lt;- data
482de62f R/granovagg.ds.R      130 138)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 139)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 140)     }
a7114834 R/granovagg.ds.R      141 141) 
482de62f R/granovagg.ds.R      134 142)     return(data)
482de62f R/granovagg.ds.R      135 143)   }
a7114834 R/granovagg.ds.R      144 144) 
794c4b70 R/granova.ds.ggplot.R   9 145)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 146)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 147)   }
a806fcaa R/granova.ds.bd.R      15 148) 
794c4b70 R/granova.ds.ggplot.R  13 149)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 150)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 151)   }
e589a242 R/granova.ds.bd.R      17 152) 
794c4b70 R/granova.ds.ggplot.R  17 153)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 154)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 155)   }
a7114834 R/granovagg.ds.R      156 156) 
794c4b70 R/granova.ds.ggplot.R  21 157)   GetTtest &lt;- function(data, conf.level) {
a7114834 R/granovagg.ds.R      158 158)     return(t.test(data[, 1],
a7114834 R/granovagg.ds.R      159 159)                   data[, 2],
a71441d3 R/granova.ds.ggplot.R  24 160)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 161)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 162)                  )
a71441d3 R/granova.ds.ggplot.R  27 163)           )
863d348b R/granova.ds.ggplot.R  30 164)   }
a7114834 R/granovagg.ds.R      165 165) 
794c4b70 R/granova.ds.ggplot.R  30 166)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 167)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 168)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 169)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 170)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 171)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 172)                      )
a71441d3 R/granova.ds.ggplot.R  38 173)           )
863d348b R/granova.ds.ggplot.R  41 174)   }
a7114834 R/granovagg.ds.R      175 175) 
794c4b70 R/granova.ds.ggplot.R  41 176)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 177)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a7114834 R/granovagg.ds.R      178 178)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))
e603b053 R/granova.ds.ggplot.R  44 179)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 180)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 181)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 182)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 183)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 184)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 185)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 186)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 187)     .shadow.offset         &lt;- (1/100)*.square.data.range
a7114834 R/granovagg.ds.R      188 188) 
a7114834 R/granovagg.ds.R      189 189)     return(list(square.data.range = .square.data.range,
a7114834 R/granovagg.ds.R      190 190)                 bounds            = .bounds,
a71441d3 R/granova.ds.ggplot.R  56 191)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 192)                 anchor            = .crossbow.anchor,
8dc6cf2b R/granovagg.ds.R      193 193)                 point.size        = I(2.5),
a7114834 R/granovagg.ds.R      194 194)                 mean.line.size    = I(1/2)
a71441d3 R/granova.ds.ggplot.R  60 195)                )
a71441d3 R/granova.ds.ggplot.R  61 196)           )
863d348b R/granova.ds.ggplot.R  64 197)   }
a7114834 R/granovagg.ds.R      198 198) 
794c4b70 R/granova.ds.ggplot.R  64 199)   GetShadows &lt;- function(dsp) {
a7114834 R/granovagg.ds.R      200 200)     x.shadow &lt;- (dsp$effect / 2) +
a7114834 R/granovagg.ds.R      201 201)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 +
48638496 R/granova.ds.ggplot.R  67 202)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 203)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 204)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 205)   }
863d348b R/granova.ds.ggplot.R  73 206) 
794c4b70 R/granova.ds.ggplot.R  72 207)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 208)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 209)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 210)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 211)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 212)                      )
a7114834 R/granovagg.ds.R      213 213)           )
863d348b R/granova.ds.ggplot.R  82 214)   }
a7114834 R/granovagg.ds.R      215 215) 
794c4b70 R/granova.ds.ggplot.R  82 216)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 217)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 218)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 219)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 220)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 221)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 222)                      )
a71441d3 R/granova.ds.ggplot.R  88 223)           )
a7114834 R/granovagg.ds.R      224 224) 
863d348b R/granova.ds.ggplot.R  94 225)   }
a7114834 R/granovagg.ds.R      226 226) 
794c4b70 R/granova.ds.ggplot.R  94 227)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 228)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 229)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 230)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 231)                      )
a71441d3 R/granova.ds.ggplot.R  97 232)           )
863d348b R/granova.ds.ggplot.R 103 233)   }
863d348b R/granova.ds.ggplot.R 104 234) 
754a8540 R/granovagg.ds.R      177 235)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 236)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 237)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 238)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 239)     return(output)
754a8540 R/granovagg.ds.R      182 240)   }
754a8540 R/granovagg.ds.R      183 241) 
73167de2 R/granovagg.ds.R      184 242)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 243)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 244)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 245)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 246)                )
73167de2 R/granovagg.ds.R      189 247)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 248)   }
a7114834 R/granovagg.ds.R      249 249) 
794c4b70 R/granova.ds.ggplot.R 103 250)   GetTrails &lt;- function(dsp) {
a7114834 R/granovagg.ds.R      251 251)     return(data.frame(x.trail.start = GetXs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 102 252)                       y.trail.start = GetYs(dsp$data),
a7114834 R/granovagg.ds.R      253 253)                       x.trail.end   = GetXs(dsp$shadow),
a71441d3 R/granova.ds.ggplot.R 104 254)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 255)                      )
a71441d3 R/granova.ds.ggplot.R 106 256)           )
863d348b R/granova.ds.ggplot.R 114 257)   }
a7114834 R/granovagg.ds.R      258 258) 
794c4b70 R/granova.ds.ggplot.R 114 259)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 260)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 261)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 262)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 263)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 264)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 265)                )
a7114834 R/granovagg.ds.R      266 266)           )
863d348b R/granova.ds.ggplot.R 125 267)   }
a7114834 R/granovagg.ds.R      268 268) 
5e0fcbf9 R/granovagg.ds.R      250 269)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 270)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 271)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 272)     summary &lt;- round(summary, digits = 3)
a7114834 R/granovagg.ds.R      273 273) 
1d932c76 R/granovagg.ds.R      254 274)     print(summary)
1d932c76 R/granovagg.ds.R      255 275)   }
a7114834 R/granovagg.ds.R      276 276) 
1d932c76 R/granovagg.ds.R      257 277)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 278)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 279)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 280)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 281)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 282)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 283)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 284)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 285)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 286)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 287)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 288)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 289)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 290)     p.value &lt;- dsp$t.test$p.value
a7114834 R/granovagg.ds.R      291 291) 
a7114834 R/granovagg.ds.R      292 292)     return(matrix(c(n,
a7114834 R/granovagg.ds.R      293 293)                     mean.1,
a7114834 R/granovagg.ds.R      294 294)                     mean.2,
a7114834 R/granovagg.ds.R      295 295)                     mean.d,
a7114834 R/granovagg.ds.R      296 296)                     standard.deviation.d,
a7114834 R/granovagg.ds.R      297 297)                     effect.size,
a7114834 R/granovagg.ds.R      298 298)                     r.xy,
a7114834 R/granovagg.ds.R      299 299)                     r.x.plus.y.d,
a7114834 R/granovagg.ds.R      300 300)                     lower.treatment.confidence,
a7114834 R/granovagg.ds.R      301 301)                     upper.treatment.confidence,
a7114834 R/granovagg.ds.R      302 302)                     t.value,
a7114834 R/granovagg.ds.R      303 303)                     degrees.of.freedom,
1d932c76 R/granovagg.ds.R      284 304)                     p.value
a7114834 R/granovagg.ds.R      305 305)                   ),
1d932c76 R/granovagg.ds.R      286 306)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 307)            )
1d932c76 R/granovagg.ds.R      288 308)     )
5e0fcbf9 R/granovagg.ds.R      255 309)   }
a7114834 R/granovagg.ds.R      310 310) 
1d932c76 R/granovagg.ds.R      291 311)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 312)     dimnames(summary) &lt;- list(
a7114834 R/granovagg.ds.R      313 313)                            c("n",
a7114834 R/granovagg.ds.R      314 314)                              paste(colnames(dsp$data)[1], "mean"),
1d932c76 R/granovagg.ds.R      295 315)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 316)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 317)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 318)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 319)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 320)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 321)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 322)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 323)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 324)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 325)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 326)                            ), "Summary Statistics")
a7114834 R/granovagg.ds.R      327 327) 
1d932c76 R/granovagg.ds.R      308 328)     return(summary)
1d932c76 R/granovagg.ds.R      309 329)   }
a7114834 R/granovagg.ds.R      330 330) 
f855a782 R/granovagg.ds.R      229 331)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 332)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 333)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 334)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 335)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 336)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 337)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 338)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 339)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 340)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 341)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 342)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 343)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 344)   PrintSummary(dsp)
a7114834 R/granovagg.ds.R      345 345) 
a7114834 R/granovagg.ds.R      346 346) 
863d348b R/granova.ds.ggplot.R 139 347) 
863d348b R/granova.ds.ggplot.R 140 348)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 349)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 350) 
a7114834 R/granovagg.ds.R      351 351) 
3eb0e1f7 R/granova.ds.ggplot.R 142 352)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 353)     return(
c5a67319 R/granovagg.ds.R      346 354)       ggplot(
a7114834 R/granovagg.ds.R      355 355)         aes_string(x = dsp$data[1],
c5a67319 R/granovagg.ds.R      348 356)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 357)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 358)       )
c5a67319 R/granovagg.ds.R      351 359)     )
863d348b R/granova.ds.ggplot.R 152 360)   }
a7114834 R/granovagg.ds.R      361 361) 
794c4b70 R/granova.ds.ggplot.R 152 362)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 363)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 364)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 365)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 366)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 367)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 368)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 369)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 370)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 371)                       )
a71441d3 R/granova.ds.ggplot.R 154 372)           )
863d348b R/granova.ds.ggplot.R 166 373)   }
863d348b R/granova.ds.ggplot.R 167 374) 
794c4b70 R/granova.ds.ggplot.R 166 375)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 376)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 377)   }
863d348b R/granova.ds.ggplot.R 174 378) 
3eb0e1f7 R/granova.ds.ggplot.R 173 379)   IdentityLine &lt;- function() {
a7114834 R/granovagg.ds.R      380 380)     return(geom_abline(slope     = 1,
a71441d3 R/granova.ds.ggplot.R 163 381)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 382)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 383)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 384)                       )
a71441d3 R/granova.ds.ggplot.R 166 385)           )
863d348b R/granova.ds.ggplot.R 183 386)   }
863d348b R/granova.ds.ggplot.R 184 387) 
794c4b70 R/granova.ds.ggplot.R 183 388)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 389)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 390)   }
863d348b R/granova.ds.ggplot.R 188 391) 
794c4b70 R/granova.ds.ggplot.R 187 392)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 393)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 394)   }
a7114834 R/granovagg.ds.R      395 395) 
0ae8f524 R/granovagg.ds.R      396 396)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 397)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 398)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 399)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
a7114834 R/granovagg.ds.R      400 400) 
0ae8f524 R/granovagg.ds.R      401 401)     return(
0ae8f524 R/granovagg.ds.R      402 402)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 403)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 404)       )
0ae8f524 R/granovagg.ds.R      405 405)     )
a7114834 R/granovagg.ds.R      406 406)   }
863d348b R/granova.ds.ggplot.R 192 407) 
794c4b70 R/granova.ds.ggplot.R 191 408)   RugPlot &lt;- function(dsp) {
<span class="changed">1656d5b5 R/granovagg.ds.R      409 409)     return(</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      410 410)       geom_rug(</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      411 411)         size  = I(1/2),</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      412 412)         alpha = I(1/3),</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      413 413)         color = dsp$colors$rugplot,</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      414 414)         sides = "tr", # top and right sides</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      415 415)         data  = dsp$data</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      416 416)       )</span>
<span class="changed">1656d5b5 R/granovagg.ds.R      417 417)     )</span>
863d348b R/granova.ds.ggplot.R 202 418)   }
863d348b R/granova.ds.ggplot.R 203 419) 
794c4b70 R/granova.ds.ggplot.R 202 420)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 421)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 422)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 423)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 424)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 425)                       alpha      = I(1/2)
a7114834 R/granovagg.ds.R      423 426)                      )
a71441d3 R/granova.ds.ggplot.R 192 427)           )
863d348b R/granova.ds.ggplot.R 213 428)   }
a7114834 R/granovagg.ds.R      426 429) 
794c4b70 R/granova.ds.ggplot.R 213 430)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 431)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 432)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 433)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 434)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 435)                       alpha      = I(1/2)
a7114834 R/granovagg.ds.R      433 436)                      )
a71441d3 R/granova.ds.ggplot.R 201 437)           )
a7114834 R/granovagg.ds.R      435 438) 
863d348b R/granova.ds.ggplot.R 225 439)   }
863d348b R/granova.ds.ggplot.R 226 440) 
794c4b70 R/granova.ds.ggplot.R 225 441)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 442)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 443)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 444)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 445)                             yend = y.end
a7114834 R/granovagg.ds.R      443 446)                            ),
a71441d3 R/granova.ds.ggplot.R 211 447)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 448)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 449)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 450)                         data  = dsp$crossbow
a7114834 R/granovagg.ds.R      448 451)                        )
a71441d3 R/granova.ds.ggplot.R 216 452)           )
863d348b R/granova.ds.ggplot.R 242 453)   }
863d348b R/granova.ds.ggplot.R 243 454) 
794c4b70 R/granova.ds.ggplot.R 242 455)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 456)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 457)                             y     = y,
0d72518f R/granovagg.ds.R      303 458)                             xend  = x.end,
a7114834 R/granovagg.ds.R      456 459)                             yend  = y.end,
a71441d3 R/granova.ds.ggplot.R 224 460)                             color = color
a7114834 R/granovagg.ds.R      458 461)                            ),
a71441d3 R/granova.ds.ggplot.R 226 462)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 463)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 464)                        )
a71441d3 R/granova.ds.ggplot.R 229 465)           )
863d348b R/granova.ds.ggplot.R 258 466)   }
863d348b R/granova.ds.ggplot.R 259 467) 
794c4b70 R/granova.ds.ggplot.R 258 468)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 469)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 470)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 471)                          ),
a7114834 R/granovagg.ds.R      469 472)                       data  = dsp$shadow,
48638496 R/granova.ds.ggplot.R 237 473)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 474)                       shape = 16,
a7114834 R/granovagg.ds.R      472 475)                       alpha = I(1/2)
a71441d3 R/granova.ds.ggplot.R 239 476)                      )
a71441d3 R/granova.ds.ggplot.R 240 477)           )
863d348b R/granova.ds.ggplot.R 272 478)   }
863d348b R/granova.ds.ggplot.R 273 479) 
794c4b70 R/granova.ds.ggplot.R 272 480)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 481)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 482)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 483)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 484)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 485)                            ),
a71441d3 R/granova.ds.ggplot.R 249 486)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 487)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 488)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 489)                         linetype = 1,
a7114834 R/granovagg.ds.R      487 490)                         alpha    = I(1/10)
a7114834 R/granovagg.ds.R      488 491)                        )
a71441d3 R/granova.ds.ggplot.R 255 492)           )
863d348b R/granova.ds.ggplot.R 290 493)   }
863d348b R/granova.ds.ggplot.R 291 494) 
ef841aa1 R/granova.ds.ggplot.R 257 495)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 496)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
a7114834 R/granovagg.ds.R      494 497) 
52d9cc47 R/granovagg.ds.R      495 498)     return(scale_color_manual(values = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 499)   }
863d348b R/granova.ds.ggplot.R 297 500) 
0afa3a38 R/granovagg.ds.R      306 501)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 502)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 503)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 504)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 505)     }
a7114834 R/granovagg.ds.R      503 506) 
0afa3a38 R/granovagg.ds.R      312 507)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 508)   }
a7114834 R/granovagg.ds.R      506 509) 
485d5f02 R/granovagg.ds.R      317 510)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 511)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 512)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 513)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 514)     }
a7114834 R/granovagg.ds.R      512 515) 
485d5f02 R/granovagg.ds.R      323 516)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 517)   }
a7114834 R/granovagg.ds.R      515 518) 
74d74c41 R/granovagg.ds.R      516 519)   Title &lt;- function(main) {
74d74c41 R/granovagg.ds.R      517 520)     output.title &lt;- "Dependent Sample Assessment Plot"
74d74c41 R/granovagg.ds.R      518 521)     if (main != "default_granova_title") {
74d74c41 R/granovagg.ds.R      519 522)       output.title &lt;- main
a2b6fe7d R/granovagg.ds.R      319 523)     }
a7114834 R/granovagg.ds.R      520 524) 
74d74c41 R/granovagg.ds.R      522 525)     return(
74d74c41 R/granovagg.ds.R      523 526)       ggtitle(output.title)
74d74c41 R/granovagg.ds.R      524 527)     )
74d74c41 R/granovagg.ds.R      525 528) 
863d348b R/granova.ds.ggplot.R 304 529)   }
a7114834 R/granovagg.ds.R      525 530) 
b5b60529 R/granova.ds.ggplot.R 271 531)   ForceCoordinateAxesToBeEqual &lt;- function() {
9d259747 R/granovagg.ds.R      527 532)     return(coord_fixed(ratio = 1))
b5b60529 R/granova.ds.ggplot.R 273 533)   }
a7114834 R/granovagg.ds.R      529 534) 
a7114834 R/granovagg.ds.R      530 535) 
3eb0e1f7 R/granova.ds.ggplot.R 304 536)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 537)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 538)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 539)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 540)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 541)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 542)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 543)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 544)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 545)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 546)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 547)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 548)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
0ae8f524 R/granovagg.ds.R      545 549)   p &lt;- p + PadViewingWindow(dsp$params)
9d259747 R/granovagg.ds.R      545 550)   p &lt;- p + ForceCoordinateAxesToBeEqual()
74d74c41 R/granovagg.ds.R      548 551)   p &lt;- p + Title(main)
0afa3a38 R/granovagg.ds.R      345 552)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 553)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 554) 
482de62f R/granovagg.ds.R      528 555)   return(p)
5d58b37c R/granova.ds.bd.R     314 556) 
b3a74c98 R/granova.ds.bd.R     301 557) }
</pre>
<div class="compileroutput">
Reimplement rug plots with ggplot2 "sides" argument<p>Force Residuals() to explicitly accept `resid` as an input parameter,<br>
instead of having it reach out to the global scope of granovagg.1w()<br>
for it.<br>
</p><p><br>
</p></div>
</td>
<td>
<a name="9b70f3c"></a>
9b70f3c 2012-08-16 16:34:12 -0400
<br>
<pre>53df74c6 R/granovagg.ds.R        1   1) #' Elemental Graphic for Display of Dependent Sample Data
a7114834 R/granovagg.ds.R        2   2) #'
2b0c8b84 R/granovagg.ds.R        3   3) #' Plots dependent sample data beginning from a scatterplot for the X,Y pairs;
2b0c8b84 R/granovagg.ds.R        4   4) #' proceeds to display difference scores as point projections; also X and Y
3ad69d89 R/granovagg.ds.R        5   5) #' means, as well as the mean of the difference scores.
a7114834 R/granovagg.ds.R        6   6) #'
61fb56e0 R/granovagg.ds.R        7   7) #' Paired X and Y values are plotted as scatterplot. The identity reference line
61fb56e0 R/granovagg.ds.R        8   8) #' (for Y = X) is drawn. Parallel projections of data points to (a lower-left)
61fb56e0 R/granovagg.ds.R        9   9) #' line segment show how each point relates to its X-Y = D difference;
61fb56e0 R/granovagg.ds.R       10  10) #' semitransparent "shadow" points are used to display the distribution of
61fb56e0 R/granovagg.ds.R       11  11) #' difference scores, with thin grey lines leading from each raw datapoint to
61fb56e0 R/granovagg.ds.R       12  12) #' its shadow projection on the difference distribution. The range of that
61fb56e0 R/granovagg.ds.R       13  13) #' difference score distribution is drawn as a blue line beneath the shadow
61fb56e0 R/granovagg.ds.R       14  14) #' points and the mean difference is displayed as a heavy dashed purple line,
61fb56e0 R/granovagg.ds.R       15  15) #' parallel to the identity reference line. Means for X and Y are also plotted
61fb56e0 R/granovagg.ds.R       16  16) #' (as thin dashed vertical and horizontal lines), and rug plots are shown for
61fb56e0 R/granovagg.ds.R       17  17) #' the distributions of X (at the top of graphic) and Y (on the right side). The
4b3a4c5c R/granovagg.ds.R       18  18) #' 95\% confidence interval for the population mean difference is also shown
61fb56e0 R/granovagg.ds.R       19  19) #' graphically as a green band, perpendicular to the mean treatment effect line.
61fb56e0 R/granovagg.ds.R       20  20) #' Because all data points are plotted relative to the identity line, and
61fb56e0 R/granovagg.ds.R       21  21) #' summary results are shown graphically, clusters, data trends, outliers, and
61fb56e0 R/granovagg.ds.R       22  22) #' possible uses of transformations are readily seen, possibly to be
a7114834 R/granovagg.ds.R       23  23) #' accommodated.
a7114834 R/granovagg.ds.R       24  24) #'
61fb56e0 R/granovagg.ds.R       25  25) #' In summary, the graphic shows all initial data points relative to the
61fb56e0 R/granovagg.ds.R       26  26) #' identity line, adds projections (to the 'north' and 'east') showing the
61fb56e0 R/granovagg.ds.R       27  27) #' marginal distributions of X and Y, as well as projections to the 'southwest'
61fb56e0 R/granovagg.ds.R       28  28) #' where the difference scores for each point are drawn. Means for all three
61fb56e0 R/granovagg.ds.R       29  29) #' distributions are shown using straight lines; the confidence interval for the
61fb56e0 R/granovagg.ds.R       30  30) #' population mean difference score is also shown. Summary statistics are
61fb56e0 R/granovagg.ds.R       31  31) #' printed as side effects of running the function for the dependent sample
61fb56e0 R/granovagg.ds.R       32  32) #' analysis.
a7114834 R/granovagg.ds.R       33  33) #'
2b0c8b84 R/granovagg.ds.R       27  34) #' @param data is an n X 2 dataframe or matrix. First column defines X
2b0c8b84 R/granovagg.ds.R       28  35) #'   (intially for horzontal axis), the second defines Y.
892e6c44 R/granovagg.ds.R       31  36) #' @param main optional main title (as character); can be supplied by user. The default value is
d9ace94c R/granovagg.ds.R       37  37) #'   \code{"default_granova_title"}, which will print a generic title for the graphic.
f855a782 R/granovagg.ds.R       27  38) #' @param revc reverses X,Y specifications
485d5f02 R/granovagg.ds.R       27  39) #' @param xlab optional label (as character) for horizontal axis. If not
485d5f02 R/granovagg.ds.R       28  40) #'   defined, axis labels are taken from colnames of data.
485d5f02 R/granovagg.ds.R       29  41) #' @param ylab optional label (as character) for vertical axis. If not
485d5f02 R/granovagg.ds.R       30  42) #'   defined, axis labels are taken from colnames of data.
a7114834 R/granovagg.ds.R       43  43) #' @param conf.level The confidence level at which to perform a dependent sample t-test.
3ad69d89 R/granovagg.ds.R       32  44) #'   Defaults to \code{0.95} (95\% Confidence)
62c4a36e R/granovagg.ds.R       34  45) #' @param plot.theme argument indicating a ggplot2 theme to apply to the
62c4a36e R/granovagg.ds.R       35  46) #'   graphic; defaults to a customized theme created for the dependent sample graphic
a7114834 R/granovagg.ds.R       47  47) #' @param northeast.padding (numeric) extends axes toward lower left,
0ae8f524 R/granovagg.ds.R       48  48) #'   effectively moving data points to the southwest. Defaults to zero padding.
0ae8f524 R/granovagg.ds.R       49  49) #' @param southwest.padding (numeric) extends axes toward upper right,
0ae8f524 R/granovagg.ds.R       50  50) #'   effectively moving data points to the southwest. Defaults to zero padding.
a7114834 R/granovagg.ds.R       51  51) #'   Making both southwest and northeast padding smaller moves points farther apart,
0ae8f524 R/granovagg.ds.R       52  52) #'   while making both larger moves data points closer together.
3329011e R/granovagg.ds.R       35  53) #' @param ... Optional arguments to/from other functions
a7114834 R/granovagg.ds.R       54  54) #' @return Returns a plot object of class \code{ggplot}.
80f8f002 R/granovagg.ds.R       38  55) #'
a7114834 R/granovagg.ds.R       56  56) #' @author Brian A. Danielak \email{brian@@briandk.com}\cr
80f8f002 R/granovagg.ds.R       40  57) #'   Robert M. Pruzek \email{RMPruzek@@yahoo.com}
80f8f002 R/granovagg.ds.R       41  58) #'
80f8f002 R/granovagg.ds.R       42  59) #' with contributions by:\cr
a7114834 R/granovagg.ds.R       60  60) #'   William E. J. Doane \email{wil@@drdoane.com}\cr
a7114834 R/granovagg.ds.R       61  61) #'   James E. Helmreich \email{James.Helmreich@@Marist.edu}\cr
80f8f002 R/granovagg.ds.R       45  62) #'   Jason Bryer \email{jason@@bryer.org}
80f8f002 R/granovagg.ds.R       46  63) #'
48265964 R/granovagg.ds.R       58  64) #' @seealso \code{\link{granovagg.1w}},
<span class="changed">9b70f3c2 R/granovagg.ds.R       65  65) #'   \code{\link{granovagg.ds}}, \code{\link{granovaGG}}</span>
48265964 R/granovagg.ds.R       61  66) #'
19d1b011 R/granovagg.ds.R       42  67) #' @example demo/granovagg.ds.R
8ca83f73 R/granovagg.ds.R       47  68) #' @export
be5c4c16 R/granovagg.ds.R       64  69) #' @references Pruzek, R. M., &amp; Helmreich, J. E. (2009). Enhancing Dependent Sample Analyses with Graphics. Journal of Statistics Education, 17(1), 21.
795b19d3 R/granovagg.ds.R       60  70) #' @references Wickham, H. (2009). Ggplot2: Elegant Graphics for Data Analysis. New York: Springer.
795b19d3 R/granovagg.ds.R       61  71) #' @references Wilkinson, L. (1999). The Grammar of Graphics. Statistics and computing. New York: Springer.
f855a782 R/granovagg.ds.R       46  72) granovagg.ds &lt;- function(data       = NULL,
a7114834 R/granovagg.ds.R       74  73)                          revc       = FALSE,
e55d776c R/granovagg.ds.R       39  74)                          main       = "default_granova_title",
0afa3a38 R/granovagg.ds.R       40  75)                          xlab       = NULL,
485d5f02 R/granovagg.ds.R       42  76)                          ylab       = NULL,
e55d776c R/granovagg.ds.R       40  77)                          conf.level = 0.95,
3329011e R/granovagg.ds.R       50  78)                          plot.theme = "theme_granova_ds",
0ae8f524 R/granovagg.ds.R       80  79)                          northeast.padding = 0,
0ae8f524 R/granovagg.ds.R       81  80)                          southwest.padding = 0,
3329011e R/granovagg.ds.R       51  81)                          ...
a7114834 R/granovagg.ds.R       83  82)                 )
be2e6fbd R/granova.ds.bd.R      19  83) 
be2e6fbd R/granova.ds.bd.R      20  84) {
a7114834 R/granovagg.ds.R       86  85) 
f855a782 R/granovagg.ds.R       58  86)   GetData &lt;- function(data) {
482de62f R/granovagg.ds.R       80  87)     data &lt;- CheckData(data)
482de62f R/granovagg.ds.R       81  88)     data &lt;- ReverseXAndY(data)
482de62f R/granovagg.ds.R       82  89)     data &lt;- EnsureDataHasColumnNames(data)
482de62f R/granovagg.ds.R       83  90)     data &lt;- EnsureDataIsADataFrame(data)
482de62f R/granovagg.ds.R       84  91)     return(data)
f855a782 R/granovagg.ds.R       62  92)   }
a7114834 R/granovagg.ds.R       94  93) 
f855a782 R/granovagg.ds.R       64  94)   CheckData &lt;- function(data) {
544a88ef R/granovagg.ds.R       57  95)     IsDataNull(data)
544a88ef R/granovagg.ds.R       58  96)     IsDataInTwoColumnFormat(data)
482de62f R/granovagg.ds.R       90  97)     return(data)
544a88ef R/granovagg.ds.R       60  98)   }
a7114834 R/granovagg.ds.R      100  99) 
f855a782 R/granovagg.ds.R       70 100)   ReverseXAndY &lt;- function(data) {
f855a782 R/granovagg.ds.R       71 101)     output &lt;- data
f855a782 R/granovagg.ds.R       72 102)     if (revc) {
f855a782 R/granovagg.ds.R       73 103)       output[, 1] &lt;- data[, 2]
f855a782 R/granovagg.ds.R       74 104)       output[, 2] &lt;- data[, 1]
f855a782 R/granovagg.ds.R       75 105)       names(output) &lt;- names(data)[2:1]
f855a782 R/granovagg.ds.R       76 106)     }
f855a782 R/granovagg.ds.R       77 107)     return(output)
f855a782 R/granovagg.ds.R       78 108)   }
a7114834 R/granovagg.ds.R      110 109) 
544a88ef R/granovagg.ds.R       62 110)   IsDataNull &lt;- function(data) {
544a88ef R/granovagg.ds.R       63 111)     if (is.null(length(data))) {
544a88ef R/granovagg.ds.R       64 112)       stop("It looks like you didn't pass any data to granovagg.ds")
544a88ef R/granovagg.ds.R       65 113)     }
544a88ef R/granovagg.ds.R       66 114)   }
544a88ef R/granovagg.ds.R       67 115) 
544a88ef R/granovagg.ds.R       68 116)   IsDataInTwoColumnFormat &lt;- function(data) {
544a88ef R/granovagg.ds.R       69 117)     message &lt;- "It looks like the data you handed in isn't in two-column (n x 2) format. granovagg.ds needs n x 2 data to work."
544a88ef R/granovagg.ds.R       70 118)     if (is.null(dim(data))) {
544a88ef R/granovagg.ds.R       71 119)       stop(message)
544a88ef R/granovagg.ds.R       72 120)     }
a7114834 R/granovagg.ds.R      122 121) 
544a88ef R/granovagg.ds.R       74 122)     if (dim(data)[2] != 2) {
544a88ef R/granovagg.ds.R       75 123)       stop(message)
544a88ef R/granovagg.ds.R       76 124)     }
544a88ef R/granovagg.ds.R       77 125)   }
a7114834 R/granovagg.ds.R      127 126) 
544a88ef R/granovagg.ds.R       79 127)   EnsureDataIsADataFrame &lt;- function(data) {
544a88ef R/granovagg.ds.R       80 128)     output &lt;- data
544a88ef R/granovagg.ds.R       81 129)     if (!is.data.frame(data)) {
544a88ef R/granovagg.ds.R       82 130)       output &lt;- as.data.frame(output)
544a88ef R/granovagg.ds.R       83 131)     }
544a88ef R/granovagg.ds.R       84 132)     return(output)
544a88ef R/granovagg.ds.R       85 133)   }
a7114834 R/granovagg.ds.R      135 134) 
482de62f R/granovagg.ds.R      128 135)   EnsureDataHasColumnNames &lt;- function(data) {
482de62f R/granovagg.ds.R      129 136)     output &lt;- data
482de62f R/granovagg.ds.R      130 137)     if (is.null(colnames(data))) {
482de62f R/granovagg.ds.R      131 138)       colnames(data) &lt;- c("x", "y")
482de62f R/granovagg.ds.R      132 139)     }
a7114834 R/granovagg.ds.R      141 140) 
482de62f R/granovagg.ds.R      134 141)     return(data)
482de62f R/granovagg.ds.R      135 142)   }
a7114834 R/granovagg.ds.R      144 143) 
794c4b70 R/granova.ds.ggplot.R   9 144)   GetXs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  10 145)     return(data[, 1])
e589a242 R/granova.ds.bd.R      12 146)   }
a806fcaa R/granova.ds.bd.R      15 147) 
794c4b70 R/granova.ds.ggplot.R  13 148)   GetYs &lt;- function(data) {
a71441d3 R/granova.ds.ggplot.R  14 149)     return(data[, 2])
e589a242 R/granova.ds.bd.R      16 150)   }
e589a242 R/granova.ds.bd.R      17 151) 
794c4b70 R/granova.ds.ggplot.R  17 152)   GetEffect &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  18 153)     return(GetXs(dsp$data) - GetYs(dsp$data))
863d348b R/granova.ds.ggplot.R  21 154)   }
a7114834 R/granovagg.ds.R      156 155) 
794c4b70 R/granova.ds.ggplot.R  21 156)   GetTtest &lt;- function(data, conf.level) {
a7114834 R/granovagg.ds.R      158 157)     return(t.test(data[, 1],
a7114834 R/granovagg.ds.R      159 158)                   data[, 2],
a71441d3 R/granova.ds.ggplot.R  24 159)                   paired     = TRUE,
a71441d3 R/granova.ds.ggplot.R  25 160)                   conf.level = conf.level
a71441d3 R/granova.ds.ggplot.R  26 161)                  )
a71441d3 R/granova.ds.ggplot.R  27 162)           )
863d348b R/granova.ds.ggplot.R  30 163)   }
a7114834 R/granovagg.ds.R      165 164) 
794c4b70 R/granova.ds.ggplot.R  30 165)   GetStats &lt;- function(dsp, conf.level) {
e603b053 R/granova.ds.ggplot.R  31 166)     ttest &lt;- GetTtest(dsp$data, conf.level)
e6196600 R/granova.ds.ggplot.R  32 167)     return(data.frame(lower.treatment.effect = as.numeric(ttest$conf.int[2]),
e6196600 R/granova.ds.ggplot.R  33 168)                       mean.treatment.effect  = as.numeric(ttest$estimate[1]),
e6196600 R/granova.ds.ggplot.R  34 169)                       upper.treatment.effect = as.numeric(ttest$conf.int[1]),
e6196600 R/granova.ds.ggplot.R  35 170)                       t.statistic            = as.numeric(ttest$statistic[1])
e6196600 R/granova.ds.ggplot.R  36 171)                      )
a71441d3 R/granova.ds.ggplot.R  38 172)           )
863d348b R/granova.ds.ggplot.R  41 173)   }
a7114834 R/granovagg.ds.R      175 174) 
794c4b70 R/granova.ds.ggplot.R  41 175)   GetGraphicsParams &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R  42 176)     .aggregate.data.range  &lt;- c(range(GetXs(dsp$data)), range(GetYs(dsp$data)))
a7114834 R/granovagg.ds.R      178 177)     .extrema               &lt;- c(max(.aggregate.data.range), min(.aggregate.data.range))
e603b053 R/granova.ds.ggplot.R  44 178)     .square.data.range     &lt;- max(.extrema) - min(.extrema)
a71441d3 R/granova.ds.ggplot.R  45 179)     .southwest.padding     &lt;- (65/100) * .square.data.range
0ae8f524 R/granovagg.ds.R      181 180)     .northeast.padding     &lt;- (15/100) * .square.data.range
e603b053 R/granova.ds.ggplot.R  47 181)     .lower.graphical.bound &lt;- min(.extrema) - .southwest.padding
0ae8f524 R/granovagg.ds.R      183 182)     .upper.graphical.bound &lt;- max(.extrema) + .northeast.padding
a71441d3 R/granova.ds.ggplot.R  49 183)     .bounds                &lt;- c(.lower.graphical.bound, .upper.graphical.bound)
a71441d3 R/granova.ds.ggplot.R  50 184)     .center                &lt;- mean(.bounds)
a71441d3 R/granova.ds.ggplot.R  51 185)     .crossbow.anchor       &lt;- mean(.bounds) + min(.bounds)
a71441d3 R/granova.ds.ggplot.R  52 186)     .shadow.offset         &lt;- (1/100)*.square.data.range
a7114834 R/granovagg.ds.R      188 187) 
a7114834 R/granovagg.ds.R      189 188)     return(list(square.data.range = .square.data.range,
a7114834 R/granovagg.ds.R      190 189)                 bounds            = .bounds,
a71441d3 R/granova.ds.ggplot.R  56 190)                 shadow.offset     = .shadow.offset,
a71441d3 R/granova.ds.ggplot.R  57 191)                 anchor            = .crossbow.anchor,
8dc6cf2b R/granovagg.ds.R      193 192)                 point.size        = I(2.5),
a7114834 R/granovagg.ds.R      194 193)                 mean.line.size    = I(1/2)
a71441d3 R/granova.ds.ggplot.R  60 194)                )
a71441d3 R/granova.ds.ggplot.R  61 195)           )
863d348b R/granova.ds.ggplot.R  64 196)   }
a7114834 R/granovagg.ds.R      198 197) 
794c4b70 R/granova.ds.ggplot.R  64 198)   GetShadows &lt;- function(dsp) {
a7114834 R/granovagg.ds.R      200 199)     x.shadow &lt;- (dsp$effect / 2) +
a7114834 R/granovagg.ds.R      201 200)                 (3 * dsp$params$bounds[1] + dsp$params$bounds[2]) / 4 +
48638496 R/granova.ds.ggplot.R  67 201)                 (4 * dsp$params$shadow.offset)
e603b053 R/granova.ds.ggplot.R  68 202)     y.shadow &lt;- x.shadow - dsp$effect
a71441d3 R/granova.ds.ggplot.R  69 203)     return(data.frame(x.shadow, y.shadow))
863d348b R/granova.ds.ggplot.R  72 204)   }
863d348b R/granova.ds.ggplot.R  73 205) 
794c4b70 R/granova.ds.ggplot.R  72 206)   GetCrossbow &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R  73 207)     return(data.frame(x     = min(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  74 208)                       y     = max(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  75 209)                       x.end = max(dsp$shadows$x.shadow) - (2 * dsp$params$shadow.offset),
48638496 R/granova.ds.ggplot.R  76 210)                       y.end = min(dsp$shadows$y.shadow) - (2 * dsp$params$shadow.offset)
a71441d3 R/granova.ds.ggplot.R  77 211)                      )
a7114834 R/granovagg.ds.R      213 212)           )
863d348b R/granova.ds.ggplot.R  82 213)   }
a7114834 R/granovagg.ds.R      215 214) 
794c4b70 R/granova.ds.ggplot.R  82 215)   GetCIBand &lt;- function(dsp) {
0d72518f R/granovagg.ds.R      159 216)     return(data.frame(x.end = ((dsp$params$anchor + dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      160 217)                       y.end = ((dsp$params$anchor - dsp$stats$lower.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      161 218)                       x     = ((dsp$params$anchor + dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      162 219)                       y     = ((dsp$params$anchor - dsp$stats$upper.treatment.effect) / 2) - 3 * (dsp$params$shadow.offset),
0d72518f R/granovagg.ds.R      163 220)                       color = factor(paste(100 * conf.level, "% CI", " (t = ", round(dsp$stats$t.statistic, digits = 2), ")", sep =""))
a71441d3 R/granova.ds.ggplot.R  87 221)                      )
a71441d3 R/granova.ds.ggplot.R  88 222)           )
a7114834 R/granovagg.ds.R      224 223) 
863d348b R/granova.ds.ggplot.R  94 224)   }
a7114834 R/granovagg.ds.R      226 225) 
794c4b70 R/granova.ds.ggplot.R  94 226)   GetTreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R  93 227)     return(data.frame(intercept = -dsp$stats$mean.treatment.effect,
a71441d3 R/granova.ds.ggplot.R  94 228)                       slope     = 1,
a71441d3 R/granova.ds.ggplot.R  95 229)                       color     = factor(paste("Mean Diff. =", round(dsp$stats$mean.treatment.effect, digits = 2)))
a71441d3 R/granova.ds.ggplot.R  96 230)                      )
a71441d3 R/granova.ds.ggplot.R  97 231)           )
863d348b R/granova.ds.ggplot.R 103 232)   }
863d348b R/granova.ds.ggplot.R 104 233) 
754a8540 R/granovagg.ds.R      177 234)   GetCrossElementCoordinates &lt;- function(dsp) {
754a8540 R/granovagg.ds.R      178 235)     crossbow &lt;- dsp$crossbow
754a8540 R/granovagg.ds.R      179 236)     ci.band  &lt;- subset(dsp$CIBand, select = -color)
754a8540 R/granovagg.ds.R      180 237)     output   &lt;- rbind(crossbow, ci.band)
754a8540 R/granovagg.ds.R      181 238)     return(output)
754a8540 R/granovagg.ds.R      182 239)   }
754a8540 R/granovagg.ds.R      183 240) 
73167de2 R/granovagg.ds.R      184 241)   EnsureCrossElementsAppearInVisualBounds &lt;- function(dsp) {
73167de2 R/granovagg.ds.R      185 242)     minimum &lt;- min(dsp$params$bounds,
73167de2 R/granovagg.ds.R      186 243)                    dsp$cross.elements$x,
73167de2 R/granovagg.ds.R      187 244)                    dsp$cross.elements$y.end
73167de2 R/granovagg.ds.R      188 245)                )
73167de2 R/granovagg.ds.R      189 246)     return(c(minimum - dsp$params$shadow.offset, max(dsp$params$bounds)))
73167de2 R/granovagg.ds.R      190 247)   }
a7114834 R/granovagg.ds.R      249 248) 
794c4b70 R/granova.ds.ggplot.R 103 249)   GetTrails &lt;- function(dsp) {
a7114834 R/granovagg.ds.R      251 250)     return(data.frame(x.trail.start = GetXs(dsp$data),
a71441d3 R/granova.ds.ggplot.R 102 251)                       y.trail.start = GetYs(dsp$data),
a7114834 R/granovagg.ds.R      253 252)                       x.trail.end   = GetXs(dsp$shadow),
a71441d3 R/granova.ds.ggplot.R 104 253)                       y.trail.end   = GetYs(dsp$shadow)
a71441d3 R/granova.ds.ggplot.R 105 254)                      )
a71441d3 R/granova.ds.ggplot.R 106 255)           )
863d348b R/granova.ds.ggplot.R 114 256)   }
a7114834 R/granovagg.ds.R      258 257) 
794c4b70 R/granova.ds.ggplot.R 114 258)   GetColors &lt;- function(dsp) {
e883b72f R/granova.ds.ggplot.R 109 259)     return(list(treatment.line = "#542570",
a71441d3 R/granova.ds.ggplot.R 111 260)                 rugplot        = "black",
a71441d3 R/granova.ds.ggplot.R 112 261)                 mean.line      = "#542570",
a71441d3 R/granova.ds.ggplot.R 113 262)                 CIBand         = "#33A02C",
a71441d3 R/granova.ds.ggplot.R 114 263)                 crossbow       = "#377EB8"
a71441d3 R/granova.ds.ggplot.R 115 264)                )
a7114834 R/granovagg.ds.R      266 265)           )
863d348b R/granova.ds.ggplot.R 125 266)   }
a7114834 R/granovagg.ds.R      268 267) 
5e0fcbf9 R/granovagg.ds.R      250 268)   PrintSummary &lt;- function(dsp) {
1d932c76 R/granovagg.ds.R      251 269)     summary &lt;- GetPrintedSummary(dsp)
1d932c76 R/granovagg.ds.R      252 270)     summary &lt;- RenamePrintedSummaryRows(summary)
7315d685 R/granovagg.ds.R      253 271)     summary &lt;- round(summary, digits = 3)
a7114834 R/granovagg.ds.R      273 272) 
1d932c76 R/granovagg.ds.R      254 273)     print(summary)
1d932c76 R/granovagg.ds.R      255 274)   }
a7114834 R/granovagg.ds.R      276 275) 
1d932c76 R/granovagg.ds.R      257 276)   GetPrintedSummary &lt;- function(dsp) {
5e0fcbf9 R/granovagg.ds.R      251 277)     n &lt;- dim(dsp$data)[1]
c6634692 R/granovagg.ds.R      252 278)     mean.1 &lt;- mean(dsp$data[, 1])
c6634692 R/granovagg.ds.R      253 279)     mean.2 &lt;- mean(dsp$data[, 2])
d7e58513 R/granovagg.ds.R      254 280)     mean.d &lt;- mean.1 - mean.2
d7e58513 R/granovagg.ds.R      255 281)     standard.deviation.d &lt;- sd(dsp$data[, 1] - dsp$data[, 2])
48593231 R/granovagg.ds.R      256 282)     effect.size &lt;- (mean.d / standard.deviation.d)
eaf5611d R/granovagg.ds.R      257 283)     r.xy &lt;- cor(dsp$data[, 1], dsp$data[, 2])
129861a6 R/granovagg.ds.R      258 284)     r.x.plus.y.d &lt;- cor((dsp$data[, 1] + dsp$data[, 2]), (dsp$data[, 1] - dsp$data[, 2]))
b36b6241 R/granovagg.ds.R      259 285)     lower.treatment.confidence &lt;- dsp$stats$upper.treatment.effect
2595918e R/granovagg.ds.R      260 286)     upper.treatment.confidence &lt;- dsp$stats$lower.treatment.effect
d543180b R/granovagg.ds.R      261 287)     t.value &lt;- dsp$t.test$statistic
f4c75a58 R/granovagg.ds.R      262 288)     degrees.of.freedom &lt;- dsp$t.test$parameter
d63415a6 R/granovagg.ds.R      263 289)     p.value &lt;- dsp$t.test$p.value
a7114834 R/granovagg.ds.R      291 290) 
a7114834 R/granovagg.ds.R      292 291)     return(matrix(c(n,
a7114834 R/granovagg.ds.R      293 292)                     mean.1,
a7114834 R/granovagg.ds.R      294 293)                     mean.2,
a7114834 R/granovagg.ds.R      295 294)                     mean.d,
a7114834 R/granovagg.ds.R      296 295)                     standard.deviation.d,
a7114834 R/granovagg.ds.R      297 296)                     effect.size,
a7114834 R/granovagg.ds.R      298 297)                     r.xy,
a7114834 R/granovagg.ds.R      299 298)                     r.x.plus.y.d,
a7114834 R/granovagg.ds.R      300 299)                     lower.treatment.confidence,
a7114834 R/granovagg.ds.R      301 300)                     upper.treatment.confidence,
a7114834 R/granovagg.ds.R      302 301)                     t.value,
a7114834 R/granovagg.ds.R      303 302)                     degrees.of.freedom,
1d932c76 R/granovagg.ds.R      284 303)                     p.value
a7114834 R/granovagg.ds.R      305 304)                   ),
1d932c76 R/granovagg.ds.R      286 305)                  ncol = 1
1d932c76 R/granovagg.ds.R      287 306)            )
1d932c76 R/granovagg.ds.R      288 307)     )
5e0fcbf9 R/granovagg.ds.R      255 308)   }
a7114834 R/granovagg.ds.R      310 309) 
1d932c76 R/granovagg.ds.R      291 310)   RenamePrintedSummaryRows &lt;- function(summary) {
1d932c76 R/granovagg.ds.R      292 311)     dimnames(summary) &lt;- list(
a7114834 R/granovagg.ds.R      313 312)                            c("n",
a7114834 R/granovagg.ds.R      314 313)                              paste(colnames(dsp$data)[1], "mean"),
1d932c76 R/granovagg.ds.R      295 314)                              paste(colnames(dsp$data)[2], "mean"),
1d932c76 R/granovagg.ds.R      296 315)                              paste("mean(D = ", colnames(dsp$data)[1], " - ", colnames(dsp$data)[2], ")",  sep = ""),
1d932c76 R/granovagg.ds.R      297 316)                              paste("SD(D)"),
1d932c76 R/granovagg.ds.R      298 317)                              paste("Effect Size"),
1d932c76 R/granovagg.ds.R      299 318)                              paste("r(", colnames(dsp$data)[1], ", ", colnames(dsp$data)[2], ")", sep = ""),
1d932c76 R/granovagg.ds.R      300 319)                              paste("r(", colnames(dsp$data)[1], " + ", colnames(dsp$data)[2], ", D)", sep = ""),
bf3b02cb R/granovagg.ds.R      313 320)                              paste("Lower ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
bf3b02cb R/granovagg.ds.R      314 321)                              paste("Upper ", (100 * conf.level), "% ", "Confidence Interval", sep = ""),
1d932c76 R/granovagg.ds.R      303 322)                              paste("t (D-bar)"),
1d932c76 R/granovagg.ds.R      304 323)                              paste("df.t"),
85bdd70d R/granovagg.ds.R      317 324)                              paste("p-value (t-statistic)")
1d932c76 R/granovagg.ds.R      306 325)                            ), "Summary Statistics")
a7114834 R/granovagg.ds.R      327 326) 
1d932c76 R/granovagg.ds.R      308 327)     return(summary)
1d932c76 R/granovagg.ds.R      309 328)   }
a7114834 R/granovagg.ds.R      330 329) 
f855a782 R/granovagg.ds.R      229 330)   dsp                &lt;- list(data = GetData(data))
a71441d3 R/granova.ds.ggplot.R 120 331)   dsp$effect         &lt;- GetEffect(dsp)
a71441d3 R/granova.ds.ggplot.R 121 332)   dsp$stats          &lt;- GetStats(dsp, conf.level)
d543180b R/granovagg.ds.R      283 333)   dsp$t.test         &lt;- GetTtest(dsp$data, conf.level)
e5f6a588 R/granova.ds.ggplot.R 122 334)   dsp$params         &lt;- GetGraphicsParams(dsp)
a71441d3 R/granova.ds.ggplot.R 123 335)   dsp$shadows        &lt;- GetShadows(dsp)
a71441d3 R/granova.ds.ggplot.R 124 336)   dsp$crossbow       &lt;- GetCrossbow(dsp)
a71441d3 R/granova.ds.ggplot.R 125 337)   dsp$CIBand         &lt;- GetCIBand(dsp)
754a8540 R/granovagg.ds.R      210 338)   dsp$cross.elements &lt;- GetCrossElementCoordinates(dsp)
73167de2 R/granovagg.ds.R      219 339)   dsp$params$bounds  &lt;- EnsureCrossElementsAppearInVisualBounds(dsp)
e603b053 R/granova.ds.ggplot.R 132 340)   dsp$treatment.line &lt;- GetTreatmentLine(dsp)
a71441d3 R/granova.ds.ggplot.R 127 341)   dsp$trails         &lt;- GetTrails(dsp)
a71441d3 R/granova.ds.ggplot.R 128 342)   dsp$colors         &lt;- GetColors(dsp)
5e0fcbf9 R/granovagg.ds.R      269 343)   PrintSummary(dsp)
a7114834 R/granovagg.ds.R      345 344) 
a7114834 R/granovagg.ds.R      346 345) 
863d348b R/granova.ds.ggplot.R 139 346) 
863d348b R/granova.ds.ggplot.R 140 347)   # Because of the way ggplot2 creates plot objects, layers can be
863d348b R/granova.ds.ggplot.R 141 348)   # added to a plot p simply by calling "p &lt;- p + newLayer"
863d348b R/granova.ds.ggplot.R 142 349) 
a7114834 R/granovagg.ds.R      351 350) 
3eb0e1f7 R/granova.ds.ggplot.R 142 351)   InitializeGgplot &lt;- function(dsp) {
c5a67319 R/granovagg.ds.R      345 352)     return(
c5a67319 R/granovagg.ds.R      346 353)       ggplot(
a7114834 R/granovagg.ds.R      355 354)         aes_string(x = dsp$data[1],
c5a67319 R/granovagg.ds.R      348 355)                    y = dsp$data[2]
c5a67319 R/granovagg.ds.R      349 356)         ), data = dsp$data
c5a67319 R/granovagg.ds.R      350 357)       )
c5a67319 R/granovagg.ds.R      351 358)     )
863d348b R/granova.ds.ggplot.R 152 359)   }
a7114834 R/granovagg.ds.R      361 360) 
794c4b70 R/granova.ds.ggplot.R 152 361)   TreatmentLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 146 362)     return(geom_abline(aes(intercept = intercept,
a71441d3 R/granova.ds.ggplot.R 147 363)                            slope     = slope,
a71441d3 R/granova.ds.ggplot.R 148 364)                            color     = color
a71441d3 R/granova.ds.ggplot.R 149 365)                           ),
fb9acd24 R/granova.ds.ggplot.R 149 366)                        alpha    = 0.5,
fb9acd24 R/granova.ds.ggplot.R 150 367)                        size     = I(1),
e883b72f R/granova.ds.ggplot.R 151 368)                        linetype = "dashed",
fb9acd24 R/granova.ds.ggplot.R 152 369)                        data     = dsp$treatment.line
a71441d3 R/granova.ds.ggplot.R 153 370)                       )
a71441d3 R/granova.ds.ggplot.R 154 371)           )
863d348b R/granova.ds.ggplot.R 166 372)   }
863d348b R/granova.ds.ggplot.R 167 373) 
794c4b70 R/granova.ds.ggplot.R 166 374)   RawData &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 158 375)     return(geom_point(size = dsp$params$point.size))
863d348b R/granova.ds.ggplot.R 173 376)   }
863d348b R/granova.ds.ggplot.R 174 377) 
3eb0e1f7 R/granova.ds.ggplot.R 173 378)   IdentityLine &lt;- function() {
a7114834 R/granovagg.ds.R      380 379)     return(geom_abline(slope     = 1,
a71441d3 R/granova.ds.ggplot.R 163 380)                        intercept = 0,
958f0c6c R/granova.ds.ggplot.R 164 381)                        alpha     = 0.75,
958f0c6c R/granova.ds.ggplot.R 165 382)                        size      = 1
a71441d3 R/granova.ds.ggplot.R 165 383)                       )
a71441d3 R/granova.ds.ggplot.R 166 384)           )
863d348b R/granova.ds.ggplot.R 183 385)   }
863d348b R/granova.ds.ggplot.R 184 386) 
794c4b70 R/granova.ds.ggplot.R 183 387)   ScaleX &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 170 388)     return(scale_x_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 187 389)   }
863d348b R/granova.ds.ggplot.R 188 390) 
794c4b70 R/granova.ds.ggplot.R 187 391)   ScaleY &lt;- function(dsp) {
48638496 R/granova.ds.ggplot.R 174 392)     return(scale_y_continuous(limits = dsp$params$bounds))
863d348b R/granova.ds.ggplot.R 191 393)   }
a7114834 R/granovagg.ds.R      395 394) 
0ae8f524 R/granovagg.ds.R      396 395)   PadViewingWindow &lt;- function(params) {
0ae8f524 R/granovagg.ds.R      397 396)     ne.offset = params$square.data.range * southwest.padding
0ae8f524 R/granovagg.ds.R      398 397)     sw.offset = params$square.data.range * northeast.padding
0ae8f524 R/granovagg.ds.R      399 398)     padded.window = c(params$bounds[1] - sw.offset, params$bounds[2] + ne.offset)
a7114834 R/granovagg.ds.R      400 399) 
0ae8f524 R/granovagg.ds.R      401 400)     return(
0ae8f524 R/granovagg.ds.R      402 401)       coord_cartesian(xlim = padded.window,
0ae8f524 R/granovagg.ds.R      403 402)                       ylim = padded.window
0ae8f524 R/granovagg.ds.R      404 403)       )
0ae8f524 R/granovagg.ds.R      405 404)     )
a7114834 R/granovagg.ds.R      406 405)   }
863d348b R/granova.ds.ggplot.R 192 406) 
794c4b70 R/granova.ds.ggplot.R 191 407)   RugPlot &lt;- function(dsp) {
1656d5b5 R/granovagg.ds.R      409 408)     return(
1656d5b5 R/granovagg.ds.R      410 409)       geom_rug(
1656d5b5 R/granovagg.ds.R      411 410)         size  = I(1/2),
1656d5b5 R/granovagg.ds.R      412 411)         alpha = I(1/3),
1656d5b5 R/granovagg.ds.R      413 412)         color = dsp$colors$rugplot,
1656d5b5 R/granovagg.ds.R      414 413)         sides = "tr", # top and right sides
1656d5b5 R/granovagg.ds.R      415 414)         data  = dsp$data
1656d5b5 R/granovagg.ds.R      416 415)       )
1656d5b5 R/granovagg.ds.R      417 416)     )
863d348b R/granova.ds.ggplot.R 202 417)   }
863d348b R/granova.ds.ggplot.R 203 418) 
794c4b70 R/granova.ds.ggplot.R 202 419)   XMeanLine &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 187 420)     return(geom_vline(xintercept = mean(GetXs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 188 421)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 189 422)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 191 423)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 190 424)                       alpha      = I(1/2)
a7114834 R/granovagg.ds.R      423 425)                      )
a71441d3 R/granova.ds.ggplot.R 192 426)           )
863d348b R/granova.ds.ggplot.R 213 427)   }
a7114834 R/granovagg.ds.R      426 428) 
794c4b70 R/granova.ds.ggplot.R 213 429)   YMeanLine &lt;- function(dsp)  {
a71441d3 R/granova.ds.ggplot.R 196 430)     return(geom_hline(yintercept = mean(GetYs(dsp$data)),
a71441d3 R/granova.ds.ggplot.R 197 431)                       color      = dsp$colors$mean.line,
48638496 R/granova.ds.ggplot.R 198 432)                       size       = dsp$params$mean.line.size,
97cf9e88 R/granova.ds.ggplot.R 201 433)                       linetype   = "dashed",
a71441d3 R/granova.ds.ggplot.R 199 434)                       alpha      = I(1/2)
a7114834 R/granovagg.ds.R      433 435)                      )
a71441d3 R/granova.ds.ggplot.R 201 436)           )
a7114834 R/granovagg.ds.R      435 437) 
863d348b R/granova.ds.ggplot.R 225 438)   }
863d348b R/granova.ds.ggplot.R 226 439) 
794c4b70 R/granova.ds.ggplot.R 225 440)   Crossbow &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 206 441)     return(geom_segment(aes(x    = x,
a71441d3 R/granova.ds.ggplot.R 207 442)                             y    = y,
a71441d3 R/granova.ds.ggplot.R 208 443)                             xend = x.end,
a71441d3 R/granova.ds.ggplot.R 209 444)                             yend = y.end
a7114834 R/granovagg.ds.R      443 445)                            ),
a71441d3 R/granova.ds.ggplot.R 211 446)                         size  = I(3/4),
a71441d3 R/granova.ds.ggplot.R 212 447)                         alpha = I(3/4),
a71441d3 R/granova.ds.ggplot.R 213 448)                         color = dsp$colors$crossbow,
a71441d3 R/granova.ds.ggplot.R 214 449)                         data  = dsp$crossbow
a7114834 R/granovagg.ds.R      448 450)                        )
a71441d3 R/granova.ds.ggplot.R 216 451)           )
863d348b R/granova.ds.ggplot.R 242 452)   }
863d348b R/granova.ds.ggplot.R 243 453) 
794c4b70 R/granova.ds.ggplot.R 242 454)   CIBand &lt;- function(dsp) {
7f8f9355 R/granovagg.ds.R      309 455)     return(geom_segment(aes(x     = x,
7f8f9355 R/granovagg.ds.R      310 456)                             y     = y,
0d72518f R/granovagg.ds.R      303 457)                             xend  = x.end,
a7114834 R/granovagg.ds.R      456 458)                             yend  = y.end,
a71441d3 R/granova.ds.ggplot.R 224 459)                             color = color
a7114834 R/granovagg.ds.R      458 460)                            ),
a71441d3 R/granova.ds.ggplot.R 226 461)                         size = I(2),
a71441d3 R/granova.ds.ggplot.R 227 462)                         data = dsp$CIBand
a71441d3 R/granova.ds.ggplot.R 228 463)                        )
a71441d3 R/granova.ds.ggplot.R 229 464)           )
863d348b R/granova.ds.ggplot.R 258 465)   }
863d348b R/granova.ds.ggplot.R 259 466) 
794c4b70 R/granova.ds.ggplot.R 258 467)   Shadows &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 233 468)     return(geom_point(aes(x = x.shadow,
a71441d3 R/granova.ds.ggplot.R 234 469)                           y = y.shadow
a71441d3 R/granova.ds.ggplot.R 235 470)                          ),
a7114834 R/granovagg.ds.R      469 471)                       data  = dsp$shadow,
48638496 R/granova.ds.ggplot.R 237 472)                       size  = dsp$params$point.size,
72c2ef7a R/granova.ds.ggplot.R 241 473)                       shape = 16,
a7114834 R/granovagg.ds.R      472 474)                       alpha = I(1/2)
a71441d3 R/granova.ds.ggplot.R 239 475)                      )
a71441d3 R/granova.ds.ggplot.R 240 476)           )
863d348b R/granova.ds.ggplot.R 272 477)   }
863d348b R/granova.ds.ggplot.R 273 478) 
794c4b70 R/granova.ds.ggplot.R 272 479)   Trails &lt;- function(dsp) {
a71441d3 R/granova.ds.ggplot.R 244 480)     return(geom_segment(aes(x    = x.trail.start,
a71441d3 R/granova.ds.ggplot.R 245 481)                             y    = y.trail.start,
a71441d3 R/granova.ds.ggplot.R 246 482)                             xend = x.trail.end,
a71441d3 R/granova.ds.ggplot.R 247 483)                             yend = y.trail.end
a71441d3 R/granova.ds.ggplot.R 248 484)                            ),
a71441d3 R/granova.ds.ggplot.R 249 485)                         data     = dsp$trails,
a71441d3 R/granova.ds.ggplot.R 250 486)                         size     = I(1/3),
a71441d3 R/granova.ds.ggplot.R 251 487)                         color    = "black",
a71441d3 R/granova.ds.ggplot.R 252 488)                         linetype = 1,
a7114834 R/granovagg.ds.R      487 489)                         alpha    = I(1/10)
a7114834 R/granovagg.ds.R      488 490)                        )
a71441d3 R/granova.ds.ggplot.R 255 491)           )
863d348b R/granova.ds.ggplot.R 290 492)   }
863d348b R/granova.ds.ggplot.R 291 493) 
ef841aa1 R/granova.ds.ggplot.R 257 494)   ColorScale &lt;- function(dsp) {
e603b053 R/granova.ds.ggplot.R 291 495)     colors &lt;- c(dsp$colors$treatment.line, dsp$colors$CIBand)
a7114834 R/granovagg.ds.R      494 496) 
52d9cc47 R/granovagg.ds.R      495 497)     return(scale_color_manual(values = colors, name = ""))
863d348b R/granova.ds.ggplot.R 296 498)   }
863d348b R/granova.ds.ggplot.R 297 499) 
0afa3a38 R/granovagg.ds.R      306 500)   XLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      316 501)     result &lt;- colnames(dsp$data)[1]
0afa3a38 R/granovagg.ds.R      308 502)     if(!is.null(xlab)) {
0afa3a38 R/granovagg.ds.R      309 503)       result &lt;- xlab
0afa3a38 R/granovagg.ds.R      310 504)     }
a7114834 R/granovagg.ds.R      503 505) 
0afa3a38 R/granovagg.ds.R      312 506)     return(xlab(result))
0afa3a38 R/granovagg.ds.R      313 507)   }
a7114834 R/granovagg.ds.R      506 508) 
485d5f02 R/granovagg.ds.R      317 509)   YLabel &lt;- function(dsp) {
5ede31eb R/granovagg.ds.R      325 510)     result &lt;- colnames(dsp$data)[2]
485d5f02 R/granovagg.ds.R      319 511)     if(!is.null(ylab)) {
485d5f02 R/granovagg.ds.R      320 512)       result &lt;- ylab
485d5f02 R/granovagg.ds.R      321 513)     }
a7114834 R/granovagg.ds.R      512 514) 
485d5f02 R/granovagg.ds.R      323 515)     return(ylab(result))
485d5f02 R/granovagg.ds.R      324 516)   }
a7114834 R/granovagg.ds.R      515 517) 
74d74c41 R/granovagg.ds.R      516 518)   Title &lt;- function(main) {
74d74c41 R/granovagg.ds.R      517 519)     output.title &lt;- "Dependent Sample Assessment Plot"
74d74c41 R/granovagg.ds.R      518 520)     if (main != "default_granova_title") {
74d74c41 R/granovagg.ds.R      519 521)       output.title &lt;- main
a2b6fe7d R/granovagg.ds.R      319 522)     }
a7114834 R/granovagg.ds.R      520 523) 
74d74c41 R/granovagg.ds.R      522 524)     return(
74d74c41 R/granovagg.ds.R      523 525)       ggtitle(output.title)
74d74c41 R/granovagg.ds.R      524 526)     )
74d74c41 R/granovagg.ds.R      525 527) 
863d348b R/granova.ds.ggplot.R 304 528)   }
a7114834 R/granovagg.ds.R      525 529) 
b5b60529 R/granova.ds.ggplot.R 271 530)   ForceCoordinateAxesToBeEqual &lt;- function() {
9d259747 R/granovagg.ds.R      527 531)     return(coord_fixed(ratio = 1))
b5b60529 R/granova.ds.ggplot.R 273 532)   }
a7114834 R/granovagg.ds.R      529 533) 
a7114834 R/granovagg.ds.R      530 534) 
3eb0e1f7 R/granova.ds.ggplot.R 304 535)   p &lt;- InitializeGgplot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 305 536)   p &lt;- p + TreatmentLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 306 537)   p &lt;- p + XMeanLine(dsp) + YMeanLine(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 307 538)   p &lt;- p + Shadows(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 308 539)   p &lt;- p + Trails(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 309 540)   p &lt;- p + RawData(dsp)
3a2f0d25 R/granova.ds.ggplot.R 278 541)   p &lt;- p + Theme(plot.theme)
3eb0e1f7 R/granova.ds.ggplot.R 311 542)   p &lt;- p + IdentityLine()
3eb0e1f7 R/granova.ds.ggplot.R 312 543)   p &lt;- p + RugPlot(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 313 544)   p &lt;- p + Crossbow(dsp)
863d348b R/granova.ds.ggplot.R 316 545)   p &lt;- p + CIBand(dsp)
ef841aa1 R/granova.ds.ggplot.R 287 546)   p &lt;- p + ColorScale(dsp)
3eb0e1f7 R/granova.ds.ggplot.R 316 547)   p &lt;- p + ScaleX(dsp) + ScaleY(dsp)
0ae8f524 R/granovagg.ds.R      545 548)   p &lt;- p + PadViewingWindow(dsp$params)
9d259747 R/granovagg.ds.R      545 549)   p &lt;- p + ForceCoordinateAxesToBeEqual()
74d74c41 R/granovagg.ds.R      548 550)   p &lt;- p + Title(main)
0afa3a38 R/granovagg.ds.R      345 551)   p &lt;- p + XLabel(dsp)
485d5f02 R/granovagg.ds.R      357 552)   p &lt;- p + YLabel(dsp)
e589a242 R/granova.ds.bd.R     316 553) 
482de62f R/granovagg.ds.R      528 554)   return(p)
5d58b37c R/granova.ds.bd.R     314 555) 
b3a74c98 R/granova.ds.bd.R     301 556) }
</pre>
<div class="compileroutput">
remove geom_rug_alt<p>Whitespace changes<br>
</p><p><br>
</p></div>
</td>
</tr></tbody></table>
</body></html>